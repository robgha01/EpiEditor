//>>built
define("epi-cms/activity/viewmodels/_ActivityViewModel",["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_9],{activityService:null,editLabel:_b.edit,comment:null,sendLabel:_b.post,resetLabel:_b.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_c.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_7.resolve("epi.cms.ActivityService");this.profile=this.profile||_7.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_7.resolve("epi.storeregistry").get("epi.cms.notification.users");},getComment:function(){var _d=this.comment;if(!_d){return "";}return _8.toHTML(this._formatText(_d));},save:function(_e){var _f=this._save(_e);_f.otherwise(this._handleError.bind(this));return _f;},_save:function(_10){},_formatText:function(_11){var map=_6.html;_11=_11&&_6.encode(_11,map);_11=_11&&_11.replace(/(\\n)/ig,"");return _11;},_handleError:function(){this.set("errorMessage",_a.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_12){this.message=_12;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _13=this._formatText(this.message);if(!_13||!this.notificationUserStore){return new _2().resolve(_8.toHTML(_13));}var _14=/\B@([^\s":;|=,+*?<>[\]\/\\]+)/g,_15=_13.match(_14)||[],_16={},_17=_15.map(function(_18){var _19=_18.replace(/^@/,""),_1a=encodeURIComponent(_19);return _5(this.notificationUserStore.get(_1a)).then(function(_1b){_16[_19]=_1b.displayName;}).otherwise(function(){});}.bind(this));return _3(_17).then(function(){_13=_13.replace(_14,function(_1c,key){return _16[key]?"<strong>"+_8.encodeForWebString(_16[key])+"</strong>":_1c;});return _8.toHTML(_13);});}});});