//>>built
define("epi-cms/activity/ActivityFeed",["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","epi/debounce","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","epi-cms/activity/Activity","epi-cms/activity/ActivityCommentForm"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){var _13=_1([_e,_f,_10]);return _1([_a,_b,_c,_d],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _12({model:this.model});_3.add(this.commentForm.domNode,"epi-card");this.list=new _13({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_2.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_6.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_renderRow:function(_14){var _15=new _11({activity:_14});_3.add(_15.domNode,"epi-card");return _15.domNode;},_resizeList:function(_16){return function(){_16.apply(this.list,arguments);var _17=this.model.isSingleItemSelected?_4.getMarginBox(this.commentForm.domNode).h:0;_5.set(this.list.contentNode,"height","calc(100% - "+_17+"px)");}.bind(this);},_setNoDataMessageAttr:function(_18){this.noDataMessage=_18;this.list.set("noDataMessage",_18);},_setQueryAttr:function(_19){this._set("query",_19);if(!this._queryFunction){this._queryFunction=_8(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,_19);},_setQueryCallback:function(_1a,_1b){if(this._destroyed){return;}var _1c=this.model.isSingleItemSelected;_3.toggle(this.domNode,"epi-activity-feed--single-item",_1c);_3.toggle(this.commentForm.domNode,"dijitHidden",!_1c);if(_1b){this.list.set("store",_1a,_1b,this.queryOptions);}else{this.list.set("store",null);}this.list.resize();}});});