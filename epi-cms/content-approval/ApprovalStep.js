//>>built
require({cache:{"url:epi-cms/content-approval/templates/ApprovalStep.html":"<div class=\"epi-approval-step\">\r\n    <div class=\"epi-approval-step__header\">\r\n        <div class=\"dijitInline dojoDndHandle\">\r\n            <span class=\"dijitInline epi-iconDnD\"></span>\r\n        </div>\r\n        <div placeholder=\"${resources.header.placeholder}\" title=\"${resources.header.tooltip}\" data-dojo-attach-point=\"headerTextbox\" data-dojo-type=\"dijit/form/TextBox\"></div>\r\n        <div class=\"dijitInline\" data-dojo-attach-point=\"removeNode\"></div>\r\n    </div>\r\n    <div class=\"epi-approval-step__container\">\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n        <div class=\"epi-reviewer__add\">\r\n            <span class=\"dijitInline dijitIcon epi-iconUser\"></span>\r\n            <div class=\"dijitInline\" data-dojo-attach-point=\"searchNode\"></div>\r\n        </div>\r\n    </div>\r\n    <div class=\"epi-approval-step__add-step\" data-dojo-attach-point=\"arrowNode\"></div>\r\n</div>\r\n"}});define("epi-cms/content-approval/ApprovalStep",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","epi-cms/content-approval/viewmodels/ReviewerViewModel","./ApprovalEnums","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/Formatter","dgrid/Keyboard","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","dijit/form/ComboBox","./Reviewer","dojo/text!./templates/ApprovalStep.html","epi/i18n!epi/nls/episerver.cms.contentapproval.step","dijit/form/TextBox"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18){var _19=_1([_e,_11,_12,_10,_f,_13]);var _1a=_1([_14],{labelType:"html",_onKey:function(evt){if(evt.keyCode===_5.UP_ARROW&&!this._opened){this.onMoveUp(evt);return;}if(evt.keyCode===_5.ENTER&&this._hasSuggestions()&&this._hasNoItemSelected()){this.set("item",this.dropDown.items[0]);}this.inherited(arguments);},labelFunc:function(_1b){var _1c="<span class=\"dijitInline dijitIcon {icon}\"></span>{displayName}";var _1d=new _8(_1b);return _2.replace(_1c,{icon:_1d.get("icon"),displayName:_1d.get("displayName")});},onMoveUp:function(){},_hasSuggestions:function(){return this._opened&&!!this.get("value")&&this.dropDown.items.length>0;},_hasNoItemSelected:function(){return !this.item;}});return _1([_a,_b,_c,_d],{model:null,modelBindingMap:{isReadOnly:["isReadOnly"],isValid:["isValid"]},templateString:_16,resources:_17,buildRendering:function(){this.inherited(arguments);var _1e=this.model.get("reviewers");this.headerTextbox.set("value",this.model.name);this.list=new _19({className:"epi-chromeless",maintainOddEven:false,store:_1e,sort:"default",renderRow:this._renderReviewer.bind(this)},this.listNode);this.own(this.list.addKeyHandler(_5.DOWN_ARROW,function(evt){evt.stopPropagation();if(evt.target===evt.currentTarget.lastElementChild){this.searchBox.focus();}}.bind(this)),this.list.addKeyHandler(_5.UP_ARROW,function(evt){evt.stopPropagation();}),this.headerTextbox.on("change",function(_1f){this.model.set("name",_1f);}.bind(this)));var _20={"class":"epi-approval-step__add-step__button",showLabel:false,tabIndex:-1},_21=new _6({settings:_20}),_22=[{category:"add",builder:_21,target:this.arrowNode},{category:"remove",builder:_21,target:this.removeNode}];new _7({configuration:_22,commandSource:this});var _23=this.model.get("userStore");this.searchBox=new _1a({labelAttr:"displayName",queryExpr:"${0}",query:{includeRoles:true},store:_23,searchAttr:"name",autoComplete:false,maxHeight:294},this.searchNode);this.own(_3.before(this.searchBox,"onSearch",this._searchBoxOnSearch.bind(this)),this.searchBox.on("change",this._searchBoxOnChange.bind(this)),this.searchBox.on("moveUp",function(evt){_11.moveFocusEnd.call(this.list,evt);}.bind(this)),this.searchBox.on("keypress",function(evt){evt.stopPropagation();}));},_renderReviewer:function(_24){var _25=new _15({model:_24,languageOptions:this.languageOptions});this.own(_25.on("remove-reviewer",function(_26){this.model.removeReviewer(_26);}.bind(this)));return _25.domNode;},_searchBoxOnSearch:function(_27,_28,_29){_27=this.model.filterOutExistingUsers(_27);return [_27,_28,_29];},_searchBoxOnChange:function(_2a){if(!_2a||!this.searchBox.item){return;}this.model.addReviewer(this.searchBox.item);this.searchBox.set("value","");},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.searchBox.startup();this.list.contentNode.tabIndex=-1;},getCommands:function(){return this.model.get("commands");},_setIsReadOnlyAttr:function(_2b){this._set("isReadOnly",_2b);_4.toggle(this.domNode,"epi-approval-step--read-only",_2b);this.headerTextbox.set({readOnly:_2b,tabIndex:_2b?-1:0});},_setIsValidAttr:function(_2c){this._set("isValid",_2c);var _2d=!_2c&&this.model.get("showValidations");var _2e=this.model.hasErrors();_4.toggle(this.domNode,"epi-approval-step--error",_2d&&_2e);_4.toggle(this.domNode,"epi-approval-step--warning",_2d&&(!_2e&&this.model.hasWarnings()));}});});