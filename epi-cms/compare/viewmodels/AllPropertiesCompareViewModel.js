//>>built
define("epi-cms/compare/viewmodels/AllPropertiesCompareViewModel",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi","epi/dependency","epi/string","epi-cms/core/ContentReference","dojo/Stateful","dijit/Destroyable"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1([_9,_a],{_metadataManager:null,contentViewModel:null,leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null,postscript:function(){this.inherited(arguments);this._metadataManager=this._metadataManager||_6.resolve("epi.shell.MetadataManager");this.initialize();},initialize:function(){var _b=_2.hitch(this,function(_c,_d,_e){var _f=this.model.rightVersion;if(!_f||(_d===_e)){return;}_4(this._metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:_f.contentLink}),_2.hitch(this,function(_10){this.set("rightMetadata",_10);}));});_b("rightVersionContentLink",null,this.model.rightVersionContentLink);this.own(this.model.watch("rightVersionContentLink",_b),this.model.watch("contentLink",_2.hitch(this,function(_11,_12,_13){if(!_8.compareIgnoreVersion(_12,_13)){this.set({leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null});}})));},generateComparison:function(){var _14={},_15=this.rightMetadata;if(!this.leftPropertyMap||!this.rightPropertyMap){this.set("comparison",null);return;}_15.groups.forEach(function(_16){_14[_16.name.toLowerCase()]=[];});_15.properties.forEach(_2.hitch(this,function(_17){this._addPropertyToComparison(_14,_17,_17.groupName);}));this.set("comparison",_14);},copy:function(_18){if(!_18){throw new Error("propertyName is required");}var _19=this.contentViewModel,_1a=_2.getObject(_18,false,this.rightPropertyMap);if(_19&&_1a!==undefined){_19.setProperty(_18,_2.clone(_1a));_19.save();}},_addPropertyToComparison:function(_1b,_1c,_1d,_1e){var _1f=_7.pascalToCamel((_1e||"")+_1c.name),_20=_2.getObject(_1f,false,this.leftPropertyMap),_21=_2.getObject(_1f,false,this.rightPropertyMap);if(_1c.showForEdit&&!_5.areEqual(_20,_21,_5.compareOptions.treatFalsyAsEquals|_5.compareOptions.skipEmptyProperties)){if(_1c.properties.length){_1c.properties.forEach(_2.hitch(this,function(_22){this._addPropertyToComparison(_1b,_22,_1d,_1f+".");}));}else{_1b[_1d.toLowerCase()].push(_1f.toLowerCase());}}},_contentViewModelSetter:function(_23){this.contentViewModel=_23;this.set({leftMetadata:_23.metadata,leftPropertyMap:_23.contentData.properties});this.own(_23.watch("contentData",_2.hitch(this,function(_24,_25,_26){this.set("leftPropertyMap",_26.properties);})),_3.after(_23,"onPropertySaved",_2.hitch(this,"_onPropertySaved"),true));},_leftPropertyMapSetter:function(_27){this.leftPropertyMap=_2.clone(_27);this.generateComparison();},_rightPropertyMapSetter:function(_28){this.rightPropertyMap=_2.clone(_28);this.generateComparison();},_rightMetadataSetter:function(_29){this.rightMetadata=_29;if(this.rightMetadata){_4(this.model.contentDataStore.get(this.model.rightVersion.contentLink)).then(_2.hitch(this,function(_2a){this.set("rightPropertyMap",_2a.properties);}));}},_onPropertySaved:function(_2b,_2c){var _2d=this.comparison;if(this.leftPropertyMap){_2.setObject(_2b,_2c,this.leftPropertyMap);}if(!_2d){return;}var _2e=this.rightMetadata.getPropertyMetadata(_2b.split(".")[0]),_2f=this.rightMetadata.getPropertyMetadata(_2b),_30=this.rightPropertyMap&&_2.getObject(_2b,false,this.rightPropertyMap);if(!_2f.showForEdit){return;}var _31=_2d[_2e.groupName.toLowerCase()],_32=_2b.toLowerCase(),_33=_31.indexOf(_32),_34=_5.areEqual(_2c,_30,_5.compareOptions.treatFalsyAsEquals|_5.compareOptions.skipEmptyProperties);if(_33>=0&&_34){_31.splice(_33,1);}else{if(_33<0&&!_34){_31.splice(0,0,_32);}}this.set("comparison",_2d);}});});