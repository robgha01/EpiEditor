//>>built
define("epi-cms/widget/viewmodel/ContentReferencesViewModel",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/store/util/QueryResults","dojo/when","epi/shell/TypeDescriptorManager","dojo/Stateful","dijit/Destroyable","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_7,_8],{contentItems:null,mode:null,notification:null,notificationBarStyle:null,numberOfReferences:null,showToolbar:null,showGrid:null,totalLinks:null,getUpdatedStore:function(_a){var _b=_2.delegate(_a,{getChildren:function(_c){return new _4(_c.references);},mayHaveChildren:function(_d){return !!_d.references&&_d.references.length>0;}});this.own(_3.after(_b,"query",function(_e){_5(_e).then(this._afterStoreQuery.bind(this));return _e;}.bind(this)));return _b;},_afterStoreQuery:function(_f){var _10=this._getReferencesCount(_f);this._updateReferenceProperties(_10);this.set("showToolbar",_10>0);this.set("showGrid",_10>0);},_getReferencesCount:function(_11){return _11.reduce(function(_12,_13){return _12+_13.references.length;},0);},_updateReferenceProperties:function(_14){var _15=this.contentItems,_16=_15[0],_17=_14>0,_18=_15.length===1,_19=_15.some(function(_1a){return _1a.hasChildren;}),_1b=_15.some(function(_1c){return !!_1c.publicUrl;});var _1d=function(_1e,_1f){_1e="reference."+(_18?"single":"multiple")+"."+_1e;var _20=_6.getResourceValue(_16.typeIdentifier,_1e);this.set("notification",_20);this.set("notificationBarStyle",_1f);}.bind(this);if(_17){_1d(_19?"usedwithchildren":"used",2);}else{if(_1b){_1d(_19?"publicwithchildren":"public",2);}else{_1d(_19?"notusedwithchildren":"notused",_19?2:1);}}if(_17){var _21=_14===1?_9.totallink:_9.totallinks;var _22=_2.replace(_21,[_14]);this.set("totalLinks",_22);}this.set("numberOfReferences",_14);}});});