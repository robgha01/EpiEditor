//>>built
define("epi-cms/widget/viewmodel/ContentTypeListViewModel",["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/when","dojo/Stateful","epi/dependency"],function(_1,_2,_3,_4,_5,_6,_7){return _2([_6],{store:null,parentLink:null,groups:null,requestedType:null,allowedTypes:null,restrictedTypes:null,contentTypeService:null,localAsset:false,otherTypesTitle:null,postscript:function(){this.inherited(arguments);this.groups={};this.contentTypeService=this.contentTypeService||_7.resolve("epi.cms.ContentTypeService");if(!this.store){var _8=_7.resolve("epi.storeregistry");this.store=_8.get("epi.cms.contenttype");}},getSortedSuggestedContentTypes:function(){return _5(this._getSuggestedContentTypes(this.requestedType)).then(function(_9){if(_9.length>1){this._sortContentTypes(_9);}return _9;}.bind(this));},getSortedGroupContentTypes:function(){return _5(this._groupContentTypes()).then(function(_a){var _b=_a.grouped;for(var _c in _b){this._sortContentTypes(_b[_c]);}return _a;}.bind(this));},clear:function(){for(var _d in this.groups){this.groups[_d].destroyRecursive();delete this.groups[_d];}},_getAvailableContentTypes:function(_e){return this.contentTypeService.getAcceptedChildTypes(this.parentLink,this.localAsset,[_e],this.allowedTypes,this.restrictedTypes);},_getSuggestedContentTypes:function(_f){var _10=this.store.query({query:"getsuggestedcontenttypes",localAsset:this.localAsset,parentReference:this.parentLink,requestedTypes:[_f]});return this.contentTypeService.filterQueryResult(_10,this.allowedTypes,this.restrictedTypes);},_groupContentTypes:function(){var _11={},_12=new _3(),_13=this.otherTypesTitle;_5(this._getAvailableContentTypes(this.requestedType)).then(function(_14){var _15=_14.length;_1.forEach(_14,function(_16){_5(_16,function(_17){var _18=_17.groupName||_13,_19=_11[_18]||[];_19.push(_17);_11[_18]=_19;_15--;if(_15===0){_12.resolve({grouped:_11,contentTypes:_14});}});});}.bind(this));return _12;},_sortContentTypes:function(_1a){if(_1a&&_1a.length>1){_1a.sort(function(a,b){return a.localizedName<=b.localizedName?-1:1;});}}});});