//>>built
define("epi-cms/widget/MediaSelector",["dojo/_base/declare","dojo/dom-style","dojo/topic","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/widget/ContentSelector","epi-cms/ApplicationSettings","epi-cms/component/Media"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=_1([_a,_5],{componentId:"SelectableMediaComponent",root:_9.rootPage,additionalTreeClass:"",postMixInProperties:function(){this.inherited(arguments);this.model.containedTypes=this.allowedTypes;this.model.changeContextOnItemSelection=false;this.model.treeStoreModel.forThisFolderEnabled=this._currentContext.currentMode!=="create";this.own(_3.subscribe("/epi/cms/upload",this._focusGrid.bind(this)));},_getValueAttr:function(){return this.model.selection.data[0].data.contentLink;},_setValueAttr:function(_c){this._set("value",_c);if(_c){this.model.selectItemsByContentReference(_c,true);this._focusGrid();}else{this.model.set("treePaths",null);}},_focusGrid:function(){this._focusManager.focus(this.list.grid.domNode);}});return _1([_8,_5],{contentClass:"epi-wrapped epi-mediaSelector",dialogClass:null,createDialogContent:function(){var _d=new _b({repositoryKey:this.repositoryKey,allowedTypes:this.allowedTypes});_d.list.set("selectionMode","single");_d.searchResultList.set("selectionMode","single");_d.resize({h:370,w:680,l:0,t:0});_d.tree.set({region:"left",splitter:true});_2.set(_d.tree.domNode,"width","250px");_d.listContainer.set({region:"center",splitter:false});this.own(_d.model.selection.watch("data",this._dataChanged.bind(this)));return _d;},contextChanged:function(){if(this.dialog){this.dialog.hide();}},setInitialValue:function(){_4(this.getCurrentContent()).then(function(_e){var _f;if(this._currentContext.currentMode==="create"){_f=_9.globalAssetsFolder;}else{_f=new _7(_e.assetsFolderLink).createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_f);}.bind(this));},_dataChanged:function(_10,_11,_12){if(!_12||_12.length!==1||!_12[0].data||!this.allowedTypes.some(function(_13){return _6.isBaseTypeIdentifier(_12[0].data.typeIdentifier,_13);})){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}this._setDialogButtonState(_12[0].data.contentLink);}});});