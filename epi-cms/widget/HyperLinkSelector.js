//>>built
require({cache:{"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}\" title=\"${title}\">${label}</label>\r\n</div>"}});define("epi-cms/widget/HyperLinkSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","dijit/form/ValidationTextBox","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16){return _2([_b,_c,_10],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_13,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _17=_2(this.modelClassName);this.model=new _17({providers:this.providers});}this._languageStore=this._languageStore||_e.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();this._createRemainingUrlInput();},startup:function(){this.inherited(arguments);this._languageSelector.startup();this._remainingUrl.startup();var _18=this,_19=this._languageSelector;_8(this._languageStore.get(),function(_1a){if(_18.get("showLanguageSelector")){if(_1a.length<=1){_18._toggleLanguageSelector(false);}else{_18._toggleLanguageSelector(true);}}var _1b=_1a.map(function(_1c){return {text:_1c.name,value:_1c.languageId};});_1b.splice(0,0,{text:_15.automaticlanguage,value:""});_19.set("selections",_1b);_19.set("value","");return _18._createInputWrappers();}).then(function(){_7.place(this._remainingUrlWrapperNode,this.domNode,"last");}.bind(this));},onSelectorsCreated:function(_1d){},_setShowLanguageSelectorAttr:function(_1e){this._set("showLanguageSelector",_1e);this._toggleLanguageSelector(_1e);},_setSelectedWrapperAttr:function(_1f){if(!_1f){return;}_1.forEach(this.wrappers,function(_20){_20.set("selected",false);});_1f.set("selected",true);this._languageSelector.set("disabled",!_1f.settings.isContentLink);_6.toggle(this._remainingUrlWrapperNode,"dijitHidden",!_1f.settings.isContentLink);},_createLanguageSelector:function(){this.own(this._languageSelector=new _12());this._languageSelectorWrapperNode=_7.toDom(_a.substitute(_16,{id:this._languageSelector.id,label:_15.language,title:""}));_7.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_createRemainingUrlInput:function(){this.own(this._remainingUrl=new _d({}));this._remainingUrlWrapperNode=_7.toDom(_a.substitute(_16,{id:this._remainingUrl.id,label:_15.remainingurl,title:_15.remainingurltitle}));this._remainingUrl.placeAt(this._remainingUrlWrapperNode,"last");},_toggleLanguageSelector:function(_21){_6.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_21);},_createInputWrappers:function(){var _22=this.model.wrapperSettings,_23=[],_24=this;_22.forEach(function(_25){var def=new _4();_23.push(def.promise);require([_25.widgetType],function(_26){var _27=new _11(_3.mixin(_25,{groupName:_25.groupName+this.id,inputWidgetCtor:_26,required:_24.required}));_24.own(_27.on("radioButtonChange",_3.hitch(this,function(){_24.set("selectedWrapper",_27);_27.focus();})));if(_25.invisible){_5.set(_27.domNode,{display:"none"});}def.resolve(_27);});},this);return _8(_9(_23),function(_28){if(_28.length===0){return;}_28.forEach(function(_29){_24.addChild(_29);});_24.set("wrappers",_28);var _2a=_24.get("value");if(_2a){_24._setValueForWidgets(_2a);}else{_24.set("selectedWrapper",_28[0]);}_24.onSelectorsCreated(_24);});},_getSelectedWrapper:function(){return _1.filter(this.wrappers,function(_2b){return _2b.get("selected");})[0];},_getValueAttr:function(){var _2c=this._getSelectedWrapper();if(_2c){if(_2c.inputWidget&&_2c.settings.isContentLink){return this.model.getUrlValue(_2c.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this._remainingUrl.get("value"),this.value);}else{return _2c.get("value");}}return this.value;},_setValueAttr:function(_2d){var _2e=function(_2f){this._set("value",_2f);this._remainingUrl.set("value",this.model.getRemainingUrl(_2f));this._setValueForWidgets(_2f);};if(_2d){this.model.getPermanentLink(_2d).then(_2e.bind(this));}else{_2e.call(this,_2d);}},_setValueForWidgets:function(_30){var _31=this.get("wrappers");if(!_31){return;}_1.forEach(_31,function(_32){_32.set("value",null);});if(!_30){return;}var url=new _f(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));_8(this.model.getContentData(_30),_3.hitch(this,function(_33){if(_33){_1.every(_31,function(_34){if(_34&&_34.settings.isContentLink){if(_1.some(_34.settings.allowedTypes,_3.hitch(this,function(_35){return this.model.isBaseTypeIdentifier(_33.typeIdentifier,_35);}))){_34.set("value",_33.contentLink);this.set("selectedWrapper",_34);return false;}}return true;},this);}else{_1.every(_31,function(_36){if(_36&&!_36.settings.isContentLink){var _37=_36.inputWidget;if(_37&&this._isValidEditorWidget(_30,_37)&&_37.validator(_30,_37.constraints)){_36.set("value",_30);this.set("selectedWrapper",_36);return false;}}return true;},this);}}));},_isValidEditorWidget:function(_38,_39){if(_39 instanceof _14){return _f(_38).scheme==="mailto";}return true;},validate:function(){var _3a=this._getSelectedWrapper();if(_3a){_3a._hasBeenBlurred=this._hasBeenBlurred;return _3a.validate();}return false;},focus:function(){var _3b=this._getSelectedWrapper();if(_3b){_3b.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});