//>>built
require({cache:{"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>\r\n"}});define("epi-cms/widget/TrashItemList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,put,epi,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25,_26){return _2([_11,_12,_13,_b,_e,_21],{resources:_25,epi:epi,templateString:_26,_grid:null,_observers:{},_setQueryOptionsAttr:function(_27){this._set("queryOptions",_27);this._initialize();},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",_3.hitch(this,function(_28){this.emit("searchBoxChange",_28);}));},resize:function(){if(this._grid){var top=_7.position(this._grid.domNode).y;var _29=_7.position(_4.body()).h;_8.set(this._grid.domNode,"height",(_29-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_6.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},_createGrid:function(_2a,_2b){var _2c=_2([_16,_17,_18,_1d,_1a]);var _2d=new _2c({store:_2a,columns:{name:_19({field:"name",label:epi.resources.header.name,renderCell:_3.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_1e.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_1e.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _15({target:_2d.domNode,color:"#fff",zIndex:500}).placeAt(document.body);this._standby.startup();this.own(_9.after(_2d,"expand",function(_2e){var row=_2e.element?_2e:_2d.row(_2e),_2f=_c(row.element).parent()[0];if(_2f){_8.set(_2f,"height","");}},true));_9.after(_2d,"_processScroll",_3.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_9.before(_2d,"adjustRowIndices",function(_30){if(_30){_1.forEach(_c("div.dgrid-no-data",this.contentNode),function(div){_d.set(div,"");});}});_9.around(_2d,"insertRow",_3.hitch(this,this._aroundInsertRow));_9.before(_2d,"renderArray",_3.hitch(this,function(_31,_32,_33){var _34=this.queryOptions.query;if(_34&&_34.query==="searchdeletedcontent"){_31.map(function(_35){if(_35){_35.hasChildren=false;}});}}));if(_2b){_2d.set("queryOptions",_2b.options);_2d.set("query",_2b.query);}var _36="epi-dgrid-mouseover";_2d.on(_1b.enterRow,function(evt){_5.add(this,_36);});_2d.on(_1b.leaveRow,function(evt){_5.remove(this,_36);});_2d.on(".epi-gridRestoreAction:click",_3.hitch(this,function(evt){var row=_2d.row(evt);this.emit("restoreItem",row);}));_2d.on(".epi-gridDeleteAction:click",_3.hitch(this,function(evt){var row=_2d.row(evt);this.emit("deleteItem",row);}));_2d.on(".dgrid-column-action:keydown",_3.hitch(this,function(e){if(e.keyCode===_a.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=_2d.row(e);this.emit("restoreItem",row);}}));return _2d;},_renderTreeNode:function(_37,_38,td,_39){var _3a=_1e.htmlEncode(_24.title(_38,_37.contentLink,_37.contentTypeName));if(_37.thumbnailUrl){_6.create("img",{src:_37.thumbnailUrl+_f.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_6.place(_1e.ellipsis(_1e.htmlEncode(_38),_3a),td);}else{var _3b=_1f.getValue(_37.typeIdentifier,"iconClass")||"epi-iconObjectPage";_6.place(_1e.icon(_3b+" epi-objectIcon",_1e.ellipsis(_1e.htmlEncode(_38),_3a)),td);}},_renderActionMenu:function(_3c){var _3d=_3.replace("<a class=\"epi-gridAction epi-gridRestoreAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_25.restore.tooltip,label:_25.restore.label});var _3e=_3.replace("<a class=\"epi-gridAction epi-gridDeleteAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_25.singledelete.tooltip,label:_25.singledelete.label});return _3d+_3e;},_localizeDate:function(_3f){return _22.toUserFriendlyString(_3f);},_createUserFriendlyUsername:function(_40){return _23.toUserFriendlyString(_1e.htmlEncode(_40));},_showStandby:function(_41){if(!this._standby){return;}if(_41){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_25.trashitemempty+"</span></span>";},_aroundInsertRow:function(_42){return _3.hitch(this,function(_43,_44,_45,i,_46){var row=_42.apply(this._grid,arguments);if(_43&&_43.thumbnailUrl){_5.add(row,"epi-mediaContent");}return row;});}});});