//>>built
require({cache:{"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>"}});define("epi-cms/widget/CategorySelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/epi","epi/shell/widget/dialog/Dialog","./viewmodel/CategorySelectorViewModel","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,epi,_11,_12,_13,res){return _2([_a,_9,_b,_e,_10],{templateString:_13,localization:res,multiple:true,value:null,onChange:function(_14){},postMixInProperties:function(){this.inherited(arguments);this.model=new _12();this.own(this.model);},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(_15){if(!_3.isArray(_15)){_15=[_15];}var _16=_1.filter(_15,function(v){return !!v;});this._setValueAndFireOnChange(_16);if(_16.length>0){this._set("value",_16);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(_17){if(epi.areEqual(this.model.get("categories"),_17)){return;}this.model.set("categories",_17);this.onChange(this.model.get("categories"));this._updateDisplayNode();},_getValueAttr:function(){return this.model.get("categories");},_setReadOnlyAttr:function(_18){this._set("readOnly",_18);_7.set(this.button.domNode,"display",_18?"none":"");_5.toggle(this.domNode,"dijitReadOnly",_18);},focus:function(){this.button.focus();},isValid:function(){if(!this.required){return true;}var _19=this.get("value");return _19&&_19.length>0;},_createCategoryButton:function(_1a){if(_8("div[data-epi-category-id='"+_1a.id+"']",this.categoriesGroupContainer).length!==0){return;}var _1b=_6.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1c=_6.create("div",{"class":"dijitInline epi-resourceName"});var _1d=_6.create("div",{"class":"dojoxEllipsis",innerHTML:_1a.description});_6.place(_1d,_1c);_6.place(_1c,_1b);this._tooltip=new _d({connectId:_1d,label:this._getCategoryPath(_1a)});var _1e=_6.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_4.set(_1e,"data-epi-category-id",_1a.id);var _1f=_1e.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_1e,_1f,_3.hitch(this,this._onRemoveClick));_6.place(_1e,_1c);}else{_6.place(_6.create("span",{innerHTML:"&nbsp;"}),_1c);}_6.place(_1b,this.categoriesGroupContainer);},_getCategoryPath:function(_20){if(!_20.parentsNameCollection||_20.parentsNameCollection.length===1){return "";}var _21=_20.parentsNameCollection[1];for(var i=2;i<_20.parentsNameCollection.length;i++){_21=_21+"/"+_20.parentsNameCollection[i];}return _21;},_createNoCategoriesChosenSpan:function(){_6.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";this.model.refreshCategories().then(function(_22){if(!this.model.hasCategories()){this._createNoCategoriesChosenSpan();return;}_22.forEach(function(_23){this._createCategoryButton(_23);},this);}.bind(this));},_onRemoveClick:function(arg){if(!this.model.get("categories")){return;}var _24=parseInt(_4.get(arg.target,"data-epi-category-id"),10);var _25=this.model.get("categories").indexOf(_24);if(_25===-1){return;}var _26=_3.clone(this.model.get("categories"));_26.splice(_25,1);this.set("value",_26);},_getCategoriesParentsNameClone:function(){var _27={};_1.forEach(this.model.get("categories"),_3.hitch(this,function(_28){_27[_28]=this.model.get("categoriesParentsName")[_28];}));return _27;},_onShow:function(){this.categorySelectorDialog.set("value",_3.clone(this.model.get("categories")));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _29=this.categorySelectorDialog.get("value");this.set("value",_29);},_isEmptyArray:function(_2a){return !_2a||_2a.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _f({rootCategory:this.root});this.dialog=new _11({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});