//>>built
define("epi-cms/component/ContentNavigationTree",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/DialogService","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,res){return _3([_18,_f,_b,_10],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_15,nodeConstructor:_14,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _a();this.selection=new _c();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",_4.hitch(this,function(_20){_20?this._copyCommand.execute():this._cutCommand.execute();})),this.on("delete",_4.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("showContextMenu",this._showContextMenuFromKeyboard.bind(this)),this.on("select",_4.hitch(this,this._onTreeNodeClicked)),this.on("paste",function(){if(this._pasteCommand.get("canExecute")){this._pasteCommand.execute();}}.bind(this)));this.connect(this,"onClick","_onTreeNodeClicked");var _21=_4.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_21);this.subscribe("/dnd/cancel",_21);},_showContextMenuFromKeyboard:function(e){this._ensureContextMenu();this._contextMenu.forceOpen(e);},startup:function(){this.inherited(arguments);_7(this.getCurrentContext(),_4.hitch(this,function(_22){this.contextChanged(_22);}));},_preparePathNodes:function(_23){var _24=this,_25;_1.some(_23,function(_26,_27){var _28=_24.getNodesByItem(_26),_29=_28.length===1&&!_28[0];if(_27>0&&_29){_1.forEach(_25,function(_2a){if(_2a.state==="LOADED"){_2a._loadDeferred=null;}});return true;}_25=_28;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showAllLanguagesCommand=new _13({model:this});var _2b=this._contextMenuCommandProvider.get("commands");_1.some(_2b,_4.hitch(this,function(_2c){if(_2c instanceof _1b){this._copyCommand=_2c;}else{if(_2c instanceof _1c){this._cutCommand=_2c;}else{if(_2c instanceof _1e){this._pasteCommand=_2c;}else{if(_2c instanceof _1d){this._deleteCommand=_2c;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showAllLanguagesCommand].concat(_2b);},_setShowAllLanguagesAttr:function(_2d){this._set("showAllLanguages",_2d);this.model.set("showAllLanguages",_2d);this._showAllLanguagesCommand.set("active",!_2d);},_onTreeNodeClicked:function(_2e,_2f,_30){_7(this.getCurrentContext(),_4.hitch(this,function(_31){var _32=true;if(_31&&_17.isContentReference(_31.id)){_32=_17.compareIgnoreVersion(_2e.contentLink,_31.id);}var _33=function(_34){var _35={typeName:_d.getResourceValue(_2e.typeIdentifier,"name"),name:_2e.name};_6.publish("/epi/shell/context/request",{uri:_2e.uri},{sender:_4.mixin(_34,{requestedContent:_35}),forceContextChange:true});};if(!_32){_33(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_33,300);}));},contentContextChanged:function(_36,_37){var _38=new _17(_36.id),_39=_38.createVersionUnspecificReference().toString(),_3a=_11.wastebasketPage.toString();this.inherited(arguments);if(_39===_3a){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_39;if(_37&&_37.sender===this&&this.selectedItem&&_39===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_36.dataType)){this.selectContent(_39,false,true).then(_4.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_3b){return this.tree.model.isSupportedType(_3b);},_getSelectionData:function(_3c){return _3c?[{type:"epi.cms.contentdata",data:_3c}]:[];},_updateGlobalToolbarButtons:function(_3d){var _3e=_3d||this.get("selectedNode"),_3f=_3e?this._getSelectionData(_3e.item):[],_40=this.getCommandModel(_3e);if(this._createCommand){this._createCommand.set("model",_40);}this._contextMenuCommandProvider.updateCommandModel(_40);this.selection.set("data",_3f);},getCommandModel:function(_41){return _41&&_41.item;},contextChangeFailed:function(_42,_43,_44){this.inherited(arguments);if(_42){if(_44&&_44.sender===this){this.selectContent(_42.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_5.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_5.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(_45){this._removeHighlightClass();this._focusNode=_45;},_ensureContextMenu:function(){if(!this._contextMenu){this.own(this._contextMenu=new _19({leftClickToOpen:true,category:"context",popupParent:this}),_2.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_2.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}},_showContextMenu:function(evt){this._ensureContextMenu();this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _46=this.inherited(arguments);_46.on("onContextMenuClick",_4.hitch(this,function(_47){this._updateGlobalToolbarButtons(_47.node);this.set("_focusNode",_47.node);this._showContextMenu(_47);}));return _46;},getIconClass:function(_48,_49){var _4a=this.inherited(arguments);if(!_48||!_48.properties||!_48.properties.pageShortcutType){return _4a;}var _4b="";switch(_48.properties.pageShortcutType){case _12.pageShortcutTypes.Shortcut:_4b="epi-iconObjectInternalLink";break;case _12.pageShortcutTypes.External:_4b="epi-iconObjectExternalLink";break;case _12.pageShortcutTypes.Inactive:_4b="epi-iconObjectNoLink";break;case _12.pageShortcutTypes.FetchData:_4b=!_48.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _4b?_4a+" "+_4b:_4a;},enableDrop:function(_4c,_4d){_4c._droppable=_4d;},_showNotificationMessage:function(_4e){_e.alert(_9.toHTML(_4e));},_onNodeMouseEnter:function(_4f,evt){this.inherited(arguments);_4f.showContextMenu(true);},_onNodeMouseLeave:function(_50,evt){this.inherited(arguments);_50.showContextMenu(false);}});});