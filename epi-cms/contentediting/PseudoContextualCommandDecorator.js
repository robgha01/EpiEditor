//>>built
define("epi-cms/contentediting/PseudoContextualCommandDecorator",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_1,_2,_3,_4,_5,_6,_7){return _2(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_8,_9,_a){this._clearContextualCommandHandlers();if(!(_8 instanceof Array)||_8.length<=0||typeof _9!=="object"){return;}this._decorateCommands(_8,_9,_a);},_decorateCommands:function(_b,_c,_d){_1.forEach(_b,function(_e){if(!this._isValidCommand(_e)){return;}if(typeof _d==="function"&&!_d(this._getCommandModel(_e))){return;}this._onAroundCommandExecute(_e,_c);},this);},_getCommandModel:function(_f){if(_f.model&&_f.model instanceof Array){if(_f.model.length===1){return _f.model[0];}return null;}return _f.isInstanceOf(_7)?_f.get("selectionData"):_f.model;},_onAroundCommandExecute:function(_10,_11){var _12=this;_12._contextualCommandHandlers.push(_4.around(_10,"execute",function(_13){return function(){var _14=_12._decorateCommandBeforeExecute(_10,_11);_13.apply(_10,arguments);_12._restoreCommandAfterExecute(_10,_14);};}));},_decorateCommandBeforeExecute:function(_15,_16){var _17=this._decorateCommand(_15);if(this._isNormalCommand(_15)){_3.mixin(_17,this._decorateNormalCommand(_15,_16));}else{if(_15.isInstanceOf(_7)){_3.mixin(_17,this._decorateSelectionCommand(_15,_16));}}_15.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _17;},_decorateCommand:function(_18){var _19={createAsLocalAsset:_18.get("createAsLocalAsset")};_18.isInstanceOf(_5)&&_18.unwatchModelChange();_18.isInstanceOf(_6)&&_18.unwatchClipboardChange();_18.isInstanceOf(_7)&&_18.unwatchSelectionChange();return _19;},_decorateNormalCommand:function(_1a,_1b){var _1c={model:_1a.get("model")};_1a.set("model",_1b);return _1c;},_decorateSelectionCommand:function(_1d,_1e){var _1f={data:_1d.get("selectionData")};var _20=_1d.get("model");if(_20&&typeof _20.refreshRoots=="function"){_1d.onRefreshSelection=function(){return _20.refreshRoots();};}_1d.selection.set("data",[{data:_1e,type:_1d.get("selectionType")}]);return _1f;},_restoreCommandAfterExecute:function(_21,_22){this._restoreCommand(_21,_22);if(this._isNormalCommand(_21)){this._restoreNormalCommand(_21,_22);return;}if(_21.isInstanceOf(_7)){this._restoreSelectionCommand(_21,_22);}},_restoreCommand:function(_23,_24){_23.set("createAsLocalAsset",_24.createAsLocalAsset);_23.isInstanceOf(_5)&&_23.watchModelChange();_23.isInstanceOf(_6)&&_23.watchClipboardChange();_23.isInstanceOf(_7)&&_23.watchSelectionChange();},_restoreNormalCommand:function(_25,_26){_25.set("model",_26.model);},_restoreSelectionCommand:function(_27,_28){_27.selection.set("data",[{data:_28.data,type:_27.get("selectionType")}]);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_1.forEach(this._contextualCommandHandlers,function(_29){typeof _29.remove==="function"&&_29.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_2a){return !(_2a.isInstanceOf(_7)||_2a.isInstanceOf(_6));},_isValidCommand:function(_2b){return !!(_2b&&_2b.isInstanceOf(_5)&&this._getCommandModel(_2b));}});});