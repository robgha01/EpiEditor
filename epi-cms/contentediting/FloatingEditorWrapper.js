//>>built
define("epi-cms/contentediting/FloatingEditorWrapper",["dojo/_base/array","dojo/_base/declare","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _2([_9],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var _a=this;this.own(_5.subscribe("/epi/shell/context/request",function(_b,_c){if(!_c.contextIdSyncChange){_a.tryToStopEditing(false);_a.set("editing",false);_a._destroyDialog();}}),_5.subscribe("/epi/shell/action/changeview",function(){_a.set("editing",false);_a._removeEditingFeatures();}));},destroy:function(){this.tryToStopEditing(false);this._destroyDialog();this.inherited(arguments);},startEdit:function(_d){this.editorParams=Object.assign(this.editorParams||{},_d);var _e=this;_e._destroyDialog();return _e._setupDialog().then(function(){_e.own(_3.after(_e._dialog,"onAfterShow",function(){_e._startEdit(_d);_e._onTryToStopWithInvalidValue();}));return _e._dialog.show();});},_createDialog:function(_f){return new _8({title:this.propertyDisplayName,content:_f,duration:350,snapToNode:this.blockDisplayNode,positioner:_7.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(_10){this.inherited(arguments);var _11=this._dialog;if(_11){_11.set("snapToNode",_10);}},_setupDialog:function(){var _12={};var _13=function(_14,_15){_12[_14]=_15;};var _16=function(_17){for(var _18 in _12){var _19=_12[_18];_19.set("parent",this);}_12=null;}.bind(this);var _1a=Object.assign({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){_1a=Object.assign(_1a,{onFieldCreated:_13,onFormCreated:_16,doLayout:false});}var _1b=new _4();require([this.editorWidgetType],function(_1c){var _1d=new _1c(_1a);this.editorWidget=_1d;var _1e=this._createDialog(_1d);this._handlers=[this.connect(_1e,"onButtonClose",this._onButtonClose),this.connect(_1e,"onCancel",this._onDialogCancel),this.connect(_1e.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1d,"onChange",this._onChange),this.connect(_1d,"onKeyPress","_onEditorKeyPress")];this._dialog=_1e;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1b.resolve();}.bind(this));return _1b.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){_1.forEach(this._handlers,function(_1f){_1f.remove();});this._handlers=null;if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}if(this._dialog){this._dialog.destroy();this._dialog=null;}},_removeEditingFeatures:function(){var _20=this._dialog;if(_20&&_20.open){_20.hide();}},_onTryToStopWithInvalidValue:function(){_6.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});