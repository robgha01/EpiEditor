//>>built
define("epi-cms/contentediting/_FloatingComponentEditorWrapperMixin",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-style","epi/obsolete","epi-cms/contentediting/_HasFloatingComponent","epi-cms/contentediting/FloatingComponentHandler"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1(null,{_component:null,_viewport:null,_viewportIframe:null,_viewportScroller:null,_componentOverlayItem:null,_floatingComponentHandler:null,constructor:function(){_6("epi-cms/contentediting/_FloatingComponentEditorWrapperMixin",null,"12.0");},onComponentFloat:function(_9){this._onComponentFloat(_9);},setupFloatingComponentEditorWrapper:function(_a){this._component=_a.componentInfo.component;this.own(_3.after(this._component,"onComponentFloat",_2.hitch(this,function(){_2.mixin(_a,{floatingInfo:{delayTime:100}});this._onComponentFloat(_a);})));},destroy:function(){this._clearLocalDefers();this._component=null;this._componentOverlayItem=this._viewport=this._viewportScroller=null;this._floatingComponentHandler=null;this.inherited(arguments);},_onComponentFloat:function(_b){this._clearLocalDefers();var _c=_b.floatingInfo.delayTime,_d=_2.hitch(this,function(){var _e=_b.componentInfo;this._component=_e.component;this._componentOverlayItem=_e.componentOverlayItem;this._viewport=_e.viewport;this._viewportIframe=_e.viewportIframe;this._viewportScroller=_e.viewportScroller;this._isValidComponent()&&this._getFloatingComponentHandler().setComponentPosition(this._component.getComponentInfo(),this._getScrollInfo(_2.delegate(this._getViewportScrollInfo(),_b.floatingInfo||{})));});_c==null?_d():this._deferOnComponentFloat=this.defer(_d,_c);},_clearLocalDefers:function(){this._deferOnComponentFloat&&this._deferOnComponentFloat.remove();},_isValidComponent:function(){return this._component&&this._component.isInstanceOf(_7);},_getScrollInfo:function(_f){return {viewportScrollInfo:this._updateViewportScrollInfo(_f),overlayItemScrollInfo:this._getOverlayItemScrollInfo()};},_getViewportScrollInfo:function(){return {refreshPosition:false,scrollTop:this._viewport.scrollTop,scrollLeft:this._viewportScroller.scrollLeft===0?this._viewport.scrollLeft:this._viewportScroller.scrollLeft};},_getOverlayItemScrollInfo:function(){if(!this._componentOverlayItem){return;}var _10=_4.position(this._componentOverlayItem);return {bottom:_10.y+_10.h,height:_10.h,horizontal:_10.y,left:_5.get(this._componentOverlayItem,"left"),right:_10.x+_10.w,top:_5.get(this._componentOverlayItem,"top"),vertical:_10.x,width:_10.w};},_getFloatingComponentHandler:function(){return this._floatingComponentHandler||(this._floatingComponentHandler=new _8());},_updateViewportScrollInfo:function(_11){if(!_11){_11=this._getViewportScrollInfo();}var _12=_4.position(this._viewport),_13=_4.position(this._viewportIframe),_14=Math.max(_13.w,_12.w);_11.bottom=_12.y+_12.h;_11.height=_12.h;_11.horizontal=_12.y;_11.right=_12.x+_14;_11.vertical=_12.x;_11.width=_12.w;return _11;}});});