//>>built
define("epi-cms/contentediting/ContentReferencesNotification",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/Stateful","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/DestroyableByKey","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a,_b,_c,_d){return _2([_5,_a],{order:40,_backCommand:null,_clickHandleKey:"clickHandle",constructor:function(){this._backCommand=new _b();},postscript:function(){this.inherited(arguments);this._store=this._store||_8.resolve("epi.storeregistry").get("epi.cms.referenced-content");},_valueSetter:function(_e){this.value=_e;var _f=_9.getValue(_e.contentData.typeIdentifier,"actAsAnAsset");if(!_f){this.set("notification",null);return;}_6(this._store.query({ids:[_e.contentData.contentLink]})).then(this._updateNotification.bind(this));},_updateNotification:function(_10){if(!_10){this.set("notification",null);return;}var _11=_10[0].references;var _12=_4.create("div");if(_11.length>0){_12.innerHTML+=_d.affect;var _13=_11.length+" "+(_11.length===1?_7.resources.text.item:_7.resources.text.items),_14=this,_15=_4.create("a",{href:"#",innerHTML:_13,title:_d.referencestooltip},_12);this.destroyByKey(this._clickHandleKey);this.ownByKey(this._clickHandleKey,on(_15,"click",function(evt){_3.stop(evt);_14._showReferenceDialog();}));}else{_12.innerHTML+=_7.resources.messages.notinuse;}this._backCommand.set("model",{});this.set("notification",{content:_12,commands:[this._backCommand]});},_showReferenceDialog:function(){_c({contentItems:[this.get("value").contentData],showToolbar:true,mode:_c.mode.show});}});});