//>>built
define("epi-cms/contentediting/EditorFactory",["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_1,_2,_3,_4){return _1(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_5){},onEditorResolved:function(_6,_7){},constructor:function(){var _8=_4.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_8&&_8.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_9,_a,_b){this._registeredEditorWrappers[_9]={wrapperClassType:_a,initializer:_b};},_handleContentEditable:function(_c,_d,_e){var _f="epi-cms/contentediting/editors/ContentEditableEditor";if(_c!==_f||_d==="contenteditable"){return _c;}var _10=_e&&_e!==_f;return _10?_e:"dijit/form/ValidationTextBox";},_getWrapperAndEditor:function(_11){var _12=_11.wrapperType;var _13=_11.editorParams||{};var _14=_11.editorWidgetType;if(!_12){if(_11.metadata.customEditorSettings&&_11.metadata.customEditorSettings.uiWrapperType){_12=_11.metadata.customEditorSettings.uiWrapperType;}else{_12=this.defaultWrapperType;}}if(!_14){if(_11.metadata.customEditorSettings&&_11.metadata.customEditorSettings.uiType){_14=_11.metadata.customEditorSettings.uiType;}else{if(_11.metadata.uiType){_14=_11.metadata.uiType;}else{_14="epi/shell/widget/FormContainer";_3.mixin(_13,{metadata:_11.metadata,onFieldCreated:function(_15,_16){}});}}}_14=this._handleContentEditable(_14,_12,_11.metadata.uiType);if(!_14){throw ("Could not resolve editor widget for property: "+_11.name);}var _17={editorWidgetType:_14,editorParams:_13};if(_11.metadata.customEditorSettings&&_11.metadata.customEditorSettings.uiParams){_3.mixin(_13,_11.metadata.customEditorSettings.uiParams);}var _18=this._registeredEditorWrappers[_12];if(!_18){throw ("No suitable editor wrapper found for type: "+_12);}if(_11.metadata.customEditorSettings&&_11.metadata.customEditorSettings.uiWrapper){_17.wrapperInitializer=null;_17.wrapperType=_11.metadata.customEditorSettings.uiWrapper;}else{_17.wrapperInitializer=_18.initializer;_17.wrapperType=_18.wrapperClassType;}this.onEditorResolved(_17,_11);if(_12){return _17;}throw ("No suitable editor found");},createEditor:function(_19,_1a,_1b,_1c){var def=new _2();var _1d=this._getWrapperAndEditor(_19);var _1e=_1d.wrapperType;var _1f=_1d.editorWidgetType;require([_1e,_1f],_3.hitch(this,function(_20){var _21=_1c||{};if(_19.metadata){_3.mixin(_21,_19.metadata.settings);_3.mixin(_21,_1d.editorParams);_21.selections=_19.metadata.selections;}var _22={wrapperType:_1d.wrapperType,editorWidgetType:_1d.editorWidgetType,editorParams:_21,blockDisplayNode:_1a,overlayItem:_21.overlayItem,property:_19,propertyName:_19.name,propertyDisplayName:_19.metadata.displayName,value:_1b,contentModel:_19.contentModel};var _23=new _20(_22);var _24=_1d.wrapperInitializer;if(_24){_3.mixin(_22.editorParams,{parent:_23});_24(_23,_22);}this.onEditorCreated(_23.getEditorWidget());def.resolve(_23);}));return def;}});});