//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/NumberSpinner","dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/compare/views/AllPropertiesCompareView","epi-cms/compare/views/CompareView","epi-cms/compare/views/SideBySideCompareView","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/VersionsComponent","epi-cms/content-approval/ApprovalComponent","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/ContentPreview","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/legacy/LegacyDialogPopup","epi-cms/legacy/LegacyFormEditor","epi-cms/project/Overview","epi-cms/project/ProjectChangesComponent","epi-cms/project/ProjectComponent","epi-cms/project/ProjectModeToolbar","epi-cms/version/LanguageSelector","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlMediaSelector","epi-cms/widget/UrlSelector"],1);},"dijit/form/NumberSpinner":function(){define("dijit/form/NumberSpinner",["dojo/_base/declare","dojo/_base/event","dojo/keys","./_Spinner","./NumberTextBox"],function(_1,_2,_3,_4,_5){return _1("dijit.form.NumberSpinner",[_4,_5.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(_6,_7){var tc=this.constraints,v=isNaN(_6),_8=!isNaN(tc.max),_9=!isNaN(tc.min);if(v&&_7!=0){_6=(_7>0)?_9?tc.min:_8?tc.max:0:_8?this.constraints.max:_9?tc.min:0;}var _a=_6+_7;if(v||isNaN(_a)){return _6;}if(_8&&(_a>tc.max)){_a=tc.max;}if(_9&&(_a<tc.min)){_a=tc.min;}return _a;},_onKeyPress:function(e){if(this.disabled||this.readOnly){return;}if((e.charOrCode==_3.HOME||e.charOrCode==_3.END)&&!(e.ctrlKey||e.altKey||e.metaKey)&&typeof this.get("value")!="undefined"){var _b=this.constraints[(e.charOrCode==_3.HOME?"min":"max")];if(typeof _b=="number"){this._setValueAttr(_b,false);}_2.stop(e);}}});});},"dijit/form/NumberTextBox":function(){define("dijit/form/NumberTextBox",["dojo/_base/declare","dojo/_base/lang","dojo/number","./RangeBoundTextBox"],function(_c,_d,_e,_f){var _10=_c("dijit.form.NumberTextBoxMixin",null,{pattern:_e.regexp,value:NaN,editOptions:{pattern:"#.######"},_formatter:_e.format,postMixInProperties:function(){this.inherited(arguments);this._set("type","text");},_setConstraintsAttr:function(_11){var _12=typeof _11.places=="number"?_11.places:0;if(_12){_12++;}if(typeof _11.max!="number"){_11.max=9*Math.pow(10,15-_12);}if(typeof _11.min!="number"){_11.min=-9*Math.pow(10,15-_12);}this.inherited(arguments,[_11]);if(this.focusNode&&this.focusNode.value&&!isNaN(this.value)){this.set("value",this.value);}},_onFocus:function(){if(this.disabled||this.readOnly){return;}var val=this.get("value");if(typeof val=="number"&&!isNaN(val)){var _13=this.format(val,this.constraints);if(_13!==undefined){this.textbox.value=_13;}}this.inherited(arguments);},format:function(_14,_15){var _16=String(_14);if(typeof _14!="number"){return _16;}if(isNaN(_14)){return "";}if(!("rangeCheck" in this&&this.rangeCheck(_14,_15))&&_15.exponent!==false&&/\de[-+]?\d/i.test(_16)){return _16;}if(this.editOptions&&this.focused){_15=_d.mixin({},_15,this.editOptions);}return this._formatter(_14,_15);},_parser:_e.parse,parse:function(_17,_18){var v=this._parser(_17,_d.mixin({},_18,(this.editOptions&&this.focused)?this.editOptions:{}));if(this.editOptions&&this.focused&&isNaN(v)){v=this._parser(_17,_18);}return v;},_getDisplayedValueAttr:function(){var v=this.inherited(arguments);return isNaN(v)?this.textbox.value:v;},filter:function(_19){return (_19==null||_19==="")?NaN:this.inherited(arguments);},serialize:function(_1a,_1b){return (typeof _1a!="number"||isNaN(_1a))?"":this.inherited(arguments);},_setBlurValue:function(){var val=_d.hitch(_d.mixin({},this,{focused:true}),"get")("value");this._setValueAttr(val,true);},_setValueAttr:function(_1c,_1d,_1e){if(_1c!==undefined&&_1e===undefined){_1e=String(_1c);if(typeof _1c=="number"){if(isNaN(_1c)){_1e="";}else{if(("rangeCheck" in this&&this.rangeCheck(_1c,this.constraints))||this.constraints.exponent===false||!/\de[-+]?\d/i.test(_1e)){_1e=undefined;}}}else{if(!_1c){_1e="";_1c=NaN;}else{_1c=undefined;}}}this.inherited(arguments,[_1c,_1d,_1e]);},_getValueAttr:function(){var v=this.inherited(arguments);if(isNaN(v)&&this.textbox.value!==""){if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+_e._realNumberRegexp(_d.mixin({},this.constraints))+"$").test(this.textbox.value))){var n=Number(this.textbox.value);return isNaN(n)?undefined:n;}else{return undefined;}}else{return v;}},isValid:function(_1f){if(!this.focused||this._isEmpty(this.textbox.value)){return this.inherited(arguments);}else{var v=this.get("value");if(!isNaN(v)&&this.rangeCheck(v,this.constraints)){if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)){return true;}else{return this.inherited(arguments);}}else{return false;}}}});var _20=_c("dijit.form.NumberTextBox",[_f,_10],{baseClass:"dijitTextBox dijitNumberTextBox"});_20.Mixin=_10;return _20;});},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_21,_22,_23,_24,_25,_26,_27,_28,_29){return _21([_28],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_23.after(this.getContentDataStore(),"notify",function(_2a,id){this.itemChanged(id,_2a);}.bind(this),true));},getContentDataStore:function(){if(!this.contentDataStore){var _2b=_26.resolve("epi.storeregistry");this.contentDataStore=_2b.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _2c=new _24();_25(this.getCurrentContext(),_22.hitch(this,function(ctx){if(!this._isContentContext(ctx)){_2c.reject({message:"Not a content data",context:ctx});return;}_25(this.getContentDataStore().get(ctx.id),function(_2d){_2c.resolve(_2d);});}));return _2c.promise;},contextChanged:function(ctx,_2e){this.inherited(arguments);if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}var _2f=(_2e&&_2e.forceContextChange?_2e.forceContextChange:false);if(!_2f&&this._isSameAsCurrentContentContext(ctx)){return;}this._currentContentContext=ctx;this.contentContextChanged(ctx,_2e);},contextUpdated:function(ctx,_30){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_30);},contentContextChanged:function(ctx,_31){},contentContextUpdated:function(ctx,_32){},itemChanged:function(id,_33){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_34,_35){var _36=new _27(_34),_37=new _27(_35);if(this.ignoreVersionWhenComparingLinks&&_36.getType()==="epi.cms.contentdata"&&_37.getType()==="epi.cms.contentdata"&&_29.compareIgnoreVersion(_36.getId(),_37.getId())){return true;}else{if(_34===_35){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_38,epi){var _39=_38(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_3a){if(_3a){this._parse(_3a);}},_parse:function(_3b){if(typeof _3b==="object"){this.id=parseInt(_3b.ID||_3b.id||_3b.iD||_3b.Id||0,10);this.workId=parseInt(_3b.WorkID||_3b.workId||0,10);this.providerName=_3b.ProviderName||_3b.providerName||null;}else{if(typeof _3b==="string"){if(_3b==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _3c=_3b.split("_");this.id=parseInt(_3c[0],10);this.workId=parseInt(_3c[1],10)||0;this.providerName=_3c[2]||"";}}else{if(typeof _3b==="number"){this.id=_3b;this.workId=0;this.providerName="";}}}if(isNaN(this.id)){throw new Error("The id parameter of a content reference must be an integer");}if(isNaN(this.workId)&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _3d=String(this.id);if(this.workId!==0){_3d+="_"+this.workId;}if(this.providerName){_3d+=(this.workId===0?"__":"_")+this.providerName;}return _3d;},createVersionUnspecificReference:function(){return new _39({id:this.id,providerName:this.providerName});}});_39.isContentReference=function(_3e){try{return !!(new _39(_3e));}catch(error){return false;}};_39.toContentReference=function(obj){if(obj instanceof _39){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _39(obj);}}return _39.empty;};_39.tryConvert=function(_3f,_40){if(_3f instanceof _39){return _3f;}try{return new _39(_3f);}catch(error){return _40!==undefined?_40:_39.empty;}};_39.compareIgnoreVersion=function(_41,_42){var c1=_39.toContentReference(_41);var c2=_39.toContentReference(_42);var _43=c1.createVersionUnspecificReference();var _44=c2.createVersionUnspecificReference();return epi.areEqual(_43,_44);};_39.empty=new _39({id:-1,workId:-1});_39.emptyContentReference=_39.empty;return _39;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/shell/request/mutators","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi/shell/StickyViewSelector","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/ContentRepositoryDescriptorService","epi-cms/conversion/ContentFragmentConverter","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/configurableQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/project/ProjectActivitiesQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/compare/command/CompareCommandProvider","epi-cms/notification/command/NotificationCommandProvider","epi-cms/command/ViewSettingsCommandProvider","epi-cms/content-activity/command/ContentActivityCommandProvider","epi-cms/contentediting/ContentHierarchyService","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/content-approval/ApprovalService","epi-cms/project/ProjectService","epi-cms/activity/ActivityService","epi-cms/notification/NotificationService","epi-cms/project/request/projectMode","epi-cms/request/contentLanguage","epi-cms/project/ProjectModeRequestInterceptor","epi-cms/project/ProjectItemQueryEngine","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/project/ProjectViewSetting","epi-cms/widget/ContentTypeService","epi-cms/Profile"],function(_45,_46,_47,_48,epi,_49,_4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52,_53,_54,_55,_56,_57,_58,_59,_5a,_5b,_5c,_5d,_5e,_5f,_60,_61,_62,_63,_64,_65,_66,_67,_68,_69,_6a,_6b,_6c,_6d,_6e,_6f,_70,_71,_72,_73,_74,_75,_76,_77,_78,_79,_7a){return _46([_49],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_7b){this._settings=_7b;},initialize:function(){this.inherited(arguments);_4b.add(_6c);_4b.add(_6d);_46.safeMixin(_53,this._settings);var _7c=_4a.resolve("epi.shell.Profile");return _48(_7c.getContentLanguage()).then(_47.hitch(this,function(_7d){_53.currentContentLanguage=_7c.contentLanguage=_7d;if(_53.enableStickyView){_52.enable();}else{_52.disable();}this.registerDependency("epi.cms.BackContextHistory",new _54());this.registerDependency("epi.cms.ContextSynchronizer",new _55(),undefined,function(_7e){_7e.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_70);this._hashWrapper=_4a.resolve("epi.shell.HashWrapper");var _7f=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",new _56(this._settings.contentRepositoryDescriptors));_7f.registerRoute("epi.cms.contentdata",_47.hitch(this,this._redirectContentDataContext));_7f.registerRoute("epi.cms.project",_47.hitch(this,this._redirectContext));_7f.registerRoute("epi.cms.approval",_47.hitch(this,this._redirectContext));this._initializeEditorFactory();this._initializeStores();this.registerDependency("epi.cms.ApprovalService",new _68());this.registerDependency("epi.cms.ProjectService",new _69());this.registerDependency("epi.cms.ActivityService",new _6a());this.registerDependency("epi.cms.NotificationService",new _6b());this.registerDependency("epi.cms.ContentHierarchyService",new _64());this._projectModeRequestInterceptor=new _6e();this.registerDependency("epi.cms.ContentTypeService",new _79());this._setupConverters();this._setupViewSettings(_7f);var _80=new _63();this.registerDependency("contentActivityCommandProvider",_80);var _81=_4a.resolve("epi.globalcommandregistry");_81.registerProvider("epi.cms.publishmenu",new _73());_81.registerProvider("epi.cms.globalToolbar",new _5f());_81.registerProvider("epi.cms.globalToolbar",new _60());_81.registerProvider("epi.cms.globalToolbar",new _62());_81.registerProvider("epi.cms.globalToolbar",new _61());_81.registerProvider("epi.cms.globalToolbar",_80);this._setupInUseNotificationManager(_81);}));},_redirectContentDataContext:function(_82,_83,uri){if(_51.viewName==="/episerver/dashboard"){var _84=_4c.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_84=_84.substring(0,_84.length-1);var _85=_84+"#"+this._hashWrapper.extractHash(_82,_83);this._redirect(_85);}else{if(_82.hasSiteChanged){var _86=_82.fullHomeUrl+"#"+this._hashWrapper.extractHash(_82,_83);this._redirect(_86);}else{if(_83&&_83.trigger==="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_82,_83);}}},_redirectContext:function(_87,_88){this._hashWrapper.onContextChange(_87,_88);},_redirect:function(url){window.location=url;},_setupConverters:function(){var _89=new _58(),_8a=new _59(),_8b=new _57(),_8c=new _5a(),_8d=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _8d){var _8e=_8d[key];if(_8e.linkableTypes){_8e.linkableTypes.forEach(function(_8f){_4d.registerConverter(_8f,_8f+".link",_89);_4d.registerConverter(_8f+".fragment",_8f+".link",_89);_4d.registerConverter(_8f,"link",_89);});}}for(key in _50._uiDescriptors){var _90=_50._uiDescriptors[key].descriptor;_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".reference",_8a);_4d.registerConverter(_90.typeIdentifier+".fragment",_90.typeIdentifier+".reference",_8a);_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".light",_89);_4d.registerConverter(_90.typeIdentifier,_90.typeIdentifier+".fragment",_8b);}_89.registerDefaultConverters(_4d);_8c.registerDefaultConverters(_4d);},_setupViewSettings:function(_91){var _92=new _67({viewSettings:[new _75(),new _77(),new _74(),new _78(_91),new _76(_91)]});this.registerDependency("epi.viewsettingsmanager",_92);},_initializeStores:function(){var _93=this.resolveDependency("epi.storeregistry"),_94,_95,_96;_94=_93.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_95=_93.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_5c});_96=_93.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_5d});_93.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_93.create("epi.cms.category",this._getRestPath("categories"));_93.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_94);_93.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_93.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_93.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_93.create("epi.cms.displaychannels",this._getRestPath("channel"));_93.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_93.create("epi.cms.project",this._getRestPath("project"),{queryEngine:_5c,realtimeInfo:{subscriptionKey:"/episerver/cms/project"}});_93.create("epi.cms.project.item",this._getRestPath("project-item"),{queryEngine:_6f,realtimeInfo:{subscriptionKey:"/episerver/cms/project-item"}});_93.create("epi.cms.activities",this._getRestPath("activities"),{queryEngine:_5e,realtimeInfo:{subscriptionKey:"/episerver/cms/activity"}});_93.create("epi.cms.activities.comments",this._getRestPath("activities-comments"),{realtimeInfo:{subscriptionKey:"/episerver/cms/activity-comment"}});_93.create("epi.cms.contenttype",this._getRestPath("contenttype")).query();_93.create("epi.cms.notification",this._getRestPath("notification"),{queryEngine:_5c,realtimeInfo:{subscriptionKey:"/episerver/cms/notification"}});_93.create("epi.cms.notification.users",this._getRestPath("notification-users"),{idProperty:"userName"});_93.add("epi.cms.approval.definition",new _4f(new _4e({idProperty:"contentLink",target:this._getRestPath("approval-definition"),preventCache:true})));_93.add("epi.cms.approval",new _4f(new _4e({target:this._getRestPath("approval"),preventCache:true})));_93.add("epi.cms.contentreferences",new _4f(new _4e({target:this._getRestPath("contentreferences"),idProperty:"contentLink",preventCache:true})));_93.add("epi.cms.referenced-content",new _4f(new _4e({target:this._getRestPath("referenced-content"),idProperty:"contentLink",preventCache:true})));_93.add("epi.cms.content.search",new _4f(new _4e({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_94.addDependentStore(_95,{refreshOnPatch:true,refresh:function(_97){setTimeout(function(){var id=_94.getIdentity(_97);var _98=new _5b(id).createVersionUnspecificReference().toString();_95.refresh(_98);});}});_94.addDependentStore(_96,{transformDelegate:function(_99){if(_99.capabilities&&!_99.capabilities.versionable){return null;}if(!_99.properties){return null;}var _9a={pageChangedBy:"savedBy",pageSaved:"savedDate",pageLanguageBranch:"language",pageName:"name",name:"name",icontent_name:"name"};var _9b=_47.mixin({},_99);for(var p in _9a){if(p in _9b.properties){_9b[_9a[p]]=_9b.properties[p];}}return _9b;}});},_getRestPath:function(_9c){return _4c.getRestPath({moduleArea:"cms",storeName:_9c});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _9d=new _65();_9d.registerEditorWrapper("inline","epi-cms/contentediting/InlineEditorWrapper",function(_9e,_9f){});_9d.registerEditorWrapper("richtextinline","epi-cms/contentediting/RichTextInlineEditorWrapper",function(_a0,_a1){});_9d.registerEditorWrapper("flyout","epi-cms/contentediting/FlyoutEditorWrapper",function(_a2,_a3){});_9d.registerEditorWrapper("floating","epi-cms/contentediting/FloatingEditorWrapper",function(_a4,_a5){});_9d.registerEditorWrapper("contenteditable","epi-cms/contentediting/ContentEditableWrapper",function(_a6,_a7){});_9d.registerEditorWrapper("legacyProperty","epi-cms/contentediting/DialogEditorWrapper",function(_a8,_a9){_a8.closeOnChange=true;_a8.showButtons=false;});return _9d;});},_setupInUseNotificationManager:function(_aa){var _ab=new _66();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_ab);_aa.registerProvider("epi.cms.publishmenu",new _72());_aa.registerProvider("epi.cms.contentdetailsmenu",new _71());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/store/Memory","epi/shell/ContextHistory","epi/shell/ViewSettings"],function(_ac,_ad,_ae,_af,_b0,_b1){return _ac([_b0],{createStore:function(){return new _af({data:[],idProperty:"uri"});},onContextChanged:function(_b2,_b3,_b4){if(_b3&&_b3.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},closeAndNavigateBack:function(_b5){var _b6=this._getLastItem();var _b7=this.store.data.filter(function(_b8){return _b6.typeIdentifier&&(_b6.typeIdentifier===_b8.typeIdentifier);});_b7.forEach(function(_b9){var _ba=this.store.getIdentity(_b9);this.store.remove(_ba);},this);var _bb=this._getLastItem();var uri=_bb&&_bb.uri?{uri:_bb.uri}:{uri:_b1.settings.defaultContext};_ae.publish("/epi/shell/context/request",uri,{sender:_b5});},getPrevious:function(){var _bc=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_bc&&_bc.length>1)?_bc[1]:null;},_updateStore:function(_bd){var _be=this._getLastItem();if(_be&&_be.uri===_bd.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){var _bf=this.store.query({},{sort:[{attribute:"dateAdded",descending:true}]});return _bf[0];}return null;},_removeLastItem:function(){var _c0=this._getLastItem();if(_c0){this.store.remove(this.store.getIdentity(_c0));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_c1,_c2,_c3,_c4,_c5,_c6){return _c1([_c5],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_c3.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_c7){var _c8=_c7.contentLink;_c4(this.getCurrentContext(),function(_c9){if(_c9&&_c6.compareIgnoreVersion(_c9.id,_c8)){var _ca={uri:"epi.cms.contentdata:///"+_c8};if(_c9.languageContext){_ca.epslanguage=_c9.languageContext.preferredLanguage;}_c3.publish("/epi/shell/context/updateRequest",_ca);}});},destroy:function(){_c3.unsubscribe(this._subscribeHandle);}});});},"epi-cms/ContentRepositoryDescriptorService":function(){define("epi-cms/ContentRepositoryDescriptorService",["epi/assign"],function(_cb){function _cc(_cd){_cb(this,_cd);};_cc.prototype.get=function(key){return !key?null:this[key.toLowerCase()];};_cc.prototype.list=function(){return Object.keys(this);};return _cc;});},"epi-cms/conversion/ContentFragmentConverter":function(){define(["dojo/_base/declare"],function(_ce){return _ce([],{convert:function(_cf,_d0,_d1){if(!_d1){return null;}return {contentLink:_d1.contentLink,name:_d1.name,typeIdentifier:_d1.typeIdentifier,id:_d1.id};}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_d2,_d3,_d4,_d5,_d6,_d7){return _d2(null,{_contentStore:null,constructor:function(_d8){_d3.mixin(this,_d8);this._contentStore=this._contentStore||_d5.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_d9){},convert:function(_da,_db,_dc){if(!_dc||(!_dc.contentLink&&!_dc.uri)){return null;}var _dd=_dc.contentLink||new _d6(_dc.uri).getId();if(!_dd){return null;}_dd=new _d7(_dd).createVersionUnspecificReference().toString();return _d4(this._contentStore.get(_dd),function(_de){return {url:_de.publicUrl,previewUrl:_de.previewUrl,permanentUrl:_de.permanentLink,text:_de.name,typeIdentifier:_de.typeIdentifier};});}});});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_df,_e0,_e1,_e2,_e3,_e4){return _df(null,{convert:function(_e5,_e6,_e7){if(!_e7||(!_e7.uri&&!_e7.contentLink)){return null;}var _e8;if(_e7.uri){var uri=new _e3(_e7.uri);_e8=uri.getId();}else{_e8=_e7.contentLink;}return new _e4(_e8).createVersionUnspecificReference().toString();}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare"],function(_e9){return _e9(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_ea){_ea.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_eb,_ec,_ed){if(_ed&&_eb===this.sourceDataType&&_ec===this.targetDataType){return new Date(_ed);}return null;}});});},"epi-cms/store/configurableQueryEngine":function(){define(["epi/shell/store/queryUtils"],function(_ee){return function(_ef,_f0){_f0=_f0||{};return _ee.createEngine(_ef,_f0);};});},"epi/shell/store/queryUtils":function(){define("epi/shell/store/queryUtils",[],function(){function _f1(_f2){return _f2 instanceof Array&&_f2.length>0;};var _f3={createFilter:function(_f4,_f5){var _f6;_f5=_f5||{};switch(typeof _f4){case "object":case "undefined":_f6=function(_f7){return !_f4||Object.keys(_f4).every(function(key){var _f8=_f5.ignore,_f9=_f5.comparers&&_f5.comparers[key],_fa=_f4[key];if(_f8&&_f8.indexOf(key)!==-1){return true;}if(_f9){return _f9(_fa,_f7);}return _fa===_f7[key];});};break;default:throw new Error("Can not query with a "+typeof _f4);}return _f6;},createSorter:function(_fb){if(!_f1(_fb)){throw new Error("Argument must be an array containing sortOptions");}return function(a,b){var _fc,_fd;for(var _fe,i=0;(_fe=_fb[i]);i++){_fc=a[_fe.attribute];_fd=b[_fe.attribute];if(typeof _fc==="string"&&typeof _fd==="string"){_fc=_fc.toLowerCase();_fd=_fd.toLowerCase();}if(_fc!==_fd){return _fe.descending===(_fc>_fd)?-1:1;}}return 0;};},createExecuter:function(_ff,_100,_101,_102){var _103=_101||0,end=_102?_103+_102:Infinity;return function(_104){var _105;_104=_ff?_104.filter(_ff):_104.slice(0);_100&&_104.sort(_100);if(_101||_102){_105=_104.length;_104=_104.slice(_103,end);_104.total=_105;}return _104;};},createEngine:function(_106,_107){var _108,_109,_10a;_107=_107||{};_108=_f3.createFilter(_106,_107);_109=_f1(_107.sort)?_f3.createSorter(_107.sort):null;_10a=_f3.createExecuter(_108,_109,_107.start,_107.count);_10a.matches=_108;return _10a;}};return _f3;});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_10b,_10c){return function(_10d,_10e){switch(typeof _10d){case "object":case "undefined":var _10f=_10d;_10d=function(_110){for(var key in _10f){var _111=_10f[key],_112=_111.toString();if(_112!==_110[key]&&(!_10c.isContentReference(_112)||!_10c.compareIgnoreVersion(_112,_110[key]))){return false;}}return true;};break;case "string":if(!this[_10d]){throw new Error("No filter function "+_10d+" was found in store");}_10d=this[_10d];break;case "function":break;default:throw new Error("Can not query with a "+typeof _10d);}function _113(_114){var _115=_10b.filter(_114,_10d);if(_10e&&_10e.sort){_115.sort(function(a,b){for(var sort,i=0;(sort=_10e.sort[i]);i++){var _116=a[sort.attribute];var _117=b[sort.attribute];if(_116!==_117){return sort.descending===(_116>_117)?-1:1;}}return 0;});}if(_10e&&(_10e.start||_10e.count)){var _118=_115.length;_115=_115.slice(_10e.start||0,(_10e.start||0)+(_10e.count||Infinity));_115.total=_118;}return _115;};_113.matches=_10d;return _113;};});},"epi-cms/project/ProjectActivitiesQueryEngine":function(){define(["dojo/_base/lang","epi/shell/store/queryUtils"],function(lang,_119){return function(_11a,_11b){_11b=lang.mixin({comparers:{projectId:function(_11c,_11d){return !_11d.projectId||_11c===_11d.projectId;},contentReferences:function(_11e,_11f){return _11e&&_11e.some(function(_120){return _120===_11f.contentLink;});}}},_11b);return _119.createEngine(_11a,_11b);};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable","dijit/form/ToggleButton","epi/dependency","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_121,_122,lang,_123,_124,_125,_126,_127,_128,_129,_12a,_12b){var _12c=_122([_127,_124],{iconClass:"epi-iconTree",tooltip:_12b.toolbar.buttons.togglenavigationpane,label:_12b.toolbar.buttons.togglenavigationpane,order:-10000,canExecute:true,constructor:function(){this.own(_123.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",lang.hitch(this,function(_12d){this.set("active",_12d);})));},_execute:function(){_123.publish("/epi/layout/pinnable/navigation/toggle");}});var _12e=_122([_127,_124],{iconClass:"epi-iconFolder",tooltip:_12b.toolbar.buttons.toggleassetspane,label:_12b.toolbar.buttons.toggleassetspane,order:10000,canExecute:true,constructor:function(){this.own(_123.subscribe("/epi/layout/pinnable/tools/visibilitychanged",lang.hitch(this,function(_12f){this.set("active",_12f);})));},_execute:function(){_123.publish("/epi/layout/pinnable/tools/toggle");}});return _122([_12a],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_126.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_128.viewName;this._addLeadingCommands();this._addCreateCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _12c(),{widget:_125,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _130=this.viewName;var _131=[];var _132=function(view){return view===_130;};for(var _133 in this.contentRepositoryDescriptors){var _134=this.contentRepositoryDescriptors[_133];if(_121.some(_134.mainViews,_132)){_131.push(_134);}}_121.forEach(_131,function(_135){_121.forEach(_135.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _129({creatingTypeIdentifier:type});},_addTrailingCommands:function(){this.addToTrailing(new _12e(),{widget:_125,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_136,_137,lang,_138,on,_139,when,_13a,_13b,_13c,_13d,_13e,_13f,_140,_141,_142,_143,_144){return _137([_13b,_140],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,confirmActionText:_144.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,autoPublish:false,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,allowedTypes:null,restrictedTypes:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _145=_13a.resolve("epi.storeregistry");this.contentStore=this.contentStore||_145.get("epi.cms.content.light");this.contextService=this.contextService||_13a.resolve("epi.shell.ContextService");this.contentTypeStore=this.contentTypeStore||_145.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_13a.resolve("epi.cms.contentRepositoryDescriptors");var _146,_147=function(type){return type===this.creatingTypeIdentifier;};for(var _148 in this.contentRepositoryDescriptors){var _149=this.contentRepositoryDescriptors[_148];if(_136.some(_149.containedTypes,_147,this)){_146=_149;break;}}if(_146){var _14a=_13c.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_14a?_14a:[this.creatingTypeIdentifier];this.roots=this.roots||_146.roots;}this.modelContent=new _142({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_146.preventContextualContentFor;this.label=this.label||_13c.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_13c.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_13c.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_13c.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},contextChanged:function(ctx,_14b){this.set("isAvailable",this._isContentContext(ctx));this.inherited(arguments);},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_14c){if(!_14c){return;}when(this.contextService.query({uri:"epi.cms.contentdata:///"+_14c.contentLink}),lang.hitch(this,function(_14d){if(!_14d){return;}var _14e=_14d.languageContext;var _14f=!_14e||(_14e.hasTranslationAccess&&_14e.isPreferredLanguageAvailable);var _150=_13e.compareIgnoreVersion(_14c.contentLink,_13f.wastebasketPage);var _151=!(_150||_14c.isDeleted)&&_14f&&_143.isActionAvailable(_14c,_143.action.Create,_143.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_14c.contentLink),lang.hitch(this,function(_152){var _153=this._isContentTypeAllowedAsChildToCurrentContext(_152,_14c);if((!_153&&!this.createAsLocalAsset)||!_151){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_14c);}}));}));}));},_getAvailableContentTypes:function(_154){return this.contentTypeStore.query({query:"getavailablecontenttypes",localAsset:this.createAsLocalAsset,parentReference:_154});},_isContentTypeAllowedAsChildToCurrentContext:function(_155,_156){var _157=_136.some(_155,function(_158){return _13c.isBaseTypeIdentifier(_158.typeIdentifier,this.creatingTypeIdentifier);},this);var _159=_136.some(this.containerTypeIdentifiers,function(type){return _13c.isBaseTypeIdentifier(_156.typeIdentifier,type);});return _157&&_159;},_createDialog:function(){this.selector=new _141({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _13d({confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});this.selector.on("change",lang.hitch(this,this._setDialogButtonState));this.dialog.own(_138.after(this.dialog,"hide",lang.hitch(this,function(_15a){this.hideDeferred=_15a;})));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _15b=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_15b),lang.hitch(this,function(_15c){this._switchView(_15c);}));}));},_switchView:function(_15d){when(this.getCurrentContent(),lang.hitch(this,function(_15e){var _15f=this.isPseudoContextualRoot(_15d)||this.createAsLocalAsset;_139.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_15f?_15e:_15d,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_15f,treatAsSecondaryView:this.createAsLocalAsset,view:_13c.getValue(this.creatingTypeIdentifier,"createView"),autoPublish:this.autoPublish,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});}));},_setDialogButtonState:function(_160){if(!_160){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_160),lang.hitch(this,function(_161){when(this.isPseudoContextualRoot(_161)?this.contextService.query({uri:"epi.cms.contentdata:///"+this._currentContext.id}):_161,lang.hitch(this,function(_162){var _163=_143.hasLanguageAccess(_162),_164=_163&&_143.hasAccess(_161.accessMask,_143.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_164);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference"],function(_165,_166,lang,when,_167,_168,_169,_16a,_16b){return _166([_167],{_commandDecorator:null,postscript:function(){this.inherited(arguments);this._commandDecorator=this._commandDecorator||new _16a();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_16c){var _16d=this.inherited(arguments),_16e=this.isContextualContent(_16c);return _16d!=null?!!(_16d||_16e):!!(_16c&&_16e);},isContextualContent:function(_16f){return this.isContextualRoot(_16f)||this.isPseudoContextualRoot(_16f);},isContextualRoot:function(_170){return _170.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_171){var _172=_16b.toContentReference(_171.contentLink);return !_172.providerName&&_172.id==this._getPseudoContextualContent();},hasContextual:function(_173){if(!(_173 instanceof Array)||_173.length<=0){return false;}return _165.some(_173,this.isContextualContent,this);},canHaveContextualContent:function(_174){var _175=_16b.toContentReference(_174.contentLink);return !_165.some(this.notSupportContextualContents,function(id){return !_175.providerName&&_175.id==id;});},getContextualRoot:function(_176){if(typeof _176!=="object"){return null;}var _177=lang.clone(_176);_177.name=this.getContextualRootName(_177);if(this.isPseudoContextualRoot(_177)){_177.hasChildren=false;}return _177;},getContextualRootName:function(_178){var _179=_178&&_178.ownerTypeIdentifier,_17a=_179||(this._currentContext&&this._currentContext.dataType)||"",_17b=_168.getResourceValue(_17a,"name",true);var _17c=_168.getResourceValue(_17a,"forthis",false);return _17b?lang.replace(_17c,[_17b]):_17c;},decoratePseudoContextualCommands:function(_17d){when(this.getCurrentContent()).then(lang.hitch(this,function(_17e){this._commandDecorator.decorateCommands(_17d,_17e,lang.hitch(this,this.isPseudoContextualRoot));})).otherwise(function(){});},_getPseudoContextualContent:function(){return _169.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_17f,_180,lang,_181,_182,_183,_184){return _180(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_185,_186,_187){this._clearContextualCommandHandlers();if(!(_185 instanceof Array)||_185.length<=0||typeof _186!=="object"){return;}this._decorateCommands(_185,_186,_187);},_decorateCommands:function(_188,_189,_18a){_17f.forEach(_188,function(_18b){if(!this._isValidCommand(_18b)){return;}if(typeof _18a==="function"&&!_18a(this._getCommandModel(_18b))){return;}this._onAroundCommandExecute(_18b,_189);},this);},_getCommandModel:function(_18c){if(_18c.model&&_18c.model instanceof Array){if(_18c.model.length===1){return _18c.model[0];}return null;}return _18c.isInstanceOf(_184)?_18c.get("selectionData"):_18c.model;},_onAroundCommandExecute:function(_18d,_18e){var self=this;self._contextualCommandHandlers.push(_181.around(_18d,"execute",function(_18f){return function(){var _190=self._decorateCommandBeforeExecute(_18d,_18e);_18f.apply(_18d,arguments);self._restoreCommandAfterExecute(_18d,_190);};}));},_decorateCommandBeforeExecute:function(_191,_192){var _193=this._decorateCommand(_191);if(this._isNormalCommand(_191)){lang.mixin(_193,this._decorateNormalCommand(_191,_192));}else{if(_191.isInstanceOf(_184)){lang.mixin(_193,this._decorateSelectionCommand(_191,_192));}}_191.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _193;},_decorateCommand:function(_194){var _195={createAsLocalAsset:_194.get("createAsLocalAsset")};_194.isInstanceOf(_182)&&_194.unwatchModelChange();_194.isInstanceOf(_183)&&_194.unwatchClipboardChange();_194.isInstanceOf(_184)&&_194.unwatchSelectionChange();return _195;},_decorateNormalCommand:function(_196,_197){var _198={model:_196.get("model")};_196.set("model",_197);return _198;},_decorateSelectionCommand:function(_199,_19a){var _19b={data:_199.get("selectionData")};var _19c=_199.get("model");if(_19c&&typeof _19c.refreshRoots=="function"){_199.onRefreshSelection=function(){return _19c.refreshRoots();};}_199.selection.set("data",[{data:_19a,type:_199.get("selectionType")}]);return _19b;},_restoreCommandAfterExecute:function(_19d,_19e){this._restoreCommand(_19d,_19e);if(this._isNormalCommand(_19d)){this._restoreNormalCommand(_19d,_19e);return;}if(_19d.isInstanceOf(_184)){this._restoreSelectionCommand(_19d,_19e);}},_restoreCommand:function(_19f,_1a0){_19f.set("createAsLocalAsset",_1a0.createAsLocalAsset);_19f.isInstanceOf(_182)&&_19f.watchModelChange();_19f.isInstanceOf(_183)&&_19f.watchClipboardChange();_19f.isInstanceOf(_184)&&_19f.watchSelectionChange();},_restoreNormalCommand:function(_1a1,_1a2){_1a1.set("model",_1a2.model);},_restoreSelectionCommand:function(_1a3,_1a4){_1a3.selection.set("data",[{data:_1a4.data,type:_1a3.get("selectionType")}]);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_17f.forEach(this._contextualCommandHandlers,function(_1a5){typeof _1a5.remove==="function"&&_1a5.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_1a6){return !(_1a6.isInstanceOf(_184)||_1a6.isInstanceOf(_183));},_isValidCommand:function(_1a7){return !!(_1a7&&_1a7.isInstanceOf(_182)&&this._getCommandModel(_1a7));}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_1a8,lang){return _1a8(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_1a9,lang){return _1a9(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_getSingleSelectionData:function(){var _1aa=this._getSelectionData();return _1aa&&(this.selection.data.length===1)?_1aa.data:null;},_selectionDataGetter:function(){var _1ab=this._getSelectionData();return _1ab&&_1ab.type==="epi.cms.contentdata"?_1ab.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/when","dijit/layout/_LayoutWidget","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/SearchBox","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_1ac,_1ad,lang,_1ae,when,_1af,epi,_1b0,_1b1,_1b2,_1b3,_1b4,_1b5,_1b6,_1b7){return _1ad([_1af,_1b5],{_contentRef:null,res:_1b7,baseClass:"epi-content-selector-dialog",roots:null,typeIdentifiers:null,showButtons:true,model:null,allowedTypes:null,restrictedTypes:null,canSelectOwnerContent:true,multiRootsMode:false,_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,showSearchBox:true,searchArea:null,_searchBox:null,buildRendering:function(){this.inherited(arguments);var _1b8=this._getTypesToDisplay(),_1b9=this.model,_1ba=this.roots||(_1b9&&_1b9.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_1b9||this.showContextualContent){_1b9=new _1b3({roots:_1ba,typeIdentifiers:_1b8,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_1b9.set("view","contentselector");if(this.showSearchBox&&this.searchArea){this._searchBox=new _1b4({innerSearchBoxClass:"epi-search--full-width",triggerContextChange:false,parameters:{allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes},onItemAction:lang.hitch(this,function(item){if(item&&item.metadata&&this._checkAcceptance(item.metadata.typeIdentifier)){this.set("value",item.metadata.id);this.onChange(item.metadata.id);}})});this._searchBox.set("area",this.searchArea);this._searchBox.set("searchRoots",this.roots);var _1bb=this._searchBox;_1b9.getRoots(true).then(function(_1bc){_1bb.set("searchRoots",_1bc.join(","));});this.addChild(this._searchBox);}this.tree=new _1b2({roots:_1ba,typeIdentifiers:_1b8,allowManipulation:false,model:_1b9,allowedTypes:lang.clone(this.allowedTypes),restrictedTypes:lang.clone(this.restrictedTypes),disableRestrictedTypes:true,expandExtraNodeItems:_1b1.startPage});this.addChild(this.tree);this.connect(this.tree,"onClick","_onTreeNodeClick");},layout:function(){this.inherited(arguments);var _1bd=this._contentBox.h;if(this._searchBox){_1bd-=_1ae.getMarginBox(this._searchBox.domNode).h;}var _1be=_1ae.getMarginBox(this.tree.domNode);_1be.h=_1bd;_1ae.setMarginBox(this.tree.domNode,_1be);},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _1bf=this.contentRepositoryDescriptors||_1b6.resolve("epi.cms.contentRepositoryDescriptors");var _1c0,_1c1=function(type){return _1b0.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _1c2 in _1bf){var _1c3=_1bf[_1c2];if(_1ac.some(_1c3.containedTypes,_1c1,this)){_1c0=_1c3;break;}}return _1c0.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _1c4=[];this._getContainerTypesRecursive(this.allowedTypes,_1c4);this._typesToDisplay=_1c4;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_1c5,_1c6,_1c7){if(!_1c7){_1c7=[];}_1ac.forEach(_1c5,lang.hitch(this,function(type){if(_1ac.indexOf(_1c7,type)===-1){_1c7.push(type);if(_1ac.indexOf(_1c6,type)===-1){_1c6.push(type);}var _1c8=_1b0.getValue(type,"containerTypes");if(_1c8){this._getContainerTypesRecursive(_1c8,_1c6,_1c7);}}}));},_setValueAttr:function(_1c9){if(_1c9){this._contentRef=_1c9;var _1ca=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_1ca,true);}));}else{if(!epi.isEmpty(_1ca)){this.tree.selectContent(_1ca,true);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_setAllowedTypesAttr:function(_1cb){this._typesToDisplay=null;this._set("allowedTypes",_1cb);},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_1b7.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_1cc){var _1cd=_1cc.contentLink;if(!this._checkAcceptance(_1cc.typeIdentifier)){this.tree.lastFocused.setSelected(false);_1cd=null;}this.set("value",_1cd);this.onChange(this.get("value"));},_checkAcceptance:function(_1ce){var _1cf=_1b0.getValidAcceptedTypes([_1ce],this.allowedTypes,this.restrictedTypes);return !!_1cf.length;},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_1d0){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","dijit/registry","epi/dependency","epi/shell/DestroyableByKey","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel"],function(_1d1,_1d2,_1d3,lang,_1d4,_1d5,_1d6,_1d7,_1d8,keys,_1d9,_1da,_1db,when,_1dc,_1dd,_1de,_1df,_1e0,Tree,_1e1,_1e2,_1e3,_1e4,_1e5){return _1d3([Tree,_1d8,_1de],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,disableRestrictedTypes:false,dndSource:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}this.own(this.model);if(this.allowManipulation){this.dndController=this.dndSource||_1df;this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_1e3;this.own(_1d6.around(this.model,"pasteItems",this._aroundPasteItem.bind(this)));if(this.allowedTypes){var _1e6=_1d1.some(this.allowedTypes,function(item){return item==="episerver.core.contentfolder";});if(!_1e6){this.allowedTypes.push("episerver.core.contentfolder");}}},getItemType:function(item){return _1e0.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_1e7){return _1e4(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_1d6.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_1e8,_1e9){var _1ea=this.getNodesByItem(_1e8)[0];if(_1ea){_1d5.set(_1ea.domNode,{display:_1e9===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _1eb=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _1d9(_1d1.map(_1eb,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _1ec=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _1ed=_1d1.map(_1ec,function(item){return this.tree.getNodesByItem(item)[0];},this);_1ed=_1d1.filter(_1ed,Boolean);return _1d9(_1d1.map(_1ed,this.tree._expandNode,this));},_aroundPasteItem:function(_1ee){return function(_1ef,_1f0){if(_1f0.isWastebasket){return _1ee.apply(this.model,arguments);}var _1f1=this.get("selectedNode");if(!_1f1){return _1ee.apply(this.model,arguments);}_1f1.markProcessing();return _1ee.apply(this.model,arguments).then(function(){if(!_1f1.isExpanded){_1f1.expand();}}).always(function(){_1f1.unmarkProcessing();});}.bind(this);},checkItemAcceptance:function(_1f2,_1f3,_1f4){var _1f5=_1dc.getEnclosingWidget(_1f2),_1f6=_1f5&&_1f5.item;if(!_1f6){return false;}return this.model.checkItemAcceptance(_1f6,_1f3);},_setAllowManipulationAttr:function(_1f7){this._set("allowManipulation",_1f7);if(_1f7){this.dndController=this.dndSource||_1df;}},_createTreeModel:function(){return new _1e5({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_1f8){function _1f9(node,_1fa){_1d1.forEach(node.getChildren(),function(_1fb){_1fa.push(_1fb.item);_1f9(_1fb,_1fa);});return _1fa;};if(_1f8){var _1fc=this._itemNodesMap[this.model.getIdentity(item)];if(_1fc){_1d1.forEach(_1fc,function(_1fd){_1d1.forEach(_1f9(_1fd,[]).reverse(),function(_1fe){this._onItemDelete(_1fe);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_1ff){this._set("typeIdentifiers",_1ff);if(this.model){this.model.typeIdentifiers=_1ff;}},getTooltip:function(item){var _200=this.model.getTooltip||this.model.getLabel;var _201=new _1e1(item.contentLink),_202=_200?_200(item):this.inherited(arguments);return _202?_1e2.title(_202,_201.id,item.contentTypeName):_202;},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _203=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_203);},getIconClass:function(item,_204){if(!item){return this.inherited(arguments);}var _205=_1e0.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_205);}var _206=_1e0.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_204&&!item.isSubRoot&&_206){_205=_205+"Open";}return _205+this._getItemDisableStyle(item);},getLabelClass:function(item,_207){return this._getItemDisableStyle(item);},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getItemDisableStyle:function(item){if(this.disableRestrictedTypes){return this._isItemRestricted(item)?" is-disabled ":"";}return "";},_isItemRestricted:function(item){var _208=_1e0.getValidAcceptedTypes([item.typeIdentifier],this.allowedTypes,this.restrictedTypes);return !_208.length;},_getTargetPath:function(_209){var _20a=this.model,_20b=new _1d7();_20a.getAncestors(_209,function(_20c){_20c.push(_209);var _20d=_1d1.map(_20c,function(item){return _20a.getIdentity(item).toString();});if(typeof _20a.filterAncestors==="function"){_20d=_20a.filterAncestors(_20d);}_20b.resolve(_20d);});return _20b.promise;},_isValidTargetContent:function(_20e){if(!_20e){return false;}return !_20e.isDeleted&&!_20e.isWastebasket;},_onSelect:function(id,_20f,_210){var _211=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{selectedContent:_211});this.selectContent(id,_20f,true,_210).then(lang.hitch(this,function(){_211=this.get("selectedNode");if(_211&&_211.item&&_211.item.contentLink){this.emit("select",_211.item,_211);}}));},selectContent:function(_212,_213,_214,_215){var self=this,_216=self.model,_217=new _1d7(),_218=function(_219){self._preparePathNodes(_219);self._setRecursivePaths(_219,_217,_213,_215);};when(_216.store.get(_212),function(_21a){if(!self._isValidTargetContent(_21a)){self.set("paths",[]);_217.resolve(null);}else{self._getTargetPath(_21a).then(function(_21b){self._onSetTargetPath();_218(_21b);});}});return _217.promise;},_onSetTargetPath:function(){this.model.set("handleSelection",this.handleSelection);if(!this.handleSelection){return;}var _21c=this.get("selectedNode");if(_21c){_21c=this.getNodesByItem(_21c.item)[0];if(_21c){this.model.set("previousSelection",{selectedContent:_21c,selectedAncestors:_21c.getTreePath()});}}},_preparePathNodes:function(_21d){},_setRecursivePaths:function(_21e,_21f,_220,_221){if(!_21e||_21e.length===0){return;}this.set("paths",[_21e]).then(lang.hitch(this,function(){var _222=this.get("selectedNode");if(!_222){this._setRecursivePaths(_21e.slice(0,-1),_21f,_220,_221);return;}if(_220){this.focus();}if(_221){_221(_222);}_21f.resolve(_222);},_21f.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_1d2.isCopyKey(e)){var _223=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_223){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.metaKey){return;}if(e.shiftKey&&e.keyCode===keys.F10){this.emit("showContextMenu",e);e.preventDefault();return;}if(e.shiftKey){return;}if(e.keyCode===keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_1db("ie")){_1d1.forEach(_1da(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_1d4.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/declare","./multiDndSource"],function(_224,_225){return _224([_225],{singular:true,userSelect:function(node){this.inherited(arguments,[node,false,false]);}});});},"epi/shell/dnd/tree/multiDndSource":function(){define("epi/shell/dnd/tree/multiDndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin","epi/shell/TypeDescriptorManager"],function(_226,_227,_228,_229,_22a,_22b,lang,on,_22c,_22d,_22e,when,_22f,_230,_231){return _228([_22f,_230],{generateText:false,singular:false,constructor:function(){var _232=this.reject;if(_232){var _233=[];for(var key in this.accept){_233.push(key);}this.accept={};_233=_231.removeIntersectingTypes(_233,this.reject);_226.forEach(_233,function(_234){this.accept[_234]=1;},this);for(var i=0;i<_232.length;++i){this.accept[_232[i]]=0;}}var _235=_22e.manager();this._startDragHandle=_229.before(_235,"startDrag",this._beforeStartDrag.bind(this));},destroy:function(){this.inherited(arguments);this._startDragHandle.remove();delete this._startDragHandle;},_beforeStartDrag:function(_236,_237,copy){if(_236!==this){return arguments;}var _238=this.getSelectedTreeNodes();if(!_238.length){return arguments;}_238=_238.map(function(_239){return _239.domNode;});return [_236,_238,copy];},deleteSelectedNodes:function(){},onDndDrop:function(_23a,_23b,copy,_23c){if(this.containerState==="Over"){var tree=this.tree,_23d=tree.model,_23e=this.targetAnchor;this.isDragging=false;var _23f;var _240=(_23e&&_23e.item)||tree.item;if(this.dropPosition==="Before"||this.dropPosition==="After"){_240=(_23e.getParent()&&_23e.getParent().item)||tree.item;_23f=_23e.getIndexInParent();if(this.dropPosition==="After"){_23f=_23e.getIndexInParent()+1;}}var _241=this.itemCreator(_23b,_23e.rowNode,_23a,_23c);if(_23a===this){if(_23d.pasteItems){var _242=_241.map(function(item){if(item.dndData){return item.dndData.data;}return item;});_23d.pasteItems(_242,_240,copy,_23f);}else{_226.forEach(_241,function(item){if(item.dndData){var _243=item.dndData.options;var _244=_243?_243.oldParentItem:null;var _245=_243?_243.indexInParent:0;if(typeof _23f=="number"){if(_240===_244&&_245<_23f){_23f-=1;}}_23d.pasteItem(item.dndData.data,_244,_240,copy,_23f);}});}}else{if(_23d.newItems){_23d.newItems(_241,_240,_23f);}else{_226.forEach(_241,function(item){_23d.newItem(item,_240,_23f);});}}if(!_23a.isDragging&&!_23c.isDragging){this.onDndEnd();}}if(this===_23c&&_23a!==_23c&&!copy&&_23a.onDndItemRemoved){var _246=_226.map(_23b,function(node){return this._getDndData(_23a.getItem(node.id),this.accept,false);},this);_23a.onDndItemRemoved(_246,_23a,_23b,copy,_23c);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_247){this.inherited(arguments);var m=_22e.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,this.dropPosition.toLowerCase()),function(_248){m.canDrop(_248);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}.bind(this),500);}},onDndEnd:function(){},onDndItemRemoved:function(_249,_24a,_24b,copy,_24c){},itemCreator:function(_24d,_24e,_24f,_250){return _226.map(_24d,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_24f.getItem(node.id),this.accept,this===_24f)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _251=item.data.getParent();opts.oldParentItem=_251?_251.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _252=_22a.contains(e.target,"dojoDndContainerOver");var _253=_22a.contains(e.target,"dijitTreeContainer");if(_252||_253){return;}this.inherited(arguments);},onMouseUp:function(e){if(this.current){var id=this.current.id;if(!this.singular&&!e.shiftKey&&this.selection[id]&&_22a.contains(e.target,"epi-iconContextMenu")){this._doDeselect=false;}}this.inherited(arguments);},checkAcceptance:function(_254,_255){if(this.readOnly){return false;}var _256=_226.map(_255,function(node){return _254.getItem(node.id);});return this._checkAcceptanceForItems(_256,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_257,_258,_259,_25a,_25b,lang,on,_25c,_25d,_25e,_25f){var _260=_259("dijit.tree.dndSource",_25f,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_261){if(!_261){_261={};}lang.mixin(this,_261);var type=_261.accept instanceof Array?_261.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_25a.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_25a.add(this.node,"dojoDndTarget");}this.topics=[_25d.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_25d.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_25d.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_25d.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_262){return this.copyOnly||_262;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_263){var m=_25e.manager(),_264=this.targetAnchor,_265=this.current,_266=this.dropPosition;var _267="Over";if(_265&&this.betweenThreshold>0){if(!this.targetBox||_264!=_265){this.targetBox=_25b.position(_265.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_267="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_267="After";}}}if(_263||_265!=_264||_267!=_266){if(_264){this._removeItemClass(_264.rowNode,_266);}if(_265){this._addItemClass(_265.rowNode,_267);}if(!_265){m.canDrop(false);}else{if(_265==this.tree.rootNode&&_267!="Over"){m.canDrop(false);}else{var _268=false;if(m.source==this){for(var _269 in this.selection){var _26a=this.selection[_269];if(_26a.item===_265.item){_268=true;break;}}}if(_268){m.canDrop(false);}else{if(this.checkItemAcceptance(_265.rowNode,m.source,_267.toLowerCase())&&!this._isParentChildDrop(m.source,_265.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_265;this.dropPosition=_267;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_25e.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _26b=this.getSelectedTreeNodes();if(_26b.length){if(_26b.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_26b[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_26b=r;}_26b=_257.map(_26b,function(n){return n.domNode;});m.startDrag(this,_26b,this.copyState(_258.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_26c){if(this!=_26c){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_25e.manager();m.canDrop(false);}}},onDndStart:function(_26d,_26e,copy){if(this.isSource){this._changeState("Source",this==_26d?(copy?"Copied":"Moved"):"");}var _26f=this.checkAcceptance(_26d,_26e);this._changeState("Target",_26f?"":"Disabled");if(this==_26d){_25e.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_270){return _257.map(_270,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_271,_272,copy){if(this.containerState=="Over"){var tree=this.tree,_273=tree.model,_274=this.targetAnchor;this.isDragging=false;var _275;var _276;var _277;_275=(_274&&_274.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_275=(_274.getParent()&&_274.getParent().item)||tree.item;_276=_274.getIndexInParent();if(this.dropPosition=="After"){_276=_274.getIndexInParent()+1;_277=_274.getNextSibling()&&_274.getNextSibling().item;}else{_277=_274.item;}}else{_275=(_274&&_274.item)||tree.item;}var _278;_257.forEach(_272,function(node,idx){var _279=_271.getItem(node.id);if(_257.indexOf(_279.type,"treeNode")!=-1){var _27a=_279.data,_27b=_27a.item,_27c=_27a.getParent().item;}if(_271==this){if(typeof _276=="number"){if(_275==_27c&&_27a.getIndexInParent()<_276){_276-=1;}}_273.pasteItem(_27b,_27c,_275,copy,_276,_277);}else{if(_273.isItem(_27b)){_273.pasteItem(_27b,_27c,_275,copy,_276,_277);}else{if(!_278){_278=this.itemCreator(_272,_274.rowNode,_271);}_273.newItem(_278[idx],_275,_276,_277);}}},this);this.tree._expandNode(_274);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_25e.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_25e.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_27d,_27e){if(!_27d.tree||_27d.tree!=this.tree){return false;}var root=_27d.tree.domNode;var ids=_27d.selection;var node=_27e.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _260;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_27f,_280,lang,dom,_281,Tree){return _280(Tree,{dndParams:["accept","reject"].concat(Tree.prototype.dndParams),postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_282){var _283=this.model.getIdentity(_282),_284=this._itemNodesMap[_283];if(_284){if(_27f.some(_284,function(node){return node.state==="LOADED";})){this.model.getChildren(_282,lang.hitch(this,function(_285){_27f.forEach(_284,function(_286){_286.setChildItems(_285);});_27f.forEach(_285,function(_287){this.model.onChange(_287);this._onChildrenReload(_287);},this);}));}else{_27f.forEach(_284,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _288=null;if(_281.curNode&&dom.isDescendant(_281.curNode,this.domNode)){_288=_281.curNode;}this.inherited(arguments);if(_288){if(dom.isDescendant(_288,this.domNode)){_288.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","epi/string","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/i18n!epi/cms/nls/episerver.shared.header"],function(lang,_289,_28a,_28b,_28c,_28d,misc,_28e,_28f,_290,_291,_292){var _293={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_294){var _295="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _294?lang.replace(_295,[_294,new Date().getTime()]):"";},contentIcon:function(_296,_297){return misc.icon(_293.contentIconClass(_296,_297));},contentIconClass:function(_298,_299){var _29a=_28e.getValue(_298,"iconClass");var _29b=_29a+" epi-objectIcon";if(_299){_29b+=" "+_299;}return _29b;},contentTypeDescription:function(_29c){return _28e.getResourceValue(_29c,"name",false);},languageBranch:function(_29d){return _29d?"<span class=\"epi-missingLanguageIndicator\">"+_29d.language+"</span>":"";},menu:function(_29e){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_29e);},path:function(path){if(path&&path.length){var _29f=misc.attributeEncode(path.join(" > "));path=_28c.truncateMiddle(path,40,"…");var text=path.map(misc.htmlEncode).join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");return lang.replace("<span class=\"dgrid-column-treePath dojoxEllipsis\" title=\"{title}\">{text}</span>",{title:_29f,text:text});}return "";},userName:function(_2a0){return _28b.toUserFriendlyHtml(_2a0);},localizedDate:function(date){return _28a.toUserFriendlyHtml(date);},friendlyBoolean:function(_2a1){var _2a2=_2a1?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_2a2+"\" />";},versionStatus:function(_2a3){return _28f.getVersionStatus(_2a3);},commonDraft:function(item,_2a4,node){if(item.isCommonDraft){node.innerHTML="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\" title=\""+_291.primarydraft+"\"></span>";}node.innerHTML+=_293.versionStatus(_2a4);},visibleLink:function(_2a5,_2a6){if(!_2a5){return "";}var text=!_2a6?misc.htmlEncode(_2a5):_2a5;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_2a7,_2a8){if(!_2a7){return "";}var text=!_2a8?misc.htmlEncode(_2a7):_2a7;return "<span class=\"epi-secondaryText\">"+text+"</span>";},title:function(name,_2a9,_2aa){return name+", "+_292.id+": "+_2a9+" ("+_292.type+": "+_2aa+")";},contentItemFactory:function(_2ab,_2ac,_2ad,_2ae,_2af,_2b0,_2b1,_2b2){return function(_2b3,_2b4,node,_2b5){var _2b6,_2b7,text,_2b8,_2b9,_2ba,_2bb,_2bc;function get(name){if(typeof _2b4.get==="function"){return _2b4.get(name);}return _2b4[name];};function _2bd(_2be){if(_2be){if(typeof _2be==="function"){return _2be(_2b4);}else{return get(_2be);}}return _2b3;};_2ba=typeof _2b3==="string";_2b7=_2bd(_2ad||(_2ba?false:"typeIdentifier"));text=_2bd(_2ab||(_2ba?false:"text"));_2b8=_2bd(_2ac||(_2ba?false:"title"));_2b9=(_2b0&&_2bd(_2b0))||_2b4.missingLanguageBranch;_2bb=_2af&&_2bd(_2af);_2bc=_2b2?_2b4.status:null;_2b6=_293.contentItem(_2b7,_2b9,text,_2b8,_2ae,_2bb,_2b1,_2bc);node.innerHTML=_2b6;if(node.nodeName!=="TD"&&_2b9){_289.add(node,"epi-ct-missingLanguageRow");}return _2b6;};},contentItem:function(_2bf,_2c0,text,_2c1,_2c2,_2c3,_2c4,_2c5){var menu=(_2c2&&_2c2.hasMenu)?_293.menu(_2c2.settings):"",_2c6=_293.languageBranch(_2c0);_2c4=(_2c4===null||_2c4===undefined)?true:_2c4;_2c1=_2c4?misc.attributeEncode(_2c1||text):(_2c1||text);text=_2c4?misc.htmlEncode(text):text;var _2c7="";if(_2c5){_2c7=_293._statusIcon(_2c5);}return (_2c3?_293.thumbnail(_2c3):_293.contentIcon(_2bf))+menu+_2c7+_2c6+misc.ellipsis(text,_2c1);},_statusIcon:function(_2c8){if(_2c8===_28f.versionStatus.Published){return "";}var _2c9=new _290({contentStatus:_2c8});var _2ca={cssClass:_2c9.statusIcon&&_2c9.statusIcon.join(" "),message:_2c9.statusMessage};return lang.replace("<span class=\"dijitIcon epi-statusIcon {cssClass}\" title=\"{message}\">&nbsp;</span>",_2ca);}};_28d.addFormatter("contentIcon",_293.contentIcon);_28d.addFormatter("userName",_293.userName);_28d.addFormatter("versionStatus",_293.versionStatus);_28d.addFormatter("localizedDate",_293.localizedDate);_28d.addFormatter("contentItem",_293.contentItemFactory,true);return _293;});},"epi/username":function(){define("epi/username",["dojox/html/entities","epi/dependency","epi/i18n!epi/shell/ui/nls/episerver.shared.text"],function(_2cb,_2cc,_2cd){return {toUserFriendlyString:function(_2ce,_2cf,_2d0,_2d1,_2d2){if(!_2cf){_2cf=this._getCurrentUsername();}var _2d3=_2d1?"":_2cd.installer,_2d4=_2d2?_2cd.yousubject:_2cd.youobject,_2d5=_2ce&&_2cf.toLowerCase()===_2ce.toLowerCase()?_2d4:_2ce||_2d3;if(_2d0){_2d5=_2d5.charAt(0).toUpperCase()+_2d5.slice(1);}return _2d5;},toUserFriendlyHtml:function(_2d6,_2d7,_2d8,_2d9,_2da){var _2db=this.toUserFriendlyString(_2d6,_2d7,_2d8,_2d9,_2da);if(_2db===""){return _2db;}return "<span class='epi-username'>"+_2cb.encode(_2db)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _2dc=_2cc.resolve("epi.shell.Profile");this.currentUsername=_2dc.get("userName");}return this.currentUsername;}};});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_2dd,_2de,when,Grid,_2df){var _2e0=_2dd(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _2e1;_2de.forEach(this.subRows,function(_2e2){_2de.forEach(_2e2,function(_2e3){_2e1=[];_2de.forEach(_2e0.shorthands,function(_2e4){var _2e5=_2e3[_2e4],_2e6=_2e0.formatters[_2e4];if(_2e5){if(_2e6){_2e1.push(_2e6.isFactory?_2e6.handler(_2e5):_2e6.handler);}else{throw new Error("Formatter with key "+_2e4+" not found");}}});if(_2e3.formatters){this._findFormatters(_2e3.formatters,_2e1);}if(_2e1.length>0){_2e3=_2df(_2e3,_2e1);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_2e7,row){return data;}];}}},renderRow:function(_2e8,_2e9){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_2e9]),data=this.field?_2e8[this.field]:_2e8,_2ea=this._resolvedFormatters,i=-1;function _2eb(_2ec){var _2ed=_2ea[i],_2ee;if(_2ed){row.innerHTML=_2ec;data=_2ec;}i++;if(_2ea.length>i){_2ed=_2ea[i];_2ee=_2ed(data,_2e8,row);when(_2ee,_2eb);}};if(_2ea.length>0){_2eb();}return row;},_findFormatters:function(_2ef,_2f0){_2f0=_2f0||[];_2de.forEach(_2ef,function(_2f1){var type=typeof _2f1,item,_2f2;if(type==="string"){item=_2e0.formatters[_2f1];if(item){_2f2=item.isFactory?item.handler():item.handler;_2f2.allParameters=item.allParameters;}}else{if(type==="function"){_2f2=_2f1;}}if(_2f2){_2f0.push(_2f2);}else{throw new Error("Formatter with key "+_2f1+"not found");}});return _2f0;}});_2e0.formatters={};_2e0.shorthands=[];_2e0.addFormatter=function(name,_2f3,_2f4,_2f5){_2e0.formatters[name]={handler:_2f3,isFactory:!!_2f4};if(_2f5){_2e0.shorthands.push(name);}};return _2e0;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_2f6){return function(_2f7,_2f8){var _2f9=_2f7.renderCell;_2f7.formatters=_2f8||_2f7.formatters;if(_2f7.formatters&&_2f7.formatters.length>0){_2f7.renderCell=function(_2fa,_2fb,cell,_2fc){_2f6.forEach(_2f7.formatters,function(_2fd){_2fb=_2fd(_2fb,_2fa,cell,_2fc);});if(_2fb){cell.innerHTML=_2fb;}};}return _2f9?_2f9.call(_2f7):_2f7;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_2fe,lang,_2ff,_300,_301){var _302={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _2ff.encode(text);},attributeEncode:function(text){return _2ff.encode(text,_302._attributeEncodeMap);},ellipsis:function(text,_303){if(!_303||!lang.isString(_303)){_303=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_303,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_300.addFormatter("htmlEncode",_302.htmlEncode,false,true);_300.addFormatter("icon",function(icon){return function(_304){return _302.icon(icon,_304);};},true,true);_300.addFormatter("ellipsis",_302.ellipsis,false,true);_300.addFormatter("ellipsisNoTooltip",_302.ellipsisNoTooltip,false,true);return _302;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _305={},_306;if(res){_305={0:res.notcreated,1:res.rejected,2:res.checkedout,3:res.checkedin,4:res.published,5:res.previouslypublished,6:res.delayedpublish,7:res.awaitingapproval,100:res.expired};}_306={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,AwaitingApproval:7,Expired:100},versionLocalizations:_305,getVersionStatus:function(_307){return this.versionLocalizations[_307];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,RequestApproval:5,CheckOut:6,Schedule:7,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_308,_309,_30a,_30b,_30c){return _306.hasAccessToAction(_308,_309,_30a,_30b,_30c)&&_306.canPerformAction(_308,_309);},hasAccessToAction:function(_30d,_30e,_30f,_310,_311){var _312;if(!_30d){return false;}if(!_310&&_30d.capabilities&&_30d.capabilities.language&&_30d.missingLanguageBranch&&_30d.missingLanguageBranch.isTranslationNeeded){return false;}if(_30f&&!_306.hasProviderCapability(_30d.providerCapabilityMask,_30f)){return false;}_312=_311?_30d.accessRights:_30d.accessMask;return _306.hasAccess(_312,_306.accessLevel[_30e]);},canPerformAction:function(_313,_314){var _315=_313.status,_316=_306.versionStatus;if(_315===_316.DelayedPublish&&(_314===_306.action.Edit||_314===_306.action.Publish)){return false;}if(_314===_306.action.Publish){return !(_315===_316.Published||_315===_316.Expired);}if(_314===_306.action.CheckIn){return _315===_316.CheckedOut||_315===_316.Rejected;}if(_314===_306.action.Edit){var _317=(_315===_316.Published&&!_313.isCommonDraft)||(_315===_316.Expired&&!_313.isCommonDraft)||_315===_316.PreviouslyPublished||(_315===_316.CheckedIn&&!_313.isPartOfAnotherProject)||_315===_316.DelayedPublish||_315===_316.AwaitingApproval;return !(_317||_313.isDeleted||_313.isWastebasket);}return true;},hasAccess:function(_318,_319){return (_318&_319)===_319;},hasLanguageAccess:function(item){if(!item){return false;}var _31a=item.languageContext||item.missingLanguageBranch||item;return !_31a||(_31a.hasTranslationAccess&&_31a.isPreferredLanguageAvailable);},getPermissionMap:function(_31b){var map={};for(var al in _306.accessLevel){map[al]=_306.hasAccess(_31b,_306.accessLevel[al]);}return map;},hasProviderCapability:function(_31c,_31d){return (_31c&_31d)===_31d;}};return _306;});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_31e,_31f,_320,lang,when,all,_321,_322,_323,_324,_325,_326){return _31f([_321,_324],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,contentLink:null,constructor:function(){this._statusIconMap={0:["epi-statusIndicatorIcon","epi-statusIndicator0"],1:["epi-statusIndicatorIcon","epi-statusIndicator1"],2:["epi-statusIndicatorIcon","epi-statusIndicator2"],3:["epi-statusIndicatorIcon","epi-statusIndicator3"],4:["epi-statusIndicatorIcon","epi-statusIndicator4"],5:["epi-statusIndicatorIcon","epi-statusIndicator5"],6:["epi-statusIndicatorIcon","epi-statusIndicator6"],7:["epi-statusIndicatorIcon","epi-statusIndicator7"],100:["epi-statusIndicatorIcon","epi-statusIndicator100"]};this._statusMessageMap={0:_326.notcreated,1:_326.rejected,2:_326.checkedout,3:_326.checkedin,4:_326.published,5:_326.previouslypublished,6:_326.delayedpublish,7:_326.awaitingapproval,100:_326.expired};},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_322.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_327){if(_327&&_327.status!==undefined){this.set("content",_327);}}));}));},_contentLinkSetter:function(_328){if(!_328){return;}this.contentLink=_328;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_329){this.content=_329;this.set("contentStatus",_329.status);},_contentStatusSetter:function(_32a){this.contentStatus=_32a;if(!_32a){return;}this.set("statusIcon",this._statusIconMap[_32a]);return when(this._getStatusMessage(),lang.hitch(this,function(_32b){return this.set("statusMessage",_32b);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _326.versionnotfound;}if(this.get("isTranslationNeeded")){return _325.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageMap[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _32c=this.get("missingLanguageBranch");if(this.get("isDeleted")||_32c&&_32c.reason===6){return false;}return this.get("contentStatus")===_323.versionStatus.Published;}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_32d,_32e,all,_32f,_330){return {getMissingLanguageMessage:function(_331){if(!_331||!_331.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_32f.resolve("epi.storeregistry").get("epi.cms.language");var def=new _32e();var _332=_331.missingLanguageBranch;all([this._languageStore.get(_332.preferredLanguage),this._languageStore.get(_332.language)]).then(lang.hitch(this,function(_333){var _334=_332.reason;var _335="languagenotifications.";if(_334===6){_335+="missing";}else{if(_334===3||_334===5){_335+="replacement";}else{if(_334===4){_335+="fallback";}}}var _336=_330.getResourceValue(_331.typeIdentifier,_335);_336=lang.replace(_336,[_333[0].name,_333[1].name]);def.resolve(_336);}),function(){def.resolve("");});return def;}};});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_337,_338,_339,_33a,Tree,_33b,_33c,_33d,_33e){return _337([Tree._TreeNode,_33b,_33d],{templateString:_33e,buildRendering:function(){this.inherited(arguments);_338.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _33f=_339.create("img",{src:item.thumbnailUrl+_33a.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_33f);_338.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _340=1;if("dojoxFFEllipsisDelay" in d.config){_340=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_340)){_340=1;}}try{var _341=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _342=document.createElementNS(sNS,"description");_342.setAttribute("crop","end");xml.appendChild(_342);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _343=d.create;var dd=d.doc;var dp=d.place;var _344=_343("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _345=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_345(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_345(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _346=r.endContainer.childNodes[r.endOffset-1];if(_346.nodeType==3){r.setEnd(_346,_346.length-1);}else{if(_346.childNodes.length){r.setEnd(_346,_346.childNodes.length);_345(r);return;}else{r.setEndBefore(_346);_345(r);return;}}}else{r.setEndBefore(r.endContainer);_345(r);return;}}}};var _347=function(n){var c=_343("div",{className:"dojoxEllipsisContainer"});var e=_343("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_344.cloneNode(true);var ns=n.style;var es=e.style;var _348;var _349=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _34a=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_34a=Math.max(Math.round(e.textContent.length*pct)-1,1);}_345(r,_34a);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_349;_349();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_341&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_341(n);}else{_347(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _34b=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_34b);},_340);};_34b();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_34c,_34d){var _34e={};lang.setObject("dojo.colors",_34e);var _34f=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_34c.fromRgb=function(_350,obj){var m=_350.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_34d.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _34c.fromArray(a,obj);}return _34c.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_34f(m1,m2,H+1/3)*256,_34f(m1,m2,H)*256,_34f(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _34c.fromArray(a,obj);}}return null;};var _351=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_34c.prototype.sanitize=function(){var t=this;t.r=Math.round(_351(t.r,0,255));t.g=Math.round(_351(t.g,0,255));t.b=Math.round(_351(t.b,0,255));t.a=_351(t.a,0,1);return this;};_34e.makeGrey=_34c.makeGrey=function(g,a){return _34c.fromArray([g,g,g,a]);};lang.mixin(_34c.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _34c;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_352,lang,when,_353,_354,_355,_356){return _352(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicatorForItem:function(item){var _357=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_357.language||"";when(_356.getMissingLanguageMessage(item),lang.hitch(this,function(_358){_353.set(this.iconNodeLanguage,"title",_358||"");}));}_354.add(this.rowNode,this._missingLanguageCssClass);},_addLanguageIndicator:function(){this._addLanguageIndicatorForItem(this.item);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_355.empty(this.iconNodeLanguage);_353.remove(this.iconNodeLanguage,"title");}_354.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \r\n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/DialogService","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_359,lang,_35a,_35b,_35c,when,json,_35d,_35e,_35f,_360,_361,_362,_363,res,_364){return function(_365){var _366=function(_367){return _367&&typeof _367=="function";};var _368=function(_369,_36a){_361.alert(_35f.toHTML(_369)).then(function(){if(_366(_36a)){_36a();}});};var _36b=function(_36c,_36d){return when(_36d).then(function(_36e){return _361.confirmation({description:_35f.toHTML(_36e),title:_36c});});};var _36f=function(_370,_371){when(_370,function(_372){if(_372&&(_372.message||_372.statusDescription)){var _373=_372.message||_372.statusDescription;_368(_373,_371);}else{if(_366(_371)){_371();}}},function(e){_368(_35d.encode(json.fromJson(e.xhr.responseText)));});return _370;};var _374=function(_375,_376,copy,_377,_378,_379){var _37a=_375[0],_37b=_375.length>1?"move.multiple.":"move.single.";var _37c=_375.every(function(_37d){return _37d.typeIdentifier===_37a.typeIdentifier;})?_37a.typeIdentifier:"episerver.core.icontentdata";var _37e=_360.getResourceValue(_37c,_37b+"title");var _37f=null;if(_376.isWastebasket){_37f=_363({contentItems:_375});}else{if(_377!==undefined&&(_376.properties.pageChildOrderRule!==_362.sortOrder.Index)){var _380,_381;if(copy){_37b=_375.length>1?"copy.multiple.":"copy.single.";_381=_360.getResourceValue(_37c,_37b+"title");_380=_35c.substitute(res.changepeerorderconfirmationcopy,[_365.getLabel(_376)]);}else{_381=_37e;_380=_35c.substitute(res.changepeerorderconfirmation,[_365.getLabel(_376)]);}_37f=_36b(_381,_380);}else{if(!copy){if(_375.some(function(item){return !_365.canCut(item);})){_368(_360.getResourceValue(_37c,"moverequiresdeleteaccess"),function(){return false;});return false;}var _382="{0}<br/><br/>{1}",_383=lang.replace(_360.getResourceValue(_37c,_37b+"confirmation"),[_375.length]),_384=lang.replace(_382,[_383,_360.getResourceValue(_37c,"movedescription")]);var _385=_35e.resolve("epi.cms.ProjectService");if(_385.isProjectModeEnabled){_384=lang.replace(_382,[_384,_364.moveconfirmation]);}_37f=_36b(_37e,_384);}else{if(!_365.canCopy(_37a)){_368(_360.getResourceValue(_37c,"copynotsupported"));return false;}}}}return when(_37f,function(){return _378.apply(_365,_379);},function(){return false;});};_35a.around(_365,"pasteItem",function(_386){return function(_387,_388,_389,copy,_38a){return _374([_387],_389,copy,_38a,_386,arguments);};});_35a.around(_365,"pasteItems",function(_38b){return function(_38c,_38d,copy,_38e){return _374(_38c,_38d,copy,_38e,_38b,arguments);};});_35a.after(_365,"pasteItem",function(_38f){return _38f&&_36f(_38f);});_35a.after(_365,"remove",function(_390){return _390&&_36f(_390);});return _365;};});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojox/html/entities","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_391,_392,epi,_393,_394,_395,_396,_397){var _398=function(_399){var _39a=new _391(),_39b=_399.contentItems,_39c=_39b[0],_39d=new _395({target:document.body,zIndex:999}).placeAt(document.body);_39d.show(50,0);var mode=_399.mode||_398.mode.confirm,_39e=mode===_398.mode.confirm,_39f=new _396({contentItems:_39b,mode:mode});var _3a0=_39f.watch("numberOfReferences",function(_3a1,_3a2,_3a3){_3a0.remove();var _3a4=_39b.length===1;var _3a5;var _3a6=_3a4?"movetotrashsingleitemdescription":"movetotrashdescription";if(_39e){_3a5=_393.getResourceValue(_39c.typeIdentifier,_3a6);_3a5=lang.replace(_3a5,[_3a4?_392.encode(_39c.name):_39b.length]);}else{_3a5=_393.getResourceValue(_39c.typeIdentifier,"referencesdescription");_3a5=lang.replace(_3a5,[_392.encode(_39c.name)]);}var _3a7=_399.title;if(!_3a7){var _3a8=_39e?(_3a4?"movetotrashsingleitem":"movetotrash"):"references";_3a7=_393.getResourceValue(_39c.typeIdentifier,_3a8);}var _3a9=new _394({focusActionsOnLoad:true,defaultActionsVisible:_39e,dialogClass:"epi-dialog-contentReferences",title:_3a7,description:_3a5,cancelActionText:epi.resources.action.cancel,confirmActionText:_3a3===0?_397.buttons.movetotrash:_397.buttons.movetotrashanyway,setFocusOnConfirmButton:_3a3===0});if(!_39e){_3a9.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_3a9.onCancel});}_3a9.connect(_3a9,"onExecute",_39a.resolve);_3a9.connect(_3a9,"onCancel",_39a.cancel);_3a9.set("content",_39f);var _3aa=_39f.on("viewReference",function(){_3a9.hide();_3aa.remove();});_39d.hide();var _3ab=_39f.grid.on("dgrid-refresh-complete",function(){_3ab.remove();_3a9.show();}.bind(this));});_39f.startup();return _39a.promise;};_398.mode={confirm:"confirm",show:"show"};return _398;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/dependency","dgrid/tree","./_GridWidgetBase","./viewmodel/ContentReferencesViewModel","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_3ac,lang,_3ad,_3ae,_3af,keys,when,_3b0,_3b1,tree,_3b2,_3b3,_3b4,_3b5,_3b6,_3b7,_3b8,_3b9){return _3ac([_3b2,_3b4,_3b5,_3b6,_3b7],{res:_3b9,templateString:_3b8,storeKeyName:"epi.cms.referenced-content",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,modelBindingMap:{notification:["notification"],notificationBarStyle:["notificationBarStyle"],numberOfReferences:["numberOfReferences"],showToolbar:["showToolbar"],showGrid:["showGrid"],totalLinks:["totalLinks"]},constructor:function(_3ba){this.model=lang.mixin(new _3b3(),_3ba);this.own(this.model);},_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_3bb){switch(_3bb){case 1:_3ad.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_3ad.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setShowToolbarAttr:function(_3bc){_3af.set(this.captionPanelNode,"display",_3bc?"":"none");},_setShowGridAttr:function(_3bd){_3af.set(this.grid.domNode,"visibility",_3bd?"visible":"hidden");},postMixInProperties:function(){this.inherited(arguments);this.store=this.model.getUpdatedStore(this.store);},buildRendering:function(){var _3be=this._getLinkTemplate();var _3bf=lang.mixin({columns:{name:tree({renderCell:lang.hitch(this,"_renderContentItem"),shouldExpand:function(){return true;}}),language:{className:"epi-width10",renderCell:function(obj,_3c0,node){if(!_3c0){return;}when(_3b1.resolve("epi.shell.Profile").getContentLanguage(),function(_3c1){if(_3c0!==_3c1){node.textContent=_3c0;}});}},treePath:{className:"epi-width50",get:function(item){var _3c2=item.treePath||[];return _3c2.join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");},ellipsisNoTooltip:true},uri:{className:"epi-width10",label:" ",formatter:function(_3c3){return _3c3?_3be:"";},sortable:false}},store:this.store,query:{ids:this.model.contentItems.map(function(_3c4){return _3c4.contentLink;})},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_3bf,this.gridNode);_3ad.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode==="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-uri a:click",lang.hitch(this,"_onChangeContext"));},fetchData:function(){this.grid.refresh();},_onChangeContext:function(e){var row=this.grid.row(e),_3c5={uri:row.data.uri};if(_3c5.uri){this._requestNewContext(_3c5,{sender:this});this.emit("viewReference");}},_getLinkTemplate:function(){var node=_3ae.create("a",{"class":"epi-visibleLink",innerHTML:_3b9.view.label,title:_3b9.view.tooltip});return node.outerHTML;}});});},"dgrid/tree":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_3c6,_3c7,_3c8,_3c9,on,_3ca,has,Grid,_3cb,put){function _3cc(_3cd,_3ce,_3cf,_3d0){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_3ce){cls+=".ui-icon.ui-icon-triangle-1-"+(_3cf?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(_3cd*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _3d1(_3d2){var _3d3=this,_3d4=this.style.height;if(_3d4){this.style.display=_3d4=="0px"?"none":"block";}if(_3d2){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_3d3,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_3d5){var _3d6=_3d5.renderCell||Grid.defaultRenderCell;var _3d7,_3d8;if(!_3d5){_3d5={};}_3d5.shouldExpand=_3d5.shouldExpand||function(row,_3d9,_3da){return _3da;};_3ca.after(_3d5,"init",function(){var grid=_3d5.grid,_3db=".dgrid-content .dgrid-column-"+_3d5.id,_3dc=[];grid.cleanEmptyObservers=false;if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_3d5.renderExpando){_3d5.renderExpando=_3cc;}_3dc.push(grid.on(_3d5.expandOn||".dgrid-expando-icon:click,"+_3db+":dblclick,"+_3db+":keydown",function(_3dd){var row=grid.row(_3dd);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(_3dd.type!="keydown"||_3dd.keyCode==32)&&!(_3dd.type=="dblclick"&&_3d8&&_3d8.count>1&&row.id==_3d8.id&&_3dd.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(_3dd.target.className.indexOf("dgrid-expando-icon")>-1){if(_3d8&&_3d8.id==grid.row(_3dd).id){_3d8.count++;}else{_3d8={id:grid.row(_3dd).id,count:1};}}}));if(has("touch")){_3dc.push(grid.on(_3cb.selector(_3db,_3cb.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_3dc.push(_3ca.after(grid,"insertRow",function(_3de){var row=this.row(_3de),_3df=_3d5.shouldExpand(row,_3d7,this._expanded[row.id]);if(_3df){this.expand(_3de,true,true);}return _3de;}));_3dc.push(_3ca.before(grid,"removeRow",function(_3e0,_3e1){var _3e2=_3e0.connected;if(_3e2){_3c9(">.dgrid-row",_3e2).forEach(function(_3e3){grid.removeRow(_3e3,true);});if(!_3e1){put(_3e2,"!");}}}));if(_3d5.collapseOnRefresh){_3dc.push(_3ca.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_3e4){var _3e5=_3e4.connected;return _3e4.offsetHeight+(_3e5?_3e5.offsetHeight:0);};grid.expand=function(_3e6,_3e7,_3e8){var row=_3e6.element?_3e6:grid.row(_3e6),_3e9=has("transitionend"),dfd=new _3c8(),_3ea=dfd.promise;dfd.resolve();_3e6=row.element;_3e6=_3e6.className.indexOf("dgrid-expando-icon")>-1?_3e6:_3c9(".dgrid-expando-icon",_3e6)[0];_3e8=_3e8||_3d5.enableTransitions===false;if(_3e6&&_3e6.mayHaveChildren&&(_3e8||_3e7!==!!this._expanded[row.id])){var _3eb=_3e7===undefined?!this._expanded[row.id]:_3e7;put(_3e6,".ui-icon-triangle-1-"+(_3eb?"se":"e")+"!ui-icon-triangle-1-"+(_3eb?"e":"se"));var _3ec=row.element,_3ed=_3ec.connected,_3ee,_3ef,_3f0={originalQuery:this.query};if(!_3ed){_3ed=_3f0.container=_3ec.connected=put(_3ec,"+div.dgrid-tree-container");var _3f1=function(_3f2){return grid.store.getChildren(row.data,_3f2);};if(_3d5.allowDuplicates){_3f0.parentId=row.id;}if("level" in _3e6){_3f1.level=_3e6.level;}_3ea=_3ea.then(function(){if(grid.renderQuery){return grid.renderQuery(_3f1,_3f0);}var _3f3=put(_3ed,"div");var rows=grid.renderArray(_3f1(_3f0),_3f3,"level" in _3f1?{queryLevel:_3f1.level}:{});_3c8.when(rows,function(){put(_3f3,"!");});return rows;});if(_3e9){on(_3ed,_3e9,_3d1);}else{_3d1.call(_3ed);}}_3ed.hidden=!_3eb;_3ee=_3ed.style;if(!_3e9||_3e8){_3ee.display=_3eb?"block":"none";_3ee.height="";}else{if(_3eb){_3ee.display="block";_3ef=_3ed.scrollHeight;_3ee.height="0px";}else{put(_3ed,".dgrid-tree-resetting");_3ee.height=_3ed.scrollHeight+"px";}setTimeout(function(){put(_3ed,"!dgrid-tree-resetting");_3ee.height=_3eb?(_3ef?_3ef+"px":"auto"):"0px";});}if(_3eb){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}return _3ea;};_3ca.after(_3d5,"destroy",function(){_3c7.forEach(_3dc,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_3d5.renderCell=function(_3f4,_3f5,td,_3f6){var grid=_3d5.grid,_3f7=Number(_3f6&&_3f6.queryLevel)+1,_3f8=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_3f4),_3f9=_3f6.parentId,_3fa,node;_3f7=_3d7=isNaN(_3f7)?0:_3f7;_3fa=_3d5.renderExpando(_3f7,_3f8,grid._expanded[(_3f9?_3f9+"-":"")+grid.store.getIdentity(_3f4)],_3f4);_3fa.level=_3f7;_3fa.mayHaveChildren=_3f8;node=_3d6.call(_3d5,_3f4,_3f5,td,_3f6);if(node&&node.nodeType){put(td,_3fa);put(td,node);}else{td.insertBefore(_3fa,td.firstChild);}};return _3d5;};tree.defaultRenderExpando=_3cc;return tree;});},"epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_3fb,lang,_3fc,_3fd,keys,_3fe,when,_3ff,_400,_401,_402,epi,_403,_404,_405,_406,_407,_408,_409,DnD,_40a,_40b,_40c){return _3fb([_402,_408],{_gridClass:_3fb([_400,_406,_401,DnD,_3ff,_40b]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",forceContextReload:false,selectionMode:"single",selection:null,postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:this.get("selectionMode"),dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _40d=_40c.resolve("epi.storeregistry");this.store=_40d.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _40e=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_40e);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_40e);this.grid.addKeyHandler(keys.SPACE,_40e);}}this.grid.on("dgrid-select, dgrid-deselect",lang.hitch(this,"_onSelectionChanged"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_3fc.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){var _40f=(item instanceof _409?item:new _409(item.id)).createVersionUnspecificReference().toString();this.grid.select(_40f);}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){this._onChangeContextInternal(e);},_onChangeContextInternal:function(e){var row=this.grid.row(e),uri=row.data.uri,_410={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_410,{sender:this,forceReload:this.forceContextReload});},_onSelectionChanged:function(e){var _411=[];for(var id in this.grid.selection){if(this.grid.selection[id]){var row=this.grid.row(id);_411.push(row.data);}}this.set("selection",_411);this.emit("selectionChanged",{selection:_411});this._onSelect(e);},_onSelect:function(e){},_onError:function(e){var _412=this.grid.errorMessage;var _413=e.error;if(_413.status&&_413.status===403){_412=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_412);},_requestNewContext:function(_414,_415){_3fe.publish("/epi/shell/context/request",_414,_415);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_416){var _417=row.data.uri;return _416&&this._compareUris(_417,_416.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_418){if(_418){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_419,_41a){this.inherited(arguments);if(_419.type!=="epi.cms.contentdata"){return;}if(!_41a||_41a.sender!==this){this.onContextChanged(_419);}},onContextChanged:function(_41b){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_41c){this.grid.cleanup();this.grid.contentNode.innerHTML=_41c||"";},contextChangeFailed:function(_41d,_41e,_41f){this.inherited(arguments);if(_41f&&_41f.sender===this){this._selectActiveItem();}},_renderContentItem:function(_420,_421,node,_422){node.innerHTML=_40a.contentItem(_420.typeIdentifier,_420.missingLanguageBranch,_421);},_localizeDate:function(_423){return _40a.localizedDate(_423);},_createUserFriendlyUsername:function(name){return _40a.userName(name);},_dndNodeCreator:function(item,hint){var _424=_407.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_424&&this.dndTypes){_424=this.dndTypes;}var node=_3fd.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_424,data:item};},_aroundInsertRow:function(_425){return lang.hitch(this,function(_426,_427,_428,i,_429){var row=_425.apply(this.grid,arguments);var _42a=this.get("currentItem");if(_42a){var _42b=(_42a instanceof _409?_42a:new _409(_42a.id)).createVersionUnspecificReference().toString();if(_42b===_426.contentLink){this.select(_42a);}}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_42c){return {id:_409.tryConvert(_42c.id,_42c).id};});},_setSelectionModeAttr:function(_42d){if(this.grid){this.grid.set("selectionMode",_42d);}this._set("selectionMode",_42d);}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_42e,lang,_42f,_430,_431,_432,_433,put){var _434=_42e(_430,{_legalMouseDown:function(evt){var _435=this.inherited(arguments);return _435&&evt.target!==this.grid.bodyNode;},getSelectedNodes:function(){var grid=this.grid;var _436=this.inherited(arguments);if(!grid.selection||Object.keys(grid.selection).length===0){if(_436.length){grid.select(_436[0]);}return _436;}var _437=false;var _438=new _42f();for(var id in grid.selection){if(grid.row(id).element!==_436[0]){_438.push(grid.row(id).element);}else{_437=true;_438.push(_436[0]);}}if(_437){return _438;}grid.clearSelection();if(_436.length){grid.select(_436[0]);}return _436;},destroy:function(){this.grid=null;this.inherited(arguments);}});return _42e([],{dndSourceTypes:null,dndParams:null,dndConstructor:_434,dndDisabled:false,dndFormatSuffix:null,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},destroy:function(){this.inherited(arguments);this.dndSource&&this.dndSource.destroy();this.dndParams=this.dndSource=null;},insertRow:function(_439){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_439,type:this._getDndType(_439),options:opts});return row;},_getDndType:function(_43a){var _43b=_433.getAndConcatenateValues(_43a.typeIdentifier,"dndTypes");if((!_43b||_43b.length<=0)&&this.dndSourceTypes){_43b=this.dndSourceTypes;}if(this.dndFormatSuffix){_43b=_43b.map(lang.hitch(this,function(type){return type+"."+this.dndFormatSuffix;}));}return _43b;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new this.dndConstructor(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _43c,node;_43c=this._getDndType(item);if(!_43c&&this.dndTypes){_43c=this.dndTypes;}node=_431.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_43c,data:item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/query","dgrid/extensions/DijitRegistry","epi/shell/DestroyableByKey","epi/shell/widget/ContextMenu","epi-cms/extension/events"],function(_43d,_43e,_43f,_440,on,_441,_442,_443,_444,_445){return _43d([_443,_442],{contextMenu:null,commandCategory:"context",stopPropagation:false,_contextMenuClass:"epi-iconContextMenu",postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _444({category:this.commandCategory,popupParent:this});this.own(this.contextMenu,this.on("."+this._contextMenuClass+":click",this._contextMouseHandler.bind(this)),this.on(on.selector(".dgrid-row",_445.keys.shiftf10),this._contextKeyHandler.bind(this)));},startup:function(){this.inherited(arguments);this.contextMenu.startup();},onContextMenuClick:function(e){if(this.selection){this.select(e.target);}on.emit(e.target,"dgrid-contextmenu",{bubbles:true});this.contextMenu.scheduleOpen(this.domNode,null,{x:e.pageX,y:e.pageY});},_extendedSelectionHandler:function(e,_446){var _447=new RegExp("\\b"+this._contextMenuClass+"\\b");if(_447.test(e.target.className)&&this.isSelected(_446)){return;}this.inherited(arguments);},_isNodeVisible:function(_448){if(!_448){return false;}var _449=_440.get(_448);return _449.display!=="none"&&_449.visibility!=="hidden";},_contextMouseHandler:function(e){if(this.stopPropagation){e.stopImmediatePropagation();e.stopPropagation();}this.onContextMenuClick(e);},_contextKeyHandler:function(e){var _44a=_441("."+this._contextMenuClass,e.target)[0],_44b;if(!this._isNodeVisible(_44a)){return;}e.stopPropagation();e.preventDefault();_44b=_43f.position(_44a);this.onContextMenuClick({target:_44a,pageX:_44b.x,pageY:_44b.y});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dojo/aspect","dojo/dom-geometry","dijit/Menu","dijit/popup","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_44c,_44d,_44e,Menu,_44f,_450,_451,_452,_453){var _454;_44d.before(_44f,"open",function(args){var _455=args.popup;if(_455&&_455 instanceof _454&&_455.popupParent){args.parent=_455.popupParent;return [args];}});return _454=_44c([Menu,_450],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _456={builder:new _452(),target:this,category:this.category},_457;var _458=[_456,{builder:new _453(),target:this,category:"menuWithSeparator"},{builder:new _452(),target:this,category:"popup"}];_457=new _451({configuration:_458,commandSource:this});_457.build();},scheduleOpen:function(_459,_45a,_45b,_45c){this._scheduleOpen(_459,_45a,_45b,_45c);},forceOpen:function(e){if(!e.target||!e.target.parentElement){return;}var _45d=e.target.parentElement.querySelector(".epi-iconContextMenu");if(!_45d){return;}e.stopPropagation();e.preventDefault();var _45e=_44e.position(_45d);this.scheduleOpen(_45d,null,{x:_45e.x,y:_45e.y});}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_45f,_460,lang,on,_461,_462){return _460([_462],{_addToContainer:function(_463,_464){this.inherited(arguments,[_463,_464]);var _465=new _461({_command:{order:_463._command.order}});this.inherited(arguments,[_465,_464]);},_onBeforeChildDestroy:function(_466,_467){var _468=this._getChildren(_466);if(_467<_468.length-1){var _469=_468[_467+1];if(_466&&_466.declaredClass){_466.removeChild(_469);}_469.destroy();}}});});},"epi-cms/extension/events":function(){define(["dojo/keys","dojo/on"],function(keys,on){function _46a(e){return e.keyCode===keys.DELETE;};function _46b(e){return e.shiftKey;};function _46c(e){return e.keyCode===keys.F10;};function _46d(e){return _46b(e)&&_46c(e);};function _46e(type,_46f){var _470=function(node,_471){return on(node,type,function(evt){if(_46f){return _46f(evt,_471);}return _471.call(this,evt);});};return _470;};return {selector:on.selector,contextmenu:_46e("contextmenu",function(e,_472){_472.call(this,e);}),keys:{shiftf10:_46e("keyup",function(e,_473){if(_46d(e)){_473.call(this,e);}}),del:_46e("keydown",function(e,_474){if(_46a(e)){_474.call(this,e);}})}};});},"epi-cms/widget/viewmodel/ContentReferencesViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/store/util/QueryResults","dojo/when","epi/shell/TypeDescriptorManager","dojo/Stateful","dijit/Destroyable","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(_475,lang,_476,_477,when,_478,_479,_47a,_47b){return _475([_479,_47a],{contentItems:null,mode:null,notification:null,notificationBarStyle:null,numberOfReferences:null,showToolbar:null,showGrid:null,totalLinks:null,getUpdatedStore:function(_47c){var _47d=lang.delegate(_47c,{getChildren:function(_47e){return new _477(_47e.references);},mayHaveChildren:function(_47f){return !!_47f.references&&_47f.references.length>0;}});this.own(_476.after(_47d,"query",function(_480){when(_480).then(this._afterStoreQuery.bind(this));return _480;}.bind(this)));return _47d;},_afterStoreQuery:function(_481){var _482=this._getReferencesCount(_481);this._updateReferenceProperties(_482);this.set("showToolbar",_482>0);this.set("showGrid",_482>0);},_getReferencesCount:function(_483){return _483.reduce(function(_484,_485){return _484+_485.references.length;},0);},_updateReferenceProperties:function(_486){var _487=this.contentItems,_488=_487[0],_489=_486>0,_48a=_487.length===1,_48b=_487.some(function(item){return item.hasChildren;}),_48c=_487.some(function(item){return !!item.publicUrl;});var _48d=function(_48e,_48f){_48e="reference."+(_48a?"single":"multiple")+"."+_48e;var text=_478.getResourceValue(_488.typeIdentifier,_48e);this.set("notification",text);this.set("notificationBarStyle",_48f);}.bind(this);if(_489){_48d(_48b?"usedwithchildren":"used",2);}else{if(_48c){_48d(_48b?"publicwithchildren":"public",2);}else{_48d(_48b?"notusedwithchildren":"notused",_48b?2:1);}}if(_489){var _490=_486===1?_47b.totallink:_47b.totallinks;var _491=lang.replace(_490,[_486]);this.set("totalLinks",_491);}this.set("numberOfReferences",_486);}});});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:fetchData\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi/epi","epi-cms/widget/ContentTreeStoreModel"],function(_492,_493,lang,_494,when,epi,_495){return _493([_495],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_496){var _497=this.inherited(arguments);return _497||!!(_496&&this.roots&&(_492.indexOf(this.roots,this.getIdentity(_496))>=0));},getRoot:function(_498){_498(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_499,_49a,_49b){if(_499===this.root){var _49c=_492.map(this.roots,function(item){return this.store.get(item);},this);when(_494(_49c),_49a,_49b);}else{this.inherited(arguments);}},getAncestors:function(item,_49d){if(this.roots.some(function(_49e){return this.getIdentity(item)===_49e;},this)){_49d([this.root]);return;}var root=this.root,_49f=lang.hitch(this,function(_4a0){if(_492.some(this.roots,function(_4a1){return this.getIdentity(_4a0[0])===_4a1;},this)){_4a0.unshift(root);}_49d(_4a0);});this.inherited(arguments,[item,_49f]);},getIdentity:function(item){return epi.areEqual(item,this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_4a2,_4a3,_4a4,lang,_4a5,_4a6,_4a7,_4a8,when,_4a9,epi,_4aa,_4ab,_4ac,_4ad,_4ae,_4af,_4b0,_4b1,_4b2){return _4a4([_4a5,_4b1,_4b2,_4ac],{store:null,service:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,autoSelectPastedItem:true,constructor:function(args){_4a4.safeMixin(this,args);this._observers={};this.store=this.store||_4aa.resolve("epi.storeregistry").get(this._defaultDataStoreName);this.service=this.service||_4aa.resolve("epi.cms.ContentHierarchyService");this._queryOptions=lang.mixin({ignore:["query"],comparers:{typeIdentifiers:lang.hitch(this,function(_4b3,_4b4){return _4a2.some(_4b3,lang.hitch(this,function(item){return item===_4b4.typeIdentifier||_4ab.isBaseTypeIdentifier(_4b4.typeIdentifier,item);}));}),referenceId:function(_4b5,_4b6){return _4b0.compareIgnoreVersion(_4b5,_4b6.parentLink);},allLanguages:function(_4b7,_4b8){if(_4b7||!_4b8.currentLanguageBranch){return true;}return epi.areEqual(_4ae.currentContentLanguage,_4b8.currentLanguageBranch.languageId);},references:function(_4b9,_4ba){return _4b9.some(function(_4bb){return _4b0.compareIgnoreVersion(_4bb,_4ba.parentLink);});}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _4bc=_4a3.subscribe("/epi/cms/contentdata/updated",this,function(_4bd){var _4be=new _4b0(_4bd.contentLink).createVersionUnspecificReference().toString();this.store.refresh(_4be).then(lang.hitch(this,function(){if(_4bd.recursive){this.onItemChildrenReload(_4bd);}}));});var _4bf=_4a3.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _4c0=_4a6.after(this.store,"notify",lang.hitch(this,function(item,id){this.onChange(item);}),true);this._handles=[_4bc,_4bf,_4c0];},destroy:function(){for(var id in this._observers){if(this._observers[id]){this._observers[id].remove();this._observers[id]=null;}}if(this._handles){_4a2.forEach(this._handles,function(_4c1){_4c1.remove();});this._handles=null;}},isSupportedType:function(_4c2){return _4a2.some(this.typeIdentifiers,function(type){return type===_4c2||_4ab.isBaseTypeIdentifier(_4c2,type);});},_showAllLanguagesSetter:function(_4c3){this.showAllLanguages=_4c3;this.onItemChildrenReload(this.root);},getRoot:function(_4c4,_4c5){if(lang.isArray(this.root)){_4c4({});}else{when(this.store.get(this.root),_4c4,_4c5);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_4c6,_4c7){var id=this.getIdentity(_4c6),_4c8=this._observers[id],_4c9=id===this.root,_4ca=_4c9&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_4cb=this._createQuery({referenceId:id,query:_4ca}),_4cc=this.store.query(_4cb,this._queryOptions);if(_4c8){_4c8.remove();delete this._observers[id];}this._observers[id]=_4cc.observe(function(item,_4cd,_4ce){when(this.store.query(_4cb,this._queryOptions),this.onChildrenChange.bind(this,_4c6));}.bind(this),true);when(_4cc,_4c7);},_getSortSettings:function(_4cf){if(!_4cf){return {};}if(_4cf instanceof String){_4cf=[_4cf];}var _4d0,_4d1=[];_4cf.map(function(type){_4d0=_4ab.getValue(type,"sortKey");if(_4d0){_4d1.push(_4d0.sortDescending?{attribute:_4d0.columnName,descending:true}:{attribute:_4d0.columnName});}});return _4d1;},_createQuery:function(_4d2,_4d3){var _4d4=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _4d5=this.showAllLanguages?{allLanguages:true}:{},_4d6=_4d3?{}:{typeIdentifiers:_4d4};var _4d7=lang.mixin(_4d2,_4d6,_4d5);return _4d7;},_createChildrenQuery:function(_4d8,_4d9){var _4da=lang.mixin(_4d8,{query:"getchildren"});return this._createQuery(_4da,_4d9);},move:function(_4db,_4dc){var _4dd=_4db.map(function(item){return item.data;});return this.pasteItems(_4dd,_4dc,false);},remove:function(_4de){_4de=_4de.map(function(item){return item.data;});var _4df=_4de.map(function(item){return this.store.remove(item.contentLink);},this);return _4a8(_4df).then(lang.hitch(this,function(){this.onDeleted(_4de);}));},copy:function(_4e0,_4e1){var _4e2=_4e0.map(function(item){return item.data;});return this.pasteItems(_4e2,_4e1,true);},pasteItems:function(_4e3,_4e4,copy,_4e5){var _4e6=copy?"copy":"move",ids,_4e7=[],_4e8;ids=_4e3.map(this.getIdentity,this);return when(this.getCurrentContext()).then(function(ctx){return this._isNodeAContextAncestor(ids,ctx).then(function(_4e9){_4e8=_4e9;return _4e9;});}.bind(this)).then(function(){return this.service[_4e6](ids,this.getIdentity(_4e4),this.createAsLocalAsset,_4e5);}.bind(this)).then(function(_4ea){return _4a8(_4e3.map(function(item){var _4eb=_4ea.extraInformation[item.contentLink].extraInformation||item.contentLink;var _4ec=_4b0.toContentReference(_4eb).createVersionUnspecificReference().toString();return this.store.get(_4ec);},this));}.bind(this)).then(function(_4ed){if(_4e4.isWastebasket){this._handleSelect(_4e3,_4e8);}else{_4a9.publish("/epi/cms/contentdata/childrenchanged",_4e4.contentLink);var _4ee=[];_4e3.forEach(function(_4ef){if(_4ee.indexOf(_4ef.parentLink)===-1){_4a9.publish("/epi/cms/contentdata/childrenchanged",_4ef.parentLink);_4ee.push(_4ef.parentLink);}});}this._handleDelete(_4ed);_4ed.forEach(function(item){this._onPasteComplete(item,item.isDeleted,null,_4e4);},this);_4e7=_4ed.filter(function(item){return _4e3.some(function(_4f0){return (_4f0.contentLink===item.contentLink)&&(_4f0.parentLink===item.parentLink);});});if(this.createAsLocalAsset===true){_4a9.publish("/epi/cms/action/createlocalasset");}}.bind(this)).then(function(){if(_4e7.length>0){this.onPasteItemsFailed(_4e7);}}.bind(this));},pasteItem:function(_4f1,_4f2,_4f3,copy,_4f4){return this.pasteItems([_4f1],_4f3,copy,_4f4).then(function(_4f5){return _4f5.extraInformation[_4f1.contentLink];});},onPasteComplete:function(){},_onPasteComplete:function(item,_4f6,_4f7,_4f8){this.onPasteComplete();this._selectItemOnPasteComplete(item,_4f6,_4f7,_4f8);},_selectItemOnPasteComplete:function(item,_4f9,_4fa,_4fb){if(this.autoSelectPastedItem&&item&&item.contentLink&&!_4f9){this.onSelect(item.contentLink,true);}},newItem:function(item,_4fc){this.newItems([item],_4fc);},newItems:function(_4fd,_4fe){var _4ff=_4fd.map(function(item){return item.dndData.data;});this._pasteNewItems(_4ff,_4fe);},_pasteNewItems:function(_500,_501){this.pasteItems(_500,_501,false);},_updateItemChanged:function(_502){when(this.store.refresh(_502),lang.hitch(this,function(_503){this._childrenChanged(_503);}));},_childrenChanged:function(_504){var dfd=new _4a7();this.getChildren(_504,lang.hitch(this,function(_505){this.onChildrenChange(_504,_505);dfd.resolve(_505);}));return dfd;},_isNodeAContextAncestor:function(_506,_507){var dfd=new _4a7(),_508=_506.some(function(_509){return _4b0.compareIgnoreVersion(_509,_507.id);});if(_508){dfd.resolve(true);}else{this.getAncestors(_507,function(_50a){var _50b=_50a.some(function(_50c){return _506.indexOf(_50c.contentLink)>-1;});dfd.resolve(_50b);});}return dfd.promise;},_handleSelect:function(_50d,_50e){var _50f,_510;if(_50e){_50f=_50d[0];if(_50f.capabilities.isPage){_510=_50d.length===1&&_50f;this.onSelect(_510?_510.parentLink:_4ae.startPage,true);return;}_4a9.publish("/epi/shell/context/request",{uri:_4ad.settings.defaultContext});}var _511=_50d.filter(function(_512){return this.isSupportedType(_512.typeIdentifier);}.bind(this));if(_511.length===1){this.onSelect(_511[0].parentLink,true);}else{if(_511.length>1){this.onSelect(_4ae.globalAssetsFolder,true);}}},checkItemAcceptance:function(_513,_514){var _515=_514.getSelectedNodes?_514.getSelectedNodes():_514.getSelectedTreeNodes();var _516=_515.map(function(node){var item=_514.getItem(node.id);var data=item.data;if(data.dndData){data=data.dndData;}return this.canPaste(data,_513);},this);return _4a8(_516).then(function(_517){return _517.every(function(_518){return _518;});});},_handleDelete:function(_519){var _51a=_519.filter(function(item){return item.isDeleted;});if(_51a.length>0){_51a.forEach(function(item){var id=this.getIdentity(item),_51b=this._observers[id];if(_51b){_51b.remove();delete this._observers[id];}this.onDelete(item,true);},this);this.onDeleted(_51a);}},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_51c){var _51d=_4ab.getValue(item.typeIdentifier,"iconClass");if(!_51d){return _51c;}var _51e="";switch(parseInt(item.contentLink,10)){case _4ae.globalAssetsFolder:_51e="AllSites";break;case _4ae.siteAssetsFolder:_51e="ThisSite";break;default:break;}return (_51e===""&&_51d===_51c)?_51d:(_51c+" "+_51d+_51e);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _51f=new _4a7();this.getAncestors(item,lang.hitch(this,function(_520){_51f.resolve(this.getIdentity(_520[0])===this.root.id);}));return _51f.promise;},canCopy:function(item){if(!item){return false;}var _521=item.contentLink,_522=_521===this.root||(_4a2.indexOf(this.notAllowToCopy,_521)>=0);return !_522&&_4af.hasAccess(item.accessMask,_4af.accessLevel.Read)&&_4af.hasProviderCapability(item.providerCapabilityMask,_4af.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _523=item.contentLink,_524=_523===this.root||(_4a2.indexOf(this.notAllowToDelete,_523)>=0);return !_524&&_4af.isActionAvailable(item,_4af.action.Delete,_4af.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _525=item.contentLink,_526=_525===this.root||(_4a2.indexOf(this.notAllowToDelete,_525)>=0);return !_526&&_4af.isActionAvailable(item,_4af.action.Delete,_4af.providerCapabilities.Delete,true);},canPaste:function(item,_527,_528){if(!item||!_527){return false;}var _529=_528&&_527.isWastebasket,_52a=!_528&&(this.getIdentity(item)===this.getIdentity(_527)),_52b=!_528&&(item.parentLink===this.getIdentity(_527)),_52c=_4af.isActionAvailable(_527,_4af.action.Create,_4af.providerCapabilities.Create,true);return !_527.isDeleted&&!_529&&!_52a&&!_52b&&_52c;},canEdit:function(item){if(!item){return false;}var _52d=item.contentLink,_52e=_52d===this.root;return !_52e&&_4af.hasAccess(item.accessMask,_4af.accessLevel.Edit);},onItemChildrenReload:function(_52f){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_530){},onSelect:function(_531,_532,_533){},onPasteItemsFailed:function(_534){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_535,lang,_536){return _535([_536],{isTypeOfRoot:function(_537){return !!(_537&&(this.isRoot(_537)||_537.isSubRoot));},isRoot:function(_538){return !!(_538&&this.root&&_538===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_539,_53a,lang,_53b,all,when){return _53a([],{parentProperty:"parentLink",store:null,constructor:function(_53c){_53a.safeMixin(this,_53c);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_53d,_53e){var _53f=this.store.getIdentity(_53d),_540=this.store.getIdentity(_53e),_541=this.getParentIdentity(_53e);if(_53f==_540||(_53e.parentLink&&_53d.contentLink==_53e.parentLink)){return true;}if(_541){return false;}return when(this.store.get(_541),lang.hitch(this,function(_542){return this.isAncestor(_53d,_542);}));},getAncestors:function(item,_543){if(!this.store){_543([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_544){when(this._getAncestors([_544]),_543);}));},_getAncestors:function(_545){if(this._hasRoot(_545)){return _545.slice(0,-1);}var _546=this.getParentIdentity(_545[0]);if(!_546){return _545.slice(0,-1);}return when(this.store.get(_546),lang.hitch(this,function(_547){if(_547){_545.unshift(_547);return this._getAncestors(_545);}return _545.slice(0,-1);}));},_hasRoot:function(_548){var _549=this.roots||[this.root];if(!_548.length||!_549.length||typeof this.getIdentity!=="function"){return false;}var _54a=this.getIdentity(_548[0]);return _539.some(_549,function(root){return root==_54a;},this);},refreshAncestors:function(item,_54b){var _54c=this.store,_54d=new _53b(),_54e=[],_54f=[];this.getAncestors(item,function(_550){_539.forEach(_550,function(_551){if(!_54b||_54b(_551)){_54e.push(when(_54c.refresh(_54c.getIdentity(_551)),function(item){_54f.push(item);}));}});all(_54e).then(function(){_54d.resolve(_54f);});});return _54d.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_552,_553,lang,_554,_555,json,_556,when,_557,_558,_559,_55a){return _553(_555,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this.inherited(arguments);this._setupStore();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_557.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_55b=new _554();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_55b.resolve(item);},function(e){_55b.reject(e);});},function(e){_55b.reject(e);});return _55b;},add:function(item,_55c){var self=this;var def=new _554();when(self.updateableStore.add(item),function(_55d){var id=self.getContentId(_55d),_55e=self.getParentIdentity(item),_55f=null;when(self.updateableStore.get(id),function(_560){if(self.getParentIdentity(_560)!==_55e){_55f=typeof _55c=="function"&&_55c();}when(_55f).then(self.updateableStore.updateDependentStores.bind(this,_560)).then(function(){when(self._childrenChanged(_55e),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_560);});});});});});return def.promise;},patch:function(id,_561){var self=this,_562=new _554(),_563={id:id,properties:{}};for(var key in _561){if(_561.hasOwnProperty(key)){_563.properties[this._convertPropertyName(key)]=json.stringify(_561[key]);}}when(self.updateableStore.patch(_563,{id:_563.id}),function(item){if(item&&item.successful){var _564={contentLink:id,properties:_563.properties,capabilities:{supportsVersions:false}};lang.mixin(_564,_561);when(self.updateableStore.patchCache(_564),_562.resolve,_562.reject);}else{return _562.reject(item&&item.validationErrors);}});return _562;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_565){var self=this,_566=new _554(),_567;function _568(item){var id=self.getIdentity(item),_569=self.getParentIdentity(item);if(_569===self.root||id===self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _566.resolve();}when(self.refreshAncestors(_565,_568),function(_56a){if(!(_56a instanceof Array)||_56a.length===0){_566.resolve();return;}_56a.reverse();var _56b=_552.some(_56a,function(item){if(item.missingLanguageBranch){_567=self.getLabel(item);return true;}return false;});when(self.store.get(_565),function(_56c){if(_56b&&_56c&&!_56c.missingLanguageBranch){self.emit("translationFailed",_567);}_566.resolve();});});return _566;},getContentId:function(_56d){return _55a.toContentReference(_56d).id.toString();}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_56e,_56f,lang,_570,_571,_572,_573,when,_574,_575,_576,_577){return _56f([_577,_575],{handleSelection:null,previousSelection:null,forThisFolderEnabled:true,postscript:function(){this.inherited(arguments);this._handles.push(_573.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_573.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_570.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_570.around(this,"pasteItems",lang.hitch(this,this._aroundPasteItems)));this._handles.push(_570.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contextChanged:function(_578,_579){this.inherited(arguments);this.refreshRoots();},getChildren:function(_57a,_57b,_57c){if(_57a===this.root){when(this._getRootItems(),_57b,_57c);}else{if(this.isPseudoContextualRoot(_57a)){_57b([]);return;}this.inherited(arguments);}},getAncestors:function(item,_57d){var _57e=this.getInherited(arguments),_57f=_57d;when(this.getCurrentContent()).then(lang.hitch(this,function(_580){var _581=this.roots.concat(_580.assetsFolderLink),_582=lang.hitch(this,function(_583){var _584;for(var i=_583.length-1;i>=0;i--){_584=_583[i];if(this.isContextualRoot(_584)){_583[i]=this.getContextualRoot(_584);}if(_56e.indexOf(_581,this.getIdentity(_584))>=0){_583=_583.slice(i);_583.unshift(this.root);_57d(_583);return;}}_57d([this.root]);});if(_56e.indexOf(_581,this.getIdentity(item))>=0){_57d([this.root]);}_57f=_582;})).always(lang.hitch(this,function(){_57e.apply(this,[item,_57f]);}));},getObjectIconClass:function(_585,_586){var _587=this._currentContext&&this._currentContext.dataType;if(!_587){return this.inherited(arguments);}var _588=_574.getValue(_587,"iconClass");return this.isContextualContent(_585)?(_588?_586+" "+_588+"Contextual":_586):this.inherited(arguments);},onToggleContentDisplay:function(_589,_58a){},onRefreshRoots:function(_58b){},refreshRoots:function(_58c){if(_58c===this){return true;}var self=this;return when(self._getRootItems(),function(_58d){self.onChildrenChange(self.root,_58d);if(self.get("handleSelection")===true){return self._setSelection(lang.clone(_58d).pop());}});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_58e,_58f){var self=this,_590=this.inherited(arguments),_591=new _571();if(_58f){_591.resolve(_590);}else{self.getAncestors(_58e,function(_592){var _593=self.isContextualContent(_58e)||self.hasContextual(_592);if(_593){when(self.getCurrentContent()).then(function(_594){if(_576.compareIgnoreVersion(item.contentLink,_594.contentLink)){_591.resolve(false);}else{self.getAncestors(_594.contentLink,function(_595){var _596=_56e.some(_595,function(_597){return item.contentLink===_597.contentLink;},this);_591.resolve(_596?false:_590);});}}).otherwise(function(){_591.resolve(false);});}else{_591.resolve(_590);}});}return _591.promise;},filterAncestors:function(_598){if(!(_598 instanceof Array)){return _598;}var _599=_598.indexOf(this._getPseudoContextualContent().toString());if(_599!==-1&&_599<_598.length-1){_598.splice(_599,1);}return _598;},isContextualContent:function(item){return !!item&&this.isSupportedType(item.typeIdentifier)&&this.inherited(arguments);},_toggleContextualContent:function(_59a){when(this.getCurrentContent(),lang.hitch(this,function(_59b){this.onToggleContentDisplay(_59b.assetsFolderLink,!_59a);this._setSelection(null);}));},_setSelection:function(_59c){var _59d=this.roots.length>0?this.roots[0].toString():(!_59c?null:_59c.assetsFolderLink),_59e=_59c!=null?_59c.contentLink:_59d,_59f=this.get("previousSelection"),_5a0=this.get("previousContextualSelection"),_5a1=_5a0&&_5a0.selectedContent,_5a2=new _571();if(!(_59e&&_59f)){_5a2.resolve();return _5a2.promise;}var _5a3=false,_5a4=_59f.selectedContent,_5a5=_59f.selectedAncestors,_5a6=_5a4.item&&!_5a4.item.contentLink;var _5a7=function(){_5a2.resolve();};if(_5a6||this.hasContextual(_5a5)){this.onSelect(_59e,_5a3,_5a7);}else{if(_5a4.item.contentLink===_59d&&_5a1&&_5a1.item&&_5a1.item.contentLink){this.onSelect(_5a1.item.contentLink,_5a3,_5a7);}else{_5a2.resolve();}}return _5a2.promise;},getRoots:function(_5a8){var def=new _571();var _5a9=this._getPseudoContextualContent().toString();var _5aa=function(_5ab){if(!_5a8){return true;}return _5ab!==_5a9;};var _5ac=function(_5ad){return _5ad.contentLink;};when(this._getRootItems(),function(_5ae){def.resolve(_5ae.map(_5ac).filter(_5aa));},def.reject);return def.promise;},_getRootItems:function(){var self=this,_5af=self.store,_5b0=_56e.map(self.roots,function(item){return _5af.get(item);});var _5b1=when(_572([self.getCurrentContent(),self.getCurrentContext()]),function(_5b2){var _5b3=_5b2[0],_5b4=_5b2.length>1?_5b2[1]:null;var _5b5=new _576(_5b3.contentLink).createVersionUnspecificReference().toString();return when(_5af.get(_5b5),function(_5b6){var _5b7=_5b4&&_5b4.currentMode==="create";if((_5b7&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_5b6)||!self.forThisFolderEnabled){return null;}var _5b8=_5b6.assetsFolderLink;if(_5b8){var _5b9=function(_5ba){return when(_5af.get(_5ba),function(_5bb){var _5bc={id:_5bb.contentLink,typeIdentifiers:self.typeIdentifiers,allLanguages:self.showAllLanguages};return when(_5af.query(_5bc),function(_5bd){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_5bd.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_5bd)){return self.getContextualRoot(_5bd);}else{return when(self.onRefreshRoots(_5bd),function(){return self._modifyContentAccess(_5bd,_5b6);});}});});};if(_5b8===self._getPseudoContextualContent().toString()){return when(_5af.refresh(_5b5),function(_5be){return _5b9(_5be.assetsFolderLink);});}else{return _5b9(_5b8);}}return null;});},function(){return null;});_5b0.push(_5b1);return when(_572(_5b0),function(_5bf){return _56e.filter(_5bf,Boolean);});},_aroundPasteItem:function(_5c0){var self=this;return function(_5c1,_5c2,_5c3,copy,_5c4){var _5c5=_5c3,_5c6=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_5c7){if(!_5c6){_5c6=self.isPseudoContextualRoot(_5c5);self.set("createAsLocalAsset",_5c6);}_5c6&&(_5c5=_5c7);}).always(function(){return when(_5c0.apply(self,[_5c1,_5c2,_5c5,copy,_5c4]),function(_5c8){if(_5c6){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_573.publish("/epi/cms/action/createlocalasset",self);return _5c8;});}else{return _5c8;}});});};},_aroundPasteItems:function(_5c9){var self=this;return function(_5ca,_5cb,copy,_5cc){var _5cd=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_5ce){if(!_5cd){_5cd=self.isPseudoContextualRoot(_5cb);self.set("createAsLocalAsset",_5cd);}_5cd&&(_5cb=_5ce);}).always(function(){return when(_5c9.apply(self,[_5ca,_5cb,copy,_5cc]),function(_5cf){if(_5cd){self.set("createAsLocalAsset",false);}else{return _5cf;}});});};},_afterStoreGet:function(_5d0){var self=this;return when(_5d0,function(_5d1){return when(self.getCurrentContent(),function(_5d2){return self._modifyContentAccess(_5d1,_5d2);},function(_5d3){return _5d1;});});},_modifyContentAccess:function(_5d4,_5d5){if(this.isContextualContent(_5d4)){var _5d6=this.getContextualRoot(_5d4);return this.isPseudoContextualRoot(_5d4)?lang.mixin(_5d6,{isPreferredLanguageAvailable:_5d5.isPreferredLanguageAvailable,hasTranslationAccess:_5d5.hasTranslationAccess,accessMask:_5d5.accessRights,ownerContentLink:_5d5.contentLink}):_5d6;}return _5d4;}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/when","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_5d7,_5d8,json,lang,when,_5d9,_5da,_5db,_5dc){return _5d7([_5da],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,innerSearchBoxClass:"",parameters:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _5db();when(this._searchManager.getStore(),lang.hitch(this,function(_5dd){this._searchBox=new _5dc({baseClass:this.innerSearchBoxClass,searchAttr:"searchQuery",store:_5dd});var _5de=lang.mixin({filterOnDeleted:true},this.parameters);lang.mixin(this._searchBox.query,{parameters:json.toJson(_5de)});this._searchBox.on("select",lang.hitch(this,function(_5df){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_5df);}));this.set("filterOnCulture",false);_5d9.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_5e0){this._set("area",_5e0);if(this._searchBox){when(this._searchManager.getProviderQuery(_5e0),lang.hitch(this,function(_5e1){lang.mixin(this._searchBox.query,_5e1);}));}},_setSearchRootsAttr:function(_5e2){this._set("searchRoots",_5e2);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_5e2});}},_setFilterOnCultureAttr:function(_5e3){this._set("filterOnCulture",_5e3);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_5e3});}},onItemAction:function(item){if(this.triggerContextChange){var _5e4={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent==="false"){_5e4.epslanguage=item.metadata.languageBranch;}_5d8.publish("/epi/shell/context/request",[_5e4,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency"],function(_5e5,_5e6,_5e7,lang,when,all,_5e8){return _5e5(null,{_providersStore:null,_resultsStore:null,constructor:function(_5e9){this._setupStores(_5e9||{});},getProviderQuery:function(area){var _5ea=new _5e7();var _5eb=[];var _5ec=area?area.split(","):[];_5ec.forEach(function(a){_5eb.push(this._getFirstMatchingProvider(a));},this);all(_5eb).then(function(_5ed){_5ed=_5ed.filter(function(p){return p;});if(_5ed.length>0){_5ea.resolve(this._getQuery(_5ed,{}));}else{_5ea.resolve();}}.bind(this));return _5ea;},_getFirstMatchingProvider:function(area){var _5ee=new _5e7();when(this.getProviders(area)).then(function(_5ef){if(_5ef&&_5ef.length>0){_5ee.resolve(_5ef[0]);}else{_5ee.resolve();}});return _5ee.promise;},getProviders:function(area){var _5f0=new _5e7();when(this._providersStore.query({searchArea:area})).then(function(_5f1){if(_5f1&&_5f1.length>0){_5f0.resolve(_5f1);}else{_5f0.resolve();}});return _5f0;},getStore:function(){return this._resultsStore;},search:function(area,_5f2){var _5f3=new _5e7();when(this.getProviders(area)).then(lang.hitch(this,function(_5f4){if(_5f4&&_5f4.length>0){var _5f5=[];_5e6.forEach(_5f4,function(_5f6,_5f7){_5f5.push(this._getData(_5f6,_5f2));},this);var data=[];all(_5f5).then(function(_5f8){_5f8.forEach(function(item){if(lang.isArray(item)){data=data.concat(item);}});_5f3.resolve(data);});}}));return _5f3;},_setupStores:function(_5f9){this._providersStore=_5f9.providersStore||_5e8.resolve("epi.storeregistry").get("epi.shell.searchproviders");this._resultsStore=_5f9.resultsStore||_5e8.resolve("epi.storeregistry").get("epi.shell.searchresults");},_getQuery:function(_5fa,_5fb){var _5fc;if(lang.isArray(_5fa)){_5fc=_5fa.map(function(p){return p.id;}).join(",");}else{_5fc=_5fa.id;}var _5fd={providerId:_5fc};lang.mixin(_5fd,_5fb||{});return _5fd;},_getData:function(_5fe,_5ff){var _600=new _5e7();when(this._resultsStore.query(this._getQuery(_5fe,_5ff))).then(function(_601){if(_601&&_601.length>0){_600.resolve(_601);}else{_600.resolve();}});return _600.promise;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_602,lang,_603,_604,_605,keys,_606,_607,_608,_609,_60a){return _602([_608,_605],{res:_60a,autoComplete:false,dropDownClass:_609,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_60b){if(this.dropDown){this.dropDown.showStandby(false);}}));_604.before(this,"_startSearch",function(_60c,args){this.emit("beforeSearch",{});return [_60c,args];});},_openResultList:function(_60d,_60e,_60f){this.emit("searchComplete",_60d);this._fetchHandle=null;this.dropDown.clearResultList();var _610=_60d.length>0||_60f.start!==0;this.dropDown.showErrorMessage(!_610,this.res.contentnotfound);this.dropDown.showGrid(_610);if(_610){this.dropDown.createOptions(_60d,_60f,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_603.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_603.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _611=this.id+"_popup",_612=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _612({id:_611,dir:this.dir,textDir:this.textDir});_606.remove(this.textbox,"aria-activedescendant");_606.set(this.textbox,"area-owns",_611);this.dropDown.on("select",lang.hitch(this,function(_613){this.closeDropDown();this.emit("select",_613);}));_607.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();this._startSearch(key);},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_614,lang,_615,_616,_617,_618,_619){return _614([_619,_616,_618],{dropDownClass:_617,buildRendering:function(){this.inherited(arguments);_615.set(this.textbox,"autocomplete","off");_615.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","epi/debounce","epi","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_61a,lang,_61b,_61c,_61d,keys,_61e,_61f,_620,_621,_622,_623,_624,epi,_625,_626){return _61a([_622],{templateString:_625,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,triggerChangeOnEnter:true,postCreate:function(){this.inherited(arguments);_61b.set(this.clearButton,"title",_626.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,this.clearValue));this.toggleClearButton();this.connect(this,"_onInput",_624(lang.hitch(this,function(_627){if(this._destroyed){return;}this.toggleClearButton();this._valueChanged(_627);}),null,this.defaultDelay));this.connect(this.domNode,"onclick","_onClick");},clearValue:function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();},toggleClearButton:function(){_61d.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_621.focus(this.textbox);},_onClick:function(){this.focus();},_valueChanged:function(_628){if(_628&&_628.charOrCode){switch(_628.charOrCode){case keys.ESCAPE:this.clearValue();return;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.TAB:return;}if(!this.triggerChangeOnEnter&&_628.charOrCode===keys.ENTER){return;}}this.onSearchBoxChange(this.encodeSearchText?_623.encode(this.textbox.value):this.textbox.value);},onSearchBoxChange:function(_629){}});});},"epi/debounce":function(){define("epi/debounce",["dgrid/util/misc"],function(misc){return misc.debounce;});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_62a,lang,_62b,_62c,_62d,_62e,_62f,_630,_631,_632,_633,_634,_635,_636,_637,_638,_639,_63a,_63b,_63c){return _62a([_630,_631,_62b,_632,_633,_635,_636],{templateString:_63c,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_63d=_634.resolve("epi.shell.Profile"),_63e=_62a([_639,_63a,_63b,_638]),_63f=function(item){return item.title;},_640=function(item){return item.metadata.typeIdentifier;},_641=function(item){var _642=self.grid.domNode,_643="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_62d.contains(_642,_643))&&_62d.add(_642,_643);return item.metadata.thumbnailUrl;},_644=function(item){if(item.metadata&&item.metadata.languageBranch!==_63d.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _63e({formatters:[_637.contentItemFactory("title",_63f,_640,null,_641,_644,true)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_62c.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_645){var row=this.grid.row(_645);if(row){this._onSelect(row.data);}}));this._standby=new _62f({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_62e.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_646){this.emit("select",_646);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_647,_648,_649){this.grid.renderArray(_647);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_64a){this.clearResultList();this.showStandby(false);if(show&&_64a){this.errorMessage.innerHTML=_64a;}_62e.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_64b,keys){return _64b(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_64c,_64d){return _64c(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_64d.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_64d.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\r\n    <div data-dojo-attach-point=\"containerNode\">\r\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\r\n    </div>\r\n    <div class=\"dijitReset epi-searchResultListNavigation\">\r\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\r\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\r\n    </div>\r\n</div>","epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_64e,lang,_64f,_650){return _64e([_650],{addToLeading:function(_651,_652){this.addCommand(_651,_652);},addToCenter:function(_653,_654){_654=lang.mixin({category:"center"},_654);this.addCommand(_653,_654);},addToTrailing:function(_655,_656){_656=lang.mixin({category:"trailing"},_656);this.addCommand(_655,_656);},addCommand:function(_657,_658){_658=lang.mixin({iconClass:_657.iconClass,category:"leading",label:_657.label,tooltip:_657.tooltip,showLabel:false,widget:_64f,model:_657},_658);_657=lang.delegate(_657,{settings:_658});this.add("commands",_657);},updateCommandModel:function(_659){this.commands.forEach(function(_65a){_65a.settings.model.set("model",_659);});}});});},"epi-cms/compare/command/CompareCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","./CompareSettingsModel","./CompareViewSelection","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.compare.command"],function(_65b,_65c,_65d,_65e,_65f,_660,_661){var _662=_65b([_65f,_660]);return _65b([_65c],{postscript:function(){this.inherited(arguments);var _663=new _65d();var _664={category:"compare"};this.add("commands",new _662({category:"compare",settings:_664,label:_661.togglecompare.label,iconClass:"epi-iconCompare",model:_663,property:"enabled"}));this.add("commands",new _65e({category:"compare",settings:_664,model:_663,label:_661.compareviewselection.label,optionsLabel:_661.compareviewselection.label,optionsProperty:"modeOptions",property:"mode"}));}});});},"epi-cms/compare/command/CompareSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi-cms/nls/episerver.cms.compare.mode"],function(_665,lang,_666,_667,when,_668,_669,res){return _665([_667,_668],{enabled:false,mode:"allpropertiescompare",_selectedCompareModeProfileKey:"epi.selected-comparemode-id",modeOptions:[{label:res.allpropertiescompare,value:"allpropertiescompare",iconClass:"epi-iconForms"},{label:res.sidebysidecompare,value:"sidebysidecompare",iconClass:"epi-iconLayout"}],constructor:function(){var self=this;this.profile=this.profile||_669.resolve("epi.shell.Profile");when(this._loadSelectedModeFromProfile(),lang.hitch(this,function(mode){if(mode){this.set("mode",mode);}}));this.own(_666.subscribe("/epi/shell/action/viewchanged",function(type,args,data){var view=data&&(data.viewName||(data.sender&&data.sender.viewName));var _66a=self.modeOptions.some(function(_66b){return _66b.value===view;});self.set("enabled",_66a,false);}),_666.subscribe("/epi/cms/action/switcheditmode",function(){self.set("enabled",false,false);}),_666.subscribe("/epi/cms/action/eyetoggle",function(_66c){if(_66c){self.set("enabled",false,false);_666.publish("/epi/shell/action/changeview/updatestate",{viewName:null});}}));},_enabledSetter:function(_66d,_66e){if(this.enabled!==_66d){this.enabled=_66d;(_66e!==false)&&this._onChange();}},_modeSetter:function(_66f){if(this.mode!==_66f){this.mode=_66f;this.get("enabled")&&this._onChange();this.profile.set(this._selectedCompareModeProfileKey,_66f,{location:"server"});}},_onChange:function(){_666.publish("/epi/shell/action/changeview",this.get("enabled")?this.get("mode"):null,null,{forceReload:true});},_loadSelectedModeFromProfile:function(){return when(this.profile.get(this._selectedCompareModeProfileKey),function(mode){if(!mode){return null;}return mode;});}});});},"epi-cms/compare/command/CompareViewSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand"],function(_670,_671){return _670([_671],{_selectedSetter:function(_672){this.inherited(arguments);this.get("options").some(function(_673){if(_673.value===_672){this.set("iconClass",_673.iconClass);return true;}},this);}});});},"epi/shell/command/OptionCommand":function(){define("epi/shell/command/OptionCommand",["dojo/_base/declare","epi/shell/command/_Command","dijit/Destroyable"],function(_674,_675,_676){return _674([_675,_676],{options:null,optionsLabel:"",optionsProperty:null,selected:null,property:null,_execute:function(){this.model.set(this.property,this.selected);},_onModelChange:function(){var self=this,_677=this.model;this.set("canExecute",!!_677);if(_677){this.set("selected",this.model.get(this.property));this.own(_677.watch(this.property,function(name,_678,_679){self.set("selected",_679);}));}},_optionsGetter:function(){return this.options||(this.model&&this.optionsProperty&&this.model.get(this.optionsProperty));},_selectedSetter:function(_67a){var _67b=this.selected;this.selected=_67a;if(_67b!==_67a){this.execute();}}});});},"epi-cms/command/_NonEditViewCommandMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable"],function(_67c,lang,_67d,_67e){return _67c([_67e],{constructor:function(){this.own(_67d.subscribe("/epi/shell/action/viewchanged",lang.hitch(this,"_viewChanged")));},_viewChanged:function(type,args,data){this.set("isAvailable",type==="epi-cms/contentediting/PageDataController"||type==="epi-cms/compare/views/CompareView");}});});},"epi-cms/notification/command/NotificationCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/notification/NotificationButton","epi-cms/notification/command/ViewNotifications"],function(_67f,_680,_681,_682){return _67f([_680],{postscript:function(){this.inherited(arguments);var _683={widget:_681,"class":"epi-chromeless"};this.addToTrailing(new _682(),_683);}});});},"epi-cms/notification/NotificationButton":function(){define(["dojo/_base/declare","dojo/on","epi/shell/widget/DeferredDropDownButton","epi/shell/widget/_ButtonBadgeMixin","./NotificationList"],function(_684,on,_685,_686,_687){return _684([_685,_686],{dropDownPosition:["below-alt","below"],showLabel:false,postMixInProperties:function(){this.inherited(arguments);if(this.modelBindingMap){this.modelBindingMap.badgeValue=["badgeValue"];}this.dropDown=this.dropDown||new _687();this.own(on(this.dropDown,"change",function(){this.closeDropDown(true);}.bind(this),true));},closeDropDown:function(){this.inherited(arguments);this.dropDown.model.markAllAsRead();}});});},"epi/shell/widget/DeferredDropDownButton":function(){define("epi/shell/widget/DeferredDropDownButton",["dojo/_base/declare","dijit/form/DropDownButton","epi/shell/widget/_HasDeferredDropDown"],function(_688,_689,_68a){return _688([_689,_68a],{});});},"epi/shell/widget/_HasDeferredDropDown":function(){define("epi/shell/widget/_HasDeferredDropDown",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dijit/_HasDropDown"],function(_68b,lang,_68c,on,_68d){return _68b([_68d],{_loaded:false,loadEvent:"loaded",isLoaded:function(){return this._loaded&&!!this.dropDown;},loadDropDown:function(){var self=this,_68e=this.dropDown,_68f=new _68c();on.once(_68e,this.loadEvent,function(){self._loaded=true;_68f.resolve();});_68e.startup();return _68f.promise;},loadAndOpenDropDown:function(){var self=this,_690=this.dropDown;if(this.isLoaded()){return new _68c().resolve(this.openDropDown());}return this.loadDropDown().then(function(){self.openDropDown();if(_690.focus){self.defer(lang.hitch(_690,"focus"),1);}});}});});},"epi/shell/widget/_ButtonBadgeMixin":function(){define("epi/shell/widget/_ButtonBadgeMixin",["dojo/_base/declare","dojo/dom-class","dojo/dom-attr"],function(_691,_692,_693){return _691(null,{badgeClass:"epi-badge-node",badgeValue:null,_setBadgeValueAttr:function(_694){this._set("badgeValue",_694);if(_694||_694===0){_692.add(this.iconNode,this.badgeClass);_693.set(this.iconNode,"badge-value",_694);}else{_692.remove(this.iconNode,this.badgeClass);}}});});},"epi-cms/notification/NotificationList":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/keys","dojo/on","./viewmodels/NotificationListViewModel","./notificationFormatter","dojo/text!./templates/NotificationList.html","epi/i18n!epi/cms/nls/episerver.cms.notification.list","dgrid/OnDemandList","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi-cms/dgrid/WithContextMenu","epi-cms/ApplicationSettings","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin"],function(_695,_696,keys,on,_697,_698,_699,res,_69a,_69b,_69c,_69d,_69e,_69f,_6a0,_6a1,_6a2,_6a3,_6a4,_6a5){return _696([_6a3,_6a4,_6a5],{templateString:_699,_listClass:_696([_69a,_69e,_69c,_69b,_69f,_69d]),_list:null,res:res,postMixInProperties:function(){this.inherited(arguments);_698.contentLanguage=_6a0.currentContentLanguage;if(!this.model){this.own(this.model=new _697());}},buildRendering:function(){this.inherited(arguments);this._setupList();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize().then(function(){this._list.startup();this._list.set("store",this.model.store,this.model.query,this.model.queryOptions);this.own(on(this.domNode,_695._keypress,this._onKeypress.bind(this)));this.emit("loaded");}.bind(this));},focus:function(){var _6a6;if(this._list){_6a6=this._list.getScrollPosition();this._list.focus();this._list.scrollTo(_6a6);}},layout:function(){this.inherited(arguments);this._list.resize();},_setupList:function(){var _6a7=this._readNotification.bind(this);this._list=new this._listClass({className:"epi-notification-list__item-list epi-card-list epi-grid-max-height--300",cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,formatters:_698.card,keepScrollPosition:true,noDataMessage:res.nodatamessage,stopPropagation:true,sort:this.model.queryOptions&&this.model.queryOptions.sort},this.listNode);this._list.contextMenu.addProvider(this.model);this.own(this._list,this._list.on("dgrid-select",this._selected.bind(this)),this._list.on(".dgrid-row:click",_6a7),this._list.addKeyHandler(keys.ENTER,_6a7),on.once(this._list,"dgrid-refresh-complete",this.focus.bind(this)));},_readNotification:function(){this.model.readSelectedNotification();this.emit("change",{});},_selected:function(e){var _6a8=e&&e.rows&&e.rows[0].data;this.model.set("selectedNotification",_6a8);},_onKeypress:function(e){if(e.charOrCode!==keys.TAB){return;}this._list.focus();e.preventDefault();e.stopPropagation();}});});},"epi-cms/notification/viewmodels/NotificationListViewModel":function(){define(["dojo/_base/declare","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/dependency"],function(_6a9,_6aa,_6ab,_6ac,when,_6ad,_6ae){return _6a9([_6ab,_6aa,_6ad],{store:null,service:null,query:null,queryOptions:null,selectedNotification:null,postscript:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"posted",descending:true},{attribute:"id",descending:true}]};this.store=this.store||_6ae.resolve("epi.storeregistry").get("epi.cms.notification");this.service=this.service||_6ae.resolve("epi.cms.NotificationService");this.query=this.query||{};},initialize:function(){return when(null);},readSelectedNotification:function(){this.markSelectedNotificationAsRead();this.gotoSelectedNotificationOrigin();},gotoSelectedNotificationOrigin:function(){if(!this.selectedNotification||!this.selectedNotification.link||this.selectedNotification.isExternal){return;}var _6af=this.selectedNotification.link;_6ac.publish("/epi/shell/context/request",{uri:_6af},{sender:this,forceReload:true});},markSelectedNotificationAsRead:function(){if(!this.selectedNotification){return;}this.service.markAsRead(this.selectedNotification.id).then(this.set.bind(this,"selectedNotification"));},markAllAsRead:function(){this.service.markAllAsRead();}});});},"epi-cms/notification/notificationFormatter":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi/shell/TypeDescriptorManager","epi-cms/dgrid/formatters","epi/shell/dgrid/util/misc","epi/string","dojo/text!./templates/InternalNotification.html","dojo/text!./templates/ExternalNotification.html","epi/i18n!epi/nls/episerver.shared"],function(_6b0,_6b1,_6b2,_6b3,_6b4,misc,_6b5,_6b6,_6b7,_6b8){var _6b9;function _6ba(){function _6bb(item){if(!item.contentLanguage){return "";}return item.contentLanguage!==_6b9.contentLanguage?item.contentLanguage:"";};function _6bc(_6bd){if(_6bd.subject){return _6b2.encode(_6bd.subject);}return "";};function _6be(_6bf){if(_6bf==="projectIcon"){return misc.icon("epi-iconObjectProject epi-objectIcon");}if(_6bf==="featureIcon"){return misc.icon("epi-iconObjectFeature epi-objectIcon");}if(_6bf){var _6c0=_6b3.getValue(_6bf,"iconClass");if(_6c0){return misc.icon(_6c0+" epi-objectIcon");}}return "";};function _6c1(_6c2){return (_6c2&&_6c2.isExternal)?_6b7:_6b6;};return function formatter(_6c3,_6c4,node){var _6c5=_6c1(_6c3);var _6c6=_6bb(_6c4);var map={title:_6bc(_6c4),languageBranch:_6b2.encode(_6c6),languageBranchClass:_6c6?"epi-card__language-branch":"epi-card__language-branch--hidden",contentIcon:_6be(_6c4.iconKey),message:_6b5.toHTML(_6c4.content),postedAt:_6b4.localizedDate(_6c4.posted),additionalEventClass:_6c4.subject?"":"epi-event--no-title",url:_6c3?_6c3.link:""};var _6c7=(_6c4.hasRead?"":" epi-card--unread");_6b0.add(node,"epi-card epi-card--compact"+_6c7);return _6b1.substitute(_6c5,map);};};_6b9={card:[_6ba()]};return _6b9;});},"url:epi-cms/notification/templates/InternalNotification.html":"<div class=\"epi-event ${additionalEventClass}\">\r\n    ${contentIcon}<span class=\"dijitInline epi-floatRight epi-lozenge ${languageBranchClass}\">${languageBranch}</span><h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\r\n    <div class=\"epi-event__message\">${message}</div>\r\n    <div class=\"epi-event__timestamp\">${postedAt}</div>\r\n</div>\r\n","url:epi-cms/notification/templates/ExternalNotification.html":"<div class=\"epi-event ${additionalEventClass}\">\r\n    ${contentIcon}\r\n    <a href=${url} target=\"_blank\">\r\n        <h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\r\n        <div class=\"epi-event__message dojoxEllipsis\">${message}</div>\r\n        <div class=\"epi-event__timestamp\">${postedAt}</div>\r\n    </a>\r\n</div>\r\n","url:epi-cms/notification/templates/NotificationList.html":"<div class=\"epi-notification-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\">${res.header}</span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","epi/shell/dgrid/Focusable":function(){define("epi/shell/dgrid/Focusable",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/focus"],function(_6c8,lang,_6c9,_6ca){return _6c8([],{postCreate:function(){this.inherited(arguments);this._listeners.push(_6c9.around(this,"_restoreFocus",function(_6cb){return function(row){var _6cc=this._removedFocus;_6cb.apply(this,arguments);if(!this._focusedNode){row=row&&this.row(row);var _6cd=row&&row.element&&row.id===_6cc.rowId?row:typeof _6cc.siblingId!=="undefined"&&this.row(_6cc.siblingId);if(_6cd){this._focusedNode=_6cd.element;}}};}));},hasFocus:function(){return this._focusedNode&&this._focusedNode===_6ca.curNode;},isFocusable:function(){return !!this._focusedNode;},focus:function(_6ce){if(typeof _6ce=="string"){_6ce=null;}this.inherited(arguments,[_6ce]);},refresh:function(_6cf){var _6d0=_6cf&&_6cf.refocus,_6d1=function(_6d2){if(this._refocusNode){this.focus(this.row(this._refocusNode).element);this._refocusNode=null;}return _6d2;};if(typeof _6d0==="undefined"){_6d0=this.refocusOnRefresh;}if(_6d0&&this.hasFocus()){this._refocusNode=this.row(this._focusedNode).id;}var _6d3=this.inherited(arguments);if(_6d3){return _6d3.then(_6d1.bind(this));}}});});},"epi-cms/notification/command/ViewNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/dependency","dijit/Destroyable","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_6d4,lang,on,_6d5,_6d6,_6d7,res){return _6d4([_6d7,_6d6],{iconClass:"epi-iconBell epi-icon--medium",label:"",isAvailable:true,canExecute:true,badgeValue:"",_unreadCount:0,postscript:function(){this.inherited(arguments);this.service=this.service||_6d5.resolve("epi.cms.NotificationService");this.own(this.service.on("notification-updated",function(_6d8){if(!_6d8.hasRead){this.set("_unreadCount",this._unreadCount+1);}}.bind(this)));this._updateUnreadCount();},_execute:function(){this.set("_unreadCount",0);},_updateUnreadCount:function(){this.service.getUnreadNotificationCount().then(function(_6d9){this.set("_unreadCount",_6d9);}.bind(this));},__unreadCountSetter:function(_6da){var _6db=_6da>0?"("+_6da+")":"";this._unreadCount=_6da;this.set({badgeValue:_6da>0?_6da:null,label:lang.replace(res.viewnotifications,{unreadcount:_6db})});}});});},"epi-cms/command/ViewSettingsCommandProvider":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/command/TogglePreviewMode","epi-cms/command/ToggleViewSettings","epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand","epi-cms/project/ProjectPreviewButton","epi-cms/contentediting/command/LanguageSelection","epi-cms/contentediting/viewmodel/LanguageSettingsModel","./DeviceSelection","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode"],function(_6dc,_6dd,_6de,_6df,_6e0,_6e1,_6e2,_6e3,_6e4,_6e5,_6e6){return _6dc([_6e5],{postscript:function(){this.inherited(arguments);var _6e7={category:"view"};this.projectService=this.projectService||_6dd.resolve("epi.cms.ProjectService");var _6e8=new _6e3();this.add("commands",new _6df({settings:_6e7,category:_6e7.category}));this.add("commands",new _6e2({category:_6e7.category,showLabel:true,settings:_6e7,optionsProperty:"availableLanguages",property:"selectedLanguage",model:_6e8}));this.add("commands",new _6e0({category:_6e7.category,settings:_6e7}));this.add("commands",new _6e4({settings:_6e7,category:_6e7.category}));if(!this.projectService.isProjectModeEnabled){this.add("commands",{settings:_6e7,category:_6e7.category,widget:new _6e1({showLabel:false})});}this.add("commands",new _6de({settings:_6e7,category:_6e7.category,innerText:_6e6.message}));}});});},"epi-cms/command/TogglePreviewMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi-cms/_SidePanelsToggleMixin","dijit/Destroyable"],function(_6e9,lang,_6ea,_6eb,_6ec,_6ed,_6ee,_6ef){return _6e9([_6ec,_6ed,_6ee,_6ef],{iconClass:"epi-iconPreview",tooltip:_6eb.label,label:_6eb.label,canExecute:true,constructor:function(){this.own(_6ea.subscribe("/epi/cms/action/disablepreview",lang.hitch(this,"_deactivate")));},_execute:function(){this.set("active",!this.active);if(this.active){_6ea.publish("/epi/shell/action/changeview","view");this._hideSidePanels();}else{this._restoreSidePanels();_6ea.publish("/epi/shell/action/changeview",null);}},_deactivate:function(){if(this.active){this.set("active",false);this._restoreSidePanels();}},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(view!=="view"){this._deactivate();}}});});},"epi-cms/_SidePanelsToggleMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojo/topic","epi/dependency"],function(_6f0,lang,all,when,_6f1,_6f2){return _6f0([],{_profile:null,_isNavigationVisible:null,_isToolsVisible:null,constructor:function(){if(!this._profile){this._profile=_6f2.resolve("epi.shell.Profile");}this._storePanelVisibility();},_restoreSidePanels:function(){_6f1.publish("/epi/layout/pinnable/navigation/toggle",this._isNavigationVisible);_6f1.publish("/epi/layout/pinnable/tools/toggle",this._isToolsVisible);},_hideSidePanels:function(){this._storePanelVisibility().then(function(){_6f1.publish("/epi/layout/pinnable/navigation/toggle",false);_6f1.publish("/epi/layout/pinnable/tools/toggle",false);});},_storePanelVisibility:function(){return all([when(this._profile.get("navigation"),lang.hitch(this,function(_6f3){this._isNavigationVisible=_6f3?_6f3.visible:false;})),when(this._profile.get("tools"),lang.hitch(this,function(_6f4){this._isToolsVisible=_6f4?_6f4.visible:false;}))]);}});});},"epi-cms/command/ToggleViewSettings":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.viewsetting","epi/shell/command/ToggleCommand","epi/dependency","epi-cms/command/_NonEditViewCommandMixin"],function(_6f5,_6f6,_6f7,_6f8,_6f9,_6fa){return _6f5([_6f8,_6fa],{iconClass:"epi-iconEye",canExecute:true,property:"enabled",label:_6f7.viewsettingbutton,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",_6f9.resolve("epi.viewsettingsmanager"));}},_execute:function(){this.inherited(arguments);_6f6.publish("/epi/cms/action/eyetoggle",this.model.get(this.property));},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(this.active&&view&&view.indexOf("compare")!==-1){this.execute();}}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/OptionCommand","./VisitorGroupViewSettingsModel","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_6fb,_6fc,_6fd,_6fe,res){return _6fb([_6fd,_6fc],{iconClass:"epi-iconUsers",model:null,optionsProperty:"options",property:"selectedGroup",optionsLabel:res.header,postscript:function(){this.inherited(arguments);this.set("model",this.model||new _6fe());this.set("label",this.model.tooltip);this.set("active",!!this.model.selectedGroup);var self=this;this.own(this.model.watch("tooltip",function(_6ff,_700,_701){self.set("label",_701);}));this.own(this.model.watch("selectedGroup",function(_702,_703,_704){self.set("active",!!_704);}));}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_705,lang,_706,_707,when,_708,_709,_70a,res){return _705([_707,_708],{selectedGroup:null,tooltip:_70a.defaulttooltip,defaultItem:{value:null,label:res.defaultitem},options:[],postscript:function(){this.inherited(arguments);if(!this._store){var _70b=_709.resolve("epi.storeregistry");this._store=_70b.get("epi.cms.visitorgroup");}if(!this._viewSettingsManager){this._viewSettingsManager=_709.resolve("epi.viewsettingsmanager");}var _70c=this._viewSettingsManager.getSettingProperty("visitorgroup");var self=this;when(this._store.query()).then(function(_70d){if(!(_70d instanceof Array)){_70d=[];}var _70e=_70d.map(function(item){return {label:item.name,value:item.id};});_70e.unshift(self.defaultItem);self.set("options",_70e);self.set("selectedGroup",_70c,false);});},_selectedGroupSetter:function(_70f,_710){if(this.selectedGroup===_70f){return;}this.selectedGroup=_70f;this._setTooltip();if(_710===false){return;}_706.publish("/epi/cms/action/viewsettingvaluechanged","visitorgroup",this.selectedGroup);},_setTooltip:function(){var _711=this._getGroup(this.selectedGroup);if(_711){this.set("tooltip",lang.replace(_70a.tooltip,{visitorgroup:_711.label}));}else{this.set("tooltip",_70a.defaulttooltip);}},_getGroup:function(id){if(id===this.defaultItem.value){return null;}for(var idx in this.options){if(this.options[idx].value===id){return this.options[idx];}}return null;}});});},"epi-cms/project/ProjectPreviewButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/topic","epi/dependency","epi/i18n!epi/nls/episerver.cms.components.project.preview","epi/shell/widget/DeferredDropDownButton","epi-cms/project/ProjectSelectorList"],function(_712,lang,_713,_714,_715,_716,_717,_718,_719){return _712([_718],{iconClass:"epi-icon--medium epi-iconProject",baseClass:"",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_716.resolve("epi.storeregistry").get("epi.cms.project");},buildRendering:function(){this.inherited(arguments);_713.add(this.domNode,["epi-chromeless","epi-mediumButton"]);if(!this.dropDown){this.dropDown=new _719({baseClass:"dijitMenu",enableDefaultValue:true,defaultValueText:_717.defaultoption,store:this.store,header:_717.header});}},postCreate:function(){this.inherited(arguments);var self=this,_71a=_716.resolve("epi.viewsettingsmanager").getSettingProperty("project"),_71b=_71a?this.store.get(parseInt(_71a)):new _714().resolve();_71b.then(function(_71c){self.dropDown.set("selectedProject",_71c);self._updateButtonState(_71c);}).always(function(){self.own(self.dropDown.watch("selectedProject",lang.hitch(self,"_selectedProjectChanged")));});},loadAndOpenDropDown:function(){if(this.isLoaded()){return this.inherited(arguments).then(lang.hitch(this,function(){return this.dropDown.refresh();}));}return this.inherited(arguments);},_selectedProjectChanged:function(name,_71d,_71e){var _71f=_71e?_71e.id:null;_715.publish("/epi/cms/action/viewsettingvaluechanged","project",_71f);this._updateButtonState(_71e);},_updateButtonState:function(_720){var _721=_717.defaulttooltip;if(_720){_721=lang.replace(_717.tooltip,{project:_720.name});}this.set("title",_721);_713.toggle(this.iconNode,"epi-icon--active",!!_720);}});});},"epi-cms/project/ProjectSelectorList":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","dijit/form/RadioButton","dijit/Menu","epi/epi","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ExpandoMenuBuilder","epi/shell/command/builder/OptionsBuilderMixin","epi/datetime","epi/username","./viewmodels/ProjectSelectorListViewModel","dojo/text!./templates/ProjectSelectorList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","dijit/Toolbar"],function(_722,_723,lang,keys,when,_724,_725,_726,Menu,epi,_727,_728,_729,_72a,_72b,_72c,_72d,_72e,_72f,res,_730,_731,_732,_733,_734,put,_735,_736,misc,_737,_738,_739,_73a){return _722([_737,_738,_739,_73a,_727],{templateString:_72e,store:null,query:null,selectedProject:null,enableDefaultValue:false,defaultValueText:res.preview.defaultoption,header:res.title,_setHeaderAttr:{node:"headerNode",type:"innerText"},_optionsMenuClass:_722([Menu,_72a]),postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _72d());}},buildRendering:function(){this.inherited(arguments);this._setupProjectSortMenu();this.list=new (_722([_730,_731,_733,_732,_735,_736]))({sort:[{attribute:"created",descending:true}],className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionMode:"exclusive",selectionEvents:"click",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.own(this.list,this.list.on("dgrid-select",lang.hitch(this,"_projectSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.ENTER,lang.hitch(this,"_listEnterKeypress")),this.model.watch("projectSortOrder",lang.hitch(this,"_sortChanged")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(_734.enterRow,lang.hitch(this,"_listMouseover")),this.defaultOption.on("click",lang.hitch(this,"_defaultOptionSelected")),this.defaultOption.on("keypress",lang.hitch(this,"_defaultOptionKeypress")),this.defaultOption.on("mouseover",lang.hitch(this,"_defaultOptionMouseover")));if(this.enableDefaultValue){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_724.add(this.defaultOption.domNode,"dijitHidden");}this.defaultOption.set({iconClass:"dijitRadioIcon",label:_725.encode(this.defaultValueText)});},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();this.list.startup();},focus:function(){if(this.enableDefaultValue){this.defaultOption.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_73b){var _73c=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitRadio"));var _73d=put("label.epi-selector-list__title.dojoxEllipsis",put("strong[title=$]",item.name,item.name));var _73e=put("div.epi-selector-list__description.dojoxEllipsis",_72b.toUserFriendlyString(new Date(item.created))+", "+_72c.toUserFriendlyString(item.createdBy));return put("div",[_73c,_73d,_73e]);},refresh:function(){if(!this._started){return;}if(!this.list.get("store")){this.list.set("store",this.store);}return this.list.refresh().then(lang.hitch(this,function(_73f){var _740=this.get("selectedProject"),_741=_740&&_73f.some(function(item){if(item.id===_740.id){_740=item;return true;}return false;},this);this.set("selectedProject",_741?_740:null);}));},_projectSelected:function(e){var _742=e&&e.rows&&e.rows[0].data;if(!epi.areEqual(_742,this.get("selectedProject"))){this.set("selectedProject",_742);this.emit("change",{value:_742});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(_743){this.emit("loaded");_724.toggle(this.separatorNode,"dijitHidden",!_743||!this.enableDefaultValue);}));},_defaultOptionSelected:function(){this.set("selectedProject",null);this.emit("change",null);},_defaultOptionKeypress:function(e){var _744;switch(e.keyCode){case keys.DOWN_ARROW:_744=_732.moveFocusHome;break;case keys.PAGE_DOWN:_744=_732.moveFocusPageDown;break;case keys.END:_744=_732.moveFocusEnd;break;default:return;}_744.apply(this.list,[e]);},_defaultOptionMouseover:function(){this.defaultOption.focus();},_listEnterKeypress:function(e){this.list.clearSelection();this.list.select(e);},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_745=list.up(row,1,true);if(row.id===_745.id){this.defaultOption.focus();}},_listNavigateHome:function(){this.defaultOption.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_sortChanged:function(evt){var _746=this.model[evt];if(this.list.get("sort")!==_746){this.list.set("sort",_746);}},_setSelectedProjectAttr:function(_747){this._set("selectedProject",_747);this.list.clearSelection();if(_747){this.list.select(_747.id);}this._updateView();},_updateView:function(){this.defaultOption.set("checked",!this.selectedProject);},_setupProjectSortMenu:function(){var _748=[{builder:new _729({settings:{"class":"epi-flat epi-chromeless",iconClass:"epi-iconSort",showLabel:false,label:res.command.sort.label}}),category:"context",target:this.toolbarGroupNode}];this.own(new _728({configuration:_748,commandSource:this.model}));}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_749,_74a){return _749(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _74b=this.getConsumer();if(!_74b){return;}this._consumerHandle=_74b.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_74a)){return this;}var _74c=this.getParent();while(_74c){if(_74c.isInstanceOf(_74a)){return _74c;}_74c=_74c.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/builder/ExpandoMenuBuilder":function(){define("epi/shell/command/builder/ExpandoMenuBuilder",["dojo/_base/declare","dojo/_base/lang","../_CommandModelBindingMixin","./ButtonBuilder","epi/shell/widget/ExpandoMenuButton"],function(_74d,lang,_74e,_74f,_750){return _74d([_74f],{_expandoClass:_74d([_750,_74e]),_expandoMenu:null,_create:function(_751){var _752,_753;if(_751.widget){return _751.widget;}_752=_751.get("options") instanceof Array;_753=typeof _751.active==="boolean";if(!_752&&_753){return this._expandoMenu=new this._expandoClass(this._createOptions(_751));}return this.inherited(arguments);},_createOptions:function(_754){return lang.mixin({innerText:_754.innerText,showLabel:!!_754.showLabel},this.inherited(arguments));},_addToContainer:function(_755,_756){if(!(_755 instanceof _750)&&this._expandoMenu){_756=this._expandoMenu;}this.inherited(arguments,[_755,_756]);}});});},"epi/shell/widget/ExpandoMenuButton":function(){require({cache:{"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\r\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\r\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\r\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\r\n--></span>\r\n"}});define("epi/shell/widget/ExpandoMenuButton",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/has","dojo/text!./templates/ExpandoMenuButton.html","dijit/registry","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","dijit/_TemplatedMixin","dgrid/util/has-css3","dijit/form/ToggleButton"],function(_757,lang,_758,on,_759,_75a,_75b,_75c,has,_75d,_75e,_75f,_760,_761){return _757([_75f,_761,_760],{templateString:_75d,label:"",innerText:"",iconClass:"",postCreate:function(){this.inherited(arguments);if(has("css-transitions")){this.own(on(this.expandoNode,has("transitionend"),lang.hitch(this,this._onTransitionEnd)));}},_setLabelAttr:function(_762){this.toggleButton.set("label",_762);this._set("label",_762);},_setInnerTextAttr:function(_763){this._set("innerText",_763);if(_763){this.innerTextNode.textContent=_763;}_759.toggle(this.innerTextContainerNode,"dijitHidden",!_763);},_setIconClassAttr:function(_764){this._set("iconClass",_764);this._updateToggleButtonIcon();},_setCheckedAttr:function(_765){this.toggleButton.set("checked",_765);this._set("checked",_765);this._updateToggleButtonIcon();this._showChildren(_765);},addChild:function(_766){if(this.innerTextContainerNode){_759.add(this.innerTextContainerNode,"dijitHidden");}var li=_75c.create("li",{},this.expandoNode);_766.placeAt(li);},onClick:function(){},onChange:function(val){},getChildren:function(){return _75e.findWidgets(this.expandoNode);},_toggleButtonClick:function(){this.onClick();},_toggleButtonChange:function(val){this.set("checked",val);this.onChange(val);},_updateToggleButtonIcon:function(){var _767=["epi-icon--medium"];if(this.iconClass){_767.push(this.iconClass);}if(this.checked){_767.push("epi-icon--active");}this.toggleButton.set("iconClass",_767.join(" "));},_showChildren:function(show){var node=this.expandoNode;if(show){_759.toggle(node,"dijitHidden",false);_75b.set(node,"width",this._childrenWidth()+"px");}else{_75b.set(node,"width",this._childrenWidth()+"px");node.offsetWidth;_75b.set(node,"width","0px");}},_onTransitionEnd:function(){var _768=this.get("checked");_759.toggle(this.expandoNode,"dijitHidden",!_768);if(_768){_75b.set(this.expandoNode,"width","");}},_childrenWidth:function(){var _769=0;_758.forEach(this.expandoNode.childNodes,function(_76a){_769+=_75a.getMarginBox(_76a).w;});return _769;}});});},"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\r\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\r\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\r\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\r\n--></span>\r\n","epi-cms/project/viewmodels/ProjectSelectorListViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort"],function(_76b,lang,_76c,_76d,when,_76e,_76f,_770,_771){return _76b([_76d,_76e,_76c],{namedCommands:null,profile:null,projectSortOrder:null,_commands:null,_sortOrderProfileKey:"epi.project-sort-order",constructor:function(){this.projectSortOrder=[{attribute:"name",descending:false}];},postscript:function(){this.inherited(arguments);this.profile=this.profile||_76f.resolve("epi.shell.Profile");this._createCommands();},initialize:function(){return when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _772=this._findSortOption("key",sort)||this.namedCommands.sortProject.options[0];this._changeAttrValue("projectSortOrder",_772.value);}));},getCommands:function(){return this._commands;},_projectSortOrderSetter:function(_773){var _774,key;if(_773===null||(_773&&_773===this.projectSortOrder)){return;}this.projectSortOrder=_773;_774=this._findSortOption("value",_773);key=_774&&_774.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_findSortOption:function(key,term){var _775=this.namedCommands.sortProject.options,_776=null;term&&_775.some(function(item){if(term===item[key]){_776=item;return true;}});return _776;},_createCommands:function(){var _777=new _770({model:this,category:"context",label:"label",property:"projectSortOrder",options:[{label:_771.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_771.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_771.createddescending,key:"-DateCreated",value:[{attribute:"created",descending:true},{attribute:"name",descending:false}]},{label:_771.createdascending,key:"+DateCreated",value:[{attribute:"created",descending:false},{attribute:"name",descending:false}]}]});this.set("_commands",[_777]);this.set("namedCommands",{sortProject:_777});}});});},"url:epi-cms/project/templates/ProjectSelectorList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\"></span>\r\n        </div>\r\n        <div data-dojo-type=\"dijit/Toolbar\" data-dojo-attach-point=\"toolbar\" class=\"epi-flatToolbar\">\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </div>\r\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"defaultOption\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitRadioIcon'\"></button>\r\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","dgrid/util/mouse":function(){define(["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _778(_779,type){return function(node,_77a){return on(node,_779+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _77a.call(this,evt);}});};};return {enterRow:_778(".dgrid-content .dgrid-row","mouseover"),enterCell:_778(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_778(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_778(".dgrid-content .dgrid-row","mouseout"),leaveCell:_778(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_778(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_778};});},"epi/shell/dgrid/selection/Exclusive":function(){define("epi/shell/dgrid/selection/Exclusive",["dojo/_base/declare"],function(_77b){return _77b([],{_exclusiveSelectionHandler:function(_77c,_77d){if(this._lastSelected!==_77d){this.clearSelection();this.select(_77d);this._lastSelected=_77d;}}});});},"epi-cms/contentediting/command/LanguageSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_77e,_77f,_780){return _77e([_77f],{optionsLabel:_780.contentdetails.existinglanguages,active:false,selected:"",_selectedSetter:function(_781){this.inherited(arguments);if(typeof (_781)=="string"&&_781!==""){this.set("label",_781.toUpperCase());if(_781!==this.model.get("documentLanguage")){this.set("active",true);}else{this.set("active",false);}}}});});},"epi-cms/contentediting/viewmodel/LanguageSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dojo/Deferred","epi/dependency","epi-cms/component/SiteTreeModel"],function(_782,lang,_783,_784,when,_785,_786,_787,_788){return _782([_784],{enabled:false,documentLanguage:"",selectedLanguage:"",availableLanguages:[],profile:null,siteTreeModel:null,postscript:function(){this.inherited(arguments);if(!this.siteTreeModel){var _789=_786.resolve("epi.storeregistry"),_78a=_789.get("epi.cms.sitestructure");this.siteTreeModel=new _787({store:_78a});}this.profile=this.profile||_786.resolve("epi.shell.Profile");this.siteTreeModel.getCurrentSite().then(lang.hitch(this,"_setAvailableLanguages")).then(lang.hitch(this,function(){when(this.profile.getContentLanguage(),lang.hitch(this,function(_78b){this.set("documentLanguage",_78b);this.set("selectedLanguage",_78b,false);}));}));},_setAvailableLanguages:function(site){if(site){var def=new _785();this.siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_78c){var obj=_78c.filter(function(item){return (item.languageId&&item.name);}).map(function(item){return {label:item.name,value:item.languageId};});this.set("availableLanguages",obj);def.resolve();}));return def.promise;}else{return new _785().resolve();}},_enabledSetter:function(_78d){if(this.enabled!==_78d){this.enabled=_78d;_783.publish("/epi/cms/action/eyetoggle",_78d);}},_selectedLanguageSetter:function(_78e,_78f){if(_78f!==false){_783.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_78e);}}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","dijit/Destroyable","epi/dependency"],function(_790,_791,_792,_793,when,lang,_794,_795,_796,_797){return _791([_792,_796],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_797.resolve("epi.shell.Profile");this.own(_794.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_798){this.onItemChildrenReload({siteUrl:_798.currentSite});}));})));},getRoot:function(_799,_79a){_799({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_79b){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_79c,_79d){when(this.store.query(lang.mixin({siteUrl:_79c.url},this.query)),_79d);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_79e){this.showAllLanguages=_79e;this._setQuery({allLanguages:_79e});},getCurrentSite:function(){var def=new _793();when(this.profile.getContentLanguage(),lang.hitch(this,function(_79f){if(_79f){when(this.store.get(),lang.hitch(this,function(_7a0){var _7a1=null;var _7a2=null;_790.some(_7a0,function(site){return _790.some(site.hosts,function(host){if(host==="*"){_7a2=site;return true;}});});var _7a3=this.location.host.toLowerCase();var _7a4=_790.some(_7a0,function(site){return _790.some(site.hosts,function(host){if(_7a3===host.toLowerCase()){_7a1={currentSite:site.url,currentEditLanguageId:site.url+_79f};return true;}});});if(!_7a4&&_7a2){_7a1={currentSite:_7a2.url,currentEditLanguageId:_7a2.url+_79f};}if(_7a1){def.resolve(_7a1);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_7a5){var def=new _793();when(this.store.query({siteUrl:_7a5,allLanguages:true}),function(_7a6){def.resolve(_7a6);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _793();when(this.getCurrentSite(),lang.hitch(this,function(_7a7){this.getAllLanguagesForSite(_7a7.currentSite).then(function(_7a8){def.resolve(_7a8);});}),function(_7a9){def.reject(_7a9);});return def;}});});},"epi-cms/command/DeviceSelection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/DestroyableByKey","epi/shell/command/OptionCommand","epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel"],function(_7aa,lang,_7ab,_7ac,_7ad){return _7aa([_7ac,_7ab],{iconClass:"epi-iconDevice",optionsProperty:"options",canExecute:true,active:false,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",new _7ad());}},_updateFromModel:function(){this.set("label",this.model.get("label"));this.set("active",!!(this.model.get("resolution")||this.model.get("channel")));},_onModelChange:function(){this.inherited(arguments);var _7ae="_ChannelCommandModelWatch";this.destroyByKey(_7ae);if(this.model){this._updateFromModel();this.ownByKey(_7ae,this.model.watch(lang.hitch(this,function(name,_7af,_7b0){if(["label","resolution","channel"].indexOf(name)!==-1){this._updateFromModel();}})));}}});});},"epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/topic","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/OptionGroup","epi/i18n!epi/cms/nls/episerver.cms.widget"],function(_7b1,lang,_7b2,_7b3,_7b4,_7b5,_7b6,_7b7){return _7b1([_7b2],{resolution:null,channel:null,postscript:function(){this.inherited(arguments);this._updateLabel();if(!this.get("viewSettingsManager")){this.set("viewSettingsManager",_7b4.resolve("epi.viewsettingsmanager"));}if(!this.get("channelStore")){var _7b8=_7b4.resolve("epi.storeregistry");this.set("channelStore",_7b8.get("epi.cms.displaychannels"));}},_resolutionSetter:function(_7b9){if(_7b9!==this.resolution){this.resolution=_7b9;this._onChange();}},_channelSetter:function(_7ba){if(_7ba!==this.channel){this.channel=_7ba;this.set("resolution",this._getDefaultResolutionForChannel(_7ba));this._onChange();}},_viewSettingsManagerSetter:function(_7bb){this.viewSettingsManager=_7bb;this.set("resolution",_7bb.getSettingProperty("resolution"));this.set("channel",_7bb.getSettingProperty("epichannel"));},_channelStoreSetter:function(_7bc){this.channelStore=_7bc;this._initialize();},_onChange:function(){this._updateLabel(this.get("resolution"),this.get("channel"));var _7bd=[{key:"resolution",value:this.get("resolution")},{key:"epichannel",value:this.get("channel")}];_7b3.publish("/epi/cms/action/viewsettingvaluechanged",_7bd);},_updateLabel:function(_7be,_7bf){var _7c0=_7b7.channelbutton.defaulttooltip;if(_7be||_7bf){_7c0=lang.replace(_7b7.channelbutton.tooltip,{channel:this._getOptionLabel(this._availableChannels,_7bf),resolution:this._getOptionLabel(this._availableResolutions,_7be)});}this.set("label",_7c0);},_getOptionLabel:function(_7c1,_7c2){var _7c3=this._find(_7c1,function(item){return item.value===_7c2;});return _7c3&&_7c3.label||"";},_initialize:function(){this.channelStore.query({query:"getallregistered"}).then(lang.hitch(this,function(_7c4){this._availableResolutions=this._getAvailableResolutions();this._availableChannels=[{value:null,label:_7b7.channelselector.defaultitem}].concat(_7c4.map(function(_7c5){return {value:_7c5.channelName,label:_7c5.name,resolutionId:_7c5.resolutionId};}));this.set("options",[new _7b6({property:"channel",model:this,label:_7b7.channelselector.header,options:this._availableChannels}),new _7b6({property:"resolution",model:this,label:_7b7.resolutionselector.header,options:this._availableResolutions})]);}));},_getAvailableResolutions:function(){var _7c6=[{value:null,label:_7b7.channelselector.defaultitem}];if(_7b5.displayResolutions){_7c6=_7c6.concat(_7b5.displayResolutions.map(function(r){return {value:r.width+"x"+r.height,label:r.name,id:r.id};}));}return _7c6;},_getDefaultResolutionForChannel:function(_7c7){var _7c8=this._availableResolutions;if(!(_7c7&&lang.isArray(_7c8))){return null;}_7c7=this._find(this._availableChannels,function(c){return c.value===_7c7;});var _7c9=this._find(_7c8,function(r){return (r.id===_7c7.resolutionId);});return _7c9?_7c9.value:null;},_find:function(_7ca,_7cb){var _7cc=null;if(!lang.isArray(_7ca)){return null;}_7ca.some(function(_7cd){if(_7cb(_7cd)){_7cc=_7cd;return true;}});return _7cc;}});});},"epi-cms/content-activity/command/ContentActivityCommandProvider":function(){define(["dojo/_base/declare","dijit/form/ToggleButton","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/content-activity/command/ContentActivityCommand"],function(_7ce,_7cf,_7d0,_7d1){return _7ce([_7d0],{model:null,postscript:function(){this.inherited(arguments);var _7d2={widget:_7cf,"class":"epi-chromeless epi-mediumButton"};this.addToTrailing(new _7d1({model:this.model,order:-10001}),_7d2);}});});},"epi-cms/content-activity/command/ContentActivityCommand":function(){define(["dojo/_base/declare","epi-cms/project/command/ToggleProjectActivities","epi-cms/command/_NonEditViewCommandMixin"],function(_7d3,_7d4,_7d5){return _7d3([_7d4,_7d5],{category:"content-activities"});});},"epi-cms/project/command/ToggleProjectActivities":function(){define(["dojo/_base/declare","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.activities.togglecommand.label"],function(_7d6,_7d7,_7d8){return _7d6([_7d7],{canExecute:true,category:"projectButton",iconClass:"epi-iconBubble",label:_7d8.show,property:"isActivitiesVisible",_activeSetter:function(_7d9){this.active=_7d9;this.set("label",_7d9?_7d8.hide:_7d8.show);}});});},"epi-cms/contentediting/ContentHierarchyService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","epi/dependency","epi/shell/DialogService","epi-cms/core/ContentReference"],function(_7da,lang,when,_7db,all,_7dc,_7dd,_7de){return _7da([],{store:null,constructor:function(_7df){_7da.safeMixin(this,_7df);this.store=this.store||_7dc.resolve("epi.storeregistry").get("epi.cms.content.light");},move:function(_7e0,_7e1,_7e2,_7e3){return this._execute("MoveMany",_7e0,_7e1,_7e2,_7e3);},copy:function(_7e4,_7e5,_7e6,_7e7){return this._execute("CopyMany",_7e4,_7e5,_7e6,_7e7);},_execute:function(_7e8,_7e9,_7ea,_7eb,_7ec){var _7ed={ids:_7e9 instanceof Array?_7e9:[_7e9],targetId:_7ea+"",createAsLocalAsset:_7eb,sortIndex:_7ec};return this.store.executeMethod(_7e8,null,_7ed).then(this._checkForErrors.bind(this)).then(this._handleUpdates.bind(this));},_checkForErrors:function(_7ee){var _7ef=new _7db(),_7f0=this.store.getAllResponsesWithError(_7ee).map(function(_7f1){return _7f1.message;});if(_7f0.length>0){_7dd.alertWithErrors({},_7f0).then(function(){_7ef.resolve(_7ee);});}else{_7ef.resolve(_7ee);}return _7ef.promise;},_handleUpdates:function(_7f2){var _7f3=this.store,_7f4=this._getUpdatesFromResponse(_7f2);return all(_7f4.map(function(item){var id=_7de.toContentReference(item.extraInformation).createVersionUnspecificReference().toString();return _7f3.refresh(id,true);})).then(function(_7f5){_7f5.forEach(function(item){_7f3.notify(item,_7f3.getIdentity(item));});return _7f2;});},_getUpdatesFromResponse:function(_7f6){var _7f7=_7f6.extraInformation,_7f8=[];Object.keys(_7f7).forEach(function(id){var item=_7f7[id];if(item.statusCode===200){_7f8.push(item);}});return _7f8;}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_7f9,_7fa,lang,_7fb){return _7f9(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_7fc){},onEditorResolved:function(data,_7fd){},constructor:function(){var _7fe=_7fb.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_7fe&&_7fe.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_7ff,_800,_801){this._registeredEditorWrappers[_7ff]={wrapperClassType:_800,initializer:_801};},_handleContentEditable:function(_802,_803,_804){var _805="epi-cms/contentediting/editors/ContentEditableEditor";if(_802!==_805||_803==="contenteditable"){return _802;}var _806=_804&&_804!==_805;return _806?_804:"dijit/form/ValidationTextBox";},_getWrapperAndEditor:function(_807){var _808=_807.wrapperType;var _809=_807.editorParams||{};var _80a=_807.editorWidgetType;if(!_808){if(_807.metadata.customEditorSettings&&_807.metadata.customEditorSettings.uiWrapperType){_808=_807.metadata.customEditorSettings.uiWrapperType;}else{_808=this.defaultWrapperType;}}if(!_80a){if(_807.metadata.customEditorSettings&&_807.metadata.customEditorSettings.uiType){_80a=_807.metadata.customEditorSettings.uiType;}else{if(_807.metadata.uiType){_80a=_807.metadata.uiType;}else{_80a="epi/shell/widget/FormContainer";lang.mixin(_809,{metadata:_807.metadata,onFieldCreated:function(_80b,_80c){}});}}}_80a=this._handleContentEditable(_80a,_808,_807.metadata.uiType);if(!_80a){throw ("Could not resolve editor widget for property: "+_807.name);}var data={editorWidgetType:_80a,editorParams:_809};if(_807.metadata.customEditorSettings&&_807.metadata.customEditorSettings.uiParams){lang.mixin(_809,_807.metadata.customEditorSettings.uiParams);}var _80d=this._registeredEditorWrappers[_808];if(!_80d){throw ("No suitable editor wrapper found for type: "+_808);}if(_807.metadata.customEditorSettings&&_807.metadata.customEditorSettings.uiWrapper){data.wrapperInitializer=null;data.wrapperType=_807.metadata.customEditorSettings.uiWrapper;}else{data.wrapperInitializer=_80d.initializer;data.wrapperType=_80d.wrapperClassType;}this.onEditorResolved(data,_807);if(_808){return data;}throw ("No suitable editor found");},createEditor:function(_80e,node,_80f,_810){var def=new _7fa();var _811=this._getWrapperAndEditor(_80e);var _812=_811.wrapperType;var _813=_811.editorWidgetType;require([_812,_813],lang.hitch(this,function(_814){var _815=_810||{};if(_80e.metadata){lang.mixin(_815,_80e.metadata.settings);lang.mixin(_815,_811.editorParams);_815.selections=_80e.metadata.selections;}var _816={wrapperType:_811.wrapperType,editorWidgetType:_811.editorWidgetType,editorParams:_815,blockDisplayNode:node,overlayItem:_815.overlayItem,property:_80e,propertyName:_80e.name,propertyDisplayName:_80e.metadata.displayName,value:_80f,contentModel:_80e.contentModel};var _817=new _814(_816);var _818=_811.wrapperInitializer;if(_818){lang.mixin(_816.editorParams,{parent:_817});_818(_817,_816);}this.onEditorCreated(_817.getEditorWidget());def.resolve(_817);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/username","epi/dependency","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_819,_81a,when,_81b,_81c,epi,_81d,_81e,_81f,_820,res){return _81a([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_821){this.inherited(arguments);lang.mixin(this,_821);this._inUseNotificationStore=this.store||_81e.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_81f.userName;this._messageService=this.messageService||_81e.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_822){this.inherited(arguments);if(this.currentModel&&!_820.compareIgnoreVersion(this.currentModel.contentData.contentLink,_822.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_822;_819.forEach(this._eventHandlers,function(_823){_823.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_81c.after(_822,"suspend",lang.hitch(this,this._onViewModelSuspended)),_81c.after(_822,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_81c.after(_822,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_81c.around(_822,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_824){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _825=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_825&&_825.length){return false;}}return _824.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _826=this.currentModel.contentData;this.removeAutomaticInUseNotification(_826);},_onPropertyEdited:function(){var _827=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_827);},ensureAutomaticInUseNotification:function(_828){var _829;_819.some(_828.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_829=item;return true;}},this);if(!_829){return this.put(this._createNotification(_828,false),_828.inUseNotifications);}else{if(_829.addedManually){return;}else{var _82a=new Date(_829.modified);if(_81b.difference(_82a,new Date(),"minute")>30){return this.put(_829,_828.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_82b){_819.forEach(_82b.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_82b.inUseNotifications);}},this);},_createNotification:function(_82c,_82d){var _82e=(new Date()).toISOString();return {contentLink:_82c.contentLink,languageBranch:_82c.currentLanguageBranch&&_82c.currentLanguageBranch.languageId,addedManually:_82d,created:_82e,modified:_82e};},put:function(_82f,_830){_82f.modified=(new Date()).toISOString();if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_82f),lang.hitch(this,function(_831){var _832;var _833=_819.some(_830,function(item,_834){if(_831.id===item.id){_832=_834;return true;}return false;});if(_833&&_832>=0){_830[_832]=_831;}else{_830.push(_831);}this._updateDependentStores(_82f.contentLink,_830);this._postFlag=false;}));}},remove:function(_835,_836){return when(this._inUseNotificationStore.remove(_835.id),lang.hitch(this,function(){var _837=_819.indexOf(_836,_835);_836.splice(_837,1);this._updateDependentStores(_835.contentLink,_836);}));},_updateDependentStores:function(_838,_839){var _83a={contentLink:_838,inUseNotifications:_839};this._inUseNotificationStore.updateDependentStores(_83a);},togglePermanentEditIndication:function(_83b,_83c){var _83d;var _83e=_819.some(_83b.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_83d=item;if(item.addedManually){return true;}}},this);if(_83e){if(_83c&&_83d.convertedFromAutomaticNotification){_83d.addedManually=false;return this.put(_83d,_83b.inUseNotifications);}else{return this.remove(_83d,_83b.inUseNotifications);}}else{if(_83d&&_83c){_83d.convertedFromAutomaticNotification=true;_83d.addedManually=true;}else{_83d=this._createNotification(_83b,true);}return this.put(_83d,_83b.inUseNotifications);}},updateMessageService:function(_83f){var _840=_83f.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_840});var _841=this._getManualInUseNotification(_83f.inUseNotifications);if(_841){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_83f.contentLink,_840,null);}},_getManualInUseNotification:function(_842){var _843;_819.forEach(_842,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_843=item;}},this);return _843;},currentUserHasInUseNotification:function(_844,_845){return _819.some(_844,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_845||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_846){var _847=[];_819.forEach(_846,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){var _848=_81d.toUserFriendlyString(item.userName,this._currentUsername);_847.push(_848);}},this);return _847;},hasInUseNotificationWarning:function(_849){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_849).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/when","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi/shell/StickyViewSelector"],function(_84a,_84b,lang,_84c,when,_84d,epi,_84e,_84f,_850,_851){return _84a([_84d,_850],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:null,_activeKey:"active",enabled:false,previewParams:null,_stickyViewSelector:null,postscript:function(){this.inherited(arguments);this._stickyViewSelector=this._stickyViewSelector||new _851();this._hashWrapper=this._hashWrapper||_84e.resolve("epi.shell.HashWrapper");this.previewParams={};this.viewSettingsHashValue=[];this._viewSettingsMap={};_84b.forEach(this.viewSettings,lang.hitch(this,function(_852){if(!this._viewSettingsMap[_852.key]){this._viewSettingsMap[_852.key]=_852;}else{throw "Duplicated view settings key.";}}));this.own(_84c.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged)),_84c.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged)));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_84b.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _853=this._viewSettingsMap[item.type];if(_853){_853.set("enabled",this.get("enabled"));_853.value=item.id;_853.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_854){this._preview=_854;_84b.forEach(this.viewSettings,lang.hitch(this,function(_855){_855.afterPreviewLoad(_854,this.get("enabled"));}));},getSettingProperty:function(_856){var _857=_84b.filter(this.viewSettingsHashValue,function(_858){return _858.type===_856;});return _857.length>0?_857[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_859){this.enabled=_859;var _85a={};_84b.forEach(this.viewSettings,lang.hitch(this,function(_85b){_85b.set("enabled",_859);_85b.beforePreviewLoad(_85a,_859);}));if(!epi.areEqual(this.previewParams,_85a)){this.previewParams=_85a;}else{_84b.forEach(this.viewSettings,lang.hitch(this,function(_85c){_85c.afterPreviewLoad(this._preview,_859);}));}},_applyViewSettingValue:function(key,_85d){var _85e,_85f=this._viewSettingsMap[key];if(_85f){_85e=lang.clone(this.previewParams);_85f.value=_85d;_85f.beforePreviewLoad(_85e,true);if(!epi.areEqual(this.previewParams,_85e)){this.previewParams=_85e;}else{_85f.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_860){var self=this;when(this.getCurrentContext()).then(function(_861){if(key!=="viewlanguage"){this._stickyViewSelector.save(_861.hasTemplate,_861.dataType,"onpageedit");}this._commitToHash(function(){var _862=key;if(!(key instanceof Array)){_862=[{key:key,value:_860}];}_862.forEach(function(_863){self._saveProperty(_863.key,_863.value);self._applyViewSettingValue(_863.key,_863.value);});});}.bind(this));},_viewSettingEnabledChanged:function(_864){var self=this;if(_864){when(this.getCurrentContext()).then(function(_865){this._stickyViewSelector.save(_865.hasTemplate,_865.dataType,"onpageedit");this._commitToHash(function(){self._saveProperty(self._activeKey,"true");self.set("enabled",_864);});}.bind(this));}else{this._commitToHash(function(){var _866=self._hasSetting();self._saveProperty(self._activeKey,_866?false:null);self.set("enabled",_864);});}},_addProperty:function(_867,_868){this.viewSettingsHashValue.push({type:_867,id:_868});},_updateProperty:function(_869,_86a){var _86b=-1;_84b.forEach(this.viewSettingsHashValue,function(item,_86c){if(item.type===_869){_86b=_86c;return;}});if(_86b>-1){this.viewSettingsHashValue[_86b].id=_86a;}else{this._addProperty(_869,_86a);}},_toObjects:function(url){var _86d=[];_84b.forEach(url.split("|"),function(item,_86e){var uri=new _84f(item);_86d.push({type:uri.getType(),id:uri.getId()});});return _86d;},_deleteProperty:function(_86f){var _870=-1;_84b.forEach(this.viewSettingsHashValue,function(item,_871){if(item.type===_86f){_870=_871;return;}});if(_870>-1){this.viewSettingsHashValue.splice(_870,1);}},_commitToHash:function(_872){var obj=this._hashWrapper.getHash();var _873=[];if(obj&&obj.viewsetting){this.set("viewSettingsHashValue",this._toObjects(obj.viewsetting));}else{this.set("viewSettingsHashValue",[]);}_872();_84b.forEach(this.viewSettingsHashValue,function(item,_874){_873.push(item.type+":///"+item.id);});if(_873.length>0){obj.viewsetting=_873.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_875,_876){if(this.get("viewSettingsHashValue")){if(_876!=null){this._updateProperty(_875,_876);}else{this._deleteProperty(_875);}}else{if(_876!=null){this._updateProperty(_875,_876);}}},_loadProperty:function(_877){var obj=this._hashWrapper.getHash();var _878=null;if(obj&&obj.viewsetting){var _879=this._toObjects(obj.viewsetting);var _87a=_84b.filter(_879,function(item){return item.type===_877;})[0];if(_87a){_878=_87a.id;}}return _878;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _84b.filter(this.viewSettings,lang.hitch(this,function(_87b){return _87b.usedForRendering;}));}});});},"epi-cms/content-approval/ApprovalService":function(){define(["dojo/topic","dojo/when","dojo/Deferred","epi/shell/xhr/errorHandler","epi/dependency"],function(_87c,when,_87d,_87e,_87f){function _880(_881,_882){this.approvalStore=_881||_87f.resolve("epi.storeregistry").get("epi.cms.approval");this.approvalDefinitionStore=_882||_87f.resolve("epi.storeregistry").get("epi.cms.approval.definition");};_880.prototype.approvalStore=null;_880.prototype.approvalDefinitionStore=null;_880.prototype.getApproval=function(_883){return when(this.approvalStore.get(_883)).otherwise(function(){return null;});};_880.prototype.approveChanges=function(_884,_885,_886){return _87e.wrapXhr(this.approvalStore.executeMethod("ApproveChanges",_884,{activeStepIndex:_885,approveReason:_886}));};_880.prototype.forceCompleteApproval=function(_887,_888){return _87e.wrapXhr(this.approvalStore.executeMethod("ForceComplete",_887,{forceReason:_888}));};_880.prototype.rejectChanges=function(_889,_88a,_88b){return _87e.wrapXhr(this.approvalStore.executeMethod("RejectChanges",_889,{activeStepIndex:_88a,rejectReason:_88b}));};_880.prototype.cancelChanges=function(_88c){return _87e.wrapXhr(this.approvalStore.executeMethod("CancelChanges",_88c.id));};_880.prototype.commentChanges=function(_88d,_88e){return _87e.wrapXhr(this.approvalStore.executeMethod("CommentChanges",_88d,{comment:_88e}));};_880.prototype.getDefinition=function(_88f){return when(this.approvalDefinitionStore.get(_88f)).otherwise(function(){return null;});};_880.prototype.getApprovalRelatedDefinition=function(_890){return when(this.approvalDefinitionStore.query({id:_890,getApprovalRelatedDefinition:true})).otherwise(function(){return null;});};_880.prototype.navigateToDefinition=function(_891){_87c.publish("/epi/shell/context/request",{uri:"epi.cms.approval:///"+_891},{sender:null});};_880.prototype.hasDefinition=function(_892){return this.getDefinition(_892).then(function(_893){return _893!==null&&_893.id!==0;});};_880.prototype.saveDefinition=function(_894){if(!_894){return new _87d().reject();}return _87e.wrapXhr(this.approvalDefinitionStore.put(_894));};_880.prototype.deleteDefinition=function(_895){return _87e.wrapXhr(this.approvalDefinitionStore.remove(_895));};_880.prototype.inheritDefinition=function(_896){return _87e.wrapXhr(this.approvalDefinitionStore.executeMethod("Inherit",_896));};return _880;});},"epi/shell/xhr/errorHandler":function(){define("epi/shell/xhr/errorHandler",["dojo/_base/declare","dojo/when","dojo/_base/json","dgrid/List","dgrid/extensions/DijitRegistry","epi/shell/DialogService","../widget/dialog/Alert","../widget/dialog/ErrorDialog"],function(_897,when,json,List,_898,_899,_89a,_89b){var _89c=_897([List,_898]),_89d;function _89e(_89f){if(typeof _89f==="string"){try{return json.fromJson(_89f);}catch(e){console.warn("Failed to parse responseText as json",e);}}return {};};_89d={forXhr:function(_8a0){var data,_8a1,list;if(_8a0.status>=500){_89b.showXmlHttpError(_8a0,_8a0);}else{data=_89e(_8a0.responseText);_8a1={description:data.message||_8a0.message};if(data.additionalInformation instanceof Array){list=new _89c({className:"epi-grid-max-height--300"});list.renderArray(data.additionalInformation);list.startup();_8a1.content=list;}return _899.alert(_8a1);}},wrapXhr:function(_8a2){_8a2=when(_8a2);_8a2.otherwise(_89d.forXhr);return _8a2;}};return _89d;});},"epi/shell/widget/dialog/ErrorDialog":function(){define("epi/shell/widget/dialog/ErrorDialog",["dojo","dijit/Dialog"],function(dojo,_8a3){var _8a4=null;var _8a5="/shell/cms/errordialog/";var _8a6={title:"A background request has failed",reloadtext:"Reload",heading:"An unhandled error has occured in a background request.",description:"The page may not function properly unless it's reloaded. Press the button below to reload the page now."};var _8a7="        <div style=\"padding-bottom:10px; width:600px\">             <h1>${heading}</h1>             <div style=\"background-color:#FFF; border:1px solid #000; padding:3px\">${errorMessage}</div>             <p>${description}</p>             <input type=\"button\" onclick=\"document.location.reload()\" value=\"${reloadtext}\" />         </div>     ";function _8a8(){if(!_8a4){_8a4=new _8a3();}return _8a4;};function _8a9(_8aa,_8ab){var _8ac=dojo.create("div",{innerHTML:dojo.string.substitute(_8a7,dojo.mixin({errorMessage:_8aa},_8a6))});var _8ad=dojo.create("iframe",{style:"width:100%; height:400px; border:inset 1px #CCC",frameborder:"0",width:"600",height:"400",src:"about:blank"});if(_8ad.attachEvent){var _8ae=function(){_8ad.detachEvent("onload",_8ae);_8ad.contentWindow.document.write(_8ab);};_8ad.attachEvent("onload",_8ae);}else{var _8af=dojo.connect(_8ad,"load",null,function(){dojo.disconnect(_8af);_8ad.contentWindow.document.write(_8ab);});}dojo.place(_8ad,_8ac);return _8ac;};var pub={getTextResourceKeys:function(){var _8b0=[];for(var p in _8a6){_8b0.push(_8a5+p);}return _8b0;},setTextResources:function(keys){if(!dojo.isArray(keys)){return;}dojo.forEach(keys,function(item){if(dojo.isString(item.key)&&dojo.isString(item.text)){_8a6[item.key.replace(_8a5,"")]=item.text;}});},showXmlHttpError:function(_8b1,_8b2){var _8b3=_8a8();var _8b4="";var _8b5="";if(_8b2&&_8b2.xhr){_8b4=_8b2.xhr.responseText;}if(dojo.isObject(_8b1)&&dojo.isString(_8b1.message)){_8b5=_8b1.message;}else{_8b5=_8b1;}var _8b6=_8a9(_8b5,_8b4);_8b3.set("title",_8a6.title);_8b3.set("content",_8b6);_8b3.show();}};return pub;});},"epi-cms/project/ProjectService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","dojo/Evented","dojo/aspect","dijit/Destroyable","epi/dependency","epi/shell/xhr/errorHandler","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_8b7,lang,when,_8b8,all,_8b9,_8ba,_8bb,_8bc,_8bd,_8be,_8bf){return _8b7([_8b9,_8bb],{isProjectModeEnabled:false,projectItemStore:null,projectStore:null,_currentProjectProfileKey:"epi.current-project-id",constructor:function(_8c0){_8b7.safeMixin(this,_8c0);this.projectItemStore=this.projectItemStore||_8bc.resolve("epi.storeregistry").get("epi.cms.project.item");this.projectStore=this.projectStore||_8bc.resolve("epi.storeregistry").get("epi.cms.project");this.profile=this.profile||_8bc.resolve("epi.shell.Profile");this.isProjectModeEnabled=_8be.isProjectModeEnabled;this.own(this.projectItemStore.on("update",this._onProjectItemUpdated.bind(this)),this.projectItemStore.on("delete",this._onProjectItemRemoved.bind(this)),this.projectStore.on("update",this._onProjectUpdated.bind(this)),this.projectStore.on("delete",this._onProjectRemoved.bind(this)));},hasScheduledProjectItems:function(_8c1){return _8bd.wrapXhr(this.projectStore.refresh(_8c1)).then(function(_8c2){return _8c2.itemStatusCount.delayedpublish>0||_8c2.itemStatusCount.delayedpublish_nopublishaccess>0;}.bind(this));},getProjectItemsForContent:function(_8c3){if(!(_8c3 instanceof Array)){_8c3=[_8c3];}return when(this.projectItemStore.query({contentLinks:_8c3}));},getProjectItemForContent:function(_8c4){var _8c5=new _8bf(_8c4);if(_8c5.workId===0){return new _8b8().reject("The content link needs to be version specific");}return this.getProjectItemsForContent(_8c4).then(function(_8c6){for(var i=0;i<_8c6.length;i++){if(_8c6[i].contentLink===_8c4){return _8c6[i];}}return null;});},getProjectsForContent:function(_8c7){var self=this;if(!(_8c7 instanceof Array)){_8c7=[_8c7];}return this.getProjectItemsForContent(_8c7).then(function(_8c8){if(_8c8.length===0){return new _8b8().resolve([]);}return self.getProjects(_8c8);});},canAddContent:function(_8c9,_8ca,_8cb){var _8cc=_8ca.filter(function(elem,pos){return _8ca.indexOf(elem)===pos;});return this.projectStore.executeMethod("CanAddContent",_8c9,{contentReferences:_8cc,languageId:_8cb});},getProjects:function(_8cd){var _8ce=this.projectStore;var _8cf=_8cd.map(function(_8d0){return _8ce.get(_8d0.projectId);});return all(_8cf);},exists:function(_8d1){return _8bd.wrapXhr(this.projectStore.executeMethod("exists",_8d1));},addProjectItems:function(_8d2,_8d3){_8d3=_8d3.filter(function(_8d4,pos){if(_8bf.isContentReference(_8d4)&&_8d3.indexOf(_8d4)===pos){return true;}});var _8d5=this.projectItemStore.executeMethod("addItems",_8d2,{contentLinks:_8d3}).then(function(_8d6){_8d6.forEach(function(item){this.projectItemStore.notify(item,this.projectItemStore.getIdentity(item));},this);return _8d6;}.bind(this));return _8bd.wrapXhr(_8d5);},removeProjectItems:function(_8d7){var _8d8=_8d7.map(function(item){return item.id;});return _8bd.wrapXhr(this.projectItemStore.removeRange(_8d8));},markAsReadyForReview:function(_8d9,_8da){var args=lang.mixin({projectItems:_8d9},_8da);return _8bd.wrapXhr(this.projectItemStore.executeMethod("ReadyForReview","",args));},markAsReadyToPublish:function(_8db){return _8bd.wrapXhr(this.projectItemStore.executeMethod("ReadyToPublish","",_8db));},isPartOfDelayedPublishedProject:function(_8dc){return this.getProjectsForContent([_8dc]).then(function(_8dd){return _8dd.some(function(_8de){return _8de.status==="delayedpublished";});});},publishProject:function(_8df,_8e0){var _8e1=this.projectStore;if(isNaN(_8df)){throw new Error("projectId is not a number");}return _8bd.wrapXhr(_8e1.executeMethod("Publish",_8df,{delayPublishUntil:_8e0})).then(_8e1.patchCache.bind(_8e1));},reactivateProject:function(_8e2){var _8e3=this.projectStore;if(isNaN(_8e2)){throw new Error("The given project ID is not a number.");}return _8bd.wrapXhr(_8e3.executeMethod("Reactivate",_8e2)).then(_8e3.patchCache.bind(_8e3));},getCurrentProjectId:function(){if(!this.isProjectModeEnabled){return new _8b8().resolve(null);}return when(this.profile.get(this._currentProjectProfileKey));},getCurrentProject:function(){var _8e4=this.projectStore;var that=this;return this.getCurrentProjectId().then(function(_8e5){if(!_8e5){return null;}return when(_8e4.get(_8e5)).otherwise(function(ex){if(ex.status===404){that.setCurrentProject(null);}return null;});});},setCurrentProject:function(_8e6){this.emit("currentProjectChanged",_8e6);return this.profile.set(this._currentProjectProfileKey,_8e6&&_8e6.id,{location:"server"});},_onProjectItemUpdated:function(_8e7){this.emit("project-item-updated",_8e7.target);},_onProjectItemRemoved:function(_8e8){this.emit("project-item-removed",_8e8.id);},_onProjectUpdated:function(_8e9){this.emit("project-updated",_8e9.target);},_onProjectRemoved:function(_8ea){this.emit("project-removed",_8ea.id);}});});},"epi-cms/activity/ActivityService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dijit/Destroyable","epi/dependency"],function(_8eb,lang,_8ec,_8ed,_8ee){return _8eb([_8ec,_8ed],{activityStore:null,activityCommentStore:null,constructor:function(_8ef){_8eb.safeMixin(this,_8ef);this.activityStore=this.activityStore||_8ee.resolve("epi.storeregistry").get("epi.cms.activities");this.activityCommentStore=this.activityCommentStore||_8ee.resolve("epi.storeregistry").get("epi.cms.activities.comments");this.own(this.activityCommentStore.on("update",this._onActivityCommentUpdated.bind(this)));},addMessage:function(_8f0,_8f1,_8f2){var obj={projectId:_8f0,contentLink:_8f1,message:_8f2};return this.activityStore.add(obj);},saveMessage:function(_8f3,_8f4){var obj={id:_8f3,message:_8f4};return this.activityStore.put(obj);},addComment:function(_8f5,_8f6){var obj={activityId:_8f5,message:_8f6};return this.activityCommentStore.add(obj);},saveComment:function(_8f7,_8f8){var obj={id:_8f7,message:_8f8};return this.activityCommentStore.put(obj);},_onActivityCommentUpdated:function(_8f9){this.emit("activity-comment-updated",_8f9.target);}});});},"epi-cms/notification/NotificationService":function(){define(["dojo/_base/declare","dojo/when","dojo/Deferred","dojo/Stateful","dojo/Evented","dijit/Destroyable","epi/shell/xhr/errorHandler","epi/dependency"],function(_8fa,when,_8fb,_8fc,_8fd,_8fe,_8ff,_900){return _8fa([_8fc,_8fd,_8fe],{notificationStore:null,postscript:function(){this.inherited(arguments);this.notificationStore=this.notificationStore||_900.resolve("epi.storeregistry").get("epi.cms.notification");this.own(this.notificationStore.on("add",this._onNotificationUpdated.bind(this)),this.notificationStore.on("update",this._onNotificationUpdated.bind(this)));},_onNotificationUpdated:function(_901){this.emit("notification-updated",_901.target);},getUnreadNotificationCount:function(){return _8ff.wrapXhr(this.notificationStore.executeMethod("GetUnreadCount"));},markAsRead:function(_902){if(!_902){return new _8fb().reject();}return _8ff.wrapXhr(this.notificationStore.executeMethod("MarkAsRead",_902)).then(this.notificationStore.refresh.bind(this.notificationStore,_902));},markAllAsRead:function(){return _8ff.wrapXhr(this.notificationStore.executeMethod("MarkAllAsRead"));}});});},"epi-cms/project/request/projectMode":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_903,when,_904){return {_getCurrentProjectId:function(){var _905="epi.cms.ProjectService";if(_904.exists(_905)){var _906=_904.resolve(_905);return _906.getCurrentProjectId();}return when(null);},beforeSend:function(_907){var _908=_907.options;if(_908.isProfileRequest){return when(_907);}var _909=new _903();this._getCurrentProjectId().then(function(_90a){if(_90a){_908.headers["X-EPiCurrentProject"]=_90a;}}).otherwise(function(err){console.error("Failed to get current project id from project service",err);}).always(function(){_909.resolve(_907);});return _909.promise;}};});},"epi-cms/request/contentLanguage":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_90b,when,_90c){return {beforeSend:function(_90d){var _90e=new _90b();var _90f=_90d.options;if(!(_90f.preventLocalizationHeader||_90f.isProfileRequest)){var _910=_90c.resolve("epi.shell.Profile");when(_910.getContentLanguage()).then(function(_911){if(_911){_90f.headers["X-EPiContentLanguage"]=_911;}_90e.resolve(_90d);});return _90e.promise;}_90e.resolve(_90d);return _90e.promise;}};});},"epi-cms/project/ProjectModeRequestInterceptor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi/dependency"],function(_912,lang,_913,_914,_915){return _912([_914],{constructor:function(_916){_912.safeMixin(this,_916);this.projectService=this.projectService||_915.resolve("epi.cms.ProjectService");this.contextService=this.contextService||_915.resolve("epi.shell.ContextService");this.own(this.contextService.registerRequestInterceptor(lang.hitch(this,this._onInterceptRequest)));},_onInterceptRequest:function(_917){var dfd=new _913();if(!this.projectService.isProjectModeEnabled){dfd.resolve();}else{this.projectService.getCurrentProject().then(function(_918){if(_918){_917.epiprojects=_918.id;_917.epieditmode=true;}}).always(dfd.resolve);}return dfd.promise;}});});},"epi-cms/project/ProjectItemQueryEngine":function(){define(["epi-cms/core/ContentReference","epi/shell/store/queryUtils"],function(_919,_91a){return function(_91b,_91c){_91c=_91c||{};_91c.comparers={contentLinks:function(_91d,_91e){return _91d.some(function(link){return _919.compareIgnoreVersion(link,_91e.contentLink);});}};return _91a.createEngine(_91b,_91c);};});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/shell/command/withConfirmation","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_91f,lang,_920,_921,_922,_923,_924,_925,_926,_927,_928,_929){var _92a=_91f([_920],{model:null,revertToPublished:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_92b){lang.mixin(this,_92b);this.revertToPublished=_921(new _923(),null,{title:_929.reverttopublishconfirmation.dialogtitle,heading:_929.reverttopublishconfirmation.confirmquestion,description:_929.reverttopublishconfirmation.description});this.translate=new _922();this.createDraft=new _926();this.sendForReview=new _924();this.publish=new _925();this.withdraw=new _927();this.manageExpiration=new _928();},_modelSetter:function(_92c){this.model=_92c;this.revertToPublished.set("model",_92c);this.translate.set("model",_92c);this.createDraft.set("model",_92c);this.sendForReview.set("model",_92c);this.publish.set("model",_92c);this.withdraw.set("model",_92c);this.manageExpiration.set("model",_92c);}});return new _92a();});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","epi/shell/widget/dialog/Confirmation"],function(_92d,lang,when,_92e,_92f){function _930(_931){var _932=new _92e(),_933=new _92f(_931);_933.connect(_933,"onAction",function(_934){if(_934){_932.resolve();}else{_932.cancel();}});_933.show();return _932.promise;};return function(_935,_936,_937){var _938=_935._execute;_935._execute=function(){var _939=new _92e();function _93a(){when(_938.apply(_935,arguments),_939.resolve,_939.cancel);};_936=_936||_930;when(_936(_937),_93a,_939.cancel);return _939;};return _935;};});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_93b,_93c,_93d,_93e){return _93b([_93e],{label:_93d.label,executingLabel:_93d.executinglabel,tooltip:_93d.title,category:"context",_execute:function(){var _93f=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_93f.content,languageBranch:_93f.language.preferredLanguage};_93c.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _940=this._getNormalizedModel(),_941=_940&&_940.language,_942=_940&&_940.content.isDeleted,_943=_941&&_941.isTranslationNeeded&&!_942,_944=_943&&_941.hasTranslationAccess&&_941.isPreferredLanguageAvailable;if(_940&&typeof _940.content.canTranslateContent==="function"){var _945=_940.content.canTranslateContent();_943=_943&&_945;_944=_944&&_945;}this.set("isAvailable",!!_943);this.set("canExecute",!!_944);},_getNormalizedModel:function(){var _946=this.model;if(_946){return {content:_946.contentData||_946,language:_946.languageContext||_946.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_947,lang,_948,_949,_94a){return _947([_948],{name:"reverttopublished",tooltip:_94a.reverttopublished.title,label:_94a.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _94b=this.model.contentData,_94c=_94b.status,_94d=_949.versionStatus;var _94e=_94c===_94d.CheckedOut||_94c===_94d.Rejected;this.set("isAvailable",_94e);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_94f,_950){var _951=this._getCanExecute(_94b,_94d);this.set("canExecute",!_950&&_951);}));this.set("canExecute",_94e&&this._getCanExecute(_94b,_94d));},_getCanExecute:function(_952,_953){var _954=_952.publishedBy!==null&&_952.publishedBy!==undefined;var _955=_952.status!==_953.Published;var _956=_952.status!==_953.Expired;var _957=this.model.canChangeContent(_949.action.Edit);var _958=_949.hasAccess(_952.accessMask,_949.accessLevel.Delete);return _954&&_955&&_956&&_957&&_958;}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_PropertyWatchCommand"],function(_959,lang,_95a){return _959([_95a],{_isChangingContentStatusHandle:null,checkDeleted:true,propertiesToWatch:["isChangingContentStatus"],_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _95b=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_95b&&!_95b.isDeleted));},_onPropertyChanged:function(){this.set("canExecute",this.get("canExecute"));}});});},"epi/shell/command/_PropertyWatchCommand":function(){define("epi/shell/command/_PropertyWatchCommand",["dojo/_base/declare","epi/shell/DestroyableByKey","epi/shell/command/_Command"],function(_95c,_95d,_95e){return _95c([_95e,_95d],{propertiesToWatch:null,_onModelChange:function(){this._watchModelProperty();},_watchModelProperty:function(){var _95f=this.model;this.destroyByKey("propertyWatchHandle");if(_95f){this._onPropertyChanged();this.propertiesToWatch.forEach(function(_960){this.ownByKey("propertyWatchHandle",_95f.watch(_960,this._onPropertyChanged.bind(this)));},this);}else{this.set("canExecute",false);}},_onPropertyChanged:function(){var _961=this.propertiesToWatch.every(function(_962){return !!this.model[_962];},this);this.set("canExecute",_961);}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_963,_964,_965,_966,_967){return _963([_966],{label:_967.sendforreview.label,executingLabel:_967.sendforreview.executinglabel,tooltip:_967.sendforreview.title,iconClass:"epi-iconCheckmark",action:_965.saveAction.CheckIn,_execute:function(){_964.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/topic","epi/shell/DestroyableByKey","epi-cms/contentediting/command/_ContentCommandBase"],function(_968,_969,_96a,_96b){return _968([_96b,_96a],{action:null,canExecute:true,forceReload:false,viewName:null,propertiesToWatch:["hasErrors"],_execute:function(){return this.model.changeContentStatus(this.action).then(this._onContentStatusChange.bind(this));},_onContentStatusChange:function(_96c){var _96d={uri:"epi.cms.contentdata:///"+_96c.id};var _96e={sender:this,trigger:"internal",forceContextChange:true,forceReload:this.forceReload};if(this.viewName){_96e.viewName=this.viewName;}_969.publish("/epi/shell/context/request",_96d,_96e);return _96c;},_onPropertyChanged:function(){this.set("canExecute",!this.model.hasErrors);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_96f,_970,when,_971,_972,_973,_974,_975){return _96f([_974],{label:_975.publish.label,executingLabel:_975.publish.executinglabel,tooltip:_975.publish.title,iconClass:"epi-iconPublished",action:_973.saveAction.Publish,forceReload:true,_execute:function(){return when(this.inherited(arguments)).then(function(_976){var _977=new _972(_976.oldId).createVersionUnspecificReference().toString();_970.publish("/epi/cms/contentdata/childrenchanged",_977);});},_onModelChange:function(){this.inherited(arguments);var _978=this.model.contentData,res=null;switch(_978.status){case _973.versionStatus.PreviouslyPublished:res=_975.republish;break;case _973.versionStatus.CheckedOut:if(_978.isMasterVersion){res=_975.publish;}else{res=_975.publishchanges;}break;default:res=_975.publishchanges;}var _979=_971.getValue(_978.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("viewName",_979);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_97a,_97b,_97c,_97d){return _97a([_97b],{name:"createdraft",label:_97d.createdraft.label,tooltip:_97d.createdraft.title,iconClass:"epi-iconVersions",ignoreContentStatus:false,_execute:function(){this.model.createDraft();},_onModelChange:function(){var _97e=this.model.contentData,_97f=_97e.status,_980=_97c.versionStatus,_981,_982;this.inherited(arguments);_981=_97c.hasAccessToAction(_97e,_97c.action.Edit,_97c.providerCapabilities.Edit);_982=this.ignoreContentStatus||_97f===_980.DelayedPublish||(_97f===_980.Published||_97f===_980.PreviouslyPublished)&&!_97e.isCommonDraft;this.set({canExecute:_981&&_982,isAvailable:_981&&_982});}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_983,_984,_985,_986){return _983([_985],{label:_986.withdraw.label,tooltip:_986.withdraw.title,iconClass:"epi-iconPen",action:_984.saveAction.Reject|_984.saveAction.ForceCurrentVersion});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/when","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/DialogService","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_987,_988,when,_989,_98a,_98b,_98c,_98d,_98e,_98f){return _988([_98c],{label:_98e.dialogtitle,tooltip:_98e.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",expirationDialogClass:_989,expirationDialogViewModelClass:_98a,_execute:function(){var _990=this.get("viewModel");var _991=new this.expirationDialogClass({model:_990});_98d.dialog({defaultActionsVisible:false,confirmActionText:_98f.action.save,content:_991,title:_98e.dialogtitle}).then(function(_992){var _993=this.get("model");_993.saveAndPublishProperty("iversionable_expire",_992,_98b.saveAction.SkipValidation);}.bind(this));},_onModelChange:function(){var _994=this.get("model");if(!_994||!_994.contentData){this.set("canExecute",false);return;}var _995=_994.contentData.properties,_996=_995.iversionable_expire;var _997=_994.canChangeContent()&&_98b.hasAccess(_994.contentData.accessMask,_98b.accessLevel.Publish);this.set("canExecute",false);when(_994.getPropertyMetaData("iversionable_expire")).then(function(_998){this.set("viewModel",new this.expirationDialogViewModelClass({metadata:_998,contentLink:_994.contentLink,contentName:_994.contentData.name,value:_996,minimumExpireDate:_995.iversionable_startpublish}));this.set("canExecute",_997);}.bind(this),function(res){if(res&&res.status===409){_98d.alert(_98f.messages.unexpectederror);}});}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_999,lang,_99a,_99b,_99c,_99d,_99e,_99f,_9a0,_9a1,res,_9a2){return _999([_99e,_9a0,_99d,_99b,_99f],{templateString:_9a1,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],infoText:["infoText"],state:["state"],enableSaveButton:["enableSaveButton"],showRemoveButton:["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.set("metadata",this.model.metadata);this.set("value",this.model.value);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_9a3){this.breadcrumb.set("contentLink",_9a3);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_9a4){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_9a4);}},_setShowRemoveButtonAttr:function(_9a5){_99a.set(this.removeButton.domNode,"display",_9a5?"":"none");},_onRemoveButtonClick:function(){var _9a6={stopPublish:null,archiveLink:null};this.set("value",_9a6);this.onChange(_9a6);},onFieldCreated:function(_9a7,_9a8){if(_9a7==="stopPublish"){_9a8.set("minimumValue",this.model.get("minimumExpireDate"));_9a8.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_9a7==="archiveLink"){this._archiveLinkSelector=_9a8;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_9a9){this.inherited(arguments);this.model.set("intermediateValue",_9a9);},getActions:function(){this._actions=[{name:"save",label:_9a2.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.model.save();this.executeDialog(this.model.get("value"));}})},{name:"cancel",label:_9a2.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.model.reset();this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_9aa,_9ab,lang,_9ac,_9ad,_9ae,_9af,_9b0,_9b1,on,when,_9b2,_9b3,_9b4,_9b5,_9b6,_9b7,_9b8,_9b9,_9ba){return _9ab([_9b6,_9ba,_9b9],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _9bb=_9b7.resolve("epi.storeregistry");this.store=this.store||_9bb.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _9bc=this.getParent(),_9bd=_9bc;while(_9bd&&!_9bd.isLayoutContainer&&_9bd.getParent()){_9bd=_9bd.getParent();}if(_9bd&&_9bd!==_9bc){this._resizeListener=_9ac.after(_9bd,"resize",lang.hitch(this,function(){var _9be=_9b0.getMarginBox(this.domNode);this.resize(_9be);}));}},resize:function(_9bf){if(!_9bf&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _9c0=_9b0.getContentBox(this.domNode).w;if(_9c0>this._availableWidth){var _9c1=this._leadingItem?_9b0.getMarginBox(this._leadingItem.domNode).w:0;var _9c2=this._availableWidth-_9c1;this._ellipsisize(0,_9c2);}}));},_setContentLinkAttr:function(_9c3){this._set("contentLink",_9c3);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _9c4=this.get("contentLink"),def=new _9ad(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_9c4){var _9c5=new _9b8(_9c4);var _9c6=_9c5.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_9c6),lang.hitch(this,function(_9c7){this.getAncestors(_9c6,lang.hitch(this,function(_9c8){this._currentContent=_9c7;this._ancestors=_9c8;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _9c9=[],_9ca=null;for(var i=this._ancestors.length-1;i>=0;i--){_9ca=this._ancestors[i];if(!_9ca.parentLink){continue;}_9c9.push(_9ca);if(this.isTypeOfRoot(_9ca)){break;}}_9c9.reverse();var _9cb=_9b0.getContentBox(this.domNode).w;this._availableWidth=_9cb>=0?_9cb:0;_9aa.forEach(_9c9,lang.hitch(this,function(_9cc){this._createItem(_9cc,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_9cd,_9ce){var node,_9cf=_9af.create("li"),_9d0=this.displayAsText||!_9cd.hasTemplate;if(_9d0){node=_9af.create("span",null,_9cf);}else{node=_9af.create("a",{href:"#"},_9cf);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_9cd);})));}node.textContent=this.isContextualContent(_9cd)?this.getContextualRootName(_9cd):_9cd.name;if(_9ce){_9af.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_9cf);}this._addAndLayout(_9cf);},onNodeClick:function(e,_9d1){e.preventDefault();_9b4.publish("/epi/shell/context/request",{uri:_9d1.uri},{sender:this});},_addAndLayout:function(node){var _9d2=new _9b5({},node);this._visibleItems.push(_9d2);this.addChild(_9d2);var _9d3=this._getTotalVisibleItemsSize();if(_9d3>this._availableWidth){this._ensureLeadingItem();while(_9d3>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _9d4=this._visibleItems.splice(0,1)[0];_9b1.set(_9d4.domNode,"display","none");_9d3=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _9d5=0;if(this._leadingItem){_9d5+=_9b0.getMarginBox(this._leadingItem.domNode).w;}_9aa.forEach(this._visibleItems,function(item){_9d5+=_9b0.getMarginBox(item.domNode).w;});return _9d5;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _9d6=_9af.create("li"),_9d7=_9af.create("span",{innerHTML:"..."}),_9d8=_9af.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_9af.place(_9d7,_9d6,"last");_9af.place(_9d8,_9d6,"last");this._leadingItem=new _9b5({},_9d6);this.addChild(this._leadingItem,0);},_ellipsisize:function(_9d9,_9da){if(_9d9>=this._visibleItems.length){return;}var _9db=this._visibleItems.length-_9d9,_9dc=Math.floor(_9da/_9db),item=this._visibleItems[_9d9],_9dd=_9b0.getMarginBox(item.domNode).w;if(_9dd<=_9dc){this._ellipsisize(_9d9+1,_9da-_9dd);}else{var _9de=_9b2(this.displayAsText?"span":"a",item.domNode)[0],_9df=_9b2("span.epi-breadCrumbsSeparator",item.domNode)[0],_9e0=_9dc-_9b0.getMarginBox(_9df).w;if(_9e0<0){_9e0=0;}_9b1.set(_9de,"width",_9e0+"px");_9ae.add(_9de,"dojoxEllipsis");this._ellipsisize(_9d9+1,_9da-_9dc);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_9e1,lang,_9e2,_9e3){var _9e4=_9e1.NodeList;function _9e5(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_9e5(n);}else{text+=n.nodeValue;}}}return text;};function _9e6(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _9e7(html,_9e8){if(typeof html=="string"){html=_9e3.toDom(html,(_9e8&&_9e8.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_9e4,{_placeMultiple:function(_9e9,_9ea){var nl2=typeof _9e9=="string"||_9e9.nodeType?_9e1(_9e9):_9e9;var _9eb=[];for(var i=0;i<nl2.length;i++){var _9ec=nl2[i];var _9ed=this.length;for(var j=_9ed-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_9eb.unshift(item);}if(j==_9ed-1){_9e3.place(item,_9ec,_9ea);}else{_9ec.parentNode.insertBefore(item,_9ec);}_9ec=item;}}if(_9eb.length){_9eb.unshift(0);_9eb.unshift(this.length-1);Array.prototype.splice.apply(this,_9eb);}return this;},innerHTML:function(_9ee){if(arguments.length){return this.addContent(_9ee,"only");}else{return this[0].innerHTML;}},text:function(_9ef){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_9e3.empty(node);node.appendChild(node.ownerDocument.createTextNode(_9ef));}}return this;}else{var _9f0="";for(i=0;node=this[i];i++){_9f0+=_9e5(node);}return _9f0;}},val:function(_9f1){if(arguments.length){var _9f2=lang.isArray(_9f1);for(var _9f3=0,node;node=this[_9f3];_9f3++){var name=node.nodeName.toUpperCase();var type=node.type;var _9f4=_9f2?_9f1[_9f3]:_9f1;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_9e2.indexOf(_9f1,opt.value)!=-1);}else{opt.selected=(opt.value==_9f4);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_9f4);}else{node.value=_9f4;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_9f1=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_9f1=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_9f1.push(opt.value);}}if(!_9f1.length){_9f1=null;}}return _9f1;}},append:function(_9f5){return this.addContent(_9f5,"last");},appendTo:function(_9f6){return this._placeMultiple(_9f6,"last");},prepend:function(_9f7){return this.addContent(_9f7,"first");},prependTo:function(_9f8){return this._placeMultiple(_9f8,"first");},after:function(_9f9){return this.addContent(_9f9,"after");},insertAfter:function(_9fa){return this._placeMultiple(_9fa,"after");},before:function(_9fb){return this.addContent(_9fb,"before");},insertBefore:function(_9fc){return this._placeMultiple(_9fc,"before");},remove:_9e4.prototype.orphan,wrap:function(html){if(this[0]){html=_9e7(html,this[0]);for(var i=0,node;node=this[i];i++){var _9fd=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_9fd,node);}var _9fe=_9e6(_9fd);_9fe.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_9e7(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _9ff=_9e6(html);for(var i=0,node;node=this[i];i++){_9ff.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_9e7(html,this[0]);for(var i=0;i<this.length;i++){var _a00=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_a00);}}return this;},replaceWith:function(_a01){_a01=this._normalize(_a01,this[0]);for(var i=0,node;node=this[i];i++){this._place(_a01,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_a02){var nl=_9e1(_a02);var _a03=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_a03,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_9e4.prototype.html){_9e4.prototype.html=_9e4.prototype.innerHTML;}return _9e4;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_a04){return _a04(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\r\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\r\n        <div class=\"epi-notificationBarButtonContainer\">\r\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>\r\n","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_a05,_a06,_a07,epi,_a08,_a09,_a0a){return _a05([_a06],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_intermediateValueSetter:function(_a0b){this.intermediateValue=_a0b;this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_a0b&&_a0b.stopPublish){var _a0c=_a0b.stopPublish instanceof Date?_a0b.stopPublish:new Date(_a0b.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_a0c<_a08.serverTime()?_a0a.expired:_a07.substitute(_a09.expiretimetext,[_a08.timeToGo(_a0c)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_a09.neverexpiretext);this.set("state","NotExpiring");}},_valueSetter:function(_a0d){this.value=_a0d;this.set("enableSaveButton",false);},_minimumExpireDateSetter:function(_a0e){var date=new Date(_a0e);this.minimumExpireDate=_a08.isDateValid(date)?date:null;this.set("minimumExpireDateMessage",_a09.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);},reset:function(){this.set("intermediateValue",this.value);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle"],function(dojo,_a0f,_a10,_a11){return _a0f([_a10],{constructor:function(){this.inherited(arguments);this.add("commands",new _a11());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_a12,_a13,_a14,_a15){return _a12([_a14],{name:"PermanentInUseNotification",label:_a15.title,tooltip:_a15.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_a13.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _a16=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_a16,true);this._updateCanExecute();},_onModelChange:function(){var _a17=this.model.contentData,_a18=this.inUseNotificationManager.currentUserHasInUseNotification(_a17.inUseNotifications,true);this.set("active",_a18);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_a19,_a1a,_a1b,_a1c){return _a19([_a1a],{constructor:function(){this.inherited(arguments);this.add("commands",_a1b(new _a1c(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_a1d,_a1e){_a1e=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_a1e);_a1d.options=_a1e;return _a1d;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_a1f,_a20,_a21,_a22,_a23){return _a1f([_a22],{name:"IgnoreInUseNotification",label:_a23.ignoreinusenotification.label,tooltip:_a23.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_a21.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _a24=this.model.contentData,_a25=this.inUseNotificationManager.hasInUseNotificationWarning(_a24.inUseNotifications),_a26,_a27;_a26=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_a27=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_a26;this.set("isAvailable",_a25&&_a27);},_requestContextChange:function(uri,_a28){var _a29={uri:uri};var _a2a={sender:this,forceContextChange:_a28};_a20.publish("/epi/shell/context/request",_a29,_a2a);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi/shell/DestroyableByKey","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi-cms/content-approval/command/AbortReview","epi-cms/content-approval/command/ApproveChanges","epi-cms/content-approval/command/CancelReview","epi-cms/content-approval/command/ForceCompleteApproval","epi-cms/content-approval/command/RejectChanges","epi-cms/content-approval/command/ReadyForReview","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi/i18n!epi/nls/episerver.cms.contentapproval.command","epi/i18n!epi/nls/episerver.shell.resources.texts"],function(_a2b,_a2c,_a2d,_a2e,_a2f,_a30,_a31,_a32,_a33,_a34,_a35,_a36,_a37,_a38,_a39,_a3a,_a3b,_a3c,_a3d,_a3e,res,_a3f,_a40){return _a2b([_a2d,_a2e],{commandMap:null,constructor:function(){this.commandMap={abortreview:_a30(_a2c(new _a39(),null,{title:_a3f.abortreview.label,description:_a3f.abortreview.description,confirmActionText:_a40.ok,cancelActionText:_a40.cancel})),approvechanges:_a30(new _a3a(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),cancelreview:_a30(_a2c(new _a3b(),null,{title:_a3f.cancelreview.label,description:_a3f.cancelreview.description,confirmActionText:_a3f.cancelreview.ok,cancelActionText:_a40.cancel})),forcecompleteapproval:_a30(new _a3c()),publish:_a30(new _a33(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"epi-success",keepMenuOpen:false,successStatus:res.successfullypublished}),readyforreview:_a30(new _a3e(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),readytopublish:_a30(new _a32(),{isMain:true,priority:8000,mainButtonClass:"epi-success",keepMenuOpen:true}),rejectchanges:_a30(new _a3d()),removescheduling:_a30(new _a38()),scheduleforpublish:_a30(new _a37()),withdraw:_a30(new _a36(),{resetLabelAfterExecution:false,keepMenuOpen:true})};this.commandMap.abortreview.order=0;this.commandMap.approvechanges.order=100;this.commandMap.forcecompleteapproval.order=200;this.commandMap.rejectchanges.order=300;this.commandMap.publish.order=400;this.commandMap.readyforreview.order=500;this.commandMap.readytopublish.order=600;this.commandMap.removescheduling.order=700;this.commandMap.scheduleforpublish.order=800;this.commandMap.cancelreview.order=900;this.commandMap.withdraw.order=1000;},updateCommandModel:function(_a41){this.destroyByKey("builtinCommands");var _a42=[];_a41.contentData.transitions.forEach(function(_a43){var _a44=this.commandMap[_a43.name];if(_a44){_a42.push(_a44);}},this);var _a45=new _a2f();_a45.order=1100;_a42.push(_a30(_a45,{isMain:true,priority:10000,mainButtonClass:"epi-primary"}));this.ownByKey("builtinCommands",_a45);var _a46=new _a35();_a46.order=1200;_a42.push(_a30(_a46));this.ownByKey("builtinCommands",_a46);var _a47=new _a34();_a47.order=1300;_a42.push(_a30(_a47));this.ownByKey("builtinCommands",_a47);var _a48=new _a31();_a48.order=1400;_a42.push(_a30(_a2c(_a48,null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));this.ownByKey("builtinCommands",_a48);this.set("commands",_a42);this.inherited(arguments);}});});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_a49,_a4a,_a4b,_a4c){return _a49([_a4a],{name:"editcommondraft",label:_a4c.editcommondraft.label,tooltip:_a4c.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_a4b;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _a4d=this.model.contentData,_a4e=_a4d.status,_a4f=_a4b.versionStatus,_a50=this.contentActionSupport.hasAccess(_a4d.accessMask,_a4b.accessLevel.Edit),_a51=(_a4e===_a4f.Published||_a4e===_a4f.PreviouslyPublished)&&!_a4d.isCommonDraft&&_a50&&this.contentActionSupport.hasProviderCapability(_a4d.providerCapabilityMask,_a4b.providerCapabilities.Edit);this.set("canExecute",_a51&&this.model.canEditCurrentLanguage());this.set("isAvailable",_a51);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","epi/shell/DialogService","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_a52,_a53,_a54,_a55,_a56,_a57,_a58,_a59){return _a52([_a54],{label:_a58.scheduleforpublish.label,tooltip:_a58.scheduleforpublish.title,iconClass:"epi-iconClock",action:_a55.saveAction.Schedule,_execute:function(){var _a5a=new _a57();_a5a.set("contentData",this.model.contentData);var _a5b=new _a56({model:_a5a});return _a53.dialog({content:_a5b,title:_a59.title,defaultActionsVisible:false}).then(function(){return this.model.scheduleForPublish(_a5a.get("dateValue"));}.bind(this)).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/_DialogContentMixin","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/project/ContentReferenceGrid","epi-cms/widget/Breadcrumb"],function(_a5c,lang,_a5d,_a5e,_a5f,_a60,_a61,_a62,_a63,_a64,_a65,_a66,_a67){return _a5c([_a5e,_a5f,_a60,_a62,_a61,_a63],{templateString:_a65,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_a68){this.breadcrumbNode.set("contentLink",_a68);},_setScheduleButtonEnabledAttr:function(_a69){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_a69);}},_setModelAttr:function(_a6a){this.inherited(arguments);this.referenceGrid.set("model",_a6a);if(_a6a){this.own(_a6a.watch("totalItems",lang.hitch(this,"_onGridItemsChange")));}},modelBindingMap:{title:["title"],dateLabel:["dateLabel"],dateValue:["dateValue"],breadcrumbModel:["breadcrumbModel"],scheduleButtonEnabled:["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _a64(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");this.addActions([{name:"save",label:_a66.confirmtext,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.executeDialog();}})},{name:"cancel",label:_a67.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}]);},_onGridItemsChange:function(_a6b,_a6c,_a6d){var _a6e=_a6d>0;if(this.referenceGrid){_a5d.toggle(this.referenceGrid.domNode,"dijitHidden",!_a6e);}this.setActionProperty("save","label",_a6e?_a66.scheduleanyway:_a66.confirmtext);this.setActionProperty("save","class",_a6e?"":"Salt");},dateTimeSelectorChanged:function(_a6f){this.model.set("dateValue",_a6f);}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_a70,_a71,_a72){return _a70([_a71],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _a73=new Date();_a73.setDate(_a73.getDate()+1);_a73.setHours(12,0,0,0);this.set("dateValue",_a73);},_isPublishedSetter:function(_a74){this.set("dateLabel",_a74?_a72.publishchangeson:_a72.publishon);},_contentDataSetter:function(_a75){this.set("title",_a75.name);this.set("isPublished",!_a75.isPendingPublish);this.set("breadcrumbModel",_a75.contentLink);var _a76=new Date(_a75.properties.iversionable_startpublish);if(!isNaN(_a76)&&_a76>new Date()){this.set("dateValue",_a76);}},_dateValueSetter:function(_a77){this.dateValue=_a77;this.set("scheduleButtonEnabled",!!(_a77&&_a77>new Date()));}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\r\n    <div data-dojo-attach-point=\"referenceGrid\" data-dojo-type=\"epi-cms/project/ContentReferenceGrid\" class=\"dijitHidden push-margin--top\"></div>\r\n</div>","epi-cms/project/ContentReferenceGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/keys","dojo/on","dojo/when","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/OnDemandGrid","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferenceGrid.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_a78,lang,_a79,keys,on,when,_a7a,_a7b,_a7c,_a7d,_a7e,_a7f,_a80,_a81,_a82,_a83){function _a84(prop){return function(_a85){if(this._grid){this._grid.set(prop,_a85);}};};return _a78([_a7a,_a7b,_a7c,_a81],{res:_a83,templateString:_a82,model:null,_gridClass:_a78([_a7d,_a7e,_a7f,_a80]),_grid:null,_loadCompleteEmitted:false,modelBindingMap:{query:["query"],store:["store"],columns:["columns"],notificationText:["notificationText"],resultSummary:["resultSummary"]},_setResultSummaryAttr:{node:"resultSummaryNode",type:"innerText"},_setQueryAttr:_a84("query"),_setColumnsAttr:_a84("columns"),_setStoreAttr:_a84("store"),_setNotificationTextAttr:function(text){var _a86=text&&text.length;_a79.toggle(this.notificationBar,"dijitHidden",!_a86);this.notificationNode.textContent=text||"";},_onRowClicked:function(e){if(this.model&&typeof this.model.onItemClicked==="function"){var data=this._grid.row(e).data;this.model.onItemClicked(data);}},buildRendering:function(){this.inherited(arguments);var _a87=this.model&&this.model.get("columns");this._grid=new this._gridClass({"class":"epi-plain-grid epi-plain-grid--no-border epi-plain-grid--no-header epi-plain-grid--margin-bottom",columns:_a87,showHeader:false,cellNavigation:false,selectionMode:"single"},this.gridNode);this._grid.addKeyHandler(keys.ENTER,lang.hitch(this,"_onRowClicked"));this._grid.addKeyHandler(keys.SPACE,lang.hitch(this,"_onRowClicked"));this._grid.on(".dgrid-cell a:click",lang.hitch(this,"_onRowClicked"));this.own(this._grid,on(this._grid,"dgrid-refresh-complete",lang.hitch(this,"_onGridRefreshComplete")));},startup:function(){this.inherited(arguments);this._grid.startup();if(!this._grid.store){this._emitLoadComplete();}},_onGridRefreshComplete:function(data){var _a88=data.results;when(_a88.total,lang.hitch(this,function(_a89){this.model.set("totalItems",_a89);this._emitLoadComplete();}));},_emitLoadComplete:function(){if(!this._loadCompleteEmitted){this.emit("contentreferencegrid-loading-complete",{});this._loadCompleteEmitted=true;}},_refresh:function(){this._grid.refresh();}});});},"url:epi-cms/project/templates/ContentReferenceGrid.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"notificationBar\" class=\"dijitHidden epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"notificationNode\" class=\"epi-notificationBarText\"></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"resultSummaryNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:_refresh\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_a8a,lang,_a8b,_a8c,_a8d){return _a8a([_a8c],{label:_a8d.label,tooltip:_a8d.title,iconClass:"epi-iconPen",action:_a8b.saveAction.CheckOut|_a8b.saveAction.ForceCurrentVersion});});},"epi-cms/content-approval/command/AbortReview":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.abortreview","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus"],function(_a8e,_a8f,_a90,_a91){return _a8e([_a91],{label:_a8f.label,iconClass:"epi-iconWarning",action:_a90.saveAction.CheckOut});});},"epi-cms/content-approval/command/ApproveChanges":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.approvechanges"],function(_a92,_a93,_a94){return _a92([_a93],{label:_a94.label,title:_a94.title,dialogPlaceHolder:_a94.placeholder,confirmActionText:_a94.confirmactiontext,executingLabel:_a94.label,executeMethod:"approveChanges",isCommentRequiredPropertyName:"isApproveCommentRequired"});});},"epi-cms/content-approval/command/_ApprovalTransitionWithReasonTextCommand":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","epi/shell/widget/ValidationTextarea","./_ApprovalTransitionCommand","epi-cms/contentediting/command/_CommandWithDialogMixin"],function(_a95,_a96,_a97,_a98,_a99,_a9a){return _a95([_a99,_a9a],{dialogContentClass:_a98,dialogClass:"epi-dialog-confirm",executeMethod:null,isCommentRequiredPropertyName:null,dialogPlaceHolder:null,dialogText:null,postscript:function(){this.inherited(arguments);this.dialogContentParams={required:true,intermediateChanges:true,placeHolder:this.dialogPlaceHolder,"class":"epi-textarea--max-height--500"};},_execute:function(){return this._getApprovalDefinition().then(function(_a9b){if(_a9b[this.isCommentRequiredPropertyName]){this._executeDeferred=new _a96();this.showDialog();return this._executeDeferred.promise;}else{return this._executeServiceMethod();}}.bind(this));},_getApprovalDefinition:function(){return this.approvalService.getApprovalRelatedDefinition(this.model.contentLink);},showDialog:function(){this.inherited(arguments);this._disableActionButton(true);if(this.dialogText&&typeof this.dialogText==="string"){_a97.place("<p>"+this.dialogText+"</p>",this.dialogContent.domNode,"before");}this._dialog.own(this.dialogContent.on("change",this._onDialogContentChanged.bind(this)));},_onDialogContentChanged:function(_a9c){this._disableActionButton(!_a9c||!(_a9c.trim()));},_disableActionButton:function(_a9d){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",_a9d);},onDialogExecute:function(){this._executeDeferred.resolve(this._executeServiceMethod.call(this,this.dialogContent.value));},onDialogCancel:function(){this._executeDeferred.reject();},_executeServiceMethod:function(_a9e){return this.approvalService[this.executeMethod](this.approval.id,this.approval.activeStepIndex,_a9e).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/content-approval/command/_ApprovalTransitionCommand":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges","epi-cms/contentediting/command/_ChangeContentStatus"],function(_a9f,_aa0,_aa1,_aa2){return _a9f([_aa2],{approval:null,executeMethod:null,postscript:function(){this.inherited(arguments);this.approvalService=this.approvalService||_aa0.resolve("epi.cms.ApprovalService");},_onModelChange:function(){this.set("canExecute",false);if(!this.model){return;}return this.approvalService.getApproval(this.model.contentLink).then(function(_aa3){this.set({canExecute:!!_aa3,approval:_aa3});}.bind(this));},_execute:function(){return this._executeServiceMethod();},_executeServiceMethod:function(){return this.approvalService[this.executeMethod](this.approval).then(this._onContentStatusChange.bind(this));},_onContentStatusChange:function(){this.inherited(arguments,[{id:this.model.contentLink}]);}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(_aa4,_aa5,lang,_aa6,when,_aa7,_aa8,_aa9,_aaa){return _aa5([_aa7],{res:_aa9,title:null,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_aaa.action.ok,cancelActionText:_aaa.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _aa8(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_aa6.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_aa6.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_aa6.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_aab,_aac){if(!_aac){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/content-approval/command/CancelReview":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.cancelreview","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_aad,_aae,_aaf){return _aad([_aaf],{label:_aae.label,iconClass:"epi-iconClose",executeMethod:"cancelChanges"});});},"epi-cms/content-approval/command/ForceCompleteApproval":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.forcecompleteapproval"],function(_ab0,_ab1,_ab2){return _ab0([_ab1],{label:_ab2.label,title:_ab2.title,dialogPlaceHolder:_ab2.placeholder,dialogText:_ab2.description,confirmActionText:_ab2.ok,iconClass:"epi-iconRight",isCommentRequiredPropertyName:"isForcedApproveCommentRequired",_executeServiceMethod:function(_ab3){return this.approvalService.forceCompleteApproval(this.approval.id,_ab3).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/content-approval/command/RejectChanges":function(){define(["dojo/_base/declare","./_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges"],function(_ab4,_ab5,_ab6){return _ab4([_ab5],{label:_ab6.label,title:_ab6.title,dialogPlaceHolder:_ab6.placeholder,confirmActionText:_ab6.confirmactiontext,iconClass:"epi-iconStop",executeMethod:"rejectChanges",isCommentRequiredPropertyName:"isDeclineCommentRequired"});});},"epi-cms/content-approval/command/ReadyForReview":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/content-approval/command/_ApprovalTransitionWithReasonTextCommand","epi/i18n!epi/nls/episerver.cms.contentapproval.command.requestapproval"],function(_ab7,_ab8,_ab9,_aba){return _ab7([_ab9],{label:_aba.label,executingLabel:_aba.label,action:_ab8.saveAction.RequestApproval,title:_aba.title,dialogPlaceHolder:_aba.placeholder,confirmActionText:_aba.confirmactiontext,isCommentRequiredPropertyName:"isStartCommentRequired",_onModelChange:function(){this._watchModelProperty();},_getApprovalDefinition:function(){return this.approvalService.getDefinition(this.model.contentLink);},_executeServiceMethod:function(_abb){return this.model.changeContentStatus(this.action).then(function(){if(_abb){return this.approvalService.getApproval(this.model.contentLink).then(function(_abc){this.set({canExecute:!!_abc,approval:_abc});return this.approvalService.commentChanges(this.approval.id,_abb);}.bind(this));}}.bind(this)).then(this._onContentStatusChange.bind(this));}});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_abd,lang,_abe){return _abd([_abe],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_abf,_ac0){this.inherited(arguments);if(_ac0&&this.value){_abf.epichannel=this.value;}else{delete _abf.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_ac1,_ac2){return _ac1(_ac2,{key:null,value:null,enabled:null,postscript:function(){this._disableObsoleteWarnings=true;this.inherited(arguments);},beforePreviewLoad:function(_ac3,_ac4){},afterPreviewLoad:function(_ac5,_ac6){}});});},"epi/shell/_StatefulGetterSetterMixin":function(){define("epi/shell/_StatefulGetterSetterMixin",["dojo/_base/declare","dojo/_base/lang","epi/obsolete"],function(_ac7,lang,_ac8){return _ac7(null,{_disableObsoleteWarnings:false,postscript:function(){if(!this._disableObsoleteWarnings){_ac8("epi/shell/_StatefulGetterSetterMixin","Use dojo/Stateful custom setters/getters instead");}},get:function(name){var _ac9=this._getAttrNames(name);return this[_ac9.g]?this[_ac9.g]():this[name];},set:function(name,_aca){if(typeof name==="object"){for(var x in name){this.set(x,name[x]);}return this;}var _acb=this._getAttrNames(name);var _acc=this[_acb.s];if(lang.isFunction(_acc)){_acc.apply(this,Array.prototype.slice.call(arguments,1));}else{this._set(name,_aca);}return this;},_attrPairNames:{},_getAttrNames:function(name){var apn=this._attrPairNames;if(apn[name]){return apn[name];}var uc=name.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase();});return (apn[name]={s:"_set"+uc+"Attr",g:"_get"+uc+"Attr",l:uc.toLowerCase()});},_set:function(name,_acd){var _ace=this[name];this[name]=_acd;if(this._watchCallbacks){this._watchCallbacks(name,_ace,_acd);}return this;}});});},"epi/obsolete":function(){define("epi/obsolete",[],function(){return function(_acf,_ad0,_ad1){var _ad2="OBSOLETE: "+_acf;if(_ad0){_ad2+=" "+_ad0;}if(_ad1){_ad2+=" -- will be removed in version: "+_ad1;}console.warn(_ad2);};});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_ad3,_ad4){return _ad3([_ad4],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_ad5,_ad6){this.inherited(arguments);if(_ad5){var size=_ad6?this._getPreviewResolution():null;_ad5.set("previewSize",size);_ad5.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _ad7=this.value;if(_ad7){var _ad8=_ad7.split("x");if(_ad8.length===2){size={w:_ad8[0],h:_ad8[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_ad9,lang,_ada,_adb,_adc){return _ad9([_adb,_adc],{key:"viewlanguage",usedForRendering:true,isTagItem:false,constructor:function(_add){this.own(_add.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},_onContextChange:function(_ade,_adf){var dfd=new _ada();dfd.resolve();if(this.get("enabled")&&this.value){_ade.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_ae0,lang,_ae1){return _ae0([_ae1],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_ae2,_ae3){this.inherited(arguments);if(_ae3&&this.value){_ae2.visitorgroupsByID=this.value;}else{delete _ae2.visitorgroupsByID;}}});});},"epi-cms/project/ProjectViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_ae4,lang,_ae5,_ae6,_ae7){return _ae4([_ae6,_ae7],{key:"project",usedForRendering:true,isTagItem:false,constructor:function(_ae8){this.own(_ae8.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},beforePreviewLoad:function(_ae9,_aea){this.inherited(arguments);if(_aea&&this.value){_ae9.epiprojects=this.value;}else{delete _ae9.epiprojects;}},_onContextChange:function(_aeb,_aec){var dfd=new _ae5();if(this.get("enabled")&&this.value){_aeb.epiprojects=this.value;_aeb.epieditmode=true;}dfd.resolve();return dfd.promise;}});});},"epi-cms/widget/ContentTypeService":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(_aed,_aee,lang,when,all,_aef,_af0){return _aed(null,{contentTypeStore:null,_getavailabletypesQuery:"getavailablecontenttypes",constructor:function(){this.contentTypeStore=this.contentTypeStore||_aef.resolve("epi.storeregistry").get("epi.cms.contenttype");},getAcceptedChildTypes:function(_af1,_af2,_af3,_af4,_af5){var _af6=this.contentTypeStore.query({query:this._getavailabletypesQuery,localAsset:_af2,parentReference:_af1,requestedTypes:_af3});return this.filterQueryResult(_af6,_af4,_af5);},filterQueryResult:function(_af7,_af8,_af9){return when(_af7).then(function(_afa){var _afb=_aee.map(_afa,function(type){return type.typeIdentifier;});_afb=_af0.getValidAcceptedTypes(_afb,_af8,_af9);_afa=_aee.filter(_afa,function(type){return _aee.some(_afb,function(_afc){return type.typeIdentifier===_afc;});});return _afa;});}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/when","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,when,_afd,_afe){lang.extend(_afd,{getContentLanguage:function(){return when(this.get("editlanguage"),function(_aff){return _aff||_afe.currentContentLanguage;});},setContentLanguage:function(_b00){return this.set("editlanguage",_b00,{location:"server"});}});return _afd;});},"epi-cms/compare/views/AllPropertiesCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","../viewmodels/AllPropertiesCompareViewModel","../AllPropertiesTransformer","../FormField","epi/shell/widget/FormContainer","epi-cms/contentediting/FormEditing","epi/shell/widget/_ModelBindingMixin"],function(_b01,lang,_b02,when,_b03,_b04,_b05,_b06,_b07,_b08){return _b01([_b07,_b08],{modelBindingMap:{comparison:["comparison"],rightMetadata:["rightMetadata"]},postMixInProperties:function(){this.inherited(arguments);this._groupMap={};this.own(this.model=new _b03({model:this.model}));},removeForm:function(form){var _b09=form.containerLayout.selectedChildWidget;if(_b09){this._selectedTabName=_b09.name.toLowerCase();}this._groupMap={};this._mappingManager.clear();return this.inherited(arguments);},_createForm:function(){return new _b06(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,metadataTransformer:new _b04({model:this.model}),baseClass:"epi-cmsEditingForm epi-form-container epi-form-container--compare"},this.formSettings));},_setupForm:function(){this.inherited(arguments);var _b0a=this._groupMap[this._selectedTabName];if(_b0a){this._form.containerLayout.selectChild(_b0a);}},_setComparisonAttr:function(_b0b){this._set("comparison",_b0b);for(var _b0c in this._groupMap){var _b0d=this._groupMap[_b0c];var _b0e=(_b0b&&_b0b[_b0c]&&_b0b[_b0c].length)||0;this._setGroupTitleWithChanges(_b0d,_b0e);}},_setRightMetadataAttr:function(_b0f){this._set("rightMetadata",_b0f);if(!this._started){return;}this._removeAndDestroyForm();this.viewModel&&this._setupForm();},onGroupCreated:function(_b10,_b11,_b12){this.inherited(arguments);if(_b12){return;}var name=_b10.toLowerCase(),_b13=this.comparison;_b11.groupName=_b10;this._groupMap[name]=_b11;this._setGroupTitleWithChanges(_b11,_b13&&_b13[name]&&_b13[name].length);},_setViewModelAttr:function(_b14){this.inherited(arguments);this.model.set("contentViewModel",this.viewModel);},_setGroupTitleWithChanges:function(_b15,_b16){var _b17=_b15.params.title;if(_b16){_b17=lang.replace("{0}<span class=\"epi-compare-tab--has-changes\">{1}</span>",[_b17,_b16]);}_b15.set("title",_b17);}});});},"epi-cms/compare/viewmodels/AllPropertiesCompareViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi","epi/dependency","epi/string","epi-cms/core/ContentReference","dojo/Stateful","dijit/Destroyable"],function(_b18,lang,_b19,when,epi,_b1a,_b1b,_b1c,_b1d,_b1e){return _b18([_b1d,_b1e],{_metadataManager:null,contentViewModel:null,leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null,postscript:function(){this.inherited(arguments);this._metadataManager=this._metadataManager||_b1a.resolve("epi.shell.MetadataManager");this.initialize();},initialize:function(){var _b1f=lang.hitch(this,function(name,_b20,_b21){var _b22=this.model.rightVersion;if(!_b22||(_b20===_b21)){return;}when(this._metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:_b22.contentLink}),lang.hitch(this,function(_b23){this.set("rightMetadata",_b23);}));});_b1f("rightVersionContentLink",null,this.model.rightVersionContentLink);this.own(this.model.watch("rightVersionContentLink",_b1f),this.model.watch("contentLink",lang.hitch(this,function(name,_b24,_b25){if(!_b1c.compareIgnoreVersion(_b24,_b25)){this.set({leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null});}})));},generateComparison:function(){var _b26={},_b27=this.rightMetadata;if(!this.leftPropertyMap||!this.rightPropertyMap){this.set("comparison",null);return;}_b27.groups.forEach(function(_b28){_b26[_b28.name.toLowerCase()]=[];});_b27.properties.forEach(lang.hitch(this,function(_b29){this._addPropertyToComparison(_b26,_b29,_b29.groupName);}));this.set("comparison",_b26);},copy:function(_b2a){if(!_b2a){throw new Error("propertyName is required");}var _b2b=this.contentViewModel,_b2c=lang.getObject(_b2a,false,this.rightPropertyMap);if(_b2b&&_b2c!==undefined){_b2b.setProperty(_b2a,lang.clone(_b2c));_b2b.save();}},_addPropertyToComparison:function(_b2d,_b2e,_b2f,_b30){var _b31=_b1b.pascalToCamel((_b30||"")+_b2e.name),_b32=lang.getObject(_b31,false,this.leftPropertyMap),_b33=lang.getObject(_b31,false,this.rightPropertyMap);if(_b2e.showForEdit&&!epi.areEqual(_b32,_b33,epi.compareOptions.treatFalsyAsEquals|epi.compareOptions.skipEmptyProperties)){if(_b2e.properties.length){_b2e.properties.forEach(lang.hitch(this,function(_b34){this._addPropertyToComparison(_b2d,_b34,_b2f,_b31+".");}));}else{_b2d[_b2f.toLowerCase()].push(_b31.toLowerCase());}}},_contentViewModelSetter:function(_b35){this.contentViewModel=_b35;this.set({leftMetadata:_b35.metadata,leftPropertyMap:_b35.contentData.properties});this.own(_b35.watch("contentData",lang.hitch(this,function(name,_b36,_b37){this.set("leftPropertyMap",_b37.properties);})),_b19.after(_b35,"onPropertySaved",lang.hitch(this,"_onPropertySaved"),true));},_leftPropertyMapSetter:function(_b38){this.leftPropertyMap=lang.clone(_b38);this.generateComparison();},_rightPropertyMapSetter:function(_b39){this.rightPropertyMap=lang.clone(_b39);this.generateComparison();},_rightMetadataSetter:function(_b3a){this.rightMetadata=_b3a;if(this.rightMetadata){when(this.model.contentDataStore.get(this.model.rightVersion.contentLink)).then(lang.hitch(this,function(_b3b){this.set("rightPropertyMap",_b3b.properties);}));}},_onPropertySaved:function(_b3c,_b3d){var _b3e=this.comparison;if(this.leftPropertyMap){lang.setObject(_b3c,_b3d,this.leftPropertyMap);}if(!_b3e){return;}var _b3f=this.rightMetadata.getPropertyMetadata(_b3c.split(".")[0]),_b40=this.rightMetadata.getPropertyMetadata(_b3c),_b41=this.rightPropertyMap&&lang.getObject(_b3c,false,this.rightPropertyMap);if(!_b40.showForEdit){return;}var _b42=_b3e[_b3f.groupName.toLowerCase()],name=_b3c.toLowerCase(),_b43=_b42.indexOf(name),_b44=epi.areEqual(_b3d,_b41,epi.compareOptions.treatFalsyAsEquals|epi.compareOptions.skipEmptyProperties);if(_b43>=0&&_b44){_b42.splice(_b43,1);}else{if(_b43<0&&!_b44){_b42.splice(0,0,name);}}this.set("comparison",_b3e);}});});},"epi-cms/compare/AllPropertiesTransformer":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/MetadataTransformer","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_b45,lang,_b46,_b47,res){return _b45([_b47],{model:null,_map:null,_getProperty:function(_b48){function _b49(map,_b4a,path){_b4a.forEach(function(_b4b){var name=(!path?_b4b.name:path+"."+_b4b.name).toLowerCase();map[name]=_b4b;_b4b.properties.length&&_b49(map,_b4b.properties,name);});return map;};if(!this.model.rightMetadata){return null;}if(!this._map){this._map=_b49({},this.model.rightMetadata.properties);}return this._map[_b48.toLowerCase()];},_getComponentDefinitions:function(_b4c,_b4d,_b4e,_b4f,_b50){if(_b4d instanceof Array){var _b51=this.defaultSingleGroupType;_b4d.forEach(function(_b52){if(_b52.name==="EPiServerCMS_SettingsPanel"){delete _b52.options.region;_b52.options.title=res.settingspaneltabname;_b52.uiType=_b51;}});}return this.inherited(arguments);},transformPropertySettings:function(_b53,_b54,_b55,_b56,_b57){var _b58=this.inherited(arguments),_b59=this._getProperty(_b54+_b53.name),_b5a;_b58.settings._hint="compare";_b58.settings.groupName=_b53.groupName;if(_b59){var _b5b=_b46.pascalToCamel(_b54+_b53.name),_b5c=this.model&&lang.getObject(_b5b,false,this.model.rightPropertyMap);_b5a=this.inherited(arguments,[_b59,"compare."+_b54,false,true,_b57]);_b5a.settings._type="compare";_b5a.settings.compareViewModel=this.model;_b5a.settings.value=_b5c;return [_b58,_b5a];}return _b58;},_createGroupContainer:function(_b5d,_b5e){var _b5f=this.inherited(arguments);_b5f.settings._hint="compare";return _b5f;},_createParentContainer:function(_b60){_b60.properties.forEach(function(_b61){_b61.groupName=_b60.groupName;});return this.inherited(arguments);}});});},"epi-cms/compare/FormField":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/form/Button","epi/shell/form/Field","epi/shell/form/formFieldRegistry","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_b62,lang,_b63,_b64,_b65,_b66,_b67,_b68,res){var _b69=_b62([_b67],{_copyButton:null,buildRendering:function(){this.inherited(arguments);this.own(this._copyButton=new _b66({"class":"epi-form-container__section__row__copy-button epi-chromeless",iconClass:"epi-icon-compare--copy",label:res.copy.label,title:res.copy.tooltip}).placeAt(this.domNode,"last"));this._copyButton.on("click",lang.hitch(this,function(){this.model.copy(this.params.name);}));},addChild:function(_b6a,_b6b){var _b6c,_b6d=_b64.create("div",{"class":"epi-form-container__section__row__editor--"+_b6a._type},this.domNode);if(_b6a.checkbox){_b6c=(_b6a._type==="compare")?_b64.create("label",{innerHTML:_b6a.label},_b6d):_b64.place(this.labelNode,_b6d);this._addCheckboxChild(_b6a,_b6c);}else{_b6a.placeAt(_b6d);}},destroy:function(){this.inherited(arguments);if(this._comparisonWatch){this._comparisonWatch.remove();this._comparisonWatch=null;}},_setReadonlyIconDisplayAttr:function(_b6e){this.inherited(arguments);if(this._copyButton){_b65.set(this._copyButton.domNode,"display",_b6e?"none":"");}},_setModelAttr:function(_b6f){this._set("model",_b6f);if(this._comparisonWatch){this._comparisonWatch.remove();}this._updateChangedState();this._comparisonWatch=_b6f.watch("comparison",lang.hitch(this,"_updateChangedState"));},_updateChangedState:function(){var _b70=this.model.comparison,_b71=_b70&&_b70[this.groupName],_b72=_b71&&_b71.indexOf(this.name.toLowerCase())>=0;_b63.toggle(this.domNode,"epi-form-container__section__row--has-changes",_b72);}});function _b73(_b74,_b75){var _b76=new _b69({labelTarget:_b74.checkbox?_b74.checkbox.id:_b74.id,label:_b74.label,tooltip:_b74.tooltip,name:_b74.name,groupName:_b74.groupName.toLowerCase(),readonlyIconDisplay:_b74.readOnly,hasFullWidthValue:_b74.useFullWidth});_b76.own(_b74.watch("readOnly",function(name,_b77,_b78){_b76.set("readonlyIconDisplay",_b78);}));return _b76;};function _b79(_b7a,_b7b){var _b7c=_b7b.getChildren().pop();_b7c.set("model",_b7a.compareViewModel);return _b7c;};_b79.preventAdd=true;_b68.add([{type:_b68.type.field,hint:"compare",factory:_b73},{type:"compare",hint:"",factory:_b79}]);return _b69;});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_b7d,_b7e,_b7f,_b80,_b81,_b82){return _b7d([_b82,_b80,_b81],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.editLayoutContainer.addChild(form,0);},removeForm:function(form){this.editLayoutContainer.leftOver&&this._removeLeftOver();this.editLayoutContainer.leftOver=form;_b7e.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;},_reloadPropertyPreview:function(){}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(_b83,_b84,lang,_b85,when,_b86,_b87){return _b84(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._removeViewModelWatches){this._removeViewModelWatches();}if(this._form){if(this.removeForm(this._form)){this._form.destroyRecursive();this._form=null;}var _b88;while((_b88=this._formConnects.pop())){this.disconnect(_b88);_b88=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){var _b89=new _b85();this._formWidgets={};this._form=this._createForm();this._formConnects=[this.connect(this._form,"onFieldCreated",this.onFieldCreated),this.connect(this._form,"onGroupCreated",this.onGroupCreated),this.connect(this._form,"onFormCreated",function(){_b89.resolve();})];this.placeForm(this._form);when(_b89,lang.hitch(this,function(){this._finishFormCreation();}));},_createForm:function(){return new _b87(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm",useDefaultValue:false},this.formSettings));},_createFormEditorWrappers:function(){for(var _b8a in this._formWidgets){var _b8b={name:_b8a,metadata:this.viewModel.getPropertyMetaData(_b8a)};var _b8c=lang.clone(this.viewModel.getProperty(_b8b.name));var _b8d=new _b86({property:_b8b,propertyName:_b8a,value:_b8c,editorWidget:this._formWidgets[_b8a],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_b8d.editorWidget.set("parent",_b8d);_b8d.editorWidget.set("editMode","formedit");this._formConnects.push(this.connect(_b8d,"onValueChange","_onWrapperValueChange"),this.connect(_b8d,"onCancel","_onWrapperCancel"),this.connect(_b8d,"onStopEdit","_onWrapperStopEdit"));this._createMapping(_b8a,_b8d);_b8b=null;_b8c=null;_b8d=null;}},_createMapping:function(_b8e,_b8f){var _b90=_b8e.split(".");var _b91=false;if(this.connectOverlayItemsToFormWidgets){while(_b90.length>0){var _b92=_b90.join(".");var _b93=this._mappingManager.find("propertyName",_b92);_b83.forEach(_b93,function(_b94){_b91=true;_b94.propertyName=_b8e;_b94.wrapper=_b94.wrapper||_b8f;});_b90.pop();}}if(!_b91){this._mappingManager.add({propertyName:_b8e,wrapper:_b8f});}},onSetActiveProperty:function(_b95){var _b96=this._mappingManager.find("propertyName",_b95).filter(function(_b97){return !!_b97.wrapper;})[0];if(_b96){_b96.wrapper.startEdit();}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_b98,_b99){this._formWidgets[_b98]=_b99;if(this._addStateWatch){this._addStateWatch(_b99);}},onGroupCreated:function(_b9a,_b9b,_b9c){if(_b9b.contentViewModel!==undefined){_b9b.set("contentViewModel",this.viewModel);}},_finishFormCreation:function(){when(this.selectFormOnCreation?this.editLayoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("viewselect","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();},_removeLeftOver:function(){var _b9d=this.editLayoutContainer,_b9e;if(_b9d.leftOver){_b9e=_b9d.selectedChildWidget===_b9d.leftOver;when(_b9e?_b9d.selectChild(this.iframeWithOverlay):null,function(){var _b9f=_b9d.leftOver;if(_b9f){_b9d.removeChild(_b9f);_b9f.destroyRecursive();_b9d=_b9d.leftOver=null;}});}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_ba0,lang,_ba1,_ba2){return _ba0([_ba2],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){this._tryToStartEditing(false);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_ba3,_ba4){this.set("value",_ba4);},_tryToStartEditing:function(_ba5){if(this.editing){return;}this._grabFocusOnStartEdit=_ba5;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _ba6=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;this._lastSavedValue=this._resetValue=this.value;}this.inherited(arguments);this.editing=_ba6;},_setValueAttr:function(_ba7){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_ba1.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_ba8){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/keys","dijit/_Widget","dijit/form/_TextBoxMixin","epi/epi"],function(_ba9,lang,_baa,keys,_bab,_bac,epi){return _ba9([_bab],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,closeOnViewportClick:true,onStartEdit:function(_bad,data){},onValueChange:function(_bae,_baf,_bb0){},onCancel:function(_bb1){},onStopEdit:function(_bb2,_bb3,_bb4){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.remove();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_bb5,_bb6){if(!this.editing){this.set("value",_bb6);}},startEdit:function(_bb7){this._startEdit(_bb7);},_startEdit:function(_bb8){lang.mixin(this.editorParams,_bb8);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_bb9){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_bb9);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_bba){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_bba);}else{this.cancel(_bba);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){this.set("editing",false);this._removeEditingFeatures();},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===keys.ESCAPE){_baa.stop(e);this.cancel();}else{if(e.keyCode===keys.ENTER&&e.target.tagName==="INPUT"){_baa.stop(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(!this.editing&&ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_bbb){this.setEditorValue(_bbb);this._set("value",this.getEditorValue()||_bbb);},_setBlockDisplayNodeAttr:function(node){this.blockDisplayNode=null;this._set("blockDisplayNode",node);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName==="INPUT"){_bac.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(_bbc,_bbd,lang){return _bbd(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){this._removeViewModelWatches();this.inherited(arguments);},_removeViewModelWatches:function(){_bbc.forEach(this._watchHandles,function(_bbe){_bbe.remove();});this._watchHandles=[];},_addStateWatch:function(_bbf){var _bc0=_bbf.get("name"),_bc1=this.viewModel;var _bc2=function(){var _bc3=_bbf.get("state");if(_bc3!=="Error"){_bc1.validator.clearPropertyErrors(_bc0,_bc1.validator.validationSource.client);}else{if(_bc3==="Error"){var _bc4=_bbf.get("message")||_bbf.getErrorMessage()||"";_bc1.validator.setPropertyErrors(_bc0,[{severity:_bc1.validator.severity.error,errorMessage:_bc4}],_bc1.validator.validationSource.client);}}};this._watchHandles.push(_bbf.watch("state",_bc2));this._watchHandles.push(_bbf.watch("message",_bc2));}});});},"epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/_base/json","dojo/_base/lang","dojo/aspect","dojo/date/stamp","dojo/dom-attr","dojo/query","dojo/topic","dojo/when","epi/dependency","epi/datetime","epi/string","epi/shell/DestroyableByKey","epi-cms/contentediting/MutationObserver","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_bc5,_bc6,_bc7,_bc8,_bc9,json,lang,_bca,date,_bcb,_bcc,_bcd,when,_bce,_bcf,_bd0,_bd1,_bd2,_bd3,_bd4,_bd5,_bd6,_bd7,_bd8,res){return _bc7([_bd3,_bd1],{toolbar:null,editorFactory:null,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_deferredReloadHandle:null,_eventHandlers:null,_isCreatingWrapper:null,_mutationObserver:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_bce.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _bd5();this._mutationObserver=new _bd2();this.own(this._mutationObserver.on("dom-updated",function(){this.emit("dom-updated");}.bind(this)));this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}this.overlay.destroyDescendants();this._mutationObserver.teardown();this.inherited(arguments);},_setCommandEnabled:function(_bd9,_bda){if(this.toolbar){this.toolbar.setItemProperty(_bd9,"disabled",!_bda);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},onReloadRequired:function(){this.inherited(arguments);setTimeout(function(){this._renderManager.suspend();this._renderManager.clear();}.bind(this),0);},_setViewModelAttr:function(_bdb){if(_bdb===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_bc6.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_bc6.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",_bc6.connect(this.viewModel,"onPropertyReverted",this,this._onPropertyReverted));this.ownByKey("viewModel",_bcd.subscribe("/dnd/start",function(){setTimeout(this.beginOperation.bind(this),0);}.bind(this.viewModel)));this.ownByKey("viewModel",_bcd.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_bdc){},onPreviewReady:function(_bdd,doc,_bde){if(_bde||_bdd!==this.viewModel){this.set("viewModel",_bdd);this.setupEditMode(doc);}else{if(_bdd){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._mappingManager.clear();if(this._renderManager){this._renderManager.destroy();}this._renderManager=new _bd6();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _bd4({button:this.toolbar._getWidget("autosave")});this.own(_bca.after(this._autoSaveButton,"onLayoutChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();})));}this._autoSaveButton.set("model",this.viewModel);var _bdf=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._destroyOverlay();this.ownByKey("viewModel",this.viewModel.watch("hasUndoSteps",_bdf),this.viewModel.watch("hasRedoSteps",_bdf));_bdf();this.onReadySetupEditMode(doc);this._mutationObserver.setup(doc);doc=null;this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);this._mutationObserver.setup(doc);}),1);}}));},_destroyOverlay:function(){this.destroyByKey("overlay");},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _be0=_bcc("[data-epi-edit], [data-epi-property-name]",doc);var _be1=_bcc("[data-epi-edit] [data-epi-edit], [data-epi-property-name] [data-epi-property-name], [data-epi-property-name] [data-epi-edit], [data-epi-edit] [data-epi-property-name]",doc);return _bc5.filter(_be0,function(node){return _be1.indexOf(node)===-1;});},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var _be2=this._getPropertyNodes(doc);var _be3=[];_bc5.forEach(_be2,function(node){var _be4=_bd0.pascalToCamel(_bcb.get(node,"data-epi-edit")||_bcb.get(node,"data-epi-property-name"));var _be5=this.viewModel.getPropertyMetaData(_be4);if(!_be5){return;}if(_be5.settings&&_be5.settings.readOnly){return;}var _be6=_bd0.pascalToCamel(_be5.getName());var _be7=_bcb.get(node,"data-epi-property-display-name");if(_be7){_be5=lang.delegate(_be5,{displayName:_be7});}if(_be5!=null&&_be5.showForEdit){var _be8={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_bcb.get(node,"data-epi-property-rendersettings")||undefined,useMvc:_bcb.has(node,"data-epi-use-mvc")?_bcb.get(node,"data-epi-use-mvc").toLowerCase()==="true":false};_be8=lang.mixin(_be8,_be5.additionalValues.renderSettings);var _be9=_bcb.get(node,"data-epi-edit")?"none":_bcb.get(node,"data-epi-property-render")||_be5.customEditorSettings.rendererClass;switch(_be9){case "client":_be9="epi-cms/contentediting/ClientRenderer";break;case "none":_be9="epi-cms/contentediting/NullRenderer";break;}var _bea=_bcb.has(node,"data-epi-property-editorsettings")?json.fromJson(_bcb.get(node,"data-epi-property-editorsettings")):null;var _beb=_bcb.has(node,"data-epi-property-overlaysettings")?json.fromJson(_bcb.get(node,"data-epi-property-overlaysettings")):null;_beb=lang.mixin(_beb,_be5.overlaySettings);_be3.push({node:node,disabled:(_bcb.get(node,"data-epi-disabled")==="true"),useOverlay:(_bcb.get(node,"data-epi-useoverlay")==="true"),overlayZIndex:parseInt(_bcb.get(node,"data-epi-overlay-z-index"),10)||0,property:{name:_be6,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_bcb.get(node,"data-epi-property-type"),wrapperType:_bcb.get(node,"data-epi-edit")?"floating":_bcb.get(node,"data-epi-property-edittype"),editorParams:_bea,overlayParams:_beb,editorWidgetType:_bcb.get(node,"data-epi-property-editor"),renderSettings:_be8,rendererClass:_be9,metadata:_be5,propertyNodeName:_be4}});}},this);_be3.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _be3;},_createUpdateControllers:function(doc){var _bec=this._createFullPageUpdateController(doc);if(_bec){this._connectFullPageUpdateControllerEvents(_bec);this._mappingManager.add({updateController:_bec});}var _bed=this._getEditableNodes(doc);_bc5.forEach(_bed,function(_bee){var _bef=_bee.property;var _bf0=_bee.node.innerHTML;var _bf1=this._createNodeUpdateController(_bee);when(this._createNodeOverlay(_bee),lang.hitch(this,function(_bf2){this._connectUpdateControllerAndOverlayEvents(_bf1,_bf2);this._mappingManager.add({blockPropertyInfo:_bef,node:_bee.node,updateController:_bf1,overlayItem:_bf2});}));this._renderManager.cacheRender(_bef.name,_bef.renderSettings,this.viewModel.getProperty(_bef.name),_bf0);},this);},_createNodeOverlay:function(_bf3){var _bf4=new _bc8();if(!this.createOverlays){_bf4.resolve(null);return _bf4;}when(_bd8.create(_bf3),lang.hitch(this,function(_bf5){this.overlay.addChild(_bf5);_bf4.resolve(_bf5);}));return _bf4;},_createNodeUpdateController:function(_bf6){var _bf7=_bf6.property;var _bf8=_bf7.metadata;var _bf9=new _bd7({displayName:_bf8.displayName,renderManager:this._renderManager,contentModel:_bf7.contentModel,contentLink:_bf7.contentLink,modelPropertyName:_bf7.name,nodePropertyName:_bf7.propertyNodeName,renderSettings:_bf7.renderSettings,rendererClass:_bf7.rendererClass,displayNode:_bf6.node});return _bf9;},_createFullPageUpdateController:function(doc){var _bfa=[];if(doc){var _bfb=_bcc("input[data-epi-full-refresh-property-names][type='hidden']",doc);_bc5.forEach(_bfb,function(tag){_bc5.forEach(_bcb.get(tag,"data-epi-full-refresh-property-names").split(","),function(_bfc){if(!_bc5.some(_bfa,function(p){return p===_bfc;})){_bfa.push(_bd0.pascalToCamel(_bfc));}});});}_bc5.forEach(this.viewModel.metadata.properties,function(_bfd){if(_bfd.additionalValues["reloadOnChange"]===true){_bfa.push(_bd0.pascalToCamel(_bfd.name));}});if(!_bfa.length){return null;}var _bfe=new _bd7({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_bfa,renderSettings:{isFullReload:true}});return _bfe;},_remapUpdateControllers:function(doc){var _bff=this._getEditableNodes(doc);var _c00=this._mappingManager.remap(_bff);_bc5.forEach(_c00,function(_c01){var _c02=_c01.property;var _c03=this._createNodeUpdateController(_c01);when(this._createNodeOverlay(_c01),lang.hitch(this,function(_c04){this._connectUpdateControllerAndOverlayEvents(_c03,_c04);this._mappingManager.add({blockPropertyInfo:_c02,node:_c01.node,updateController:_c03,overlayItem:_c04});}));this._renderManager.cacheRender(_c02.name,_c02.renderSettings,this.viewModel.getProperty(_c02.name),_c01.node.innerHTML);},this);var _c05=this._createFullPageUpdateController(doc);if(_c05){this._connectFullPageUpdateControllerEvents(_c05);this._mappingManager.add({updateController:_c05});}},_connectUpdateControllerAndOverlayEvents:function(_c06,_c07){if(_c06){this.ownByKey("overlay",_bca.after(_c06,"onReloadRequired",lang.hitch(this,this._onBlockReloadRequired),true),_bca.after(_c06,"onRender",lang.hitch(this,this._onBlockRender),true));}if(_c07){this.ownByKey("overlay",_bca.after(_c07,"onClick",lang.hitch(this,this._onOverlayItemClick),true),_bca.after(_c07,"onValueChange",lang.hitch(this,function(_c08){this._onOverlayValueChange(_c07,_c08);}),true));}},_connectFullPageUpdateControllerEvents:function(_c09){this.destroyByKey("fullpageoverlay");this.ownByKey("fullpageoverlay",_bca.after(_c09,"onReloadRequired",this._onBlockReloadRequired.bind(this),true),_bca.after(_c09,"onRender",this._onBlockRender.bind(this),true));},_getEditor:function(_c0a){var _c0b=this._mappingManager.findOne("overlayItem",_c0a);return (_c0b.wrapper&&_c0b.wrapper.editorWidget)?_c0b.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_c0c){},_onOverlayItemClick:function(_c0d){if(this._isCreatingWrapper){return;}this._isCreatingWrapper=true;var _c0e=this._mappingManager.findOne("overlayItem",_c0d);var _c0f=_c0e.blockPropertyInfo;var val=this.viewModel.getProperty(_c0e.propertyName);var _c10=lang.clone(val,true);var _c11;var _c12=lang.hitch(this,function(_c13){_c0e.wrapper=_c13;this._activeEditorWrapper=_c13;_bcd.publish("/epi/layout/pinnable/propertyEditor/show",null);_bc5.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_c0e.overlayItem.set("active",true);var _c14={value:_c10,parent:_c13};when(_c13.startEdit(_c14)).always(lang.hitch(this,function(){this._isCreatingWrapper=null;}));this.overlay.set("readOnly",_c13.isOverlayDisabled);this.viewModel.set("disableUndo",_c13.isUndoDisabled);});if(_c0e.wrapper){_c11=_c0e.wrapper;if(_c11&&_c11.editorWidget&&!_c11.editorWidget.overlayItem){_c11.editorWidget.overlayItem=_c0d;}_c11.set("blockDisplayNode",_c0e.node);_c12(_c11);}else{when(this._createEditorWrapper(_c0f,_c0d,_c0e.node,_c10),lang.hitch(this,function(_c15){_c12(_c15);this.onEditorWrapperCreated(_c15);}));}},_createEditorWrapper:function(_c16,_c17,node,_c18){var def=new _bc8(),_c19={overlayItem:_c17};when(this.editorFactory.createEditor(_c16,node,_c18,_c19),lang.hitch(this,function(_c1a){this.ownByKey("overlay",_bca.after(_c1a,"onValueChange",lang.hitch(this,this._onWrapperValueChange),true),_bca.after(_c1a,"onCancel",lang.hitch(this,this._onWrapperCancel),true),_bca.after(_c1a,"onStopEdit",lang.hitch(this,this._onWrapperStopEdit),true));def.resolve(_c1a);}),def.reject);return def;},_onBlockReloadRequired:function(_c1b){var _c1c=function(){if(this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor){return;}if(this._deferredReloadHandle){this._deferredReloadHandle.remove();this._deferredReloadHandle=null;}this._toggleUndoRedoActions(false,false);this.onReloadRequired();}.bind(this);if(this.viewModel.isSaved){_c1c();}else{if(!this._deferredReloadHandle){this.own(this._deferredReloadHandle=_bca.after(this.viewModel,"onPropertySaved",_c1c,true));}}},_onBlockRender:function(_c1d){var _c1e=this._mappingManager.findOne("updateController",_c1d);if(_c1e&&_c1e.overlayItem){_c1e.overlayItem.refresh();}},_saveEditorChanges:function(_c1f,data){var _c20=this._getEditor(_c1f);if(_c20&&!_c20.overlayItem){_c20.overlayItem=_c1f;}if(_c20&&_c20.saveChanges){_c20.saveChanges(_c20,data);}},_onOverlayValueChange:function(_c21,data){this._saveEditorChanges(_c21,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_c22,_c23,_c24){var _c25=this._mappingManager.findOne("wrapper",_c22),_c26=_c25.propertyName;if(_c25.overlayItem){_c25.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_c26,_c23,_c24);},_onWrapperStopEdit:function(_c27,_c28,_c29,_c2a){var _c2b=this._mappingManager.findOne("wrapper",_c27);this.viewModel.endOperation();if(_c2b.overlayItem){_c2b.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_c2c,_c2d){var _c2e=this._mappingManager.findOne("wrapper",_c2c),_c2f=_c2e.updateController;this.viewModel.abortOperation();if(_c2f&&_c2f.renderSettings&&_c2f.renderSettings.rerenderOnCancel){_c2f.render();}if(_c2e.overlayItem){_c2e.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onPropertyReverted:function(_c30,_c31){this._mappingManager.find("propertyName",_c30).forEach(function(_c32){var _c33=_c32.wrapper,_c34;if(_c33){_c34=_c33.get("editing");_c33.set("editing",false);_c33.set("value",_c31);_c33.set("editing",_c34);}});},_toggleUndoRedoActions:function(_c35,_c36){this._setCommandEnabled("undo",!!_c35);this._setCommandEnabled("redo",!!_c36);}});});},"epi-cms/contentediting/MutationObserver":function(){define(["dojo/_base/declare","dojo/Evented"],function(_c37,_c38){return _c37([_c38],{_mutationObserverHandle:null,setup:function(doc){this.teardown();var _c39=new MutationObserver(function(_c3a){_c3a.forEach(function(_c3b){if(_c3b.type==="attributes"&&(_c3b.attributeName==="data-epi-edit"||_c3b.attributeName==="data-epi-property-name")){this._publishEvent();}else{if(_c3b.type==="childList"){Array.prototype.slice.call(_c3b.addedNodes).forEach(function(_c3c){var _c3d=this._getEpiPropertyNodes(_c3c);if(_c3d.length===0){return;}this._publishEvent();},this);}}}.bind(this));}.bind(this));_c39.observe(doc,{attributes:true,childList:true,subtree:true});this._mutationObserverHandle=_c39;},teardown:function(){if(this._mutationObserverHandle!==null){this._mutationObserverHandle.disconnect();}this._mutationObserverHandle=null;},_getEpiPropertyNodes:function(_c3e){if(_c3e.nodeType!==Node.ELEMENT_NODE&&_c3e.nodeType!==Node.DOCUMENT_NODE){return [];}if(_c3e.attributes&&(_c3e.attributes["data-epi-edit"]||_c3e.attributes["data-epi-property-name"])){return [_c3e];}else{var _c3f=_c3e.querySelectorAll("[data-epi-edit], [data-epi-property-name]");return Array.prototype.slice.call(_c3f);}},_publishEvent:function(){this.emit("dom-updated");}});});},"epi-cms/contentediting/_View":function(){define(["dojo/_base/declare","dijit/_Widget"],function(_c40,_c41){return _c40([_c41],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_c42){this._set("viewModel",_c42);},_setIframeWithOverlayAttr:function(_c43){this._set("iframeWithOverlay",_c43);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_c44,doc){this.set("viewModel",_c44);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(_c45,_c46){},onReloadRequired:function(){}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(_c47,_c48,_c49,lang,_c4a,_c4b,_c4c,_c4d,_c4e,res){var _c4f={Saving:0,Offline:1,Saved:2};return _c49([_c4d],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,_updateTimeHandle:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){_c47.forEach(this._modelHandles,function(_c50){_c50.unwatch();});this._updateTimeHandle&&clearTimeout(this._updateTimeHandle);this._updateTimeHandle=null;this.inherited(arguments);},_setModelAttr:function(_c51){_c47.forEach(this._modelHandles,function(_c52){_c52.unwatch();});this._set("model",_c51);if(_c51){this._modelHandles=[_c51.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),_c51.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),_c51.watch("isSaved",lang.hitch(this,"_isSavedChanged")),_c51.watch("isSaving",lang.hitch(this,"_isSavingChanged")),_c51.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),_c51.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",_c51.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_c53){this._set("lastSaved",_c53);this.updateLastSaveTime();},_disableUndo:function(_c54,_c55,_c56){this._isUndoDisabled=_c56;this.updateButton();},_isOnlineChanged:function(name,_c57,_c58){if(_c58===_c57){return;}if(_c58){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_c59,_c5a){this.set("lastSaved",_c5a);},_isSavedChanged:function(name,_c5b,_c5c){if(_c5c){this.updateLastSaveTime();}},_isSavingChanged:function(name,_c5d,_c5e){if(_c5e){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_c5f,_c60){if(_c5f===_c60){return;}if(!_c60){this.revertToLastAutoSaveTime();}else{_c48.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_c4a.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_c4a.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_c4a.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state===_c4f.Saving||this._hasDropDownOpen()){return;}if(this._state===_c4f.Saved){_c4a.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_c4a.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!==_c4f.Saved);},_setVisibility:function(_c61){if(_c61!==this._visible){this._visible=_c61;if(this.button){_c4b.set(this.button.domNode,{display:_c61?"":"none"});this.button.set("itemVisibility",_c61&&!this.button.disabled);if(this.button.isInNarrowToolbar){this.onLayoutChanged();}}}},onLayoutChanged:function(){},_hasDropDownOpen:function(){return this.button._popupStateNode?_c4a.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}this._updateTimeHandle&&clearTimeout(this._updateTimeHandle);this._updateTimeHandle=setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);this._setVisibility(true);},showSavingStatus:function(){this._setVisibility(true);this._state=_c4f.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_c4f.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||!this.model.canChangeContent()||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}if(this.model.isSaving){this._state=_c4f.Saving;return;}this._state=_c4f.Saved;var _c62="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _c63={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_c4e.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_c4c.substitute(_c62,_c63));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_c64,lang,_c65,json,_c66,_c67,SHA1){return _c64(null,{_mappings:null,domUtils:null,attrNames:["data-epi-edit","data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_c67;},clear:function(){var _c68;try{while((_c68=this._mappings.pop())){this._clearMapping(_c68);}}catch(ex){console.error(ex);}},_calculateNodeHash:function(node){if(!node){return "";}var _c69=_c65.map(this.attrNames,lang.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(_c69));},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_c6a){if(this._calculateNodeHash(_c6a.node)===item.nodeHash){item.node=_c6a.node;item.updateController.displayNode=_c6a.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_c6a.node);item.overlayItem.refresh();}return {success:true,mappedNode:_c6a};}return {success:false};},remap:function(_c6b){var _c6c=[];var _c6d=(_c6b!=null?_c6b.slice(0):[]);_c65.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _c6e=null;var _c6f=_c65.some(_c6d,lang.hitch(this,function(_c70){var _c71=this._tryRemapNode(item,_c70);_c6e=_c6e||_c71.mappedNode;return _c71.success;}));if(_c6f){if(_c6e){_c6d.splice(_c65.indexOf(_c6d,_c6e),1);}}else{this._clearMapping(item);delete item.node;_c6c.push(item);}if(item.wrapper&&item.node){item.wrapper.set("blockDisplayNode",item.node);}}));var _c72;while((_c72=_c6c.pop())){this._mappings.splice(_c65.indexOf(this._mappings,_c72),1);}return _c6d;},findOne:function(_c73,_c74){var _c75;_c65.some(this._mappings,function(m){if(m[_c73]===_c74){_c75=m;return true;}});return _c75;},find:function(){var _c76;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_c76=arguments[0];}else{var _c77=arguments[0],_c78=arguments[1];_c76=function(m){return m[_c77]===_c78;};}}return _c65.filter(this._mappings,_c76);},_clearMapping:function(_c79){for(var prop in _c79){if(_c79[prop]){if(prop!=="node"){if(lang.isFunction(_c79[prop].destroyRecursive)){_c79[prop].destroyRecursive();}else{if(lang.isFunction(_c79[prop].destroy)){_c79[prop].destroy();}else{if(lang.isFunction(_c79[prop].remove)){_c79[prop].remove();}}}}_c79[prop]=null;}}}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var _c7a=8,mask=(1<<_c7a)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_c7b(key);if(wa.length>16){wa=core(wa,key.length*_c7a);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_c7b(data)),512+data.length*_c7a);return core(opad.concat(hash),512+160);};function _c7b(s){var wa=[];for(var i=0,l=s.length*_c7a;i<l;i+=_c7a){wa[i>>5]|=(s.charCodeAt(i/_c7a)&mask)<<(32-_c7a-i%32);}return wa;};function _c7c(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _c7d(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_c7a){s.push(String.fromCharCode((wa[i>>5]>>>(32-_c7a-i%32))&mask));}return s.join("");};function _c7e(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_c7f){var out=_c7f||dxd.outputTypes.Base64;var wa=core(_c7b(data),data.length*_c7a);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _c7c(wa);case dxd.outputTypes.String:return _c7d(wa);default:return _c7e(wa);}};dxd.SHA1._hmac=function(data,key,_c80){var out=_c80||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _c7c(wa);case dxd.outputTypes.String:return _c7d(wa);default:return _c7e(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var _c81=8;var mask=(1<<_c81)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*_c81;i<l;i+=_c81){wa[i>>5]|=(s.charCodeAt(i/_c81)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_c81){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_c82,lang,_c83,json,_c84,epi,_c85,_c86,SHA1,_c87,_c88){return _c82([_c87],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_c89){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_c89);this.defaultRenderer=this.defaultRenderer||new _c88();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_c85.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_c8a){var def=new _c83();if(_c8a){if(this._rendererPool[_c8a]){return this._rendererPool[_c8a];}else{require([_c8a],function(_c8b){def.resolve(new _c8b());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_c8c,_c8d,_c8e,_c8f,_c90){var def;if(this._isSuspending){def=new _c83();def.cancel();return def;}_c8e=_c86.transformDate(_c8e);_c8f=this.cloneAndCompleteRenderSettings(_c8f||{});var _c91=this._get(_c8d,_c8f,_c8e);if(_c91){def=new _c83();def.resolve(_c91);}else{if(_c8f&&_c8f.isFullReload){def=new _c83();def.resolve({doReload:true});}else{def=new _c83();_c83.when(this._getRenderer(_c90),lang.hitch(this,function(_c92){if(!_c92){_c92=this.defaultRenderer;}_c83.when(this._queueItem(_c92,_c8c,_c8d,_c8f,_c8e),function(_c93){def.resolve(_c93);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_c94){_c94.propertyRenderSettings=_c94.propertyRenderSettings||"";var _c95=lang.clone(_c94);if(this.viewSettingsManager.get("enabled")){_c84.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_c96){if(_c96.get("enabled")){var _c97=this.viewSettingsManager.getSettingProperty(_c96.key);if(_c97){this.updateRenderSettings(_c95,_c97,_c96.key,_c96.isTagItem);}}}));}return _c95;},updateRenderSettings:function(_c98,_c99,key,_c9a){var _c9b=[],_c9c=[],_c9d="",_c9e=(_c9a?"tag":key),_c9f=!_c9a,data=null;if(_c9a){_c98.propertyRenderSettings=_c98.propertyRenderSettings||"";data=(_c98.propertyRenderSettings?dojo.fromJson(_c98.propertyRenderSettings):{});}else{data=(_c98?_c98:{});}if(!data[_c9e]||_c9f){_c9d=_c99;}else{_c9b=data[_c9e].split(",");_c84.forEach(_c9b,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!==_c99.toLowerCase()){_c9c.push(item);}});_c9c.push(_c99);_c9d=_c9c.join(", ");}data[_c9e]=_c9d;if(_c9a){_c98.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _ca0=this._nextItemToProcessIndex();while(_ca0>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_ca0);_ca0=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var _ca1=-1;var i=0;while(i<this._queue.length&&_ca1===-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){_ca1=i;}i++;}return _ca1;},_processItemInQueue:function(_ca2){var item=this._queue.splice(_ca2,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _ca3=lang.hitch(this,function(_ca4){if(this._isDestroyed){item.deferred.cancel();return;}if(_ca4&&_ca4.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:_ca4.doReload,innerHtml:_ca4.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_ca4);});var _ca5=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_c83.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_ca3,_ca5);},cacheRender:function(_ca6,_ca7,_ca8,_ca9){var data={innerHtml:_ca9,doReload:false};this._put(_ca6,_ca7,_ca8,data);},_queueItem:function(_caa,_cab,_cac,_cad,_cae){var key=this._getRenderHash(_cac,_cad);var _caf;var _cb0=this._itemsBeingRendered[key];if(_cb0&&!_cb0.deferred.fired&&_cb0.value===_cae){_caf=_cb0.deferred;}else{var _cb1=this._queueIndex(_caa,_cab,_cac,_cad,_cae);if(_cb1<0){_caf=new _c83();this._queue.push({contentLink:_cab,renderer:_caa,propertyName:_cac,renderSettings:_cad,renderSettingsString:json.toJson(_cad),value:_cae,deferred:_caf});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[_cb1];item.contentLink=_cab;item.renderer=_caa;item.value=_cae;_caf=item.deferred;}}return _caf;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_cb2,_cb3){return SHA1(json.toJson({p:_cb2,r:_cb3}));},_queueIndex:function(_cb4,_cb5,_cb6,_cb7,_cb8){var _cb9=-1;var _cba=json.toJson(_cb7);_c84.some(this._queue,function(item,i){if((item.propertyName===_cb6)&&(item.renderSettingsString===_cba)){_cb9=i;return true;}});return _cb9;},_put:function(_cbb,_cbc,_cbd,data){if(!_cbc.cacheResults){return;}var _cbe=this._getCacheHash(_cbb,_cbc,_cbd);if(!this._cache){this._cache={};}this._cache[_cbe]={data:data};},_get:function(_cbf,_cc0,_cc1){var _cc2=this._getCacheHash(_cbf,_cc0,_cc1);var _cc3=this._cache[_cc2];return (_cc3?_cc3.data:undefined);},_getCacheHash:function(_cc4,_cc5,_cc6){return SHA1(json.toJson({p:_cc4,r:_cc5,v:_cc6}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_cc7,epi,_cc8,_cc9,_cca,_ccb,_ccc,_ccd){return _cc7([_cca],{_routes:_ccc,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _cc9();}this._profile=this._profile||_cc8.resolve("epi.shell.Profile");},render:function(_cce,_ccf,_cd0,_cd1){var _cd2=_ccb.toContentReference(_cce);var url=null;if(_cd1.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_cd1.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_cd2.toString(),epieditmode:true,visitorgroupsByID:_cd1.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _cd3={propertyName:_ccf,propertyValue:json.toJson(_cd0),id:_cd2.toString(),renderSettings:""};if(_cd1&&_cd1.propertyRenderSettings){_cd3.renderSettings=_cd1.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_cd3});}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_cd4){dojo.mixin(this,_cd4);},render:function(_cd5,_cd6,_cd7,_cd8){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,_cd9,_cda,lang,_cdb,_cdc,_cdd,_cde,_cdf){return _cda(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_ce0){dojo.mixin(this,_ce0);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_ce1){this._modelWatchHandle.push(this.contentModel.watch(_ce1,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){_cd9.forEach(this._modelWatchHandle,function(_ce2){_ce2.remove();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_ce3){},onRender:function(_ce4){},_renderNode:function(_ce5,_ce6,_ce7){var _ce8=this.contentLink;var _ce9=this.renderSettings;var _cea=this.rendererClass;var _ceb=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_ce8,_ceb,_ce7,_ce9,_cea);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_cec){if(this._lastRenderDeferred){if(_cec.doReload!==undefined&&_cec.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_cec)){this._updateRendering(_cec);}else{if(_cec.innerHtml!==undefined){this._updateRendering(_cec.innerHtml,_cec.attributes);}else{if(_cec.error!==undefined){this._handleValidationError(_cec.error);}}}}if(def===this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_ced){var html="";if(!_ced){return false;}if(_ced.tagName==="IMG"){html=dojo.attr(_ced,"src")||"";}else{html=_ced.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _cee;if(!this._showEmptyNode){return;}_cee=this._isEmptyHtml(this.displayNode);if(_cee&&this._canModifyDisplayNode()){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_canModifyDisplayNode:function(){return this.rendererClass!=="epi-cms/contentediting/NullRenderer";},_ensureSize:function(){if(!this._canModifyDisplayNode()){return;}try{this._clearComputedStyle();this._computeStyle();}catch(e){console.warn("Could not get or set domStyle for displayNode",e);}},_clearComputedStyle:function(){var _cef=this._originalStyle;if(_cef){for(var prop in _cef){if(_cef.hasOwnProperty(prop)){_cdc.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){var node=this.displayNode,_cf0=node&&_cdc.get(node);if(!_cf0){return;}var _cf1={minWidth:_cdc.toPixelValue(node,_cf0.minWidth),minHeight:_cdc.toPixelValue(node,_cf0.minHeight),display:_cf0.display},_cf2={},_cf3=_cf1.minHeight===0,_cf4=_cf1.minWidth===0,_cf5=_cf1.display==="inline",_cf6=_cdd.getMarginBox(node,_cf0);if(_cf6.h<(_cf3?this.minHeight:_cf1.minHeight)||_cf6.w<(_cf4?this.minWidth:_cf1.minWidth)){if(_cf3){_cf2.minHeight=this.minHeight+"px";}if(_cf4){_cf2.minWidth=this.minWidth+"px";}if(_cf5){_cf2.display="inline-block";}if(_cf5||_cf3||_cf4){this._originalStyle=_cf1;_cdc.set(node,_cf2);}}},_updateRendering:function(_cf7,_cf8){this.displayNode.innerHTML=_cf7;if(_cf8){_cd9.forEach(_cf8,lang.hitch(this,function(_cf9){this._updateAttribute(_cf9);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_cdc.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_cfa){if(_cfa.name.toLowerCase()==="class"){_cdb.add(this.displayNode,_cfa.value);}else{_cde.set(this.displayNode,_cfa.name,_cfa.value);}},_handleValidationError:function(_cfb){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){_cdf.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi-cms/widget/overlay/Property"],function(lang,_cfc){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_cfd){var _cfe=new _cfc();var _cff=_cfd.property.metadata.overlaySettings&&_cfd.property.metadata.overlaySettings.customType;var _d00=_cfd.property,_d01=_cff||this.defaultType,_d02={},_d03=_d00.metadata&&_d00.metadata.settings||{};_d02.allowedTypes=_d03.allowedTypes||[];_d02.restrictedTypes=_d03.restrictedTypes||[];require([_d01],lang.hitch(this,function(_d04){var _d05=lang.mixin({name:_d00.name,description:lang.getObject("settings.tooltip",false,_d00.metadata),contentModel:_d00.contentModel,displayName:_d00.metadata.displayName,disabled:_cfd.disabled,sourceItemNode:_cfd.node},_d00.overlayParams,_d02);var _d06=new _d04(_d05);_cfe.resolve(_d06);}));return _cfe;}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_d07,lang,_d08,Item){return _d07([Item],{onValueChange:function(_d09){},_getRightProperty:function(){var _d0a=this.name;if(this.dndTargetPropertyName){_d0a+=("."+_d08.pascalToCamel(this.dndTargetPropertyName));}return _d0a;},onDrop:function(_d0b,_d0c){var _d0d=this._getRightProperty();function _d0e(_d0f){if(!_d0f){return [];}if(!(_d0f instanceof Array)){return [_d0f];}return _d0f;};if(this.dndTargetPropertyAllowMultiple===true){var _d10=_d0e(lang.clone(this.contentModel.get(_d0d)));_d0e(_d0c).forEach(function(item){_d10.push(item);});_d0c=_d10;}this.onValueChange({propertyName:_d0d,value:_d0c});}});});},"epi-cms/compare/views/CompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi-cms/contentediting/PageDataController","epi-cms/compare/CompareToolbar","epi-cms/compare/viewmodels/CompareViewModel"],function(_d11,lang,_d12,_d13,_d14,_d15){return _d11([_d13],{iframeName:"compareView",buildRendering:function(){this.inherited(arguments);var _d16=new _d15(),_d17=this.mainLayoutContainer,_d18=new _d14({region:"top",splitter:false,model:_d16.compareToolbarViewModel});_d17.addChild(_d18);this.set("compareModel",_d16);this.own(_d16,_d16.watch("leftVersionUri",lang.hitch(this,function(name,_d19,uri){this._changeContext(uri);})),_d18,_d18.on("versionInformationUpdated",function(){_d17.layout();}),_d12.subscribe("/epi/shell/action/changeview",this._onChangeView.bind(this)));},setView:function(_d1a,_d1b){_d1b=lang.mixin({model:this.compareModel},_d1b);return this.inherited(arguments,[_d1a,_d1b]);},_changeContext:function(uri){if(uri&&this._currentViewModel&&uri!==this._currentViewModel.contentData.uri){_d12.publish("/epi/shell/context/request",{uri:uri},{sender:this});}},_refreshModel:function(_d1c,_d1d){this.inherited(arguments);this.compareModel.set({contentLink:_d1c.contentLink,typeIdentifier:_d1c.typeIdentifier,languages:_d1c.existingLanguageBranches});},_switchEditMode:function(){if(this.isActive){_d12.publish("/epi/shell/action/changeview","formedit",null,null,true);}},_onChangeView:function(type){if(type==="sidebysidecompare"||type==="allpropertiescompare"){this.compareModel.set("rightVersion",null);}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/debounce","epi/dependency","epi/Url","epi/shell/StickyViewSelector","epi/shell/TypeDescriptorManager","epi/shell/postMessage","epi-cms/_ContentContextMixin","epi-cms/contentediting/EditNotifications","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/viewmodel/ContentActivityFeedViewModel","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html","dijit/layout/BorderContainer","epi/shell/layout/CardContainer","epi/shell/layout/PreserveRatioBorderContainer","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/NotificationBar","epi-cms/activity/ActivityFeed"],function(_d1e,_d1f,lang,_d20,_d21,_d22,_d23,_d24,when,_d25,_d26,_d27,_d28,_d29,Url,_d2a,_d2b,_d2c,_d2d,_d2e,_d2f,_d30,_d31,res,_d32){return _d1f([_d26,_d25,_d27,_d2d],{templateString:_d32,contextTypeName:"epi.cms.contentdata",iframeName:"sitePreview",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #1456F1 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_postMessage:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_ensurePreviewReadyPromise:null,_stickyViewSelector:null,componentTypeName:null,postMixInProperties:function(){this.inherited(arguments);var _d33=_d29.resolve("epi.storeregistry");this._pageDataStore=this._pageDataStore||_d33.get("epi.cms.contentdata");this._stickyViewSelector=new _d2a();this._viewSettingsManager=_d29.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_d29.resolve("epi.shell.MessageService");this._profile=this._profile||_d29.resolve("epi.shell.Profile");this._postMessage=this._postMessage||_d2c;this._editingCommands=_d31;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_d29.resolve("epi.cms.contentediting.inUseNotificationManager");this._editNotifications=this._editNotifications||new _d2e();this.own(this._editNotifications,this._editNotifications.on("changed",function(e){this._defaultNotificationWatchHandler("",e.oldValue,e.newValue,e.notification);}.bind(this)));this.activityModel=this.activityModel||new _d30({componentTypeName:this.componentTypeName});this.own(this.activityModel.watch("isActivitiesVisible",this._toggleActivities.bind(this)));},postCreate:function(){var cs;this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",this._switchEditMode.bind(this));cs=_d29.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(this._interceptRequestContext.bind(this));this.own(this.notificationBar.on("notificationsChanged",function(){this.mainLayoutContainer.layout();}.bind(this)),_d24.subscribe("/epi/cms/action/undo",this._undoAction.bind(this)),_d24.subscribe("/epi/cms/action/redo",this._redoAction.bind(this)),_d24.subscribe("/epi/cms/action/save",this._saveAction.bind(this)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_d20.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),function(_d34){this.contextChanged(_d34);}.bind(this));this._toggleActivities();var _d35=this.mainLayoutContainer.getSplitter("right");_d22.after(_d35,"_stopDrag",function(){var _d36={size:_d21.get(this.activityFeed.domNode,"width")};this.activityModel._persistActivityFeedSettings(_d36);}.bind(this));},buildRendering:function(){this.inherited(arguments);this._loadSettings();},destroy:function(){this._interceptorHandle&&this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels.forEach(function(vm){vm.destroy();});this._viewModels=null;this.inherited(arguments);},_defaultNotificationWatchHandler:function(name,_d37,_d38,_d39){if(_d37){this.notificationBar.remove(_d37);}if(_d38&&_d38.content){var _d3a=_d39?this._editNotifications.getAvailableNotificationIndex(_d39):0;this.notificationBar.add(_d38,_d3a);}},_switchEditMode:function(_d3b,_d3c,_d3d){var _d3e,_d3f=this._currentViewModel.viewName,_d40=false,_d41="view",_d42="onpageedit",_d43="formedit";if(!this.isActive){return;}if(_d3f===_d41){_d24.publish("/epi/cms/action/disablepreview");}if(_d3f===_d43){_d3e=_d42;_d40=true;}else{_d3e=_d43;}if(_d3d){this._stickyViewSelector.save(this._currentViewModel.contentData.hasTemplate,this._currentViewModel.contentData.typeIdentifier,_d3e);}return this._ensurePreviewReady(this.setView(_d3e,_d3c),_d40,true,_d3e);},_iFrameLoaded:function(url,_d44){if(!!url&&!_d44){this._requestContextChangeByUrl(url,true,true);}when(this._profile.get("isEPiBetaUser")).then(function(_d45){if(!_d45){return null;}this._postMessage.publish("beta/epiReady",this._getInitialData(url),this.iFrame.getWindow());}.bind(this));},_getInitialData:function(url){url=new Url(url);if(!url.query||url.query.epieditmode!=="True"){return {isEditable:false};}return {isEditable:!!this._currentViewModel&&this._currentViewModel.canChangeContent()};},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var _d46=-1;_d1e.some(this._viewModels,function(item,idx){if(item.contentLink===id){_d46=idx;return true;}});return _d46;},_getViewModel:function(id){var _d47=this._getViewModelIndex(id);if(_d47>=0){return this._viewModels[_d47];}else{return null;}},_removeViewModel:function(id){var _d48=this._getViewModelIndex(id);if(_d48>=0){var _d49=this._viewModels.splice(_d48,1)[0];_d49.clear();}},_createViewModel:function(_d4a,ctx){var _d4b=new _d2f({contentLink:_d4a.contentLink,contextTypeName:this.contextTypeName});_d4b.set("contentData",_d4a);_d4b.set("languageContext",ctx.languageContext);this._viewModels.push(_d4b);return _d4b;},contentContextUpdated:function(ctx,_d4c){var _d4d=ctx.id;this._pageDataStore.refresh(_d4d).then(function(_d4e){if(this._currentViewModel){this._updateContentViewModel(_d4e,ctx.languageContext);this._refreshModel(_d4e,ctx);this._onViewRequireReload();}}.bind(this));},updateView:function(_d4f,ctx,_d50){this._setActivityCommandModel();when(this._ensurePreviewReadyPromise,function(){if(_d4f&&_d4f.skipUpdateView&&_d4f.viewName===this._currentViewModel.viewName){return;}if(_d50&&_d50.widgetResumed){_d21.set(this.domNode,"visibility","hidden");}if(_d4f&&_d4f.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(function(_d51){var _d52=this._currentViewModel.contentData.contentLink;this._updateContentViewModel(_d51,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange(_d52,_d51.contentLink);this._refreshModel(_d51,ctx);}.bind(this));}else{if(this._currentViewModel){this._currentViewModel.suspend();}var _d53;if(_d4f&&_d4f.viewName){if(_d4f.availableViews){this._availableViewsLookup={};_d1e.forEach(_d4f.availableViews,function(_d54){this._availableViewsLookup[_d54.key]=_d54;},this);}_d53=_d4f.viewName;}var _d55=_d4f.forceReload;if((_d53==="view"||_d53==="onpageedit")&&this._currentViewModel&&this._currentViewModel.viewName==="formedit"){_d55=true;}return this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_d53,ctx,_d4f.availableViews),true,_d55,_d53);}}.bind(this));},_getPreviewUrl:function(_d56){return when(this.getCurrentContext(),function(_d57){return (_d56==="view"&&_d57.previewUrl)?_d57.previewUrl:_d57.editablePreviewUrl;});},_ensurePreviewReady:function(_d58,_d59,_d5a,_d5b){var def=new _d23();if(_d58){def=_d58;}else{def.resolve();}if(_d59&&_d5b!=="formedit"){def=def.then(function(_d5c){return when(this._getPreviewUrl(_d5b),function(url){return when(this._changeUrl(url,_d5a),function(){return _d5c;});}.bind(this));}.bind(this));}this._ensurePreviewReadyPromise=when(def,function(_d5d){var doc=this.iframeWithOverlay.iframe.getDocument();var _d5e=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_d5e);_d5e=null;this.iframeWithOverlay.overlay.set("enabled",this._currentViewModel.get("showOverlay")&&this.iframeWithOverlay.iframe.isInspectable());if(this._viewSettingsManager.get("enabled")&&this._viewSettingsManager.getSettingProperty("project")){this.iframeWithOverlay.overlay.set("enabled",false);}this.iframeWithOverlay.layout(true);});_d21.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,!!_d5d);this._editNotifications.updateSettings({viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}.bind(this));return this._ensurePreviewReadyPromise;},_loadContentDataAndSetView:function(_d5f,_d60,ctx,_d61){var def=new _d23();when(this._pageDataStore.refresh(_d5f)).then(function(_d62){this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_d61,viewName:_d60},contentData:_d62});if(!_d62){return;}if(this._currentViewModel&&this._currentViewModel.contentLink!==_d5f){this.notificationBar.clear();}this._currentViewModel=this._getViewModel(_d62.contentLink);if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_d62,ctx);this._setActivityModel(_d62);}else{this._updateContentViewModel(_d62,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_d62,ctx);when(this.setView(_d60)).then(function(){def.resolve(true);}).otherwise(function(){def.cancel();});}.bind(this)).otherwise(function(){def.reject();});return def.promise;},_updateContentViewModel:function(_d63,_d64){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_d63);this._currentViewModel.set("languageContext",_d64);this._setActivityModel(_d63);},_refreshModel:function(_d65,_d66){var _d67=this._currentViewModel;if(_d67){this.toolbar.set("contentViewModel",_d67);this._inUseNotificationManager.updateCommandModel(_d67);this._editingCommands.set("model",_d67);this._editNotifications.update(_d65,_d66,_d67);}},itemChanged:function(id,item){},setView:function(_d68,_d69){var def=new _d23();if(_d68==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_d68 in this._availableViewsLookup))){_d68="formedit";}if(_d68&&!(_d68 in this._availableViewsLookup)){return;}var _d6a=function(){when(this._setView(_d68,_d69),function(){def.resolve();},function(){def.cancel();});}.bind(this);var _d6b=function(){_d24.publish("/epi/cms/action/showerror");def.cancel();};when(this._savePendingChanges(),_d6a,_d6b);return def;},_setView:function(_d6c,_d6d){var def=new _d23(),_d6e=this._currentViewComponent,_d6f=_d6e&&_d6e.viewModel&&_d6e.viewModel.viewName===_d6c;var _d70=function(def){if(this.editLayoutContainer.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}.bind(this));}def.resolve();}.bind(this);_d24.publish("/epi/shell/action/changeview/updatestate",{viewName:_d6c});if(_d6f){this._currentViewModel.viewName=_d6c;this.toolbar.set("contentViewModel",this._currentViewModel);_d70(def);}else{this._destroyCurrentViewComponent();var _d71=this._availableViewsLookup[_d6c].viewType;require([_d71],function(_d72){this._currentViewComponent=new _d72(lang.mixin({mainLayoutContainer:this.mainLayoutContainer,editLayoutContainer:this.editLayoutContainer,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_d6d));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);when(this._profile.get("isEPiBetaUser"),function(_d73){if(_d73){this._currentViewComponent.on("dom-updated",_d28(this._onDomUpdated,this,100));}}.bind(this));this._currentViewComponent.startup();this._currentViewModel.viewName=_d6c;this.toolbar.set("contentViewModel",this._currentViewModel);_d70(def);}.bind(this));}return def;},_onViewRequireReload:function(){return this._ensurePreviewReady(null,true,true,this._currentViewModel.viewName);},resize:function(size){this.inherited(arguments);if(this._started){this.mainLayoutContainer.resize(size);}},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",true);this.iframeWithOverlay.overlay.set("readOnly",false);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);if(this._currentViewModel){this._currentViewModel.resetNotifications();}},_requestContextChangeByUrl:function(url,_d74,_d75,_d76,_d77){var _d78=new Url(url,_d76,_d77),_d79={url:_d78.toString()},_d7a={sender:this,forceContextChange:_d74,suppressFailure:_d75,viewName:this._currentViewModel&&this._currentViewModel.viewName};_d24.publish("/epi/shell/context/request",_d79,_d7a);},_changeUrl:function(url,_d7b){var _d7c=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_d7c},true,_d7b);},_interceptRequestContext:function(_d7d,_d7e){if(!(_d7e&&_d7e.sender&&_d7e.sender===this)){return this._savePendingChanges();}else{var def=new _d23();def.resolve();return def;}},_savePendingChanges:function(){if(this._saveDeferred&&!this._saveDeferred.isFulfilled()){return this._saveDeferred.promise;}else{this._saveDeferred=new _d23();}if(this._currentViewModel&&this._currentViewModel.get("hasPendingChanges")&&!this._currentViewModel.get("hasErrors")){var _d7f=this._currentViewModel.watch("hasPendingChanges",function(name,_d80,_d81){if(!_d81){_d7f.remove();_d7f=null;this._saveDeferred.resolve();}}.bind(this));this._currentViewModel.save();}else{this._saveDeferred.resolve();}return this._saveDeferred.promise;},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);},_undoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.undo();}},_redoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.redo();}},_saveAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.save();}},_onDomUpdated:function(){if(!this._currentViewComponent){return;}var doc=this.iframeWithOverlay.iframe.getDocument();this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,false);},_setIsActiveAttr:function(_d82){this._set("isActive",_d82);if(_d82){this._currentViewModel&&this._currentViewModel.wakeUp();this._editNotifications.wakeUp();}else{this._viewModels.forEach(function(_d83){_d83.suspend();});this._editNotifications.suspend();}},_toggleActivities:function(){_d20.toggle(this.activityFeed.domNode,"dijitHidden",!this.activityModel.isActivitiesVisible);_d20.toggle(this.activityFeed._splitterWidget.domNode,"dijitHidden",!this.activityModel.isActivitiesVisible);this._loadSettings();this.mainLayoutContainer.layout();},_setActivityCommandModel:function(){var _d84=_d29.resolve("contentActivityCommandProvider");_d84.updateCommandModel(this.activityModel);},_setActivityModel:function(_d85){this.activityModel.set({contentLink:_d85.contentLink,name:_d85.name});},_loadSettings:function(){var _d86=this.activityModel.getActivityFeedSettings();if(!_d86||!_d86.size||_d21.get(this.mainLayoutContainer.domNode,"width")<_d86.size){return;}_d21.set(this.activityFeed.domNode,"width",_d86.size+"px");}});});},"epi-cms/contentediting/EditNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/plugin-area/edit-notifications"],function(_d87,lang,_d88,_d89,_d8a){return _d87([_d89,_d88],{_notificationChangedKey:"_EditingNotificationHandles",_notificationsKey:"_notifications",_notifications:null,postscript:function(){this.inherited(arguments);this.own(_d8a.on("added, removed",this._watchNotifications.bind(this)));this._watchNotifications();},update:function(_d8b,_d8c,_d8d){this._notifications.forEach(function(_d8e){_d8e.set("value",{contentData:_d8b,context:_d8c,contentViewModel:_d8d});});},updateSettings:function(_d8f){this._notifications.forEach(function(_d90){_d90.set("settings",_d8f);});},suspend:function(){this._notifications.forEach(function(_d91){_d91.set("isSuspended",true);});},wakeUp:function(){this._notifications.forEach(function(_d92){_d92.set("isSuspended",false);});},_watchNotifications:function(){this.destroyByKey(this._notificationsKey);this._notifications=_d8a.get().sort(function(a,b){return a.order-b.order;}).map(function(_d93){this.ownByKey(this._notificationsKey,_d93);return _d93;},this);this.destroyByKey(this._notificationChangedKey);this._notifications.forEach(function(_d94){this.ownByKey(this._notificationChangedKey,_d94.watch("notification",function(name,_d95,_d96){this.emit("changed",{notification:_d94,oldValue:_d95,newValue:_d96});}.bind(this)));},this);},getAvailableNotificationIndex:function(_d97){if(typeof _d97.order==="undefined"){return undefined;}var _d98=this._notifications.filter(function(n){return n!==_d97&&n.notification&&n.notification.content;});var _d99=0;_d98.forEach(function(n,_d9a){if(_d97.order>=n.order){_d99=_d9a+1;}},this);return _d99;}});});},"epi-cms/plugin-area/edit-notifications":function(){define(["epi/PluginArea","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/FuturePublishingDateNotification","epi-cms/project/ProjectNotification","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification"],function(_d9b,_d9c,_d9d,_d9e,_d9f,_da0,_da1,_da2){var _da3=new _d9b("epi-cms/edit/notifications[]");_da3.add(_da0);_da3.add(_da1);_da3.add(_da2);_da3.add(_d9c);_da3.add(_d9d);_da3.add(_d9e);_da3.add(_d9f);return _da3;});},"epi/PluginArea":function(){define("epi/PluginArea",["dojo/_base/declare","dojo/Evented","epi/locator"],function(_da4,_da5,_da6){return _da4([_da5],{constructor:function(_da7){if(typeof _da7!=="string"||_da7===""){throw new Error("The argument 'identifier' must be a non-empty string.");}this._identifier=_da7;_da6.add(_da7,[]);_da6.on(_da7,this.emit.bind(this));},add:function(_da8){return _da6.add(this._identifier,_da8);},get:function(){return _da6.get(this._identifier);}});});},"epi/locator":function(){define("epi/locator",["dojo/Evented","dojo/has","dojo/string"],function(_da9,has,_daa){var _dab=/.+\[\]$/,_dac={},_dad=new _da9();return {add:function(_dae,_daf){if(typeof _dae!=="string"||_dae===""){throw new Error("The argument 'identifier' must be a non-empty string.");}var _db0=_dab.test(_dae);if(!_db0&&_dac[_dae]){throw new Error(_daa.substitute("A service with the identifier '${0}' has already been registered.",[_dae]));}_dac[_dae]=_db0?(_dac[_dae]||[]).concat(_daf):_daf;_dad.emit(_dae,"added");return {remove:this.remove.bind(this,_dae,_daf)};},get:function(_db1){var _db2=_dac[_db1];if(_db2===undefined){if(has("epi-ignore-undefined-dependencies")){return;}throw new Error(_daa.substitute("No service has been registered for the identifier '${0}'.",[_db1]));}var _db3=function(_db4){return (typeof _db4==="function")?new _db4():_db4;};if(_dab.test(_db1)){return _db2.map(_db3);}return _db3(_db2);},on:_dad.on.bind(_dad),remove:function(_db5,_db6){var _db7=_dac[_db5];if(_db7===undefined){return;}if(_dab.test(_db5)){var _db8=_db7.indexOf(_db6);if(_db8>-1){_db7.splice(_db8,1);}}else{delete _dac[_db5];}_dad.emit(_db5,"removed");}};});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/Stateful","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/DestroyableByKey","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(_db9,_dba,_dbb,_dbc,_dbd,on,when,epi,_dbe,_dbf,_dc0,_dc1,_dc2,_dc3){return _dba([_dbd,_dc0],{order:40,_backCommand:null,_clickHandleKey:"clickHandle",constructor:function(){this._backCommand=new _dc1();},postscript:function(){this.inherited(arguments);this._store=this._store||_dbe.resolve("epi.storeregistry").get("epi.cms.referenced-content");},_valueSetter:function(_dc4){this.value=_dc4;var _dc5=_dbf.getValue(_dc4.contentData.typeIdentifier,"actAsAnAsset");if(!_dc5){this.set("notification",null);return;}when(this._store.query({ids:[_dc4.contentData.contentLink]})).then(this._updateNotification.bind(this));},_updateNotification:function(_dc6){if(!_dc6){this.set("notification",null);return;}var _dc7=_dc6[0].references;var _dc8=_dbc.create("div");if(_dc7.length>0){_dc8.innerHTML+=_dc3.affect;var _dc9=_dc7.length+" "+(_dc7.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_dca=_dbc.create("a",{href:"#",innerHTML:_dc9,title:_dc3.referencestooltip},_dc8);this.destroyByKey(this._clickHandleKey);this.ownByKey(this._clickHandleKey,on(_dca,"click",function(evt){_dbb.stop(evt);self._showReferenceDialog();}));}else{_dc8.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this.set("notification",{content:_dc8,commands:[this._backCommand]});},_showReferenceDialog:function(){_dc2({contentItems:[this.get("value").contentData],showToolbar:true,mode:_dc2.mode.show});}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_dcb,_dcc,_dcd,_dce,_dcf){return _dcb([_dce],{label:_dcf.backtoprevious,tooltip:_dcf.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_dcd.resolve("epi.cms.BackContextHistory");},_execute:function(){_dcc.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/Stateful","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_dd0,lang,_dd1,Url,_dd2,_dd3,_dd4,_dd5,_dd6,_dd7){return _dd0([_dd2],{order:50,_valueSetter:function(data){var _dd8=data.context;if(!_dd8.languageContext){this.set("notification",null);return;}var _dd9=_dd4.resolve("epi.storeregistry").get("epi.cms.language");_dd9.query().then(lang.hitch(this,function(_dda){var _ddb={};_dd1.forEach(_dda,function(_ddc){_ddb[_ddc.languageId]=_ddc.name;},this);var _ddd=_dd8.languageContext.warning;var _dde=_dd5.currentContentLanguage;var _ddf=_dd8.languageContext;var _de0;if(_dde!==_ddf.preferredLanguage&&_ddf.isTranslationNeeded){_ddd=lang.replace(_dd7.nottranslatedswitchto,[_ddb[_ddf.language],_ddb[_ddf.preferredLanguage]]);_de0=_ddf.preferredLanguage;}else{if(_dde!==_ddf.language&&!_ddf.isTranslationNeeded){var _de1=_ddb[_dde];var _de2=_ddb[_ddf.language];if(_de1&&_de2){_ddd=lang.replace(_dd7.workinginwrongsite,[_de1,_de2]);}else{_ddd=_dd7.languagenotenabled;}_de0=_ddf.language;}}if(!_ddd){this.set("notification",null);return;}var html=_dd3.create("div",{innerHTML:_ddd});var _de3=_ddb[_de0];if(_de3){var url=new Url(window.top.location.href);var text=lang.replace(_dd7.switchto,[_de3]);_dd3.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_de0,"#context=",_dd8.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this.set("notification",{content:html,commands:_ddf.isTranslationNeeded&&_dde===_ddf.preferredLanguage?[_dd6.translate]:[]});}));}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_de4,_de5,_de6,_de7,_de8,_de9,_dea,_deb){return _de4([_de5],{order:60,postscript:function(){this.inherited(arguments);this._notificationPeriod=_de9.expirationNotificationPeriod;this._setupCommands();},_valueSetter:function(_dec){var _ded=_dec.contentData.properties.iversionable_expire;this._updateNotification(_ded);},_updateNotification:function(_dee){var _def=_de7.serverTime();var _df0=_dee?_dee.stopPublish:null,_df1=new Date(_df0);var text=null;if(_df0&&_de7.isDateValid(_df1)){if(new Date(_def.getTime()+this._notificationPeriod*1000)>_df1){text=_df1<_def?_deb.expired:_de6.substitute(_dea.expiretimetext,[_de7.timeToGo(_df1)]);}}if(!text){this.set("notification",null);}else{this.set("notification",{content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_de8.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_df2,_df3){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_df3.watch("value",function(name,_df4,_df5){self._updateNotification(_df5);});});}});});},"epi-cms/contentediting/FuturePublishingDateNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.futurepublishingdate"],function(_df6,_df7,_df8,_df9,_dfa,_dfb){return _df6([_df7],{order:70,notification:null,_valueSetter:function(_dfc){var _dfd=_dfc&&_dfc.contentData;if(_dfd.status===_dfa.versionStatus.Published){var _dfe=new Date(_dfd.properties.iversionable_startpublish);_dfe.setSeconds(0,0);if(_dfe.getTime()>_df9.serverTime()){var _dff=_df8.substitute(_dfb.message,[_df9.toUserFriendlyHtml(_dfe)]);this.set("notification",{content:_dff});return;}}this.set("notification",null);}});});},"epi-cms/project/ProjectNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/Stateful","dojox/html/entities","epi/dependency","epi/shell/DestroyableByKey","epi-cms/ApplicationSettings","epi-cms/contentediting/command/CreateDraft","epi-cms/core/ContentReference","dojo/text!./templates/ProjectNotification.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.notifications"],function(_e00,lang,all,_e01,_e02,_e03,_e04,_e05,_e06,_e07,_e08,_e09){return _e00([_e01,_e04],{order:10,_projectService:null,_createDraftCommand:null,constructor:function(_e0a,_e0b){this._projectService=_e0b||_e03.resolve("epi.cms.ProjectService");this._createDraftCommand=new _e06({ignoreContentStatus:true});this.own(this._projectService.on("project-item-updated",lang.hitch(this,this._onItemUpdated)),this._projectService.on("project-item-removed",lang.hitch(this,this._onItemRemoved)),this._projectService.on("project-updated",function(){this._onModelChanged(this.value);}.bind(this)));},_valueSetter:function(_e0c){var _e0d=_e0c.contentViewModel;this.value=_e0d;if(!_e0d||!_e0d.contentLink){this.set("model",null);this._currentProjectItemId=0;return;}this._createDraftCommand.set("model",_e0d);var _e0e="contentLinkWatch";this.destroyByKey(_e0e);this.ownByKey(_e0e,_e0d.watch("contentLink",lang.hitch(this,"_onModelChanged",_e0d)));this._onModelChanged(_e0d);},_onItemUpdated:function(item){this._onItemsAddedOrRemoved(item.id);},_onItemRemoved:function(id){this._onItemsAddedOrRemoved(id);},_onItemsAddedOrRemoved:function(_e0f){if(!this.model){return;}if(this._currentProjectItemId===_e0f){this._updateNotification(this.model.contentLink);}},_onModelChanged:function(_e10){if(_e10.get("isSuspended")){return;}this._projectService.getProjectItemForContent(_e10.contentLink).then(function(_e11){var _e12=_e10.languageContext,_e13=_e12&&_e12.isTranslationNeeded&&_e05.currentContentLanguage===_e12.preferredLanguage;this.set("model",_e10);this._currentProjectItemId=_e11&&_e11.id||0;this._updateNotification(_e10.contentLink,_e10.contentData.isPartOfAnotherProject,_e13);}.bind(this)).otherwise(function(){this._currentProjectItemId=0;}.bind(this));},_updateNotification:function(_e14,_e15,_e16){var self=this;all([this._projectService.getProjectsForContent(_e14),this._projectService.getCurrentProject()]).then(function(_e17){var _e18=_e17[0],_e19=_e17[1];if(_e18.length===0){self.set("notification",null);return;}var _e1a=_e18.map(function(_e1b){return _e02.encode(_e1b.name);}).join(", ");var _e1c="";if(_e15){_e1c=_e09.partofanotherproject+": "+_e1a;}else{if(_e19){_e1c=_e09.partofcurrentproject;}else{_e1c=_e09.partofproject+": "+_e1a;}}var _e1d=lang.replace(_e08,{partOfProject:_e1c});var _e1e=_e15&&self._projectService.isProjectModeEnabled&&!_e16?[self._createDraftCommand]:[];self.set("notification",{content:_e1d,commands:_e1e});});}});});},"url:epi-cms/project/templates/ProjectNotification.html":"<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon epi-iconProject\"></span>\r\n<span class=\"dijitReset dijitInline epi-project-notification__content\">{partOfProject}</span>","epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_e1f,lang,_e20,_e21,_e22){var _e23=["normal","shortcut","external","inactive","fetchdata"];return _e1f([_e20],{order:20,_valueSetter:function(_e24){var _e25=_e24.contentViewModel.contentModel.get("iversionable_shortcut");if(_e25){this._updateNotification(_e25.pageShortcutType);}if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_e24.contentViewModel.contentModel.watch("iversionable_shortcut",lang.hitch(this,function(name,_e26,_e27){this._updateNotification(_e27&&_e27.pageShortcutType);}));},_updateNotification:function(_e28){var _e29,_e2a=null;if(_e28>0){_e29=_e23[_e28];_e2a=_e21.toHTML(_e22[_e29]);}this.set("notification",{content:_e2a});}});});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","dojo/Stateful","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_e2b,_e2c,_e2d,_e2e){return _e2b([_e2c],{order:30,_settingsSetter:function(_e2f){var _e30=_e2f.viewModel.contentData&&_e2f.viewModel.contentData.accessMask<=_e2d.accessLevel.Read,_e31=_e30&&_e2f.viewSetting.get("enabled")&&_e2f.viewSetting.hasVisitorGroup();this.set("notification",_e31?{content:_e2e.visitorgroups.noaccessright}:null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/json","dojo/Deferred","dojo/_base/lang","dojo/topic","dojo/on","dojo/when","dojo/promise/all","dojo/Stateful","dijit/Destroyable","dgrid/List","dgrid/extensions/DijitRegistry","epi","epi/dependency","epi/shell/UndoManager","epi/shell/DialogService","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","epi/shell/xhr/errorHandler","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_e32,_e33,_e34,json,_e35,lang,_e36,on,when,all,_e37,_e38,List,_e39,epi,_e3a,_e3b,_e3c,_e3d,_e3e,_e3f,_e40,_e41,_e42,_e43,_e44,_e45,res,_e46){return _e34([_e37,_e38],{contentModel:null,metadata:null,syncService:null,editorFactory:null,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,enableAutoSave:true,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,validationErrors:null,isChangingContentStatus:false,isSuspended:false,constructor:function(){this.contentModel=new _e3f();},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_e3a.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_e3a.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_e3a.resolve("epi.cms.ProjectService");this.currentContentLanguage=this.currentContentLanguage||_e41.currentContentLanguage;this.contentDataStore=this.contentDataStore||_e3a.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_e3a.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _e3b();this.validator=this.validator||new _e43({contextId:this.get("contentLink"),contextTypeName:this.contextTypeName});this._dialogService=this._dialogService||_e3c;if(!this.syncService){this._createSyncService();}var _e47=lang.hitch(this,function(name,_e48,_e49){this.set(name,_e49);});this._operation=new _e45();this.own(this.syncService.watch("hasPendingChanges",_e47),this.validator.watch("isValid",_e47),this.validator.watch("hasErrors",_e47),this.undoManager.watch("hasUndoSteps",_e47),this.undoManager.watch("hasRedoSteps",_e47),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this.set("isSuspended",true);this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this.set("isSuspended",false);},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _e4a=new _e44({contentLink:this.get("contentLink"),contentDataStore:this.contentDataStore});this.syncService=_e4a;},connectLocal:function(_e4b,obj,evt,_e4c){if(!lang.isArray(_e4b)){throw Error("First argument to connectLocal must be an Array");}return _e4b.push(_e33.connect(obj,evt,this,_e4c));},disconnectLocal:function(_e4d){if(lang.isArray(_e4d)){var _e4e;while((_e4e=_e4d.pop())){_e33.disconnect(_e4e);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_e4f){return this.contentModel.get(_e4f);},setProperty:function(_e50,_e51,_e52){this._setModelProperty(_e50,_e51,_e52);},scheduleForPublish:function(date){return this.saveProperty("iversionable_startpublish",date,_e42.saveAction.ForceCurrentVersion|_e42.saveAction.Schedule);},saveProperty:function(_e53,_e54,_e55){return this.syncService.saveProperty(_e53,_e54,_e55).then(function(_e56){this.set("validationErrors",_e56.validationErrors);this.contentModel.set(_e53,_e54);return this.changeContentStatus(_e55,true);}.bind(this));},saveAndPublishProperty:function(_e57,_e58,_e59){return when(this.syncService.saveProperty(_e57,_e58,_e42.saveAction.Publish|_e59),lang.hitch(this,function(_e5a){this.validator.setGlobalErrors(_e5a.validationErrors,this.validator.validationSource.server);this.contentModel.set(_e57,_e58);return when(all([this.contentDataStore.refresh(_e5a.contentLink),_e5a.publishedContentLink?this.contentDataStore.refresh(_e5a.publishedContentLink):null]),lang.hitch(this,function(_e5b){var _e5c=_e5b[0];this.set("contentData",_e5c);return _e5a;}));}));},_commitChanges:function(_e5d){var _e5e=[];_e5d.forEach(function(_e5f){_e5e.push({propertyName:_e5f.propertyName,value:_e5f.oldValue,oldValue:_e5f.value});},this);this.undoManager.createStep(this,this._saveProperties,[_e5e],"Edit properties");},_saveProperties:function(_e60){this.beginOperation();_e32.forEach(_e60,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_e61,_e62,_e63){_e63=_e63===undefined?this.contentModel.get(_e61):_e63;this.set("isSaved",false);this.contentModel.set(_e61,_e62);this._operation.save({propertyName:_e61,value:_e62,oldValue:_e63});this.syncService.scheduleForSync(_e61,_e62);this.enableAutoSave&&this.save();this.onPropertyEdited(_e61,_e62);},onPropertyEdited:function(_e64,_e65){},onPropertySaved:function(_e66,_e67){},onPropertyReverted:function(_e68,_e69){this.contentModel.set(_e68,_e69);},_onSynchronizeSuccess:function(_e6a,_e6b,_e6c){_e32.forEach(_e6b,lang.hitch(this,function(_e6d){this.validator.clearPropertyErrors(_e6d.name,this.validator.validationSource.server);this._patchContentDataStore(_e6a,_e6d.name,null,_e6d.value);this.onPropertySaved(_e6d.name,_e6d.value);}));this.validator.setGlobalErrors(_e6c.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_e6e,_e6f,_e70,_e71){var _e72=[];_e32.forEach(_e6f,function(_e73){if("successful" in _e73){if(_e73.successful){this.validator.clearPropertyErrors(_e73.name,this.validator.validationSource.server);}else{_e72.push(_e73);}}},this);if(_e72.length){var _e74=_e32.map(_e72,function(_e75){return _e75.validationErrors;});this._showErrorsDialog(res.autosave.title,res.autosave.error,_e74,lang.hitch(this,function(){_e32.forEach(_e72,function(_e76){this.onPropertyReverted(_e76.name,_e76.value);},this);}));}if(_e71){if(_e71.validationErrors){this.validator.setGlobalErrors(_e71.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_showErrorsDialog:function(_e77,_e78,_e79,_e7a){var list=new (_e34([List,_e39]))({className:"epi-grid-max-height--300"});list.renderArray(_e79);list.startup();function _e7b(){_e7a();this._currentErrorDialog=null;};if(this._currentErrorDialog){this._currentErrorDialog.set("content",list);}else{this._currentErrorDialog=new _e3e({title:_e77,description:_e78,content:list,onAction:_e7b.bind(this)});this._currentErrorDialog.show();}},_contentLinkChanged:function(_e7c){this.set("contentLink",_e7c);this.syncService.set("contentLink",_e7c);this.validator.setContextId(_e7c);this.onContentLinkChange();},ensureWritableVersion:function(){var _e7d=this.get("contentLink");if(!this.contentData.isNewVersionRequired){return _e7d;}if(this._isCreatingNewVersionDeferred&&!this._isCreatingNewVersionDeferred.isFulfilled()){return this._isCreatingNewVersionDeferred.promise;}else{this._isCreatingNewVersionDeferred=new _e35();}this.isCreatingNewVersion=true;when(this._contentVersionStore.put({originalContentLink:_e7d}),lang.hitch(this,function(_e7e){this.contentDataStore.refresh(_e7e.contentLink).then(lang.hitch(this,function(_e7f){this.set("contentData",_e7f);})).always(lang.hitch(this,function(){this.isCreatingNewVersion=false;this._contentLinkChanged(_e7e.contentLink);this._isCreatingNewVersionDeferred.resolve(_e7e);}));}),lang.hitch(this,function(_e80){this.isCreatingNewVersion=false;this._isCreatingNewVersionDeferred.reject(_e80);var _e81=_e80.responseText?json.fromJson(_e80.responseText):_e80.message;this.validator.setGlobalErrors(_e81,this.validator.validationSource.server);}));return this._isCreatingNewVersionDeferred.promise;},validate:function(){var def;if(!this.validator){def=new _e35();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _e82=this.get("contentLink");return when(this._contentVersionStore.remove(_e82),function(){this._loadPublishedVersion(_e82);}.bind(this),function(_e83){var _e84;if(_e83.status===403){_e84=_e46.deleteversion.cannotdeletepublished;}else{if(_e83.status===404){_e84=res.versionstatus.versionnotfound;}}if(_e84){return this._dialogService.alert(_e84).then(function(){this._loadPublishedVersion(_e82);}.bind(this));}}.bind(this));},_loadPublishedVersion:function(_e85){when(this._contentVersionStore.query({contentLink:_e85,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_e86){if(_e86!==null){var _e87={uri:"epi.cms.contentdata:///"+_e86.contentLink,context:this};_e36.publish("/epi/shell/context/request",_e87,{sender:this,forceReload:true});}}));},createDraft:function(){var _e88=this.get("contentLink"),_e89=this.contentData.isCommonDraft&&this.contentData.status===_e42.versionStatus.DelayedPublish&&!this.projectService.isProjectModeEnabled;return when(this._contentVersionStore.put({originalContentLink:_e88,isCommonDraft:_e89}),lang.hitch(this,function(_e8a){var _e8b={uri:"epi.cms.contentdata:///"+_e8a.contentLink,context:this};_e36.publish("/epi/shell/context/request",_e8b,{sender:this});_e36.publish("/epi/cms/content/statuschange/","common-draft",{id:_e8a.contentLink});}));},editCommonDraft:function(){var _e8c=this.get("contentLink");return when(this._contentVersionStore.query({contentLink:_e8c,query:"getcommondraftversion"}),lang.hitch(this,function(_e8d){var _e8e={uri:"epi.cms.contentdata:///"+_e8d.contentLink,context:this};_e36.publish("/epi/shell/context/request",_e8e,{sender:this});}));},_populateContentModel:function(data,_e8f){var _e90={},_e91,_e92;for(var _e93 in data){var _e94=_e8f.getPropertyMetadata(_e93);var _e95=data[_e93];if(_e94.hasSubProperties()){_e90[_e93]=this._populateContentModel(_e95,_e94);}else{_e90[_e93]=_e95;_e91=_e94.customEditorSettings.converter;if(_e91){_e92=_e3d.getConverter(_e91,"runtimeType");if(_e92){_e90[_e93]=_e92.convert(_e91,"runtimeType",_e95);}}}}return _e90;},getPropertyMetaData:function(_e96){return when(this._getMetadata(),function(_e97){return _e97.getPropertyMetadata(_e96);});},reload:function(){return when(all([this.contentDataStore.get(this.get("contentLink")),this._getMetadata(true)]),lang.hitch(this,function(data){var _e98=data[0],_e99=data[1];this.set("contentData",_e98);var _e9a=this.get("contentModel");var _e9b=this._populateContentModel(_e98.properties,_e99);for(var name in _e9b){if(_e9b.hasOwnProperty(name)&&!epi.areEqual(_e9a.get(name),_e9b[name])){_e9a.set(name,_e9b[name]);}}}));},_getMetadata:function(_e9c){var _e9d=this.get("metadata");if(!_e9c&&_e9d){return _e9d;}var self=this;return when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.get("contentLink")}),function(_e9e){self.set("metadata",_e9e);return _e9e;});},save:function(){if(!this.isOnline){var def=new _e35();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _e35(),_e9f=lang.hitch(this,function(_ea0){if(_ea0){if(_ea0.successful){this._onSynchronizeSuccess(_ea0.contentLink,_ea0.properties,_ea0);}else{this._rescheduleProperties(_ea0.properties);this._onSynchronizeFailure(_ea0.contentLink,_ea0.properties,_ea0.validationErrors,_ea0);}if(_ea0&&_ea0.hasContentLinkChanged&&this.contentLink!==_ea0.contentLink){this._contentLinkChanged(_ea0.contentLink);}this.set("validationErrors",_ea0.validationErrors);}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_ea1=lang.hitch(this,function(_ea2){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);this.set("isOnline",false);if(_ea2){this.set("validationErrors",_ea2.validationErrors);this._rescheduleProperties(_ea2.properties);}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);def.reject(_ea2);});if(!this.hasPendingChanges){_e9f();}else{when(this.ensureWritableVersion()).then(lang.hitch(this,function(){this.set("isSaving",true);return this.syncService.save();})).then(_e9f).otherwise(_ea1);}return def;},_rescheduleProperties:function(_ea3){_e32.forEach(_ea3,lang.hitch(this,function(_ea4){if(!this.syncService.pendingSync(_ea4.name)){this.syncService.scheduleForSync(_ea4.name,_ea4.value);}}));},undo:function(){!this.get("isSuspended")&&this.undoManager.undo();},redo:function(){!this.get("isSuspended")&&this.undoManager.redo();},_patchContentDataStore:function(_ea5,_ea6,_ea7,_ea8){var _ea9={};lang.setObject(_ea6,_ea8,_ea9);return this.contentDataStore.patchCache({contentLink:_ea5,changedBy:this.profileHandler.userName,saved:(new Date()).toISOString(),properties:_ea9});},changeContentStatus:function(_eaa,_eab){var _eac=this.get("contentLink");var def=new _e35();this.set("isChangingContentStatus",true);var _ead=lang.hitch(this,function(_eae){var _eaf=_eae&&_eae.success;var _eb0=this.validator;if(_eaf){if(_eaa===_e42.saveAction.Publish||_eaa===_e42.saveAction.CheckIn||_eaa===(_e42.saveAction.CheckIn|_e42.saveAction.DelayedPublish|_e42.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_eb0){_eb0.clearGlobalErrors(_eb0.validationSource.server);}var _eb1={id:_eae.id,oldId:_eac};_e36.publish("/epi/cms/content/statuschange/",_eaa,_eb1);def.resolve(_eb1);}else{if(_eae&&_eae.validationErrors){if(_eb0){_eb0.setGlobalErrors(_eae.validationErrors,_eb0.validationSource.server);_eb0.validate();}def.reject(null);}else{def.reject((_eae&&_eae.errorMessage)?_eae.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _eb2=lang.hitch(this,function(_eb3){_e36.publish("/epi/cms/action/showerror");def.reject((_eb3&&_eb3.errorMessage)?_eb3.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();if(_eab){var _eb4;if(this.validationErrors&&this.validationErrors.length>0){_eb4=!this.validationErrors.some(function(_eb5){return _eb5.severity===3;});}else{_eb4=true;}_ead({id:this.contentLink,success:_eb4,validationErrors:this.validationErrors});}else{when(this.validate()).then(this.save.bind(this)).then(function(){return _e40.wrapXhr(this.contentDataStore.executeMethod("ChangeStatus",this.get("contentLink"),{action:_eaa}));}.bind(this)).then(_ead).otherwise(_eb2);}return def;},_lastSavedGetter:function(){if(this.lastSaved){return this.lastSaved;}if(this.contentData){return this.contentData.saved;}return null;},onContentChange:function(){},onContentLinkChange:function(){if(this.get("isSuspended")){return;}var _eb6={uri:"epi.cms.contentdata:///"+this.get("contentLink")};_e36.publish("/epi/shell/context/request",_eb6,{sender:this,contextIdSyncChange:true,trigger:"internal"});},hasEditAccess:function(){return _e42.hasAccess(this.contentData.accessMask,_e42.accessLevel.Edit);},hasAccess:function(_eb7){var _eb8=!this.languageContext||!this.languageContext.isTranslationNeeded;return _eb8&&_e42.isActionAvailable(this.contentData,_eb7||_e42.action.Edit,_e42.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!==this.currentContentLanguage){return false;}return true;},canChangeContent:function(_eb9){var _eba=this.projectService.isProjectModeEnabled&&this.contentData.isPartOfAnotherProject;return !_eba&&this.canEditCurrentLanguage()&&this.hasAccess(_eb9);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language===this.currentContentLanguage;},_contentDataSetter:function(_ebb){this.contentData=_ebb;if(_ebb.contentLink!==undefined){this.set("contentLink",_ebb.contentLink);}},_showOverlayGetter:function(){var _ebc=this.getProperty("iversionable_shortcut");if(_ebc&&_ebc.pageShortcutType){return _ebc.pageShortcutType!==4;}return true;}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_ebd,_ebe,_ebf,lang,_ec0,_ec1,_ec2,_ec3){return _ebe([_ec2],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{none:0,info:1,warn:2,error:3},validationSource:{server:1,client:2},_errorLevels:{},constructor:function(_ec4){_ebe.safeMixin(this,_ec4);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _ec5=this.severity[p];this._errorLevels[_ec5]=p;}this.messageService=this.messageService||_ec3.resolve("epi.shell.MessageService");this._store=new _ec1({idAttribute:"id",data:[]});},setContextId:function(_ec6){var _ec7=this.contextId;this.contextId=_ec6;var _ec8=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_ec7});_ec8.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_ec9,_eca){if(!_ec9){return;}this._clearErrors(_ec9,_eca);},setPropertyErrors:function(_ecb,_ecc,_ecd){if(!_ecb){return;}this._setErrors(_ecc,_ecb,_ecd);},clearGlobalErrors:function(_ece){this._clearErrors(null,_ece);},clearErrorsBySource:function(_ecf){this._clearErrors(undefined,_ecf);},setGlobalErrors:function(_ed0,_ed1){this._setErrors(_ed0,null,_ed1);},_clearErrors:function(_ed2,_ed3){var _ed4;if(_ed2){_ed4={propertyName:_ed2};}else{if(_ed2===null){_ed4={global:true};}else{_ed4={};}}if(_ed3){_ed4.source=_ed3;}var _ed5=this._store.query(_ed4);_ed5.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_ed6,_ed7,_ed8){this._clearErrors(_ed7,_ed8);_ebd.forEach(_ed6,function(item){this._putStoreItem(item,_ed7,_ed8);},this);this._updateFlags();},_putStoreItem:function(item,_ed9,_eda){var _edb="";if(this._errorLevels[item.severity]){_edb=this._errorLevels[item.severity];}var _edc=this.messageService.put(_edb,item.errorMessage,this.contextTypeName,this.contextId);var _edd={id:this._storeId++,item:item,severity:item.severity,messageId:_edc};if(_ed9){_edd.propertyName=_ed9;}else{_edd.global=true;}if(_eda!==undefined){_edd.source=_eda;}return this._store.put(_edd);},_updateFlags:function(){var _ede=this._store.query({severity:this.severity.error});var _edf=this._store.query({severity:this.severity.warn});var _ee0=_ede.length===0&&_edf.length===0;var _ee1=_ede.length>0;this.set("isValid",_ee0);this.set("hasErrors",_ee1);},validate:function(){var _ee2=this.severity.error,_ee3=new _ebf();_ebf.when(this._validate(_ee2),function(_ee4){if(_ee4){_ec0.publish("/epi/cms/action/showerror");}_ee3.resolve(_ee4);},function(){_ec0.publish("/epi/cms/action/showerror");_ee3.reject();});return _ee3;},_validate:function(_ee5){var _ee6=new _ebf();if(!this._isBlocking){_ebf.when(this._store.query({severity:_ee5}),lang.hitch(this,function(_ee7){var _ee8=_ebd.filter(_ee7,function(item){return item.source===this.validationSource.client;},this);var _ee9=_ee8.length>0;var _eea=_ee7.length>_ee8.length;if(_ee9){_ee6.reject();}else{_ee6.resolve(_eea);}}));}return _ee6;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/json","dojo/Stateful","epi/assign","epi/datetime","epi/dependency","epi/string","epi/shell/postMessage","./ContentActionSupport"],function(_eeb,_eec,_eed,when,json,_eee,_eef,_ef0,_ef1,_ef2,_ef3,_ef4){return _eec([_eee],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,_oldContentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,_postMessage:null,_profile:null,constructor:function(_ef5){_eec.safeMixin(this,_ef5);this._queue=[];this._postMessage=this._postMessage||_ef3;this._profile=this._profile||_ef1.resolve("epi.shell.Profile");},_contentLinkSetter:function(_ef6){this._oldContentLink=this.contentLink;this.contentLink=_ef6;},scheduleForSync:function(_ef7,_ef8){if(_ef8===undefined){return;}this.set("hasPendingChanges",true);_ef8=_ef0.transformDate(_ef8);var _ef9=this._propertyIndexInQueue(_ef7);if(_ef9<0){this._queue.push({name:_ef7,value:_ef8});}else{this._queue[_ef9].value=_ef8;}},saveProperty:function(_efa,_efb,_efc){this.scheduleForSync(_efa,_efb);return this._startSynchronizeInterval({delay:0,action:_efc});},_propertyIndexInQueue:function(_efd){var _efe=-1;_eeb.some(this._queue,function(item,i){if(item.name===_efd){_efe=i;return true;}});return _efe;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(_eff){var _f00;if(!this._saveDeferred){this._saveDeferred=new _eed();_f00=_eff&&_eff.delay||this.processInterval;setTimeout(this._synchronizeItem.bind(this,_eff),_f00);}return this._saveDeferred.promise;},_synchronizeItem:function(_f01){var _f02=this._queue,_f03=this.contentLink,_f04=this._saveDeferred;this._queue=[];this._saveDeferred=null;this.set("hasPendingChanges",false);var _f05=function(_f06){var _f07={},_f08;if(_f06){_eeb.forEach(_f06.properties,function(_f09){_f09.name=_ef2.pascalToCamel(_f09.name);},this);_f08=_f06.savedContentLink;_f07=_eef({successful:false,contentLink:_f06.savedContentLink,hasContentLinkChanged:this._hasContentLinkChanged(_f06)},_f06);if(_f08&&_f08!==this.contentLink){this.set("contentLink",_f08);}_f07.oldContentLink=this._oldContentLink;this._oldContentLink=null;this._publishContentSavedMessage(_f07);_f04.resolve(_f07);}else{_f04.reject({contentLink:_f03,properties:_f02,error:"Unexpected result returned from the server."});}}.bind(this);var _f0a=function(_f0b){var _f0c={contentLink:_f03,properties:_f02,error:_f0b};_f04.reject(_f0c);}.bind(this);if(_f02.length===0){_f04.resolve();return;}when(this._saveProperties(_f02,_f01)).then(_f05).otherwise(_f0a);},_hasContentLinkChanged:function(_f0d){var _f0e=this._oldContentLink&&this._oldContentLink!==this.contentLink;return _f0d.savedContentLink&&_f0d.savedContentLink!==this.contentLink||_f0e;},_publishContentSavedMessage:function(_f0f){when(this._profile.get("isEPiBetaUser"),function(_f10){if(_f10){this._postMessage.publish("beta/contentSaved",_f0f);}}.bind(this));},pendingSync:function(_f11){return this._propertyIndexInQueue(_f11)!==-1;},_saveProperties:function(_f12,_f13){var _f14=this.contentLink,_f15={};_eeb.forEach(_f12,function(item){_f15[item.name]=json.toJson(item.value);});var _f16={id:_f14,properties:_f15,action:_f13?_f13.action:_ef4.saveAction.Save|_ef4.saveAction.SkipValidation};return this.contentDataStore.patch(_f16,{id:_f16.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(_f17,_f18,lang,_f19,_f1a){return _f18([_f1a,_f19],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=_f17.filter(this.changes,function(_f1b){if(_f1b.propertyName===data.propertyName){data.oldValue=_f1b.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/viewmodel/ContentActivityFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/project/viewmodels/_ProjectFeedViewModel"],function(_f1c,lang,when,_f1d,_f1e){return _f1c([_f1e],{isSingleItemSelected:true,_contentLink:null,isActivitiesVisible:false,_activityFeedSettings:null,postscript:function(){this.inherited(arguments);this.store=this.store||_f1d.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_f1d.resolve("epi.shell.profile");this._activityFeedSettings={};when(this.profile.get(this._getActivityFeedProfileKey())).then(function(_f1f){this._activityFeedSettings=_f1f;this.set("isActivitiesVisible",!!(_f1f&&_f1f.isActivitiesVisible));}.bind(this));},_contentLinkSetter:function(_f20){this._contentLink=_f20;this._updateQuery();},_isActivitiesVisibleSetter:function(_f21){this.isActivitiesVisible=_f21;this._updateQuery();this._persistActivityFeedSettings({isActivitiesVisible:_f21});},_updateQuery:function(){if(this.isActivitiesVisible&&this._contentLink){this.set("query",{contentReferences:[this._contentLink]});}else{this.set("query",null);}},_nameSetter:function(name){this.set("placeholderName",name);},_persistActivityFeedSettings:function(_f22){this._activityFeedSettings=lang.mixin(this._activityFeedSettings,_f22);this.profile.set(this._getActivityFeedProfileKey(),this._activityFeedSettings);},getActivityFeedSettings:function(){return this._activityFeedSettings;},_getActivityFeedProfileKey:function(){return this.componentTypeName+"activity-feed";}});});},"epi-cms/project/viewmodels/_ProjectFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/activity/viewmodels/_ActivityViewModel","dojo/Evented"],function(_f23,lang,_f24,_f25,_f26){return _f23([_f25,_f26],{hideOnPost:false,isEditEnabled:false,isSingleItemSelected:false,readOnly:false,selectedProjectId:null,noDataMessage:"",_save:function(_f27){var _f28=this.activityService.addMessage(this.selectedProjectId,this._contentLink,_f27);_f28.then(this.emit.bind(this,"save"));return _f28;},_placeholderNameSetter:function(_f29){this.placeholderName=_f29;var _f2a=_f29?lang.replace(_f24.textareaplaceholder,{name:_f29}):"";this.set("placeholderText",_f2a);}});});},"epi-cms/activity/viewmodels/_ActivityViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_f2b,_f2c,all,_f2d,when,_f2e,_f2f,_f30,_f31,_f32,_f33,_f34){return _f2b([_f31],{activityService:null,editLabel:_f33.edit,comment:null,sendLabel:_f33.post,resetLabel:_f33.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_f34.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_f2f.resolve("epi.cms.ActivityService");this.profile=this.profile||_f2f.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_f2f.resolve("epi.storeregistry").get("epi.cms.notification.users");},getComment:function(){var _f35=this.comment;if(!_f35){return "";}return _f30.toHTML(this._formatText(_f35));},save:function(_f36){var _f37=this._save(_f36);_f37.otherwise(this._handleError.bind(this));return _f37;},_save:function(_f38){},_formatText:function(text){var map=_f2e.html;text=text&&_f2e.encode(text,map);text=text&&text.replace(/(\\n)/ig,"");return text;},_handleError:function(){this.set("errorMessage",_f32.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_f39){this.message=_f39;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _f3a=this._formatText(this.message);if(!_f3a||!this.notificationUserStore){return new _f2c().resolve(_f30.toHTML(_f3a));}var _f3b=/\B@([^\s":;|=,+*?<>[\]\/\\]+)/g,_f3c=_f3a.match(_f3b)||[],_f3d={},_f3e=_f3c.map(function(_f3f){var _f40=_f3f.replace(/^@/,""),_f41=encodeURIComponent(_f40);return when(this.notificationUserStore.get(_f41)).then(function(user){_f3d[_f40]=user.displayName;}).otherwise(function(){});}.bind(this));return all(_f3e).then(function(){_f3a=_f3a.replace(_f3b,function(_f42,key){return _f3d[key]?"<strong>"+_f30.encodeForWebString(_f3d[key])+"</strong>":_f42;});return _f30.toHTML(_f3a);});}});});},"url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\r\n    <div data-dojo-attach-point=\"mainLayoutContainer\" data-dojo-type=\"epi/shell/layout/PreserveRatioBorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\r\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top', layoutPriority: 90\"></div>\r\n        <div data-dojo-attach-point=\"activityFeed\" data-dojo-type=\"epi-cms/activity/ActivityFeed\" data-dojo-props=\"region: 'right', model: this.activityModel, layoutPriority: 95, splitter: true, minSize: 200\" style=\"width: 25%; min-width: 200px\" class=\"dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"editLayoutContainer\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center', layoutPriority: 100\">\r\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true, iframeName:'${iframeName}'\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_f43,lang,fx,_f44,has,on,_f45,_f46,_f47,_f48,when,_f49,_f4a,_f4b){return _f43([_f4a,_f49],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var _f4c=this.selectedChildWidget;var _f4d=this.getChildren(),_f4e=_f4d[_f4d.length-1];if(_f4c&&_f4c.resize){if(_f4c.fitContainer){_f4c.resize(this._containerContentBox||this._contentBox);}else{_f4c.resize();}}if(_f4c!==_f4e&&!_f4c.fitContainer){_f45.replace(_f4e.domNode,"dijitVisible","dijitHidden");if(_f4e&&_f4e!==_f4c&&_f4e.resize){if(_f4e.fitContainer){_f4e.resize(this._containerContentBox||this._contentBox);}else{_f4e.resize();}}}},addChild:function(_f4f,_f50){if(this._started){var _f51=this.getChildren(),_f52=_f51[_f51.length-1];if(_f50>=_f51.length){_f45.replace(_f52.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_f53,_f54){var _f55=this.getChildren(),_f56=_f55[_f55.length-1];if(!_f54||_f54._destroyed){return;}if(_f54.fitContainer&&_f54!==_f56){_f45.replace(_f56.domNode,"dijitVisible","dijitHidden");}return when(_f53===_f56?this._hideTransition(_f54,_f56):null,lang.hitch(this,function(n){var _f57=0;if(_f54&&!_f54._destroyed&&_f54!==_f56){_f57=_f47.getMarginBox(_f54.domNode).h;this._hideChild(_f54);}if(!_f53||_f53._destroyed){return;}this._showChild(_f53);if(_f53.resize){if(_f53.fitContainer){_f53.resize(this._containerContentBox||this._contentBox);}else{_f53.resize(null);}return when(this._showTransition(_f53,_f56,_f57),function(){if(_f53.fitContainer&&_f53!==_f56){_f45.replace(_f56.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_f58,_f59){return this._doTransition(_f58,_f59,false);},_showTransition:function(_f5a,_f5b,_f5c){return this._doTransition(_f5a,_f5b,true,_f5c);},_doTransition:function(page,_f5d,_f5e,_f5f){if(page!==_f5d){var _f60=_f47.getMarginBox(page.domNode),_f61=this._getAnimationNode(page,_f5d);var _f62=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_f60.h:_f60.w,from=_f5e?-(size-_f5f)+"px":"0px",to=_f5e?"0px":-size+"px",_f63=!_f5e;return this._animate(_f61,_f62,from,to,_f63);}},_getAnimationNode:function(page,_f64){return page.transitionMode==="slideIn"?this.containerNode:((page.transitionMode==="reveal")?_f64.domNode:null);},_animate:function(node,_f65,from,to,_f66){var dfd=new _f48();if(node&&has("css-transitions")&&from!==to){_f46.set(node,_f65,from);setTimeout(lang.hitch(this,function(){_f45.add(node,this.transitionClass);var _f67=on(node,has("transitionend"),lang.hitch(this,function(){_f67.remove();_f45.remove(node,this.transitionClass);if(_f66){_f46.set(node,_f65,from);}dfd.resolve();}));setTimeout(function(){_f46.set(node,_f65,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi/shell/layout/PreserveRatioBorderContainer":function(){define("epi/shell/layout/PreserveRatioBorderContainer",["dojo/_base/declare","dijit/layout/BorderContainer","epi/shell/layout/_PreserveRatioMixin"],function(_f68,_f69,_f6a){return _f68([_f69,_f6a],{});});},"epi/shell/layout/_PreserveRatioMixin":function(){define("epi/shell/layout/_PreserveRatioMixin",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/Destroyable"],function(_f6b,lang,_f6c,_f6d){return _f6b([_f6d],{postCreate:function(){this.inherited(arguments);this.own(_f6c.before(this,"resize",lang.hitch(this,this._adjustSplitter)));},_adjustSplitter:function(){if(typeof this.getChildren==="function"){var _f6e=this.getChildren();if(_f6e.length===0){return;}var _f6f=_f6e.filter(function(obj){return (obj.splitter===true);});var _f70=_f6e.filter(function(obj){return (obj.splitter!==true);});var _f71=_f6f.length;var max=0;for(var _f72 in _f6f){max=this._calcTrueMax(_f70,_f6f,_f6f[_f72],_f71);_f6f[_f72].set("style",this._getStyle(_f6f[_f72],max));}}},_getStyle:function(_f73,max){var _f74=null;switch(_f73.region){case "top":case "bottom":_f74="height: "+this._calcRatio(_f73.get("h"),max)+"%;";break;case "left":case "right":_f74="width: "+this._calcRatio(_f73.get("w"),max)+"%;";break;}return _f74;},_calcRatio:function(_f75,max){return (_f75/max)*100;},_calcTrueMax:function(_f76,_f77,_f78,_f79){var _f7a="w";if(_f78.region==="bottom"||_f78.region==="top"){_f7a="h";}var max=_f78.get(_f7a);var _f7b=_f76.filter(function(_f7c){return _f7c.region==="center";})[0].get(_f7a);var _f7d=_f78._splitterWidget.get(_f7a);var _f7e=function(_f7f){if(_f7a==="w"&&(_f7f.region==="right"||_f7f.region==="left")){max+=_f7f.get("w");}else{if(_f7a==="h"&&(_f7f.region==="bottom"||_f7f.region==="top")){max+=_f7f.get("h");}}};_f76.forEach(_f7e);_f77.forEach(function(_f80){if(_f80===_f78){return;}_f7e(_f80);});return max+_f7b+(_f7d*_f79);}});});},"epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/topic","dojo/when","epi","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_f81,lang,_f82,_f83,_f84,when,epi,_f85,_f86,_f87,res,_f88){return _f81([_f87],{res:res,_isSavingHandle:null,_editActionViewModel:null,_commands:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_f85;this.own(this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);})));this._editActionViewModel=new _f86();this.own(this._editActionViewModel);},resize:function(_f89){this.inherited(arguments);if(_f89){_f83.toggle(this.domNode,"epi-editToolbarNarrow",_f89.w<620);_f83.toggle(this.domNode,"epi-editToolbarMedium",_f89.w>=620&&_f89.w<1000);_f83.toggle(this.domNode,"epi-editToolbarLarge",_f89.w>=1300);this._editActionViewModel.set("expanded",_f89.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_f89.w<1000);}},setupChildren:function(_f8a,_f8b){var _f8c=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_f84.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_f84.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._commands.revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}}];var _f8d=_f8a?_f8a:[];_f8c=_f8b?_f8b.concat(_f8c):_f8c;return this.inherited(arguments,[_f8d,_f8c]);},_setContentViewModelAttr:function(_f8e){this._set("contentViewModel",_f8e);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(_f8e);}));},_updateToolbarItemsModel:function(_f8f){if(!_f8f.isSaving){this.setItemProperty("autosave","label","");}this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _f90=_f8f.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_f90.contentLink});this._editActionViewModel.set("dataModel",_f8f);if(this._isSavingHandle){this._isSavingHandle.unwatch();}this._isSavingHandle=_f8f.watch("isSaving",function(name,_f91,_f92){this._widgetMap["editactionpanel"].toggleDropDownMenu(!_f92);}.bind(this));this.setItemProperty("viewselect","viewName",_f8f.viewName);}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(_f93,_f94,lang,_f95,_f96,_f97,_f98,_f99,_f9a,_f9b,_f9c,res){return _f94([_f99],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10,AwaitingApproval:11,Rejected:12},_isSavingHandle:null,_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_f9c.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _f9d in this._virtualStatusEnum){this._virtualStatusCssState.push(_f9d);this._virtualStatusLocalization.push(this.res["status"][_f9d.toLowerCase()]);}this._statusMap[_f98.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_f98.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_f98.versionStatus.Rejected]=this._virtualStatusEnum.Rejected;this._statusMap[_f98.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_f98.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_f98.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_f98.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusMap[_f98.versionStatus.AwaitingApproval]=this._virtualStatusEnum.AwaitingApproval;this._statusIcon[_f98.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_f98.versionStatus.Rejected]="epi-icon--inverted epi-iconStop";this._statusIcon[_f98.versionStatus.AwaitingApproval]="epi-icon--inverted epi-iconGlasses";}if(!this.skipChildModels){this.publishMenuViewModel=new _f9a({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}if(this._isSavingHandle){this._isSavingHandle.unwatch();}this.inherited(arguments);},_dataModelSetter:function(_f9e){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",_f9e);}},onDataModelChange:function(){var _f9f=this.dataModel.contentData;if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this._isChangingContentStatusHandle=this.dataModel.watch("isSaving",function(name,_fa0,_fa1){if(_fa1){this.set("statusText","");}else{this._refresh(_fa1);}}.bind(this));this._refresh((!this.dataModel.hasErrors&&this.dataModel.hasPendingChanges)||this.dataModel.isSaving);if(_f9f.isDeleted){this.set("statusIcon","");this.set("nonEditableIndicator",true);}else{this.set("statusIcon",this._getStatusIcon(_f9f));var _fa2=this.dataModel.canChangeContent(_f98.action.Edit);var _fa3=_f9f.status===_f98.versionStatus.AwaitingApproval;this.set("nonEditableIndicator",!_fa2&&!_fa3);}this.set("visible",!_f9f.isWastebasket);},_refresh:function(_fa4){if(_fa4){return;}var _fa5=this.dataModel.contentData;var _fa6=this._getVirtualStatus(_fa5);this.set("additionalClass",this._getVirtualStatus(_fa5)===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this.set("state",this._virtualStatusCssState[_fa6]);this.set("statusText",this._getStatusText(_fa6,_fa5));this.set("buttonText",this._getButtonText(_fa6,_fa5));},_getStatusText:function(_fa7,_fa8){if(_fa7===this._virtualStatusEnum.Deleted){return this._virtualStatusLocalization[_fa7];}if(_fa8.status===_f98.versionStatus.DelayedPublish){return _f96.substitute(this._virtualStatusLocalization[_fa7],[_f9b.toUserFriendlyHtml(_fa8.properties.iversionable_startpublish)]);}if(_fa7===this._virtualStatusEnum.InUse){var _fa9=this.inUseNotificationManager.getOtherUsersInUseNotifications(_fa8.inUseNotifications);_fa9=_fa9.map(function(item){return _f97.encode(item);}).join(",");return _f96.substitute(this._virtualStatusLocalization[_fa7],[_fa9]);}if(_fa8.status===_f98.versionStatus.AwaitingApproval){if(this._canApproveCurrentStep()){return this.res.awaitingyourapproval.label;}return this.res.currentlyinreview.label;}return this._virtualStatusLocalization[_fa7];},_getStatusIcon:function(_faa){if(this._isRejected()){return "";}return this._statusIcon[_faa.status]||"";},_getButtonText:function(_fab,_fac){if((_fab===this._virtualStatusEnum.NotPublishedYet||_fab===this._virtualStatusEnum.ChangesToPublish||_fab===this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_f98.action.Publish)){return this.res.buttonlabel.publish;}else{if(this._shouldShowApprovalButton(_fab)){return this.res.awaitingyourapproval.button;}else{return this.res.buttonlabel.option;}}},_shouldShowApprovalButton:function(_fad){return _fad===this._virtualStatusEnum.AwaitingApproval&&this._isContentInCurrentLanguage()&&this._canApproveCurrentStep();},_isContentInCurrentLanguage:function(){var _fae=this.dataModel.contentData;if(_fae&&_fae.capabilities&&!_fae.capabilities.language){return true;}if(!this.dataModel.languageContext){return false;}var _faf=this.dataModel.currentContentLanguage;var _fb0=this.dataModel.languageContext.language;return _faf===_fb0;},_getVirtualStatus:function(_fb1){if(_fb1.isDeleted){return this._virtualStatusEnum.Deleted;}var _fb2,_fb3,_fb4;_fb2=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_fb3=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_fb2;_fb4=this.inUseNotificationManager.hasInUseNotificationWarning(_fb1.inUseNotifications);if(_fb4&&_fb3){return this._virtualStatusEnum.InUse;}if(_fb1.isCommonDraft){if(_fb1.status===_f98.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_fb1.status===_f98.versionStatus.CheckedOut){return _fb1.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}if(this._isRejected()){return this._virtualStatusEnum.NotPublishedYet;}return this._statusMap[_fb1.status];},_isRejected:function(){return !this._canTransitionTo("readyforreview")&&this._canTransitionTo("readytopublish");},_canApproveCurrentStep:function(){return this._canTransitionTo("approvechanges");},_canTransitionTo:function(_fb5){return this.dataModel.contentData.transitions.some(function(item){return item.name===_fb5;});}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/Stateful","epi/shell/DestroyableByKey"],function(_fb6,_fb7,_fb8){return _fb6([_fb7,_fb8],{dataModel:null,_dataModelHandlesKey:"dataModelHandles",_dataModelSetter:function(_fb9){this.destroyByKey(this._dataModelHandlesKey);this.dataModel=_fb9;this.onDataModelChange();this.ownByKey(this._dataModelHandlesKey,this.dataModel.watch("status",this.onDataModelChange.bind(this)),this.dataModel.watch("contentData",this.onDataModelChange.bind(this)));},onDataModelChange:function(name,_fba,_fbb){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dijit/Destroyable","dojox/html/entities","epi","epi/datetime","epi/dependency","epi/Url","epi/string","epi/username","epi-cms/content-approval/ApprovalEnums","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_fbc,lang,when,_fbd,_fbe,_fbf,epi,_fc0,_fc1,Url,_fc2,_fc3,_fc4,_fc5,_fc6,_fc7,_fc8,_fc9,res){return _fbc([_fc7,_fc8,_fc9,_fbe],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,bottomInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.projectService=this.projectService||_fc1.resolve("epi.cms.ProjectService");this.approvalService=this.approvalService||_fc1.resolve("epi.cms.ApprovalService");this.contentActionSupport=this.contentActionSupport||_fc5;this.initializeCommandProviders();},onDataModelChange:function(name,_fca,_fcb){var _fcc=this.dataModel.contentData,_fcd=(_fcc.publishedBy!==null&&_fcc.publishedBy!==undefined);this._updateCommands();this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_fcc));this.set("bottomInfoSectionVisible",this._getBottomInfoSectionVisible());this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_fcc));this.set("lastPublishedTitle",this._getLastPublishedTitle(_fcc));this.set("lastPublishedTitleVisible",_fcd);this.set("lastPublishedText",this._getLastPublishedText(_fcc));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_fcc,_fcd));this.set("lastPublishedViewLinkHref",this._getLastPublishedHref(_fcc));this.set("typeIdentifier",_fcc.typeIdentifier);this._setAdditionalInfo(_fcc);if(this._shouldShowApprovalInfo()){this._setApprovalInfo(_fcc);}else{this._setLastChangeStatus(_fcc);}},onCommandsChanged:function(name,_fce,_fcf){if(_fce){_fce.forEach(function(_fd0){this.destroyByKey(_fd0);},this);}_fcf.forEach(function(_fd1){if(_fd1.options&&_fd1.options.isMain){this.ownByKey(_fd1,_fd1.watch("canExecute",function(){this._calculateMainButtonCommand();}.bind(this)));}},this);},_dataModelSetter:function(_fd2){this.updateCommandModel(_fd2);this.inherited(arguments);},_shouldShowApprovalInfo:function(){var _fd3=this.dataModel.contentData.status===_fc5.versionStatus.AwaitingApproval;var _fd4=this.dataModel.languageContext&&this.dataModel.languageContext.isTranslationNeeded;return _fd3&&!_fd4;},_isOpenSetter:function(_fd5){this.isOpen=_fd5;if(_fd5){var _fd6=this.dataModel.contentData;if(this._shouldShowApprovalInfo()){this._setApprovalInfo(_fd6);}else{this._setLastChangeStatus(_fd6);}}},_setApprovalInfo:function(_fd7){return this.approvalService.getApproval(_fd7.contentLink).then(lang.hitch(this,function(_fd8){if(!_fd8){if(this.dataModel.contentData.status===_fc5.versionStatus.AwaitingApproval){this._setAbortInfo(_fd7);}return null;}var _fd9=lang.replace(this.res.approvalinfo.timepassed,{timepassed:_fc0.timePassed(new Date(_fd8.startDate))});var _fda=" <br /> "+lang.replace(this.res.approvalinfo.stepinfo,{activeStepIndex:_fd8.activeStepIndex+1,totalsteps:_fd8.totalSteps});var _fdb=_fd9+(_fd8.status===_fc4.status.inReview?_fda:"");this.set("topInfoSectionVisible",true);this.set("lastChangeStatus",_fdb);var _fdc=lang.replace(this.res.approvalinfo.requestedby,{username:this._getFriendlyUsername(_fd8.startedBy,true),time:_fc0.toUserFriendlyHtml(_fd8.startDate)});this.set("publishInfoSectionVisible",true);this.set("lastPublishedText",_fdc);this.set("lastPublishedTitleVisible",false);this.set("lastPublishedViewLinkVisible",false);return _fd8;})).otherwise(function(){return null;});},_setAbortInfo:function(_fdd){this.set("topInfoSectionVisible",true);this._setLastChangeStatus(_fdd);this.set("publishInfoSectionVisible",true);this.set("lastPublishedText",this.res.approvalinfo.approvalmissing);this.set("lastPublishedTitleVisible",false);this.set("lastPublishedViewLinkVisible",false);},_updateCommands:function(){this._calculateMainButtonCommand();this.set("commands",this.getCommands());},_calculateMainButtonCommand:function(){var _fde=this.getCommands(),_fdf=null;_fde.forEach(function(_fe0){if(_fe0.canExecute&&_fe0.options&&_fe0.options.isMain&&_fe0.options.priority&&(!_fdf||_fdf.options.priority<_fe0.options.priority)){_fdf=_fe0;}});this.set("mainButtonCommand",_fdf);this.set("mainButtonSectionVisible",_fdf!==null);},_getBottomInfoSectionVisible:function(){return this.getCommands().some(function(_fe1){return _fe1.isAvailable&&_fe1!==this.mainButtonCommand;}.bind(this));},_getTopInfoSectionVisible:function(_fe2){return this.mainButtonCommand||!((_fe2.status===_fc5.versionStatus.Published||_fe2.status===_fc5.versionStatus.Expired)&&!_fe2.isCommonDraft);},_getPublishInfoSectionVisible:function(_fe3){var _fe4=this.inUseNotificationManager.hasInUseNotificationWarning(_fe3.inUseNotifications),_fe5=this._isOriginallyEditable();return !(_fe4&&_fe5);},_getLastPublishedViewLinkVisible:function(_fe6,_fe7){return _fe7&&!!_fe6.publicUrl;},_setLastChangeStatus:function(_fe8){var _fe9,_fea,self=this;var _feb=this.dataModel.get("lastSaved");_fea=_fe9=this._getTemplatedText(this.res.lastchangestatus,_fe8.changedBy,_feb);if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _fec=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;_fea=_fec;}if(_fe8.missingLanguageBranch&&_fe8.missingLanguageBranch.isTranslationNeeded){_fea=lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_fe8.missingLanguageBranch.languageId],languageId:_fe8.missingLanguageBranch.languageId});}if(_fe8.status===_fc5.versionStatus.Published||_fe8.status===_fc5.versionStatus.Expired){_fea=this.res.notmodifiedsincelastpublish;}if(_fe8.status===_fc5.versionStatus.PreviouslyPublished){_fea=this._getTemplatedText(this.res.previouslypublished,_fe8.versionCreatedBy,_fe8.versionCreatedTime);}if(_fe8.status===_fc5.versionStatus.Rejected){_fea=this._getTemplatedText(this.res.rejectedapproval,_fe8.versionCreatedBy,_fe8.versionCreatedTime);}if(_fe8.status===_fc5.versionStatus.DelayedPublish){_fea=this.projectService.getProjectsForContent(_fe8.contentLink).then(function(_fed){_fed=_fed.filter(function(_fee){return _fee.status==="delayedpublished";});if(_fed.length){return lang.replace(self.res.projectdelayedpublish,{date:_fc0.toUserFriendlyHtml(_fe8.properties.iversionable_startpublish),project:_fbf.encode(_fed[0].name)});}return _fe9;});}when(_fea,lang.hitch(this,"set","lastChangeStatus"));},_getLastPublishedTitle:function(_fef){return _fef.status===_fc5.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_ff0){return (_ff0.publishedBy===null||_ff0.publishedBy===undefined)?this.res.notpublishedbefore:this._getTemplatedText(this.res.publishedtime,_ff0.publishedBy,_ff0.lastPublished,true);},_getLastPublishedHref:function(_ff1){if(!_ff1.publicUrl){return null;}var url=new Url(_ff1.publicUrl);if(_ff1.properties.pageShortcutType===_fc6.pageShortcutTypes.Shortcut){url.query.id=new Date().valueOf();}return url.toString();},_setAdditionalInfo:function(_ff2){var _ff3=this.inUseNotificationManager.hasInUseNotificationWarning(_ff2.inUseNotifications),_ff4=this._isOriginallyEditable(),_ff5=_ff3&&_ff4;this.set("additionalInfoSectionVisible",_ff5);if(_ff5){var _ff6=this.inUseNotificationManager.getOtherUsersInUseNotifications(_ff2.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_ff6.join(",")));}},_isOriginallyEditable:function(){var _ff7=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _ff8=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_ff7;return _ff8;},_getFriendlyUsername:function(name,_ff9){return _fc3.toUserFriendlyHtml(name,null,_ff9);},_getTemplatedText:function(_ffa,_ffb,_ffc,_ffd){var date=new Date(_ffc);return lang.replace(_ffa,{username:this._getFriendlyUsername(_ffb,_ffd),time:_fc0.toUserFriendlyHtml(date),timepassed:_fc0.timePassed(date)});},_canTransitionTo:function(_ffe,_fff){return _ffe.transitions.some(function(item){return item.name===_fff;});}});});},"epi-cms/content-approval/ApprovalEnums":function(){define({definitionStatus:{enabled:0,disabled:1,inherited:2},reviewerType:{user:0,role:1},status:{inReview:0,approved:1,rejected:2}});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){return {pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(array,_1000,lang,_1001,_1002){return _1000([_1001],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_1002.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);array.forEach(this.commandProviders.providers,function(_1003){this._consumer.addProvider(_1003);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(model){this._currentCommandModel=model;array.forEach(this.commandProviders.providers,function(_1004){if(_1004.updateCommandModel){_1004.updateCommandModel(model);}},this);},onProvidersChanged:function(name,_1005,added){if(_1005){array.forEach(_1005,this._consumer.removeProvider,this._consumer);}if(added){array.forEach(added,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){array.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/plugin-area/edit-view-filters","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ChangeView"],function(_1006,lang,all,when,_1007,_1008,_1009,_100a,_100b,_100c,_100d){return _1006([_100a],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,constructor:function(){this.viewConfigurations={};},buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(_100e,_100f){var _1010=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1011=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ChangeView"},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];_1010=_100e?_100e.concat(_1010):_1010;_1011=_100f?_100f.concat(_1011):_1011;return this.add(_1010).then(lang.hitch(this,function(){return this.add(_1011);}));},updateChildren:function(){var _1012=this.currentContext,_1013=_1012&&_1012.id;this.setItemProperty("breadcrumbs","contentLink",_1013);this.setItemProperty("viewselect","currentContext",this.currentContext);this.setItemProperty("viewselect","viewName",this.viewConfigurations.viewName);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_1012){this.setItemProperty("currentcontent","currentItemInfo",{name:_1012.name,dataType:_1012.dataType});}},update:function(data){if(!data){return;}var _1014=data.viewConfigurations;_100b.get().forEach(function(_1015){_1014=_1015(_1014,data.contentData,data.currentContext);},this);this.currentContext=data.currentContext;this.viewConfigurations=_1014;when(this.isSetup(),lang.hitch(this,this.updateChildren));}});});},"epi-cms/plugin-area/edit-view-filters":function(){define(["epi/PluginArea"],function(_1016){var _1017=new _1016("epi-cms/edit-view/filters[]");return _1017;});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_1018,_1019,_101a,topic,_101b,_101c,_101d,_101e,_101f,_1020){return _1018([_101d,_101c],{templateString:_1020,_currentIconClass:null,_setCurrentItemInfoAttr:function(value){if(!value){return;}this.heading.innerHTML=_101e.encodeForWebString(value.name);if(value.dataType){var _1021=_101f.getValue(value.dataType,"iconClass");if(_1021&&_1021!==this._currentIconClass){_1019.remove(this.iconNode,this._currentIconClass);_1019.add(this.iconNode,_1021);this._currentIconClass=_1021;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\r\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\r\n</div>","epi-cms/widget/ChangeView":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/ViewSwitchButton","epi-cms/widget/ViewSelectorDropDownButton","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_1022,array,_1023,_1024,_1025,_1026,_1027,_1028,_1029,res){return _1022([_1025,_1026,_1027],{templateString:"<div class=\"dijitInline epi-trailingContainer\"></div>",buildRendering:function(){this.inherited(arguments);this._createViewSelector();this._createSwitchButton();},_createViewSelector:function(){this._viewSelectorDropDownButton=new _1029({showLabel:false,"class":"epi-mediumButton"});this._viewSelectorDropDownButton.placeAt(this.domNode);},_createSwitchButton:function(){this._viewSwitchButton=new _1028({firstButtonSettings:{title:res.onpageedit.title,label:res.onpageedit.label,iconClass:"epi-iconLayout",showLabel:false},secondButtonSettings:{title:res.formedit.title,label:res.formedit.label,iconClass:"epi-iconForms",showLabel:false}});this._viewSwitchButton.placeAt(this.domNode);},_setStateAttr:function(value){this.inherited(arguments);this._viewSwitchButton.set("state",value);},_setViewNameAttr:function(_102a){var _102b=_102a==="onpageedit"||_102a==="sidebysidecompare"||_102a==="view"||_102a==="allpropertiescompare";this._viewSwitchButton.set("isFirstButtonActive",_102b);},_setCurrentContextAttr:function(_102c){this._currentContext=_102c;},_setViewConfigurationsAttr:function(_102d){this._viewSelectorDropDownButton.set("viewConfigurations",_102d);var _102e=this._hasCustomViews(_102d.availableViews);var _102f=this._hasBuiltInViews(_102d.availableViews);this._setVisibility(this._viewSwitchButton,!_102e&&_102f&&this._currentContext.hasTemplate);this._setVisibility(this._viewSelectorDropDownButton,_102e);},_hasCustomViews:function(_1030){return array.filter(_1030,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_1031){return array.filter(_1031,function(view){return view.key==="onpageedit"||view.key==="formedit";}).length===2;},_setVisibility:function(_1032,_1033){_1024.set(_1032.domNode,{display:(_1033?"":"none")});_1032.set("itemVisibility",_1033);}});});},"epi-cms/widget/ViewSwitchButton":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/topic","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_CssStateMixin","dijit/form/Button"],function(_1034,_1035,topic,_1036,_1037,_1038,_1039,_103a){return _1034([_1036,_1037,_1038,_1039],{baseClass:"epi-viewSwitchButton",templateString:"<span data-dojo-attach-point=\"stateNode\" class=\"epi-groupedButtonContainer\"></span>",_state:"",buildRendering:function(){this.inherited(arguments);this._firstButton=this._createButton();this._secondButton=this._createButton();this.set("isFirstButtonActive",true);},_createButton:function(value){var _103b=new _103a({showLabel:false,onClick:function(){if(_1035.contains(this.domNode,"loading")){return;}_1035.toggle(this.domNode,"loading",true);setTimeout(function(){topic.publish("/epi/cms/action/switcheditmode",null,null,true);},0);}});_103b.placeAt(this.domNode);return _103b;},_setFirstButtonSettingsAttr:function(value){this._firstButton.set(value);},_setSecondButtonSettingsAttr:function(value){this._secondButton.set(value);},_setIsFirstButtonActiveAttr:function(value){this._firstButton.set("disabled",value);this._secondButton.set("disabled",!value);_1035.toggle(this._firstButton.domNode,"epi-button--pressed",value);_1035.toggle(this._secondButton.domNode,"epi-button--pressed",!value);_1035.toggle(this._firstButton.iconNode,"epi-icon--active",value);_1035.toggle(this._secondButton.iconNode,"epi-icon--active",!value);},_setStateAttr:function(value){this.inherited(arguments);if(value===""){_1035.toggle(this._firstButton.domNode,"loading",false);_1035.toggle(this._secondButton.domNode,"loading",false);}},_getStateAttr:function(){return this._state;}});});},"epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(array,_103c,lang,_103d,_103e,_103f){return _103c([_103d],{buildRendering:function(){this.inherited(arguments);this.set("title",_103f.title);this.own(this.dropDown=new _103e());},_setViewConfigurationsAttr:function(value){if(!value){return;}array.some(value.availableViews,lang.hitch(this,function(view){if(view.key===value.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",value);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(array,_1040,lang,topic,when,_1041,_1042,_1043,_1044){return _1040([_1043],{viewConfigurations:null,headingText:_1042.title,_setViewConfigurationsAttr:function(value){this._set("viewConfigurations",value);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}this.getChildren().forEach(function(item){this.removeChild(item);item.destroyRecursive();},this);var _1045=this.viewConfigurations.viewName,_1046=this.viewConfigurations.availableViews;var _1047="";array.forEach(_1046,function(view){if(view.hideFromViewMenu){return;}var _1048=view.category||"";if(_1048!==_1047){this.addChild(new _1041({baseClass:"epi-menuSeparator"}));}_1047=_1048;var item=new _1044({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_1045});item.own(item.on("click",function(){this.onExecute();item.set("checked",!item.checked);if(_1045==="view"){topic.publish("/epi/cms/action/disablepreview");}topic.publish("/epi/shell/action/changeview",view.key,null,null,true);}.bind(this)));this.addChild(item);},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_1049,keys,_104a,_104b){return _1049([_104a],{templateString:_104b,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-menu--inverted\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span>${headingText}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\r\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_104c,_104d,_104e){return _104c(_104d,{templateString:_104e});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(array,_104f,event,lang,_1050,keys,_1051,_1052,_1053,_1054,_1055,_1056,_1057,_1058,_1059,_105a){return _104f([_1051,_1052,_1053],{res:_105a,templateString:_1059,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_1056.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _1058({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this.own(this._tooltipDialog);this._buildIconBlock();_1050.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));},update:function(_105b){this._hideTooltip();this.messageContext=_105b;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_105c){var query=(_105c)?lang.mixin({typeName:_105c},this.messageContext):this.messageContext;return this.messageService.query(query);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_105d,items){if(items&&items.length>0){array.forEach(items,function(item){zone.addRow(lang.replace(_105d,{message:_1055.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _105e=this.getMessages("error");var _105f=this.getMessages("warn");var _1060=this.getMessages("info");this._totalNotifications=_105e.length+_105f.length+_1060.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_105e);this._updateNotificationZone(this.warningZone,this._itemTemplate,_105f);this._updateNotificationZone(this.infoZone,this._itemTemplate,_1060);this._updateIconStatus(_105e.length,_105f.length,_1060.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_1050.add(this.domNode,this._dimmedOutCssClass);_1050.remove(this.domNode,this._notificationNoteClass);_1050.remove(this.domNode,this._notificationWarningClass);_1050.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_1050.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_1061,_1062,_1063){if(_1061){_1050.add(this.domNode,this._notificationErrorClass);_1050.remove(this.domNode,this._notificationNoteClass);_1050.remove(this.domNode,this._notificationWarningClass);}else{if(_1062){_1050.add(this.domNode,this._notificationWarningClass);_1050.remove(this.domNode,this._notificationNoteClass);}else{if(_1063){_1050.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(value){this._set("notificationContext",value);this.update(value);},_show:function(e){if(e){event.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_1064,_1065,_1066){return _1064([_1065,_1066],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_1067,_1068){dojo.place(_1067,this.contentContainer,_1068);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_1069,dijit,_106a,_106b,_106c,_106d){return dojo.declare([_106a],{templateString:_106d,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_1069.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_106e,_106f){dijit.popup.open({popup:this,around:_106e,orient:_106f});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){dijit.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_1069.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner==="MR"||this._pos.aroundCorner==="ML"){var _1070=_1069.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_1070));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_1071){if(!_1071){return 0;}if(_1071==="right"||_1071==="left"){var _1072=dojo.style(this.connectorNode,_1071);if(!_1072){return 0;}var _1073=/(px|em|%)/ig;return _1069.parse(_1072)||_1069.parse(_1072.replace(_1073,""));}return 0;},_getNumberInPx:function(_1074){return _1074+"px";},_getCenterHorizontalAroundNode:function(){return _1069.round((_1069.parse(this.connectorNode.clientWidth)-_1069.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\r\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\r\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\r\n    </div>\r\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\r\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\r\n    <div class=\"epi-dijitTooltipTitleBar\">\r\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\r\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\r\n    </div>\r\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\r\n        <div data-dojo-attach-point=\"zoneContainer\">\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_1075,lang,_1076,_1077,_1078,_1079,_107a,_107b,_107c,_107d,epi,_107e,_107f,_1080,_1081,res,_1082){return _1075([_107b,_107a,_107c,_1079,_1080],{templateString:_1082,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{state:["state"],statusText:["statusText"],visible:["visible"],buttonText:["buttonText"],nonEditableIndicator:["nonEditableIndicator"],statusIcon:["statusIcon"],publishMenuViewModel:["publishMenuViewModel"],additionalClass:["additionalClass"],expanded:["expanded"]},_setStatusTextAttr:function(_1083){this._set("statusText",_1083);this._setStatusNodeText(_1083);},_setStatusNodeText:function(_1084){this.statusTextNode.innerHTML=_1084;_1076.set(this.stateNode,"visibility",_1084?"visible":"hidden");_1078.set(this.stateNode,"title",_1081.stripHtmlTags(_1084));},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_1076.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_1085){this._set("expanded",_1085);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_1077.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_1077.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){if(this.get("statusIcon")){_1077.remove(this.statusTextIcon,this.get("statusIcon"));}this._set("statusIcon",val);_1077.add(this.statusTextIcon,val);},_setAdditionalClassAttr:function(val){var _1086=this.get("additionalClass");if(_1086){_1077.remove(this.stateNode,_1086);}this._set("additionalClass",val);_1077.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},toggleDropDownMenu:function(val){_1076.set(this.dropDownMenu.domNode,"display",val?"":"none");this.dropDownButton.set("disabled",!val);},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(array,_1087,event,lang,_1088,_1089,_108a,_108b,html,on,sniff,_108c,when,_108d,_108e,_108f,epi,_1090,_1091,_1092,_1093,_1094,_1095,res){return _1087([_108d,_108f,_1091],{templateString:_1095,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _1092();},modelBindingMap:{commands:["commands"],mainButtonCommand:["mainButtonCommand"],mainButtonSectionVisible:["mainButtonSectionVisible"],lastChangeStatus:["lastChangeStatus"],topInfoSectionVisible:["topInfoSectionVisible"],publishInfoSectionVisible:["publishInfoSectionVisible"],lastPublishedTitle:["lastPublishedTitle"],lastPublishedTitleVisible:["lastPublishedTitleVisible"],lastPublishedText:["lastPublishedText"],lastPublishedViewLinkVisible:["lastPublishedViewLinkVisible"],lastPublishedViewLinkHref:["lastPublishedViewLinkHref"],additionalInfoSectionVisible:["additionalInfoSectionVisible"],additionalInfoText:["additionalInfoText"],typeIdentifier:["typeIdentifier"],bottomInfoSectionVisible:["bottomInfoSectionVisible"]},_setCommandsAttr:function(_1096){this.focusedChild=null;this.destroyDescendants();this._addCommandsToMenu(_1096);this.focusFirstChild();},_setMainButtonCommandAttr:function(_1097){this._set("mainButtonCommand",_1097);if(_1097){this.mainButton.set("label",_1097.label);this.mainButton.set("disabled",!_1097.get("canExecute"));_108a.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_108a.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_1097.options&&_1097.options.mainButtonClass){this._addedMainButtonClass=_1097.options.mainButtonClass;_108a.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_1098){_1088.set(this.mainButtonSection,"display",_1098?"":"none");_1088.set(this.mainButton.domNode,"display",_1098?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_1099){_1088.set(this.topInfoSection,"display",_1099?"":"none");},_setBottomInfoSectionVisibleAttr:function(_109a){_1088.set(this.bottomInfoSection,"display",_109a?"":"none");},_setPublishInfoSectionVisibleAttr:function(_109b){_1088.set(this.publishInfoSection,"display",_109b?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_109c){_1088.set(this.lastPublishedTitleNode,"display",_109c?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_109d){_1088.set(this.lastPublishedViewLinkNode,"display",_109d?"":"none");},_setLastPublishedViewLinkHrefAttr:function(value){_1089.set(this.lastPublishedViewLinkNode,"href",value);},_setAdditionalInfoSectionVisibleAttr:function(_109e){_1088.set(this.additionalInfoSection,"display",_109e?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_109f){var _10a0=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_10a1=_10a0&&_10a0.downloadUrl,_10a2=_109f&&_1090.getValue(_109f,"actAsAnAsset");if(!_10a2||!_10a1){_1089.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_1089.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){event.stop(e);var _10a3=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_10a3&&_10a3.downloadUrl,name=_10a3.name;_1093.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_10a4,added){if(_10a4){this._removeCommandsFromMenu(lang.isArray(_10a4)?_10a4:[_10a4]);}if(added){this._addCommandsToMenu(lang.isArray(added)?added:[added]);}},_addCommandsToMenu:function(_10a5){array.forEach(_10a5,function(_10a6){if(_10a6!==this.model.mainButtonCommand){this._menuBuilder.create(_10a6,this);}},this);},_removeCommandsFromMenu:function(_10a7){var _10a8=this.getChildren();array.forEach(_10a7,function(_10a9){for(var i=_10a8.length-1;i>=0;i--){var item=_10a8[i];if(item._command===_10a9){this.removeChild(item);item.destroyRecursive();break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_108a.add(this.mainButton.domNode,"epi-loading");var _10aa=this.mainButtonCommand,_10ab=lang.hitch(this,function(){if(_10aa.options&&_10aa.options.resetLabelAfterExecution){this.mainButton.set("label",_10aa.label);}_108a.remove(this.mainButton.domNode,"epi-loading");if(_10aa.options&&!_10aa.options.keepMenuOpen){this.onExecute();}}),_10ac=lang.hitch(this,function(){this.model.set("lastExecutedCommand",_10aa);});when(this.mainButtonCommand.execute(),function(){return when(_10ab(),_10ac);},function(){return _10ab();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _10ad=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_10ad){this.focusedChild._setSelected(false);return _1088.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _10ae=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _1088.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_10ae){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_10af){var _10b0=_108b.getMarginBox(this.domNode),_10b1=_108b.getPadExtents(this.topInfoSection),_10b2=_108b.getMarginBox(this.mainButton.containerNode),_10b3=_108b.getMarginBox(this.containerNode);var _10b4=Math.max(_10b2.w+_10b1.l+_10b1.r,_10b0.w);_10b4=Math.max(_10b3.w,_10b4);_10af.w=_10b4;_108b.setMarginBox(this.domNode,_10af);}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_10b5){return {_classicalDownload:function(url,name){var _10b6=document.getElementsByTagName("body")[0],_10b7={href:url,download:name,target:"_blank",style:{display:"none;"}},_10b8=_10b5.create("a",_10b7,_10b6,"last");_10b8.click();_10b5.destroy(_10b8);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\"\r\n                        data-dojo-attach-point=\"mainButton\"\r\n                        data-dojo-attach-event=\"onClick: _onMainButtonClick\"\r\n                        class=\"epi-button--full-width\"></button>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" data-dojo-attach-point=\"bottomInfoSection\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\r\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\r\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\r\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\r\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\r\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\r\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line. -->\r\n    </div>\r\n\r\n\r\n\r\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\r\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-button--bold'\">\r\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_10b9,lang,_10ba,_10bb,_10bc,array,on,_10bd,_10be,_10bf,_10c0,_10c1,_10c2,_10c3,_10c4,_10c5){var _10c6=_10b9([_10be,_10bd,_10c0,_10c1],{templateString:_10c5,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_10bc.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){array.forEach(this.item.commands,lang.hitch(this,function(_10c7){this._addButtonForCommand(_10c7);}));}},_addButtonForCommand:function(_10c8){var _10c9=new _10c2({label:_10c8.label,title:_10c8.tooltip,iconClass:_10c8.iconClass});if(_10c8.cssClass){_10ba.add(_10c9.domNode,_10c8.cssClass);}_10c9.set("disabled",!_10c8.canExecute);_10c9.on("click",function(){_10c8.execute();});this.own(_10c8.watch("canExecute",lang.hitch(this,function(){_10c9.set("disabled",!_10c8.canExecute);})));if(_10c8.category==="leftAligned"){_10c9.placeAt(this.contentContainer,"first");}else{_10c9.placeAt(this.buttonContainer,"first");}this.own(_10c9);}});var _10ca=_10b9([_10be,_10bf,_10bd,_10c0,_10c1],{templateString:_10c4,noBorderClass:"epi-notificationBarWithoutBorder",buildRendering:function(){this.inherited(arguments);this._hideIfEmpty();},clear:function(){this._hideIfEmpty();array.forEach(this.getChildren(),function(_10cb){this.removeChild(_10cb);_10cb.destroy();_10cb=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_10cc,_10cd){var _10ce=new _10c6({item:_10cc});this.own(on(_10ce,"close",lang.hitch(this,"_onCloseNotification")));this.addChild(_10ce,_10cd);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_10cf){array.forEach(this.getChildren(),lang.hitch(this,function(_10d0){if(_10d0.item&&_10d0.item===_10cf){this._onCloseNotification(_10d0);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_10ba.toggle(this.domNode,this.noBorderClass,!show);_10bb.set(this.domNode,"display",show?"":"none");}});return _10ca;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\r\n    <div data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\r\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\r\n        <p data-dojo-attach-point=\"textContainer\"></p>\r\n    </div>\r\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\r\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\r\n    </div>\r\n</div>","epi-cms/activity/ActivityFeed":function(){define(["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","epi/debounce","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","epi-cms/activity/Activity","epi-cms/activity/ActivityCommentForm"],function(_10d1,_10d2,_10d3,_10d4,_10d5,_10d6,_10d7,_10d8,_10d9,_10da,_10db,_10dc,_10dd,_10de,_10df,_10e0,_10e1,_10e2){var _10e3=_10d1([_10de,_10df,_10e0]);return _10d1([_10da,_10db,_10dc,_10dd],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _10e2({model:this.model});_10d3.add(this.commentForm.domNode,"epi-card");this.list=new _10e3({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_10d2.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_10d6.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_renderRow:function(value){var _10e4=new _10e1({activity:value});_10d3.add(_10e4.domNode,"epi-card");return _10e4.domNode;},_resizeList:function(_10e5){return function(){_10e5.apply(this.list,arguments);var _10e6=this.model.isSingleItemSelected?_10d4.getMarginBox(this.commentForm.domNode).h:0;_10d5.set(this.list.contentNode,"height","calc(100% - "+_10e6+"px)");}.bind(this);},_setNoDataMessageAttr:function(_10e7){this.noDataMessage=_10e7;this.list.set("noDataMessage",_10e7);},_setQueryAttr:function(query){this._set("query",query);if(!this._queryFunction){this._queryFunction=_10d8(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,query);},_setQueryCallback:function(store,query){if(this._destroyed){return;}var _10e8=this.model.isSingleItemSelected;_10d3.toggle(this.domNode,"epi-activity-feed--single-item",_10e8);_10d3.toggle(this.commentForm.domNode,"dijitHidden",!_10e8);if(query){this.list.set("store",store,query,this.queryOptions);}else{this.list.set("store",null);}this.list.resize();}});});},"epi/shell/dgrid/WidgetRow":function(){define("epi/shell/dgrid/WidgetRow",["dojo/_base/declare","dijit/registry"],function(_10e9,_10ea){return _10e9(null,{insertRow:function(){var row=this.inherited(arguments),_10eb=_10ea.byNode(row);_10eb.startup();return row;},removeRow:function(_10ec,_10ed){this.inherited(arguments);var _10ee=_10ec.element||_10ec,_10ef=_10ea.byNode(_10ee);if(_10ef){_10ef.destroyRecursive(_10ed);}}});});},"epi-cms/activity/Activity":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","./ActivityComment","./viewmodels/ActivityViewModel","./viewmodels/ActivityCommentViewModel","./viewmodels/MessageActivityViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/Activity.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/activity/ActivityCommentForm"],function(_10f0,lang,_10f1,_10f2,_10f3,_10f4,_10f5,_10f6,_10f7,_10f8,_10f9,_10fa,_10fb){return _10f0([_10f6,_10f7,_10f8,_10f9],{templateString:_10fa,model:null,modelBindingMap:{upsertActivityComment:["upsertActivityComment"]},buildRendering:function(){this.inherited(arguments);var _10fc=this.activity;var model=new _10f3({activity:_10fc});this.set("model",model);this.own(this.model);this.commentForm.set("model",model);this.titleNode.textContent=model.get("title");_10f1.add(this.iconNode,model.get("iconClass"));_10f1.add(this.actionIconNode,model.get("actionIconClass"));_10f1.add(this.actionNode,model.get("actionClass"));this.actionTextNode.textContent=model.get("content");if(_10fc.message){_10f1.add(this.domNode,"epi-activity__message");this.own(this._messageForm=new _10f2({model:new _10f5(_10fc)},this.messageNode));}var _10fd=model.getComment();if(_10fd){this.activityCommentNode.innerHTML=_10fd;}else{_10f1.add(this.activityCommentNode,"dijitHidden");}if(_10fc.comments){_10fc.comments.forEach(function(_10fe){this.set("upsertActivityComment",_10fe);},this);}},startup:function(){this.inherited(arguments);this._messageForm&&this._messageForm.startup();},_getActivityCommentComponent:function(_10ff){var index=-1;var _1100=null;var _1101=this.getChildren()||[];for(var i=0;i<_1101.length;i++){index=i;var _1102=_1101[i];if(_1102.get("model").id===_10ff){_1100=_1102;break;}}return {position:(_1100!==null?index:-1),activityComment:_1100};},_setUpsertActivityCommentAttr:function(_1103){if(!_1103){return;}var _1104=this._getActivityCommentComponent(_1103.id);var _1105=_1104.activityComment;var _1106=(_1104.position===-1?this.getChildren().length:_1104.position);if(_1105){var _1107=new Date(_1105.get("model").lastUpdated).getTime();var _1108=new Date(_1103.lastUpdated).getTime();if(_1107===_1108){return;}this.removeChild(_1105);_1105.destroyRecursive();}var _1109=new _10f2({model:new _10f4(_1103)});this.addChild(_1109,_1106);}});});},"epi-cms/activity/ActivityComment":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityComment.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message","./ActivityCommentForm","dijit/form/Button"],function(_110a,lang,_110b,_110c,_110d,_110e,_110f,_1110,_1111,_1112,_1113){return _110a([_110e,_110f,_1110,_1111],{templateString:_1112,modelBindingMap:{hasChanged:["hasChanged"]},_setHasChangedAttr:function(_1114){this._set("hasChanged",_1114);var _1115=lang.replace(_1113.editedformat,{updated:_110c.toUserFriendlyString(this.model.lastUpdated)});this.editedIconNode.title=_1115;_110b.toggle(this.editedIconNode,"dijitHidden",!_1114);},buildRendering:function(){this.inherited(arguments);var user=this.model.changedBy||this.model.author;this.usernameNode.textContent=_110d.toUserFriendlyString(user,null,false,false,true);this.timestampNode.textContent=_110c.toUserFriendlyString(this.model.created);}});});},"url:epi-cms/activity/templates/ActivityComment.html":"<div class=\"epi-activity-comment\">\r\n    <header>\r\n        <span class=\"dijitReset dijitInline epi-username\" data-dojo-attach-point=\"usernameNode\"></span>\r\n        <span class=\"dijitReset dijitInline epi-event__timestamp\" data-dojo-attach-point=\"timestampNode\"></span>\r\n        <span class=\"dijitReset dijitInline epi-iconEdited\" data-dojo-attach-point=\"editedIconNode\"></span>\r\n    </header>\r\n    <div data-dojo-type=\"epi-cms/activity/ActivityCommentForm\"\r\n         data-dojo-props=\"model: this.model\"\r\n         data-dojo-attach-point=\"commentForm\"></div>\r\n</div>\r\n","epi-cms/activity/ActivityCommentForm":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_FocusMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityCommentForm.html","epi/shell/widget/AutoCompleteTextarea","dijit/form/Button"],function(_1116,_1117,_1118,_1119,_111a,_111b,_111c,_111d){return _1116([_1118,_1119,_111a,_111b,_111c],{templateString:_111d,readOnly:null,hideOnPost:null,isEditEnabled:true,errorMessage:"",modelBindingMap:{readOnly:["readOnly"],editLabel:["editLabel"],isEditEnabled:["isEditEnabled"],hideOnPost:["hideOnPost"],errorMessage:["errorMessage"],placeholderText:["placeholder"],sendLabel:["sendLabel"],resetLabel:["resetLabel"],message:["value"],formattedMessage:["displayValue"],noNotificationUserMessage:["noNotificationUserMessage"],notificationUserStore:["notificationUserStore"]},postCreate:function(){this.inherited(arguments);this._commentChanged(this.get("value"));this._commentTextarea.on("save",this._postComment.bind(this));},_setModelAttr:function(model){this.inherited(arguments);this._toggleFormsButtonVisibility(!model.readOnly&&this.get("value")!=="");},_setErrorMessageAttr:function(_111e){this._set("errorMessage",_111e);this._errorMessage.textContent=_111e;},_setSendLabelAttr:function(_111f){this._set("sendLabel",_111f);if(_111f){this._postButton.set("label",_111f);}},_setResetLabelAttr:function(_1120){this._set("resetLabel",_1120);if(_1120){this._resetButton.set("label",_1120);}},_setEditLabelAttr:function(_1121){this._set("editLabel",_1121);if(_1121){this._editButton.set("label",_1121);}},_setIsEditEnabledAttr:function(_1122){this._set("isEditEnabled",_1122);if(this._editButton){_1117.toggle(this._editButton.domNode,"dijitHidden",!this.isEditEnabled);}},_setNoNotificationUserMessageAttr:function(_1123){this._commentTextarea.set("noDataMessage",_1123);},_setNotificationUserStoreAttr:function(store){this._set("notificationUserStore",store);this._commentTextarea.set("store",store);},_setPlaceholderAttr:function(_1124){this._commentTextarea.set("placeholder",_1124);},_setReadOnlyAttr:function(_1125){this._set("readOnly",_1125);_1117.toggle(this._commentTextarea.domNode,"dijitHidden",this.readOnly);if(this.readOnly){this._toggleFormsButtonVisibility(false);}},_setValueAttr:function(value){this._set("value",value);this._commentTextarea.set("value",value);},_setDisplayValueAttr:function(_1126){_1126.then(function(value){this.commentNode.innerHTML=value;}.bind(this));},_getValueAttr:function(){return this._commentTextarea.get("value");},_commentChanged:function(_1127){this._started&&this._postButton.set("disabled",!_1127||_1127===this.model.message);},_commentFocused:function(){this._toggleFormsButtonVisibility(true);},_reset:function(){if(this._destroyed){return;}this.hideOnPost&&this._toggleWriteComment();this.model.set("errorMessage","");this._commentTextarea.reset();this._toggleFormsButtonVisibility(false);},_postComment:function(){var value=this._commentTextarea.get("value");if(value.trim().length===0){return;}if(value===this.model.message||this._postButton.get("disabled")){this._reset();return;}this._postButton.set("disabled",true);var delay=10;this.defer(function(){_1117.add(this._postButton.domNode,"epi-button--loading");}.bind(this),delay);this.model.save(value).then(this._reset.bind(this)).always(function(){if(!this._destroyed){this._postButton.set("disabled",false);_1117.remove(this._postButton.domNode,"epi-button--loading");}}.bind(this));},_toggleWriteComment:function(){_1117.toggle(this._commentTextarea.domNode,"dijitHidden");_1117.toggle(this._editButton.domNode,"dijitHidden");_1117.toggle(this.commentNode,"dijitHidden");if(this._commentTextarea.isFocusable()){this._commentTextarea.focus();this._commentTextarea.setCaretLast();}if(this._editButton.isFocusable()){this._editButton.focus();}},_toggleFormsButtonVisibility:function(_1128){_1117.toggle(this._commentFormButtons,"dijitHidden",!_1128);}});});},"url:epi-cms/activity/templates/ActivityCommentForm.html":"<div class=\"epi-activity-comment-form\">\r\n    <div class=\"epi-activity-comment__message\"\r\n         data-dojo-attach-point=\"commentNode\"></div>\r\n    <div data-dojo-attach-point=\"_commentTextarea, focusNode\"\r\n         data-dojo-attach-event=\"onChange:_commentChanged, onFocus: _commentFocused\"\r\n         data-dojo-props=\"intermediateChanges: true, searchProperty: 'name', tagProperty: 'name', displayProperty: 'displayName'\"\r\n         data-dojo-type=\"epi/shell/widget/AutoCompleteTextarea\" class=\"epi-autocomplete-textarea--chat-icon\"></div>\r\n    <div class=\"epi-activity-comment-form__buttons dijitHidden\"\r\n         data-dojo-attach-point=\"_commentFormButtons\">\r\n        <span class=\"epi-activity-feed__error-message\"\r\n              data-dojo-attach-point=\"_errorMessage\"></span>\r\n        <button data-dojo-type=\"dijit/form/Button\"\r\n                class=\"epi-primary\"\r\n                data-dojo-attach-event=\"onClick:_postComment\"\r\n                data-dojo-props=\"disabled: true\"\r\n                data-dojo-attach-point=\"_postButton\"></button>\r\n        <button data-dojo-type=\"dijit/form/Button\"\r\n                class=\"epi-chromeless epi-chromeless--text-only\"\r\n                data-dojo-attach-point=\"_resetButton\"\r\n                data-dojo-attach-event=\"onClick: _reset\"></button>\r\n    </div>\r\n    <button data-dojo-type=\"dijit/form/Button\"\r\n            class=\"epi-chromeless epi-chromeless--text-only epi-text--small\"\r\n            data-dojo-attach-point=\"_editButton\"\r\n            data-dojo-attach-event=\"onClick: _toggleWriteComment\"></button>\r\n</div>\r\n","epi/shell/widget/AutoCompleteTextarea":function(){define("epi/shell/widget/AutoCompleteTextarea",["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-style","dojo/dom-geometry","dijit/form/_FormValueWidget","dijit/_WidgetsInTemplateMixin","dijit/form/_TextBoxMixin","dgrid/OnDemandList","dgrid/Selection","epi/debounce","put-selector/put","dijit/popup","epi/shell/dgrid/selection/Extensions","dijit/form/Textarea"],function(_1129,lang,keys,_112a,_112b,_112c,_112d,_112e,_112f,_1130,_1131,put,popup,_1132){var _1133=_1129([_112f,_1130,_1132]);return _1129([_112c,_112d],{templateString:"<div><div data-dojo-type='dijit/form/Textarea' data-dojo-attach-point='_textArea, focusNode'></div><div data-dojo-attach-point='_listNode'></div></div>",baseClass:"epi-autocomplete-textarea",value:null,store:null,placeholder:"",searchProperty:"query",tagProperty:"",displayProperty:"",noDataMessage:"",_setIdAttr:"domNode",buildRendering:function(){this.inherited(arguments);var _1134=this._textArea;this.own(_1134.on("keyup",lang.hitch(this,"_onKeyUp")),_1134.on("keydown",lang.hitch(this,"_onKeyDown")),_1134.on("change",lang.hitch(this,"_handleOnChange")),this.on("blur",this._closePopup.bind(this)),this._selectList=new _1133({className:"epi-autocomplete-list",selectionMode:"single",renderRow:this._renderRow.bind(this)},this._listNode),this._selectList.on(".dgrid-row:click",this._insertSelection.bind(this)),this._selectList.on("dgrid-refresh-complete",lang.hitch(this._selectList,"moveSelectionDown")));popup.moveOffScreen(this._selectList);},startup:function(){this.inherited(arguments);this._selectList.startup();},focus:function(){if(this.isFocusable()){this.inherited(arguments);}},setCaretLast:function(){if(this._textArea.value){_112e.selectInputText(this._textArea.domNode,this._textArea.value.length);}},reset:function(){this._textArea.reset();},_setIntermediateChangesAttr:function(_1135){this._set("intermediateChanges",_1135);this._textArea.set("intermediateChanges",_1135);},_setNoDataMessageAttr:function(_1136){this._selectList.set("noDataMessage",_1136);},_setPlaceholderAttr:function(_1137){this._set("placeholder",_1137);this._textArea.set("placeholder",_1137);},_setValueAttr:function(value){this._set("value",value);this._textArea.set({value:value,_resetValue:value});},_getValueAttr:function(){return this._textArea.get("value");},_onKeyUp:function(e){if(!this.store){return;}var key=e.keyCode;switch(key){case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.HOME:case keys.END:case keys.UP_ARROW:case keys.DOWN_ARROW:case keys.CTRL:case keys.ALT:case keys.SHIFT:return;}var _1138=this._textArea.textbox,_1139=_1138.selectionStart,value=_1138.value;if(value[_1139-1]==="@"&&(_1139===1||/\s/.test(value[_1139-2]))){this._tagStart=_1139-1;this._openPopup();}if(this._isPopupOpen){var _113a=key===keys.ESCAPE,_113b=typeof this._tagStart=="number"&&value[this._tagStart]!=="@";if(_113a||_113b){this._closePopup();return;}if(key===keys.ENTER||key===keys.TAB){this._insertSelection();return;}this._tagEnd=_1139;var query=value.substring(this._tagStart+1,_1139);this._setQuery(query);}},_setQuery:function(query){query=(query||"").trim();if(!query){this._selectList.set("store",null);return;}if(!this._queryFunction){var _113c=function(query){this._selectList.set("store",this.store,query);};this._queryFunction=_1131(_113c.bind(this),null,200);}var _113d={};_113d[this.searchProperty]=query;this._queryFunction(_113d);},_onKeyDown:function(e){var _113e=this._selectList,key=e.keyCode;if(this._isPopupOpen){switch(key){case keys.UP_ARROW:e.preventDefault();_113e.moveSelectionUp();break;case keys.DOWN_ARROW:e.preventDefault();_113e.moveSelectionDown();break;case keys.ESCAPE:case keys.ENTER:case keys.TAB:e.preventDefault();break;}return;}if(key===keys.ENTER&&!e.shiftKey){this.emit("save");e.preventDefault();}},_insertSelection:function(){var _113f=this._textArea.textbox,_1140=this._selectList,_1141=this._tagEnd,value=_113f.value;var _1142=null;for(var id in _1140.selection){if(_1140.selection[id]){_1142=_1140.row(id).data;break;}}if(!_1142){this._closePopup();return;}var _1143=_1142[this.tagProperty];var _1144="";var _1145=0;(value.charAt(_1141)!==" "?_1144=" ":_1145=1);var _1146=value.slice(0,this._tagStart+1)+_1143+_1144;var _1147=_1146.length+_1145;_1146+=value.slice(_1141);_113f.value=_1146;_113f.setSelectionRange(_1147,_1147);this._closePopup();},_renderRow:function(item){return put("div",""+item[this.displayProperty]);},_openPopup:function(){var _1148=this._selectList,_1149=_112b.getContentBox(this.domNode),_114a=this._closePopup.bind(this);_112a.set(_1148.domNode,"width",_1149.w+"px");popup.open({parent:this,popup:_1148,around:this.domNode,onExecute:_114a,onCancel:_114a});this._isPopupOpen=true;},_closePopup:function(){this._isPopupOpen=false;this._tagStart=null;this._tagEnd=null;this._selectList.set("store",null);popup.close(this._selectList);}});});},"epi/shell/dgrid/selection/Extensions":function(){define("epi/shell/dgrid/selection/Extensions",["dojo/_base/declare","dojo/query","dojo/window"],function(_114b,query,win){return _114b([],{moveSelectionUp:function(){return this.moveSelection(true);},moveSelectionDown:function(){return this.moveSelection(false);},moveSelection:function(up){var _114c=this.getFirstSelectedRow();if(!_114c){return this._selectFirstRow();}this.clearSelection();_114c=up?this.up(_114c,1,true):this.down(_114c,1,true);this.select(_114c,1,true);win.scrollIntoView(_114c.element);return _114c;},hasSelection:function(){return Object.keys(this.selection).length>0;},getFirstSelectedRow:function(){if(!this.hasSelection()){return null;}var row=this.row(Object.keys(this.selection)[0]);if(row&&!row.data){return null;}return row;},_selectFirstRow:function(){var rows=query(".dgrid-row",this.domNode);if(rows.length===0){return null;}var _114d=this.row(rows[0]);if(!_114d){return null;}this.select(_114d,1,true);return _114d;}});});},"epi-cms/activity/viewmodels/ActivityViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/Destroyable","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.cms.activities.activity"],function(_114e,lang,_114f,_1150,_1151,_1152,_1153,_1154,_1155){return _114e([_1154,_114f],{id:null,hasMessage:false,title:null,content:null,comment:null,actionIconClass:null,actionClass:null,iconClass:null,_resources:_1155,postscript:function(){this.inherited(arguments);this.set({id:this.activity.id,hasMessage:!!this.activity.message,upsertActivityComment:null,comment:this.activity.comment,title:this.activity.name});this.own(this.activityService.on("activity-comment-updated",lang.hitch(this,this._activityCommentUpdated)));this.set("actionIconClass",lang.replace("epi-icon{actionIcon} epi-icon--{actionColor}",this.activity));this.set("actionClass",lang.replace("epi-event--{actionColor} epi-event--{actionColor}-{activityType}",this.activity));this.set("iconClass",_1152.getValue(this.activity.typeIdentifier,"iconClass")||"epi-iconProject");var _1156=this.activity;var _1157=_1156.delayPublishUntil?this._resources.delaypublishmessagetemplate:this._resources.messagetemplate;var _1158=lang.replace(_1157,{event:_1156.actionText,delaypublish:_1150.toUserFriendlyString(_1156.delayPublishUntil),user:_1151.toUserFriendlyString(_1156.changedBy),date:_1150.toUserFriendlyString(_1156.created)});this.set("content",_1158);},_editLabelGetter:function(){return this.hasMessage?this._resources.message.reply.label:this._resources.message.comment.label;},_save:function(_1159){return this.activityService.addComment(this.id,_1159);},_activityCommentUpdated:function(_115a){if(_115a&&_115a.activityId===this.id){this.set("upsertActivityComment",_115a);}},_titleSetter:function(title){var _115b=this.activity.language;if(_115b&&_115b!==_1153.currentContentLanguage){title=lang.replace("{0} ({1})",[title,_115b]);}this.title=title;}});});},"epi-cms/activity/viewmodels/ActivityCommentViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_115c,_115d,_115e){return _115c([_115d],{sendLabel:_115e.save,_save:function(_115f){var _1160=this.activityService.saveComment(this.id,_115f);_1160.then(this.set.bind(this));return _1160;}});});},"epi-cms/activity/viewmodels/MessageActivityViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1161,_1162,_1163){return _1161([_1162],{sendLabel:_1163.save,_save:function(_1164){return this.activityService.saveMessage(this.id,_1164);}});});},"url:epi-cms/activity/templates/Activity.html":"<div class=\"epi-event epi-activity\">\r\n    <div class=\"epi-event__title-wrapper\">\r\n        <span class=\"dijitInline\" data-dojo-attach-point=\"iconNode\"></span>\r\n        <span class=\"epi-event__title\" data-dojo-attach-point=\"titleNode\"></span>\r\n    </div>\r\n    <div class=\"epi-event__status\" data-dojo-attach-point=\"actionNode\">\r\n        <span class=\"dijitInline epi-event__status__icon\">\r\n            <span data-dojo-attach-point=\"actionIconNode\"></span>\r\n        </span><span class=\"epi-event__status__message\" data-dojo-attach-point=\"actionTextNode\"></span>\r\n    </div><div data-dojo-attach-point=\"messageNode\"></div\r\n    ><div class=\"epi-activity__comment\" data-dojo-attach-point=\"activityCommentNode\"></div\r\n    ><div class=\"epi-activity__comments\" data-dojo-attach-point=\"containerNode\"></div>\r\n    <div data-dojo-type=\"epi-cms/activity/ActivityCommentForm\" data-dojo-attach-point=\"commentForm\"></div>\r\n</div>\r\n","epi-cms/compare/CompareToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Evented","dojo/topic","dijit/Toolbar","epi/shell/widget/DeferredDropDownButton","epi","epi/username","epi-cms/version/VersionSelector","epi/shell/widget/_ModelBindingMixin","dojo/text!./template/CompareToolbar.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_1165,lang,_1166,_1167,topic,_1168,_1169,epi,_116a,_116b,_116c,_116d,_116e,_116f){return _1165([_1168,_1167,_116c],{region:"top",baseClass:"epi-compare-toolbar epi-localToolbar epi-flatToolbar",templateString:_116d,_leftVersionSelector:null,_rightVersionSelector:null,_resources:lang.mixin(_116e,_116f),modelBindingMap:{currentLanguage:["currentLanguage"],leftVersion:["leftVersion"],rightVersion:["rightVersion"],leftButtonLabel:["leftButtonLabel"],rightButtonLabel:["rightButtonLabel"],leftByText:["leftByText"],rightByText:["rightByText"],leftDateText:["leftDateText"],rightDateText:["rightDateText"],messageText:["messageText"],showsVersionSelectors:["showsVersionSelectors"]},buildRendering:function(){this.inherited(arguments);this._leftVersionSelector=this._createVersionSelector("leftVersion","left");this._rightVersionSelector=this._createVersionSelector("rightVersion","right");this._leftButton=new _1169({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._leftVersionSelector,iconClass:"epi-iconVersions"},this.leftVersionSelector);this._rightButton=new _1169({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._rightVersionSelector,iconClass:"epi-iconVersions"},this.rightVersionSelector);this.own(this._leftVersionSelector,this._rightVersionSelector,this._leftButton,this._rightButton);},_refreshSelectors:function(){this._leftVersionSelector.refresh();this._rightVersionSelector.refresh();},_setLeftVersionAttr:function(_1170){if(epi.areEqual(this.leftVersion,_1170)){return;}this._set("leftVersion",_1170);if(_1170){this._leftVersionSelector.set("contentLink",_1170.contentLink);this._rightVersionSelector.set("markedContentLink",_1170.contentLink);this._refreshSelectors();}},_setRightVersionAttr:function(_1171){this._set("rightVersion",_1171);if(_1171){this._rightVersionSelector.set("contentLink",_1171.contentLink);this._leftVersionSelector.set("markedContentLink",_1171.contentLink);}},_setLeftButtonLabelAttr:function(label){this._set("leftButtonLabel",label);this._leftButton.set("label",label);},_setRightButtonLabelAttr:function(label){this._set("rightButtonLabel",label);this._rightButton.set("label",label);},_setLeftByTextAttr:{node:"leftBy",type:"innerHTML"},_setRightByTextAttr:{node:"rightBy",type:"innerHTML"},_setLeftDateTextAttr:{node:"leftDate",type:"innerHTML"},_setRightDateTextAttr:{node:"rightDate",type:"innerHTML"},_setMessageTextAttr:{node:"messageSection",type:"innerHTML"},_setShowsVersionSelectorsAttr:function(_1172){_1166.toggle(this.leftVersionSection,"dijitHidden",!_1172);_1166.toggle(this.rightVersionSection,"dijitHidden",!_1172);_1166.toggle(this.messageSection,"dijitHidden",_1172);this.emit("versionInformationUpdated");},_createVersionSelector:function(_1173,_1174){var model=this.model,_1175=new _116b({store:model.contentVersionStore,region:_1174,languages:model.languages,currentLanguage:model.currentLanguage,name:_1173}),_1176=function(name,_1177,value){_1175.set(name,value);};this.own(_1175.on("change",function(e){model.set(_1173,e.version);}),model.watch("languages",_1176),model.watch("currentLanguage",_1176));return _1175;}});});},"epi-cms/version/VersionSelector":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi-cms/core/ContentReference","dojo/text!./template/VersionSelector.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/extensions/ColumnHider","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","epi-cms/dgrid/formatters","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","epi/shell/widget/_FocusableMixin","epi-cms/version/LanguageSelector"],function(_1178,event,lang,_1179,_117a,keys,_117b,_117c,_117d,_117e,_117f,_1180,_1181,_1182,_1183,_1184,misc,_1185,_1186,_1187,_1188,_1189,_118a){return _1178([_1186,_1187,_1188,_1189,_118a],{baseClass:"epi-version-selector",templateString:_117c,contentLink:null,markedContentLink:null,languages:null,store:null,region:null,buildRendering:function(){this.inherited(arguments);this.grid=new (_1178([_117e,_117f,_1180,_1181,_1184,_1183,_1182]))({columns:{selector:{label:"",formatter:function(){return misc.icon("epi-iconCheckmark");},sortable:false},icon:{label:"",formatter:function(){return misc.icon("");},sortable:false},language:{label:_117d.language,sortable:false},status:{label:_117d.status,renderCell:_1185.commonDraft},savedDate:{label:_117d.saved,formatter:_1185.localizedDate,className:"epi-grid--30"},savedBy:{label:_117d.by,formatter:_1185.userName,sortable:false}},cellNavigation:false,selectionEvents:"click",selectionMode:"exclusive",sort:[{attribute:"savedDate",descending:true}]},this.gridNode);this.own(this.grid,this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.grid.on("dgrid-select",lang.hitch(this,"_versionSelected")),_1179.around(this.grid,"renderRow",lang.hitch(this,"_renderRow")),this.languageSelector.watch("value",lang.hitch(this,"_updateFilter")),this.on("keydown",lang.hitch(this,"_onKeydown")));},startup:function(){if(this._started){return;}this.inherited(arguments);this.grid.startup();this.grid.set("store",this.store,{contentLink:this.contentLink});},resize:function(){this.inherited(arguments);this.grid.resize();},refresh:function(){if(this._started){this.grid.refresh();}},_setContentLinkAttr:function(_118b){if(this.contentLink===_118b){return;}if(this._started&&!_117b.compareIgnoreVersion(this.contentLink,_118b)){this.languageSelector.set("value",this.languageSelector.defaultOption.value);this.grid.set("query",{contentLink:_118b});}this.contentLink=_118b;this.grid.clearSelection();this.grid.select(_118b);},_setCurrentLanguageAttr:function(_118c){this._set("currentLanguage",_118c);this.languageSelector.set("currentLanguage",_118c);},_setLanguagesAttr:function(_118d){this._set("languages",_118d);this.languageSelector.set("languages",_118d);var _118e=_118d&&_118d.length;this.languageSelector.set("disabled",!_118e);_117a.toggle(this.languageSelectorContainer,"dijitHidden",!_118e);this.grid.toggleColumnHiddenState("language",!_118e);},_setMarkedContentLinkAttr:function(_118f){var row=this._getRowElement(this.markedContentLink);if(row){_117a.remove(row,"dgrid-row--marked");}row=this._getRowElement(_118f);if(row){_117a.add(row,"dgrid-row--marked");}this.markedContentLink=_118f;},_setRegionAttr:function(_1190){var _1191=this.baseClass+"--"+_1190,_1192=this.baseClass+"--"+this.region;this.region=_1190;_117a.replace(this.domNode,_1191,_1192);},_refreshComplete:function(){this.grid.select(this.contentLink);this.emit("loaded");},_versionSelected:function(e){if(e.parentType){var _1193=e.rows&&e.rows[0].data;this.contentLink=_1193.contentLink;this.emit("change",{version:_1193});}},_renderRow:function(_1194){var self=this;return function(item){var row=_1194.apply(this,arguments);if(item.contentLink===self.markedContentLink){_117a.add(row,"dgrid-row--marked");}return row;};},_getRowElement:function(_1195){if(_1195){return this.grid.row(_1195).element;}},_updateFilter:function(name,_1196,value){if(this._started){if(value!==this.languageSelector.defaultOption.value){this.grid.set("query",{contentLink:this.contentLink,language:value});}else{this.grid.set("query",{contentLink:this.contentLink});}}this.refresh();},_onKeydown:function(evt){if(evt.ctrlKey||evt.altKey||evt.keyCode!==keys.TAB){return;}if(evt.shiftKey){this.focusPrev();}else{this.focusNext();}event.stop(evt);}});});},"url:epi-cms/version/template/VersionSelector.html":"<div>\r\n    <div data-dojo-attach-point=\"languageSelectorContainer\" class=\"epi-flatToolbar\">\r\n        <select data-dojo-attach-point=\"languageSelector\" data-dojo-type=\"epi-cms/version/LanguageSelector\" class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\"></select>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\" class=\"epi-plain-grid epi-grid-max-height--300\"></div>\r\n</div>\r\n","dgrid/extensions/ColumnHider":function(){define(["dojo/_base/declare","dojo/has","dojo/on","../util/misc","put-selector/put","dojo/i18n!./nls/columnHider","xstyle/css!../css/extensions/ColumnHider.css"],function(_1197,has,_1198,_1199,put,i18n){var _119a,_119b,hasIE=has("ie"),_119c=hasIE&&has("quirks"),_119d=hasIE<8||_119c?"htmlFor":"for";function _119e(cb,grid){return cb.id.substr(grid.id.length+18);};return _1197(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:i18n,_hiderMenuOpened:false,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var _119f=this.subRows,first=true,_11a0,_11a1,sr,c;delete this._columnHiderFirstCheckbox;for(sr=0,_11a0=_119f.length;sr<_11a0;sr++){for(c=0,_11a1=_119f[sr].length;c<_11a1;c++){this._renderHiderMenuEntry(_119f[sr][c]);if(first){first=false;this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[_119f[sr][c].id];}}}},_renderHiderMenuEntry:function(col){var id=col.id,_11a2=_1199.escapeCssIdentifier(id,"-"),div,_11a3,_11a4,label;if(col.hidden){col.hidden=false;this._hideColumn(id);col.hidden=true;}if(col.unhidable){return;}div=put("div.dgrid-hider-menu-row");_11a3=this.domNode.id+"-hider-menu-check-"+_11a2;_11a4=this._columnHiderCheckboxes[id]=put(div,"input.dgrid-hider-menu-check.hider-menu-check-"+_11a2+"[type=checkbox]");_11a4.id=_11a3;label=put(div,"label.dgrid-hider-menu-label.hider-menu-label-"+_11a2+"["+_119d+"="+_11a3+"]",col.label||col.field||"");put(this.hiderMenuNode,div);if(!col.hidden){_11a4.checked=true;}},renderHeader:function(){var grid=this,_11a5=this.hiderMenuNode,_11a6=this.hiderToggleNode,id;function _11a7(event){event.stopPropagation();};this.inherited(arguments);if(!_11a5){_11a6=this.hiderToggleNode=put(this.domNode,"button.ui-icon.dgrid-hider-toggle[type=button][aria-label="+this.i18nColumnHider.popupTriggerLabel+"]");this._listeners.push(_1198(_11a6,"click",function(e){grid._toggleColumnHiderMenu(e);}));_11a5=this.hiderMenuNode=put("div.dgrid-hider-menu[role=dialog][aria-label="+this.i18nColumnHider.popupLabel+"]");_11a5.id=this.id+"-hider-menu";this._listeners.push(_1198(_11a5,"keyup",function(e){var _11a8=e.charCode||e.keyCode;if(_11a8===27){grid._toggleColumnHiderMenu(e);_11a6.focus();}}));_11a5.style.display="none";put(this.domNode,_11a5);this._listeners.push(_1198(_11a5,".dgrid-hider-menu-check:"+(hasIE<9||_119c?"click":"change"),function(e){grid._updateColumnHiddenState(_119e(e.target,grid),!e.target.checked);}));this._listeners.push(_1198(_11a5,"mousedown",_11a7),_1198(_11a6,"mousedown",_11a7));if(!_119b){_119b=_1198.pausable(document,"mousedown",function(e){_119a&&_119a._toggleColumnHiderMenu(e);});_119b.pause();}}else{for(id in this._columnHiderRules){this._columnHiderRules[id].remove();}_11a5.innerHTML="";}this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries();},destroy:function(){this.inherited(arguments);for(var id in this._columnHiderRules){this._columnHiderRules[id].remove();}},left:function(cell,steps){return this.right(cell,-steps);},right:function(cell,steps){if(!cell.element){cell=this.cell(cell);}var _11a9=this.inherited(arguments),_11aa=cell;while(_11a9.column.hidden){_11a9=this.inherited(arguments,[_11a9,steps>0?1:-1]);if(_11aa.element===_11a9.element){return cell;}_11aa=_11a9;}return _11a9;},isColumnHidden:function(id){return !!this._columnHiderRules[id];},_toggleColumnHiderMenu:function(){var _11ab=this._hiderMenuOpened,_11ac=this.hiderMenuNode,_11ad=this.domNode,_11ae;_11ac.style.display=(_11ab?"none":"");if(_11ab){_11ac.style.height="";}else{if(_11ac.offsetHeight>_11ad.offsetHeight-12){_11ac.style.height=(_11ad.offsetHeight-12)+"px";}(_11ae=this._columnHiderFirstCheckbox)&&_11ae.focus();}_119b[_11ab?"pause":"resume"]();_119a=_11ab?null:this;this._hiderMenuOpened=!_11ab;},_hideColumn:function(id){var grid=this,_11af="#"+_1199.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",_11b0;if(this._columnHiderRules[id]){return;}this._columnHiderRules[id]=_1199.addCssRule(_11af+_1199.escapeCssIdentifier(id,"-"),"display: none;");if((has("ie")===8||has("ie")===10)&&!has("quirks")){_11b0=_1199.addCssRule(".dgrid-row-table","display: inline-table;");window.setTimeout(function(){_11b0.remove();grid.resize();},0);}},_showColumn:function(id){if(this._columnHiderRules[id]){this._columnHiderRules[id].remove();delete this._columnHiderRules[id];}},_updateColumnHiddenState:function(id,_11b1){this[_11b1?"_hideColumn":"_showColumn"](id);this.columns[id].hidden=_11b1;_1198.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[id],hidden:_11b1,bubbles:true});this.resize();},toggleColumnHiddenState:function(id,_11b2){if(typeof _11b2==="undefined"){_11b2=!this._columnHiderRules[id];}this._updateColumnHiddenState(id,_11b2);this._columnHiderCheckboxes[id].checked=!_11b2;}});});},"dgrid/extensions/nls/columnHider":function(){define({root:{popupTriggerLabel:"Show or hide columns",popupLabel:"Show or hide columns"},es:true,ro:true});},"epi-cms/version/LanguageSelector":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.languageselector","dijit/form/Select"],function(_11b3,_11b4,_11b5){return _11b3([_11b5],{defaultOption:null,languages:null,currentLanguage:null,constructor:function(){this.defaultOption={label:_11b4.alllanguages,value:"all"};},_setLanguagesAttr:function(_11b6){this._set("languages",_11b6);if(!_11b6||!_11b6.length){this.set("options",[]);return;}this.set("options",this._convertLanguagesToOptions(_11b6));},_setCurrentLanguageAttr:function(_11b7){this._set("currentLanguage",_11b7);var _11b8=this.languages;if(_11b8&&_11b8.length){this.set("options",this._convertLanguagesToOptions(_11b8));}},_convertLanguagesToOptions:function(_11b9){var value=this.value,_11ba=this.currentLanguage;var _11bb=_11b9.map(function(item){var _11bc=item.languageId===_11ba;return {label:item.name+(_11bc?" ("+_11b4.currentlanguage+")":""),value:item.languageId};});_11bb=[this.defaultOption,{}].concat(_11bb);_11bb.forEach(function(item){item.selected=item.value===value;});return _11bb;}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(array,_11bd,_11be,_11bf,_11c0,event,i18n,lang,has,_11c1,_11c2,Menu,_11c3,_11c4,_11c5,_11c6){var _11c7=_11bd("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_11bf.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";n.setAttribute("role","listbox");o.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",event.stop);},focus:function(){var found=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){array.forEach(this.parentWidget._getChildren(),function(child){if(child.option&&(val===child.option.value)){found=true;this.focusChild(child,false);}},this);}if(!found){this.inherited(arguments);}},resize:function(mb){if(mb){_11c0.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _11c8=_11bd("dijit.form.Select",[_11c1,_11c2],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_11c6,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _11c7({id:this.id+"_menu",parentWidget:this});_11bf.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_11c9){if(!_11c9.value&&!_11c9.label){return new _11c4({ownerDocument:this.ownerDocument});}else{var click=lang.hitch(this,"_setValueAttr",_11c9);var item=new _11c3({option:_11c9,label:_11c9.label||this.emptyLabel,onClick:click,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_11c9.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_11ca){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_11ca));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_11cb){if(_11cb===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{array.forEach(this._getChildren(),function(child){child.destroyRecursive();});var item=new _11c3({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(value){this.inherited(arguments);_11be.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(value){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(value){this._set("required",value);this.focusNode.setAttribute("aria-required",value);this._refreshState();},_setOptionsAttr:function(_11cc){this._isLoaded=false;this._set("options",_11cc);},_setDisplay:function(_11cd){var lbl=_11cd||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_11ce){var _11cf=this.disabled||this.isValid(_11ce);this._set("state",_11cf?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_11cf?"false":"true");var _11d0=_11cf?"":this._missingMsg;if(_11d0&&this.focused&&this._hasBeenBlurred){_11c5.show(_11d0,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_11c5.hide(this.domNode);}this._set("message",_11d0);return _11cf;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_11c5.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",event.stop);this.domNode.setAttribute("aria-expanded","false");},_setStyleAttr:function(value){this.inherited(arguments);_11bf.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_11d1){this._loadChildren(true);this._isLoaded=true;_11d1();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_11d2){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_11d2);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_11c5.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_11c8._Menu=_11c7;return _11c8;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(array,_11d3,_11d4,_11d5,_11d6,dom,_11d7,_11d8,lang,query,when,_11d9,_11da){var _11db=_11d6("dijit.form._FormSelectWidget",_11da,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_11dc){var opts=this.options||[];if(_11dc==null){return opts;}if(lang.isArray(_11dc)){return array.map(_11dc,"return this.getOptions(item);",this);}if(lang.isString(_11dc)){_11dc={value:_11dc};}if(lang.isObject(_11dc)){if(!array.some(opts,function(_11dd,idx){for(var a in _11dc){if(!(a in _11dd)||_11dd[a]!=_11dc[a]){return false;}}_11dc=idx;return true;})){_11dc=-1;}}if(_11dc>=0&&_11dc<opts.length){return opts[_11dc];}return null;},addOption:function(_11de){array.forEach(lang.isArray(_11de)?_11de:[_11de],function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_11df){var _11e0=this.getOptions(lang.isArray(_11df)?_11df:[_11df]);array.forEach(_11e0,function(_11e1){if(_11e1){this.options=array.filter(this.options,function(node){return (node.value!==_11e1.value||node.label!==_11e1.label);});this._removeOptionItem(_11e1);}},this);this._loadChildren();},updateOption:function(_11e2){array.forEach(lang.isArray(_11e2)?_11e2:[_11e2],function(i){var _11e3=this.getOptions({value:i.value}),k;if(_11e3){for(k in i){_11e3[k]=i[k];}}},this);this._loadChildren();},setStore:function(store,_11e4,_11e5){var _11e6=this.store;_11e5=_11e5||{};if(_11e6!==store){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!store.get){lang.mixin(store,{_oldAPI:true,get:function(id){var _11e7=new _11d3();this.fetchItemByIdentity({identity:id,onItem:function(_11e8){_11e7.resolve(_11e8);},onError:function(error){_11e7.reject(error);}});return _11e7.promise;},query:function(query,_11e9){var _11ea=new _11d3(function(){if(_11eb.abort){_11eb.abort();}});_11ea.total=new _11d3();var _11eb=this.fetch(lang.mixin({query:query,onBegin:function(count){_11ea.total.resolve(count);},onComplete:function(_11ec){_11ea.resolve(_11ec);},onError:function(error){_11ea.reject(error);}},_11e9));return new _11d9(_11ea);}});if(store.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_11d4.after(store,"onNew",lang.hitch(this,"_onNewItem"),true),_11d4.after(store,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_11d4.after(store,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",store);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}if(_11e5.query){this._set("query",_11e5.query);this._set("queryOptions",_11e5.queryOptions);}if(store){this._loadingStore=true;this.onLoadDeferred=new _11d3();this._queryRes=store.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(items){if(this.sortByLabel&&!_11e5.sort&&items.length){if(store.getValue){items.sort(_11d5.createSortFunction([{attribute:store.getLabelAttributes(items[0])[0]}],store));}else{var _11ed=this.labelAttr;items.sort(function(a,b){return a[_11ed]>b[_11ed]?1:b[_11ed]>a[_11ed]?-1:0;});}}if(_11e5.onFetch){items=_11e5.onFetch.call(this,items,_11e5);}array.forEach(items,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._observeHandle=this._queryRes.observe(lang.hitch(this,function(_11ee,_11ef,_11f0){if(_11ef==_11f0){this._onSetItem(_11ee);}else{if(_11ef!=-1){this._onDeleteItem(_11ee);}if(_11f0!=-1){this._onNewItem(_11ee);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_11e4);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(items);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _11e6;},_setValueAttr:function(_11f1,_11f2){if(!this._onChangeActive){_11f2=null;}if(this._loadingStore){this._pendingValue=_11f1;return;}if(_11f1==null){return;}if(lang.isArray(_11f1)){_11f1=array.map(_11f1,function(value){return lang.isObject(value)?value:{value:value};});}else{if(lang.isObject(_11f1)){_11f1=[_11f1];}else{_11f1=[{value:_11f1}];}}_11f1=array.filter(this.getOptions(_11f1),function(i){return i&&i.value;});var opts=this.getOptions()||[];if(!this.multiple&&(!_11f1[0]||!_11f1[0].value)&&!!opts.length){_11f1[0]=opts[0];}array.forEach(opts,function(opt){opt.selected=array.some(_11f1,function(v){return v.value===opt.value;});});var val=array.map(_11f1,function(opt){return opt.value;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}var disp=array.map(_11f1,function(opt){return opt.label;});this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_11f2]);this._updateSelection();},_getDisplayedValueAttr:function(){var ret=array.map([].concat(this.get("selectedOptions")),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_setDisplayedValueAttr:function(label){this.set("value",this.getOptions(typeof label=="string"?{label:label}:label));},_loadChildren:function(){if(this._loadingStore){return;}array.forEach(this._getChildren(),function(child){child.destroyRecursive();});array.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=[].concat(this.value);if(val&&val[0]){array.forEach(this._getChildren(),function(child){var _11f3=array.some(val,function(v){return child.option&&(v===child.option.value);});_11d7.toggle(child.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_11f3);child.domNode.setAttribute("aria-selected",_11f3?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=array.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return array.map(array.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_11f4){if(!_11f4||!_11f4.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var store=this.store;this.removeOption({value:store.getIdentity(item)});},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var store=this.store,label=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:store.getLabel(item),value=(label?store.getIdentity(item):null);return {value:value,label:label,item:item};},_addOptionForItem:function(item){var store=this.store;if(store.isItemLoaded&&!store.isItemLoaded(item)){store.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _11f5=this._getOptionObjForItem(item);this.addOption(_11f5);},constructor:function(_11f6){this._oValue=(_11f6||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?query("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_11d8._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);_11d4.after(this,"onChange",lang.hitch(this,"_updateSelection"));var store=this.store;if(store&&(store.getIdentity||store.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(store,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions({selected:true});},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _11db;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _11f7={};lang.setObject("dojo.data.util.sorter",_11f7);_11f7.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_11f7.createSortFunction=function(_11f8,store){var _11f9=[];function _11fa(attr,dir,comp,s){return function(itemA,itemB){var a=s.getValue(itemA,attr);var b=s.getValue(itemB,attr);return dir*comp(a,b);};};var _11fb;var map=store.comparatorMap;var bc=_11f7.basicComparator;for(var i=0;i<_11f8.length;i++){_11fb=_11f8[i];var attr=_11fb.attribute;if(attr){var dir=(_11fb.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_11f9.push(_11fa(attr,dir,comp,store));}}return function(rowA,rowB){var i=0;while(i<_11f9.length){var ret=_11f9[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _11f7;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","url:epi-cms/compare/template/CompareToolbar.html":"<div class=\"dijit\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <span data-dojo-attach-point=\"leftVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\r\n        <span>${_resources.comparing}</span>\r\n        <span data-dojo-attach-point=\"leftVersionSelector\"></span>\r\n\r\n        <span data-dojo-attach-point=\"leftDate\"></span>\r\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\r\n        <span data-dojo-attach-point=\"leftBy\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"rightVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\r\n        <span>${_resources.with}</span>\r\n        <span data-dojo-attach-point=\"rightVersionSelector\"></span>\r\n        <span data-dojo-attach-point=\"rightDate\"></span>\r\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\r\n        <span data-dojo-attach-point=\"rightBy\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"messageSection\" class=\"epi-compare-toolbar__text-wrapper epi-compare-toolbar__text-wrapper--text-only\"></span>\r\n</div>\r\n","epi-cms/compare/viewmodels/CompareViewModel":function(){define(["dojo/_base/declare","dojo/aspect","dojo/topic","dojo/_base/lang","dojo/Stateful","dojo/when","epi/shell/DestroyableByKey","epi/dependency","epi-cms/core/ContentReference","epi-cms/compare/viewmodels/CompareToolbarViewModel"],function(_11fc,_11fd,topic,lang,_11fe,when,_11ff,_1200,_1201,_1202){return _11fc([_11fe,_11ff],{contentLink:null,languages:null,typeIdentifier:null,leftVersion:null,rightVersion:null,leftVersionUri:null,rightVersionUrl:null,hasAccess:true,contentDataStore:null,contentVersionStore:null,orientation:"vertical",compareToolbarViewModel:null,_rightVersionDeferred:null,postscript:function(){this.inherited(arguments);this.contentDataStore=this.contentDataStore||_1200.resolve("epi.storeregistry").get("epi.cms.contentdata");this.contentVersionStore=this.contentVersionStore||_1200.resolve("epi.storeregistry").get("epi.cms.contentversion");this._setupCompareToolbarViewModel();this.own(topic.subscribe("/epi/cms/content/statuschange/",lang.hitch(this,"_refresh")));},_refresh:function(){var store=this.contentVersionStore;when(store.refresh(this.leftVersion.contentLink),lang.hitch(this,function(_1203){this.set("leftVersion",_1203);}));if(this.rightVersion){when(store.refresh(this.rightVersion.contentLink),lang.hitch(this,function(_1204){this.set("rightVersion",_1204);}));}},_contentLinkSetter:function(_1205){this.contentLink=_1205;var store=this.contentVersionStore;if(this._rightVersionDeferred&&!this._rightVersionDeferred.isFulfilled()){this._rightVersionDeferred.cancel();}when(store.get(_1205),lang.hitch(this,function(_1206){this.set("leftVersion",_1206);if(!this.rightVersion||!_1201.compareIgnoreVersion(this.leftVersion.contentLink,this.rightVersion.contentLink)){var _1207={contentLink:_1205,language:this.leftVersion.language,query:"getcompareversion"};this._rightVersionDeferred=store.query(_1207);when(this._rightVersionDeferred,lang.hitch(this,function(_1208){this.set("hasAccess",true);this.set("rightVersion",_1208&&_1208.length?_1208[0]:null);}),lang.hitch(this,function(error){this.set("hasAccess",error.status!==403);this.set("rightVersion",null);}));}}));},_leftVersionSetter:function(_1209){this.leftVersion=_1209;if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.leftVersion!==_1209){this.compareToolbarViewModel.set("leftVersion",_1209);}}this.set("leftVersionUri",_1209.uri);},_rightVersionSetter:function(_120a){var _120b="removeAfter";this.rightVersion=_120a;this.destroyByKey(_120b);if(_120a){this.ownByKey(_120b,_11fd.after(this.contentVersionStore,"remove",lang.hitch(this,function(_120c){if(_120a.contentLink===_120c){this.set("rightVersion",null);}}),true));}if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.rightVersion!==_120a){this.compareToolbarViewModel.set("rightVersion",_120a);}}if(_120a===null){this.set("rightVersionUrl","about:blank");this.set("rightVersionContentLink",null);return;}when(this.contentDataStore.get(_120a.contentLink),lang.hitch(this,function(_120d){if(this.leftVersion===this.rightVersion){this.set("rightVersionUrl","about:blank");}this.set("rightVersionUrl",_120d.editablePreviewUrl);this.set("rightVersionContentLink",_120d.contentLink);}));},_typeIdentifierSetter:function(_120e){this.typeIdentifier=_120e;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("typeIdentifier",_120e);}},_languagesSetter:function(_120f){this.languages=_120f;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("languages",_120f);}},_hasAccessSetter:function(_1210){this.hasAccess=_1210;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("hasAccess",_1210);}},_setupCompareToolbarViewModel:function(){this.compareToolbarViewModel=this.compareToolbarViewModel||new _1202({contentVersionStore:this.contentVersionStore,leftVersion:this.leftVersion,rightVersion:this.rightVersion,typeIdentifier:this.typeIdentifier,hasAccess:this.hasAccess,languages:this.languages});this.own(this.compareToolbarViewModel.watch("leftVersion",lang.hitch(this,function(_1211,_1212,_1213){if(this.leftVersion!==_1213){this.set("leftVersion",_1213);}})));this.own(this.compareToolbarViewModel.watch("rightVersion",lang.hitch(this,function(_1214,_1215,_1216){if(this.rightVersion!==_1216){this.set("rightVersion",_1216);}})));}});});},"epi-cms/compare/viewmodels/CompareToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_1217,lang,_1218,when,_1219,_121a,_121b,_121c,_121d,_121e){return _1217([_1218],{contentVersionStore:null,leftVersion:null,rightVersion:null,leftButtonLabel:null,rightButtonLabel:null,leftByText:null,rightByText:null,leftDateText:null,rightDateText:null,messageText:null,showsVersionSelectors:null,hasAccess:true,typeIdentifier:null,languages:null,currentLanguage:null,postscript:function(){this.inherited(arguments);var _121f=this._profile||_1219.resolve("epi.shell.Profile");when(_121f.getContentLanguage(),lang.hitch(this,function(_1220){this.set("currentLanguage",_1220);}));},_leftVersionSetter:function(_1221){this.leftVersion=_1221;if(_1221){this.set("leftButtonLabel",this._createButtonLabel(_1221));this.set("leftByText",_121b.toUserFriendlyString(_1221.savedBy,null,false));this.set("leftDateText",_121a.toUserFriendlyString(_1221.savedDate));}},_rightVersionSetter:function(_1222){this.rightVersion=_1222;if(_1222){this.set("rightButtonLabel",this._createButtonLabel(_1222));this.set("rightByText",_121b.toUserFriendlyString(_1222.savedBy,null,false));this.set("rightDateText",_121a.toUserFriendlyString(_1222.savedDate));}this.set("showsVersionSelectors",_1222!==null);},_typeIdentifierSetter:function(_1223){this.typeIdentifier=_1223;this._updateMessageText();},_hasAccessSetter:function(_1224){this.hasAccess=_1224;this._updateMessageText();},_updateMessageText:function(){this.set("messageText",this.hasAccess?_121c.getResourceValue(this.typeIdentifier,"compare.onlyoneversion"):_121e.insufficientpermission);},_createButtonLabel:function(_1225){var _1226=_1225.language?" ("+_1225.language+")":"";var _1227=_121d.getVersionStatus(_1225.status);return _1227+_1226;}});});},"epi-cms/compare/views/SideBySideCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/shell/widget/Iframe","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/OnPageEditing"],function(_1228,lang,topic,_1229,_122a,_122b){return _1228([_122b,_122a],{createOverlays:true,modelBindingMap:{rightVersionUrl:["rightVersionUrl"]},_rightIframe:null,buildRendering:function(){this.inherited(arguments);this._setupComparePanes();},destroy:function(){this._removeAndDestroyComparePanes();this.inherited(arguments);},_setRightVersionUrlAttr:function(url){if(url){this._rightIframe.load(url);}},_setupComparePanes:function(){var _122c=this.model.orientation;var width=this.editLayoutContainer.w/2;this._rightIframe=new _1229({region:_122c==="vertical"?"right":"bottom",layoutPriority:100,style:_122c==="vertical"?"width: "+width+"px":"height: 50%",splitter:true,"class":"epi-iframe--overflow epi-editorViewport"});this.own(this._rightIframe.on("load",lang.hitch(this,this._onRightIframeLoad)));this.mainLayoutContainer.addChild(this._rightIframe);},_onRightIframeLoad:function(url,_122d){if(!!url&&!_122d&&url!==this.model.rightVersionUrl){topic.publish("/epi/shell/context/request",{url:url},{sender:this,forceContextChange:true,suppressFailure:true});}},_removeAndDestroyComparePanes:function(){if(this._rightIframe){this.mainLayoutContainer.removeChild(this._rightIframe);this._rightIframe.destroyRecursive();this._rightIframe=null;}}});});},"epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/when","dojo/topic","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_122e,lang,_122f,on,when,topic,_1230,_1231,_1232,_1233){return _122e([_1233,_1231,_1232],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_1234,_1235){return _1235.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_1236){if(_1236&&_1236.editorWidget){var _1237=_1236.editorWidget;if(_1237.onFieldCreated){var _1238=_122f.after(_1237,"onFieldCreated",lang.hitch(this,function(_1239,_123a){_1238.remove();_1238=null;this._addStateWatch(_123a);}),true);}else{_1237.set("name",_1236.get("propertyName"));this._addStateWatch(_1237);}_1237.validate&&_1237.validate();}},onSetActiveProperty:function(_123b){var _123c=this._mappingManager.findOne("propertyName",_123b);if(!_123c){topic.publish("/epi/cms/action/switcheditmode",null,{activePropertyOnStartup:_123b});}else{if(_123c.wrapper){_123c.wrapper.startEdit();}else{if(_123c.overlayItem){this._onOverlayItemClick(_123c.overlayItem);}}}},_onOverlayItemClick:function(_123d,e){var _123e=this._activeEditorWrapper;var _123f=this._mappingManager.find().filter(function(item){return (item.overlayItem&&item.wrapper);}).map(function(item){return item.wrapper;});if(_123f.length>0){_123f.forEach(function(item){item.tryToStopEditing();});var _1240=_123f.some(function(item){return (item.editing);});if(_1240||(_123e&&_123d.name===_123e.overlayItem.name)){return;}}this.inherited(arguments);},onReadySetupEditMode:function(){this.inherited(arguments);var self=this,_1241=function(){var _1242=self._activeEditorWrapper;if(_1242&&_1242.closeOnViewportClick){_1242.tryToStopEditing(false);}};this._formConnects.push(on(this._form,"mouseup",_1241));this.own(on(this.iframeWithOverlay.iframe,"mouseup",_1241));},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.editLayoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _1243=this;this._pullDownGesture=_1230(_1243.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_1243.editLayoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_1243.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_1243.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_1243.editLayoutContainer.selectChild(_1243.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_1243.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_1243.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_1243.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _1244=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_1244=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_1244&&_1244.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while((c=this._iframeConnects.pop())){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},_destroyOverlay:function(){this.inherited(arguments);this._removeViewModelWatches();},removeForm:function(form){this._removePullDownGesture();this.editLayoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_1245,event,lang,mouse,on,_1246){return _1245([_1246],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_1247,_1248){this._delegate=_1248;this._scrollTarget=_1247;this.addMouseWheelListener(_1247);},addMouseWheelListener:function(_1249){if(_1249){return this.own(on(_1249,mouse.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){event.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){event.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){event.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(array,_124a,lang,topic,_124b,_124c,_124d,_124e,_124f){return _124a([_124f],{ignoreVersionWhenComparingLinks:false,_sort:"dateAdded",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_124b.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _1250=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single",dndFormatSuffix:this.dndFormatSuffix,sort:this._sort},this.defaultGridMixin);this.grid=new this._gridClass(_1250,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);this.own(topic.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_1251){if(_1251){_1251.forEach(function(_1252){this.store.remove("epi.cms.contentdata:///"+_1252);},this);}})));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _1253=this.inherited(arguments);_1253.data.contentLink=new _124c(_1253.data.uri).getId();return _1253;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort",this._sort,true);},fetchData:function(){var _1254=_124d.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_1254+"]|\\d{2,})")});this.grid.set("sort",this._sort,true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/ExpandoMenuBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_1255,lang,_1256,_1257,_1258,_1259,_125a,_125b,_125c,_125d,_125e,_125f,_1260,_1261){var _1262=_1255([_125c],{_create:function(_1263){var _1264=_1255([_1263.settings.widget,_125a]);return new _1264(_1263.settings);}});var _1265=_1255([_125d],{_getBuildInfo:function(_1266){if(_1266.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category===_1266.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _1255([_1259,_125b],{templateString:_1260,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _1267=new _1262();var _1268=new _125e({settings:{title:_1261.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false},hideEmptyButton:true});var _1269=[{category:"leading",builder:_1267,target:this.leadingContainerNode},{category:"view",builder:new _125f({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.viewNode},{category:"center",builder:_1267,target:this.centerContainerNode},{category:"trailing",builder:_1267,target:this.trailingContainerNode},{category:"create",builder:_1268,target:this.leadingContainerNode},{category:"compare",builder:new _125f({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.compareNode}];var _126a=new _1265({configuration:_1269,commandSource:this});_126a.build();},_getNextFocusableChild:function(child,dir){var _126b=this.getChildren();var index=_126b.indexOf(child);index=(dir>0)?index+1:index-1;if(index<0){index=_126b.length-1;}else{if(index>=_126b.length){index=0;}}return _126b[index];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_126c,_126d,_126e){return _126c([_126d,_126e],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_126f,_1270,_1271){return _126f([_1271,_1270],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <div class=\"epi-toolbarGroupContainer\">\r\n        <div class=\"epi-toolbarLeading epi-toolbarGroup\">\r\n            <span data-dojo-attach-point=\"leadingContainerNode\"></span\r\n            ><span data-dojo-attach-point=\"viewNode\"></span\r\n            ><span data-dojo-attach-point=\"compareNode\"></span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\r\n    </div>\r\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-class","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/component/_ShowAllLanguagesMixin","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree","dojo/text!./templates/MainNavigation.html","epi-cms/widget/SearchBox"],function(array,_1272,lang,_1273,_1274,when,_1275,_1276,_1277,_1278,_1279,res,_127a){return _1272([_1275,_1276,_1277,_1278],{templateString:_127a,res:res,contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1279.resolve("epi.cms.contentRepositoryDescriptors");var _127b=this.contentRepositoryDescriptors.get(this.repositoryKey);var roots=this.roots?this.roots:_127b.roots;this.search.set("area",_127b.searchArea);this.search.set("searchRoots",roots);var _127c=_127b.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_127c],lang.hitch(this,function(_127d){var _127e=new _127d({typeIdentifiers:_127b.mainNavigationTypes?_127b.mainNavigationTypes:_127b.containedTypes,containedTypes:_127b.containedTypes,settings:_127b,roots:roots,repositoryKey:this.repositoryKey});_127e.placeAt(this.navigation);this.tree=_127e;when(this.tree._isSiteMultilingual()).then(function(_127f){if(!_127f){return;}this.loadShowAllLanguages().then(function(_1280){_127e.set("showAllLanguages",_1280);this._setShowAllLanguagesLinkVisibility(_1280);}.bind(this));}.bind(this));this.tree.resize();this.own(this.tree.watch("showAllLanguages",function(value){var _1281=this.tree.get("showAllLanguages");this.search.set("filterOnCulture",!_1281);if(this.showAllLanguages!==_1281){this.saveShowAllLanguages(_1281);}this.set("showAllLanguages",_1281);this._setShowAllLanguagesLinkVisibility(_1281);}.bind(this)));}));this.own(this.on(".epi-main-navigation-language-link:click",function(){this.tree.set("showAllLanguages",true);}.bind(this)));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;this._relayout();}},_relayout:function(){var sb=_1273.getMarginBox(this.search.domNode);var _1282=_1274.contains(this.bottomLinkContainer,"dijitHidden")?0:_1273.getMarginBox(this.bottomLinkContainer).h;_1273.setMarginBox(this.navigation,{w:this._contentBox.w,h:this._contentBox.h-sb.h-_1282});},_setShowAllLanguagesLinkVisibility:function(_1283){_1274.toggle(this.bottomLinkContainer,"dijitHidden",_1283);if(!this._contentBox){return;}this._relayout();}});});},"epi-cms/component/_ShowAllLanguagesMixin":function(){define(["dojo/_base/declare","dojo/when","epi/dependency"],function(_1284,when,_1285){return _1284([],{showAllLanguages:true,_showAllLanguagesKey:"_showAllLanguages",_profile:null,constructor:function(_1286){this._profile=_1286._profile||_1285.resolve("epi.shell.Profile");},loadShowAllLanguages:function(){return when(this._profile.get(this.componentId+this._showAllLanguagesKey)).then(function(_1287){if(_1287!==null){this.showAllLanguages=_1287;return _1287;}return this.showAllLanguages;}.bind(this));},saveShowAllLanguages:function(value){this._profile.set(this.componentId+this._showAllLanguagesKey,value);}});});},"url:epi-cms/component/templates/MainNavigation.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>\r\n    <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">\r\n    </div>\r\n    <div class=\"epi-gadget-bottom-container dijitHidden\" data-dojo-attach-point=\"bottomLinkContainer\">\r\n        <a class=\"epi-visibleLink epi-main-navigation-language-link\">${res.showalllanguages}</a>\r\n    </div>\r\n</div>\r\n","epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/asset/HierarchicalList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_1288,_1289,_128a,_128b,on,topic,_128c,_128d,_128e,_128f,_1290,_1291){return _1288([_128d],{res:_1291,showCreateContentArea:true,showThumbnail:true,modelClassName:_128c,noDataMessages:_1291.nodatamessages,hierarchicalListClass:"epi-mediaList",createContentText:_1291.dropareatitle,postMixInProperties:function(){this.inherited(arguments);this.modelBindingMap.dropZoneSettings=["dropZoneSettings"];},buildRendering:function(){this.inherited(arguments);this._setupDropZone();},postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);var _1292=this.model.getCommand("uploadDefault");this.own(_1292.watch("canExecute",function(name,_1293,_1294){this._toggleCreateContentArea(_1294);}.bind(this)),_1292.watch("isAvailable",function(name,_1295,_1296){this._toggleCreateContentArea(_1296);}.bind(this)));},_setupDropZone:function(){var _1297=this.model.getCommand("uploadDefault");if(!_1297){return;}this.own(this._dropZone=new _128e({outsideDomNode:this.container.domNode}));_128a.place(this._dropZone.domNode,this.domNode,"first");this.connect(this._dropZone,"onDrop",this._onDrop);},_onDrop:function(evt,_1298){_1298=_128f.filterFileOnly(_1298);if(!_1298||_1298.length<=0){return;}var _1299=this.model.getCommand("uploadDefault");if(!_1299){return;}_1299.set("fileList",_1298);_1299.execute();this.searchBox.clearValue();},_setDropZoneSettingsAttr:function(_129a){if(this._dropZone){this._dropZone.set("settings",_129a);}},_onCreateAreaClick:function(){this.inherited(arguments);this.model.getCommand("uploadDefault").execute();},_setupCreateContentArea:function(){this.inherited(arguments);var _129b=this.createContentAreaButton.domNode;_1289.remove(_129b,"epi-flat");_1289.add(_129b,"epi-button--full-width");}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","dojo/topic","epi","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/asset/view-model/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/command/UploadContent","epi-cms/command/EditImage","epi-cms/command/DownloadMedia","epi-cms/asset/command/UploadContentToSelection","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(array,_129c,lang,_129d,when,topic,epi,_129e,_129f,_12a0,_12a1,_12a2,_12a3,_12a4,_12a5,_12a6,_12a7){return _129c([_12a0],{dropZoneSettings:null,_dialog:null,postscript:function(){this.inherited(arguments);this.own(topic.subscribe("/epi/cms/upload",function(_12a8){this.set("selectedTreeItems",this.get("selectedTreeItems"));if(this.isPseudoContextualRoot({contentLink:_12a8})&&this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"){this.treeStoreModel.refreshRoots(this);}}.bind(this)));},_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _12a9={selection:this.selection};var _12aa=new _12a3(lang.mixin({iconClass:"epi-iconPlus",label:_12a7.command.label,resources:_12a7,viewModel:this},_12a9));var _12ab={uploadDefault:{command:_12aa},upload:{command:new _12a6(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_12a7.linktocreateitem,viewModel:this},_12a9)),order:2},editImage:{command:new _12a4(lang.mixin({category:"context",forceContextChange:true,label:_12a7.command.openineditor},_12a9)),order:3},download:{command:new _12a5(lang.mixin({category:"context",label:_12a7.command.download},_12a9)),order:4}};this.own(_12aa.watch("canExecute",this._onUploadCommandUpdated.bind(this)));this._commandRegistry=lang.mixin(this._commandRegistry,_12ab);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_onUploadCommandUpdated:function(name,_12ac,_12ad){var _12ae=this._commandRegistry.uploadDefault.command;var _12af=_12ae.get("model");var _12b0=_12af?_12af.length===1:false;var _12b1=_12b0?_12af[0].name:null;var _12b2=this.get("isSearching");var _12b3={dropFolderName:_12b1,validSelection:_12b0,enabled:!_12b2&&(_12ad||!_12b0)};this.set("dropZoneSettings",_12b3);},_selectedTreeItemsSetter:function(items){this._commandRegistry.uploadDefault.command.set("model",items);this.inherited(arguments);},upload:function(_12b4,_12b5,_12b6){var _12b7=new _12a2({model:new _12a1({store:this.get("store"),query:this.get("listQuery")})});_12b7.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_12b7.on("close",lang.hitch(this,function(_12b8){this._dialog&&(_12b8?this._dialog.hide():this._dialog.destroy());}));_12b7.on("uploadComplete",lang.hitch(this,function(_12b9){if(_12b7.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_12b7.set("createAsLocalAsset",false);_12b7.set("uploadDirectory",this.get("selectedTreeItems")[0].id);_12b7.model.set("query",this.get("listQuery"));}));}else{this.onListItemUpdated(_12b9);topic.publish("/epi/cms/upload",_12b5);this.selectListItemsByContentReferences(_12b9.map(function(_12ba){var _12bb=_129f.toContentReference(_12ba.contentLink);return _12bb.createVersionUnspecificReference().toString();}));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _129e({title:_12a7.linktocreateitem,dialogClass:"epi-dialog-upload",content:_12b7,autofocus:true,defaultActionsVisible:false,closeIconVisible:false,destroyOnHide:false});this._dialog.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:function(){_12b7.close();}});this._dialog.resize({w:700});this._dialog.show();var _12bc=this.get("selectedTreeItems")[0];this._buildBreadcrumb(_12bc,_12b7);_12b7.set("uploadDirectory",_12b5||_12bc.id);_12b7.set("createAsLocalAsset",_12b6);_12b7.upload(_12b4);},onListItemUpdated:function(_12bd){var store=this.store;return when(this.getCurrentContext(),function(_12be){var _12bf=(new _129f(_12be.id)).createVersionUnspecificReference().toString();return when(store.get(_12bf),function(_12c0){var _12c1=array.filter(_12bd,function(_12c2){return _12c0.name.toLowerCase()===_12c2.fileName.toLowerCase();})[0];return _12c1?_12c0:null;});});},_buildBreadcrumb:function(_12c3,_12c4){if(!_12c4){return;}if(this.treeStoreModel.isTypeOfRoot(_12c3)){_12c4.set("breadcrumb",[_12c3]);return;}this.treeStoreModel.getAncestors(_12c3.contentLink,lang.hitch(this,function(_12c5){var _12c6,paths=[_12c3];for(var i=_12c5.length-1;i>=0;i--){_12c6=_12c5[i];paths.unshift(_12c6);if(this.treeStoreModel.isTypeOfRoot(_12c6)){break;}}_12c4.set("breadcrumb",paths);}));}});});},"epi-cms/asset/view-model/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/aspect","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/registry","dijit/Destroyable","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/CreateCommandsMixin","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/component/command/ViewTrash","epi-cms/asset/command/ChangeContextToSelection","epi-cms/asset/command/NewFolder","epi-cms/asset/command/RenameSelectedFolder","epi-cms/asset/command/TranslateSelectedContent","epi-cms/plugin-area/assets-pane"],function(array,_12c7,lang,topic,_12c8,_12c9,_12ca,when,all,_12cb,_12cc,epi,_12cd,_12ce,_12cf,_12d0,_12d1,_12d2,_12d3,_12d4,_12d5,_12d6,_12d7,_12d8,_12d9,_12da,_12db,_12dc,_12dd,_12de,_12df,_12e0,_12e1,_12e2){return _12c7([_12ca,_12c9,_12d4,_12d2,_12d8,_12cc],{searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,treePaths:null,selectedTreeItems:null,selectedListItems:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:null,treeStoreModel:null,store:null,searchStore:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,noDataMessages:null,noDataMessage:"",_profile:null,_commandItems:null,_pluginCommands:null,constructor:function(){this._commandRegistry={sort:function(){var _12e3=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var index=this[key].order;if(!index){index=100;}_12e3.push([index,this[key].command]);}}_12e3.sort(function(a,b){return a[0]-b[0];});return _12e3;},toArray:function(){var _12e4=this.sort();var _12e5=[];array.forEach(_12e4,function(key){_12e5.push(key[1]);});return _12e5;}};this.own(_12e2.on("added, removed",this._setCommands.bind(this)));},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_12cd.resolve("epi.cms.contentRepositoryDescriptors");_12c7.safeMixin(this,this.contentRepositoryDescriptors.get(args.repositoryKey));this._profile=this._profile||_12cd.resolve("epi.shell.Profile");this.clipboardManager=this.clipboardManager||new _12ce();this.selection=this.selection||new _12d0();this.store=this.store||_12cd.resolve("epi.storeregistry").get(this.storeKey);this.searchStore=this.searchStore||_12cd.resolve("epi.storeregistry").get("epi.cms.content.search");this._setupTreeStoreModel();this._setupCommands();this._setCommands();this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_12e6){return this._commandRegistry[_12e6]?this._commandRegistry[_12e6].command:null;},contentContextChanged:function(_12e7,_12e8){this._setupSearchRoots();if(!this._isSupportedContent(_12e7)){return;}this.selectItemsByContentReference(_12e7.id,false);},selectItemsByContentReference:function(_12e9,_12ea){if(!_12e9){return;}var _12eb=_12d5.toContentReference(_12e9);when(this.store.get(_12eb.createVersionUnspecificReference().toString()),function(_12ec){this.treeStoreModel.getAncestors(_12ec,function(_12ed){if(!_12ea&&this._isAncestorAssetFolder(_12ed)){return;}var _12ee=[];if(_12ec.capabilities.isContentFolder){_12ed.push(_12ec);}else{_12ee.push(_12ec);}var _12ef=[_12ed];if(epi.areEqual(this.get("treePaths"),_12ef)&&epi.areEqual(this.get("selectedListItems"),_12ee)){return;}this.emit("setPathsAndItems",_12ef,_12ee);}.bind(this));}.bind(this));},selectListItemsByContentReferences:function(_12f0){all(_12f0.map(function(_12f1){return when(this.store.get(_12f1));}.bind(this))).then(function(_12f2){this.set("selectedListItems",_12f2);}.bind(this));},_isAncestorAssetFolder:function(_12f3){if(_12f3.length===1){return true;}return _12f3.some(function(_12f4){return this._isAssetsFolder(_12f4);}.bind(this));},_isAssetsFolder:function(_12f5){return _12f5.typeIdentifier==="episerver.core.contentassetfolder"||_12d5.compareIgnoreVersion(_12f5.contentLink,_12d3.contentAssetsFolder);},updateTreePaths:function(_12f6){var _12f7=this.get("treePaths");if(!_12f7||!_12f7.length){return;}var _12f8=this._getAssetFolderIndex(_12f7);if(this._selectionContainsAssetFolder(_12f8)){var _12f9=lang.clone(_12f7);this._removeOldAssetFolder(_12f9,_12f8);this._addNewAssetFolder(_12f6,_12f9);if(!_12f9.length){_12f9=this._getDefaultTreePaths();}when(_12f9).then(function(_12fa){this.set("treePaths",_12fa);}.bind(this));}},_getAssetFolderIndex:function(_12fb){var _12fc=-1;_12fb.some(function(_12fd,index){return _12fd.some(function(_12fe){var _12ff=this._isAssetsFolder(_12fe);if(_12ff){_12fc=index;}return _12ff;}.bind(this));}.bind(this));return _12fc;},_selectionContainsAssetFolder:function(_1300){return _1300>-1;},_removeOldAssetFolder:function(_1301,_1302){_1301.splice(_1302,1);},_addNewAssetFolder:function(_1303,_1304){_1303.some(function(_1305){var _1306=this._isAssetsFolder(_1305);if(_1306){_1304.push([this.treeStoreModel.root,_1305]);}return _1306;}.bind(this));},setSearchText:function(_1307){var _1308=!!_1307;this.set("isSearching",_1308);this._updateSearchListQuery(_1307);var _1309=_1308?null:this.get("selectedListItems")||this.get("selectedTreeItems");this._updateCommands(_1309);},onListItemUpdated:function(_130a){},_isSupportedContent:function(_130b){return !!(_130b&&_130b.id)&&this.containedTypes.some(function(type){return _12d1.isBaseTypeIdentifier(_130b.dataType,type);});},_showAllLanguagesSetter:function(value){this.showAllLanguages=value;this._updateListQuery(this.selectedTreeItems);if(this.get("isSearching")){var _130c=this.get("searchListQuery");this._updateSearchListQuery(_130c.queryText);}this.treeStoreModel.set("showAllLanguages",value);},setTreePaths:function(_130d){if(!epi.areEqual(_130d,this.get("treePaths"))){this._treePathsSetter(_130d);}},_treePathsSetter:function(value){this.treePaths=value;this._saveTreePaths(value);this._changeAttrValue("selectedListItems",null);var _130e=lang.clone(value);var _130f=_130e?_130e.map(function(path){return path.pop();}):null;this.set("selectedTreeItems",_130f);},_selectedTreeItemsSetter:function(value){this.selectedTreeItems=value;this._updateListQuery(value);if(!this.get("isSearching")){this._updateCommands(value);}},setSelectedListItems:function(_1310){this._selectedListItemsSetter(_1310);},_selectedListItemsSetter:function(value){this.selectedListItems=value;if(!this.get("isSearching")){this._updateCommands(value);}},setSelectedSearchResults:function(_1311){this._selectedSearchResultsSetter(_1311);},_selectedSearchResultsSetter:function(value){this.selectedSearchResults=value;this._updateCommands(value);},updateTreeCommands:function(){this._updateCommands(this.get("selectedTreeItems"));},updateListCommands:function(){this._updateCommands(this.get("selectedListItems"));},_setupSelection:function(){if(!this.roots||!this.roots.length){return null;}when(this.getCurrentContext(),function(ctx){if(this._isSupportedContent(ctx)){this.contentContextChanged(ctx,null);return;}when(this._loadTreePaths()).then(function(paths){if(!paths){paths=this._getDefaultTreePaths();}when(paths).then(function(paths){this.set("treePaths",paths);}.bind(this));}.bind(this));}.bind(this));},_getDefaultTreePaths:function(){if(!this.roots||!this.roots.length){return [];}var _1312=_12d5.toContentReference(this.roots[0]).toString();return this.store.get(_1312).then(function(model){return [[this.treeStoreModel.root,model]];}.bind(this));},_setupTreeStoreModel:function(){if(!this.treeStoreModelClass){this.treeStoreModelClass=this.enableContextualContent?_12d7:_12d6;}var _1313=this.treeStoreModel||new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,autoSelectPastedItem:false,onAddDelegate:lang.hitch(this,function(node){var _1314=_12cb.getEnclosingWidget(node.domNode),_1315=_1314&&_1314.item,_1316=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_1315);if(_1316){node.edit();var _1317=function(){topic.publish("/epi/cms/contentdata/childrenchanged",_1315.parentLink);};var _1318=node.on("rename",function(){_1318.remove();_1317();});var _1319=node.on("cancelEdit",function(){_1319.remove();_1317();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),onPasteItemsFailed:lang.hitch(this,this._pasteItemsFailed),additionalQueryOptions:{sort:this._getSortSettings()}});this.own(_1313,_12c8.after(_1313,"rename",this._afterRename.bind(this)));this.set("treeStoreModel",_1313);},_afterRename:function(_131a){return _131a.then(function(_131b){return this.store.refresh(_131b.contentLink).then(function(item){var _131c=this.selectedTreeItems;if(_131c&&_131c.length===1){if(_131c[0].contentLink===item.contentLink){this.set("selectedTreeItems",[item]);}}}.bind(this));}.bind(this));},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){var roots=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[];when(this.getCurrentContent()).then(lang.hitch(this,function(_131d){var _131e=_131d&&_131d.assetsFolderLink;if(_131e&&typeof this._getPseudoContextualContent==="function"&&_131e!==this._getPseudoContextualContent()){roots.push(_131e);}})).always(lang.hitch(this,function(){this.set("searchRoots",roots.join(","));}));},_setupCommands:function(){var _131f={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var index=1;array.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _12df(lang.mixin({typeIdentifier:type},_131f)),order:index};index=index+1;},this);this.createCommands=this.getCreateCommands(index);var _1320=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);var _1321={rename:{command:new _12e0(_131f),order:10},cut:{command:new _12da(_131f),order:20},copy:{command:new _12d9(_131f),order:30},paste:{command:new _12dc(lang.mixin({typeIdentifiers:this.mainNavigationTypes},_131f)),order:40},edit:{command:new _12de(lang.mixin({forceReload:true,forceContextChange:true,typeIdentifiers:_1320},_131f)),order:3},translate:{command:new _12e1(_131f)},"delete":{command:new _12db(_131f),order:50},trash:{command:new _12dd({typeIdentifiers:this.mainNavigationTypes,order:60}),order:60}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_1321);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_setCommands:function(){var _1322=[];_12e2.get().forEach(function(_1323){_1323.category="context";_1322.push(_1323);});this._pluginCommands=_1322;var _1324=this._commandRegistry.toArray().concat(_1322);this.set("commands",_1324);},_pasteItemsFailed:function(_1325){this.set("selectedListItems",_1325);},_updateListQuery:function(items){var query=null;if(items&&items.length>0){query=this._createListChildrenQuery(items);this.set("noDataMessage",items.length>1?this.noDataMessages.multiple:this.noDataMessages.single);}this.set("listQuery",query);},_createListChildrenQuery:function(items){var _1326=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);var ids=items.map(function(item){return item.contentLink.toString();});return {references:ids,query:"getchildren",allLanguages:this.showAllLanguages,typeIdentifiers:_1326};},_updateSearchListQuery:function(_1327){var query=null;if(_1327){query=this._createListSearchQuery(_1327);}this.set("searchListQuery",query);},_createListSearchQuery:function(_1328){return {queryText:_1328,query:"searchcontent",allLanguages:this.showAllLanguages,contentSearchAreas:this.get("searchArea"),searchRoots:this.get("searchRoots"),maxResults:1000,filterDeleted:true};},_updateCommands:function(_1329){if(epi.areEqual(this._commandItems,_1329)){return;}this._commandItems=_1329;this._updateSelection(_1329);this._updateCommandModels(_1329);if(_1329&&_1329.length===1){this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}},_updateSelection:function(_132a){var _132b=_132a?_132a.map(function(_132c){return {type:"epi.cms.contentdata",data:_132c};}):[];this.selection.set("data",_132b);},_updateCommandModels:function(_132d){var _132e=this.createCommands;for(var key in _132e){_132e[key].command.set("model",_132d);}this._pluginCommands.forEach(function(_132f){_132f.set("model",_132d);});},_saveTreePaths:function(_1330){this._profile.set(this.componentId+"_treePaths",_1330);},_loadTreePaths:function(){return this._profile.get(this.componentId+"_treePaths");},_getPseudoContextualCommands:function(){var key,_1331=[];for(key in this.createCommands){_1331.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_1331.push(this.createHierarchyCommands[key].command);}_1331.push(this._commandRegistry.paste.command);return _1331;},upload:function(_1332){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_1333,_1334){return _1333(_1334,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_1335,copy){this.set("copy",copy);this.set("data",_1335);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_1336,_1337){return _1336(_1337,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_1338,_1339,when,lang,_133a,_133b,_133c){return _1338([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_133d){lang.mixin(this,_133d);},_isSiteMultilingual:function(){var _133e=new _1339();if(this._cachedValue!==undefined){_133e.resolve(this._cachedValue);return _133e;}if(!this._siteTreeModel){var _133f=_133a.resolve("epi.storeregistry"),_1340=_133f.get("epi.cms.sitestructure");this._siteTreeModel=new _133c({store:_1340});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(items){this._cachedValue=items.length>=2;_133e.resolve(this._cachedValue);}));return _133e;},_contentExistsInCurrentLanguage:function(_1341){if(!_1341){return false;}if(_1341.capabilities&&!_1341.capabilities.language){return true;}if(!_1341.currentLanguageBranch){return false;}return _133b.currentContentLanguage===_1341.currentLanguageBranch.languageId;}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(array,_1342,lang,_1343,_1344,_1345,_1346){return _1342([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_1345,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1343.resolve("epi.cms.contentRepositoryDescriptors");_1342.safeMixin(this,this.contentRepositoryDescriptors.get(this.repositoryKey));this.commandCategory=this.commandCategory||"context";var _1347={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_1347.ROOT|_1347.TREE;},getCreateCommands:function(index){var _1348={};var _1349=index||1;if(!this.creatableTypes){return _1348;}array.forEach(this.creatableTypes,function(type){_1348[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_1349};_1349=_1349+1;},this);if(this.creatableTypes.length<2){return _1348;}var _134a=new _1344({label:_1346.action["new"],commands:_1348});return {popupCommand:{command:_134a,order:index}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(array,_134b,_134c,_134d,_134e,_134f){return _134b([_134d,_134e],{category:"popup",canExecute:true,popup:null,popupClass:_134f,popupCategory:"context",_commandsSetter:function(value){if(!value){return;}var _1350=[];if(value instanceof Array){_1350=value;}else{for(var index in value){_1350.push(value[index].command);}}this.commands=_1350;this._updateIsAvailable();},_popupSetter:function(popup){this.popup=popup;popup.addProvider(this);},_updateIsAvailable:function(){var _1351=array.some(this.get("commands"),function(_1352){return _1352.get("isAvailable");});this.set("isAvailable",_1351);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(array,_1353,lang,_1354,topic,when,all,_1355,_1356,_1357,_1358){return _1353([_1356],{contentType:null,createAsLocalAsset:false,postscript:function(){this.inherited(arguments);var _1359=this.contentType;this.label=this.label||_1357.getResourceValue(_1359,"create");this.tooltip=this.tooltip||_1357.getResourceValue(_1359,"createdescription");this.iconClass=this.iconClass||_1357.getValue(_1359,"commandIconClass");if(!this.store){var _135a=_1355.resolve("epi.storeregistry");this.store=_135a.get("epi.cms.contenttype");}},_execute:function(){topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,view:_1357.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}this.set("canExecute",this._canExecute());var model=this.model;if(!model){this.set("isAvailable",false);return;}when(this._getContentType(model),lang.hitch(this,function(_135b){if(!_135b){this.set("isAvailable",false);return;}when(this._checkAvailability(_135b.availableContentTypes),lang.hitch(this,function(_135c){this.set("isAvailable",_135c);}));}));},_canExecute:function(){var model=this.model,_135d=_1358.action.Create,_135e=_1358.providerCapabilities.Create,_135f=model&&!(model.isWastebasket||model.isDeleted)&&_1358.hasLanguageAccess(model)&&_1358.isActionAvailable(model,_135d,_135e,true);return !!_135f;},_getContentType:function(model){if(!model){return null;}return this.store.get(model.contentTypeID);},_checkAvailability:function(_1360){if(_1360.length===0){return false;}var _1361=new _1354();var _1362=array.map(_1360,lang.hitch(this,function(_1363){return this.store.get(_1363);}));when(all(_1362),lang.hitch(this,function(_1364){var _1365=array.some(_1364,lang.hitch(this,function(_1366){return _1357.isBaseTypeIdentifier(_1366.typeIdentifier,this.contentType);}));_1361.resolve(_1365);}));return _1361;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_1367,array,epi,_1368,_1369,_136a){return _1367([_1368,_1369,_136a],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_136b=this.selection.data,_136c=false;if(model&&_136b.length){_136c=array.every(_136b,function(item){return model.canCopy(item.data);});}this.set("canExecute",_136c);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_136d,epi,_136e,_136f,_1370){return _136d([_136e,_136f,_1370],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_1371=this.selection.data,_1372=false;if(model&&_1371.length){_1372=array.every(_1371,function(item){return model.canCut(item.data);});}this.set("canExecute",_1372);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_1373,lang,_1374,topic,when,_1375,_1376,_1377,_1378,_1379,_137a,_137b){return _1373([_1377,_1378,_1379],{label:_137a.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var model=this.model,_137c=this.clipboard,_137d=this.selection.data,_137e=this.hasWastebasket?model.move(_137d,{contentLink:_1375.wastebasketPage,isWastebasket:true}):model.remove(_137d);return when(_137e,lang.hitch(this,function(){var _137f=[];if(_137c&&_137c.data){_137d.forEach(function(_1380){var map=_137c.data.map(function(_1381){return model.isAncestor(_1380.data,_1381.data);});_137f=_137f.concat(map);});}when(_1374(_137f),function(_1382){var _1383=_1382.every(function(_1384){return _1384;});if(_1383){_137c.clear();}});}),lang.hitch(this,function(){topic.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_1385){this.hasWastebasket=_1385;this.set("iconClass",_1385?"epi-iconTrash":"epi-iconClose");this.set("label",_1385?_137a.movetotrash:_137b.action.deletelabel);},_onModelChange:function(){var model=this.model,_1386=this.selection.data,_1387=function(item){var _1388=item.data;return _1388&&!_1388.isDeleted&&model.canDelete(_1388);},_1389=function(item){var _138a=item.data;return _138a&&_1376.hasProviderCapability(_138a.providerCapabilityMask,_1376.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_1386.length&&_1386.every(_1389));this.set("canExecute",!!(model&&_1386.length)&&_1386.every(_1387)&&(this.hasWastebasket||!_1386.some(_1389)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager"],function(array,_138b,lang,_138c,when,epi,_138d,_138e,_138f,_1390){return _138b([_138d,_138e,_138f],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",typeIdentifiers:null,createAsLocalAsset:false,_execute:function(){var _1391=this.get("clipboardData"),_1392=this._getSingleSelectionData();this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_1391,_1392);}else{return when(this.model.move(_1391,_1392),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,model=self.model,_1393=self.get("clipboardData"),_1394=self._getSingleSelectionData();self.set("canExecute",false);var _1395=!!_1394&&this._isTargetOfCorrectType(_1394);this.set("isAvailable",_1395);if(model&&_1393&&_1393.length&&_1394){var _1396=array.map(_1393,function(item){return model.canPaste(item.data,_1394,self.clipboard.copy);});when(_138c(_1396),function(_1397){var _1398=array.every(_1397,function(_1399){return _1399;});if(self.clipboard.copy){self.set("canExecute",_1398);return;}model.getAncestors(_1394,function(_139a){var _139b=array.some(_1393,function(item){return array.indexOf(_139a,item.data)>=0;});self.set("canExecute",_1398&&!_139b);});});}},_isTargetOfCorrectType:function(_139c){if(!this.typeIdentifiers){return true;}return this.typeIdentifiers.some(function(type){return _1390.isBaseTypeIdentifier(_139c?_139c.typeIdentifier:"",type);},this);}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_139d,lang,topic,when,_139e,_139f,_13a0,_13a1){return _139d([_13a0],{label:_13a1.viewtrash,category:"setting",typeIdentifiers:null,postscript:function(){this.inherited(arguments);var store=this.store||_139e.resolve("epi.storeregistry").get("epi.cms.content.light"),_13a2=store.get(_139f.wastebasketPage.toString());when(_13a2,lang.hitch(this,function(_13a3){this.set("canExecute",_13a3.statusCode!==403);}));},_execute:function(){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_139f.wastebasketPage},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/asset/command/ChangeContextToSelection":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_13a4,topic,_13a5,_13a6,_13a7,_13a8,_13a9){return _13a4([_13a6,_13a7],{contentActionSupport:null,forceContextChange:false,forceReload:false,viewType:null,viewName:null,typeIdentifiers:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13a5;},_execute:function(){var _13aa=this._getSingleSelectionData();topic.publish("/epi/shell/context/request",{uri:_13aa.uri},{sender:null,forceReload:this.forceReload,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){var _13ab=this._getSingleSelectionData();if(!_13ab){this.set("canExecute",false);this.set("isAvailable",false);return;}var _13ac=this.contentActionSupport.hasAccess(_13ab.accessMask,this.contentActionSupport.accessLevel.Read);var _13ad=this._isTargetOfCorrectType(_13ab);this.set("isAvailable",_13ad);this.set("canExecute",_13ad&&_13ac);if(this.contentActionSupport.hasAccess(_13ab.accessMask,this.contentActionSupport.accessLevel.Edit)){this.set("label",_13a9.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_13a9.view);this.set("iconClass","epi-iconSearch");}},_isTargetOfCorrectType:function(_13ae){if(!this.typeIdentifiers){return true;}return this.typeIdentifiers.some(function(type){return _13a8.isBaseTypeIdentifier(_13ae.typeIdentifier,type);},this);}});});},"epi-cms/asset/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(array,_13af,lang,topic,when,_13b0,_13b1,_13b2,_13b3,_13b4){return _13af([_13b0,_13b1],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _13b5=this.typeIdentifier;this._defaultName=_13b2.getResourceValue(_13b5,"newitemdefaultname");var _13b6=_13b2.getResourceValue(_13b5,"create");this.set("label",_13b6);this.set("tooltip",_13b6);},_execute:function(){var self=this,_13b7=self._getSingleSelectionData(),_13b8=(new _13b3(_13b7.contentLink)).createVersionUnspecificReference().toString(),_13b9=self.createAsLocalAsset;var _13ba=function(_13bb){self.model.getChildren(_13bb,function(_13bc){when(self.model.add({parentLink:_13b8,name:self._getUniqueFolderName(_13bc,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_13b9},self.onRefreshSelection),function(_13bd){if(_13bd.parentLink!==_13b8){topic.publish("/epi/cms/action/createlocalasset");}});});};if(_13b9){when(self.model.store.refresh(_13b8),function(_13be){when(self.model.store.get(_13be.assetsFolderLink),_13ba);});}else{_13ba(_13b7);}},_onModelChange:function(){var _13bf=this._getSingleSelectionData(),_13c0=_13b4.action.Create,_13c1=_13b4.providerCapabilities.Create,_13c2=!!this.model&&!!_13bf&&_13b4.isActionAvailable(_13bf,_13c0,_13c1,true),_13c3=_13c2&&_13b2.isBaseTypeIdentifier(_13bf.typeIdentifier,this.typeIdentifier);this.set("isAvailable",_13c3);this.set("canExecute",_13c2);},_getUniqueFolderName:function(arr,_13c4){var _13c5=function(times){var name=times>0?lang.replace(_13c4+" {0}",[times]):_13c4;if(times>1000){return name;}var _13c6=array.some(arr,function(child){return lang.trim(child.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_13c6){times=times+1;return _13c5(times);}return name;};return _13c5(0);}});});},"epi-cms/asset/command/RenameSelectedFolder":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager"],function(_13c7,epi,_13c8,_13c9,_13ca,_13cb){return _13c7([_13c9,_13ca],{label:epi.resources.action.rename,contentActionSupport:null,iconClass:"epi-iconRename",renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13c8;},_execute:function(){this.renameDelegate(this._getSingleSelectionData());},_onModelChange:function(){var _13cc=this._getSingleSelectionData();var _13cd=!!_13cc&&_13cb.isBaseTypeIdentifier(_13cc.typeIdentifier,this.typeIdentifier)&&!((this.model.isContextualContent&&this.model.isContextualContent(_13cc))||this.model.isRoot(_13cc.contentLink));var _13ce=_13cd&&this.renameDelegate&&this.contentActionSupport.hasAccess(_13cc.accessMask,_13c8.accessLevel[_13c8.action.Edit]);this.set("isAvailable",_13cd);this.set("canExecute",_13ce);}});});},"epi-cms/asset/command/TranslateSelectedContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin"],function(_13cf,topic,_13d0,_13d1,_13d2){return _13cf([_13d1,_13d2],{label:_13d0.label,executingLabel:_13d0.executinglabel,tooltip:_13d0.title,category:"context",_execute:function(){var model=this._getNormalizedModel();var data={contentData:model.content,languageBranch:model.language.preferredLanguage};topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);},_onModelChange:function(){var model=this._getNormalizedModel(),_13d3=model&&model.language,_13d4=model&&model.content.isDeleted,_13d5=_13d3&&_13d3.isTranslationNeeded&&!_13d4,_13d6=_13d5&&_13d3.hasTranslationAccess&&_13d3.isPreferredLanguageAvailable;if(model&&typeof model.content.canTranslateContent==="function"){var _13d7=model.content.canTranslateContent();_13d5=_13d5&&_13d7;_13d6=_13d6&&_13d7;}this.set("isAvailable",!!_13d5);this.set("canExecute",!!_13d6);},_getNormalizedModel:function(){var model=this._getSingleSelectionData();if(model){return {content:model.contentData||model,language:model.languageContext||model.missingLanguageBranch};}}});});},"epi-cms/plugin-area/assets-pane":function(){define(["epi/PluginArea","epi-cms/content-approval/command/EditApprovalDefinition"],function(_13d8,_13d9){var _13da=new _13d8("epi-cms/assets-pane/commands[]");_13da.add(_13d9);return _13da;});},"epi-cms/content-approval/command/EditApprovalDefinition":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.contentapproval.command.edit","epi/shell/command/_Command"],function(_13db,_13dc,_13dd,_13de,_13df){return _13db([_13df],{canExecute:false,contentActionSupport:null,iconClass:"epi-iconApproval",isAvailable:false,label:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_13dd;this.approvalService=this.approvalService||_13dc.resolve("epi.cms.ApprovalService");},_onModelChange:function(){if(this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}if(!this.model){this._setEnabledState(false);return;}this._setEnabledState(true);var _13e0=this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Administer);this.set("label",_13e0?_13de.editlabel:_13de.viewlabel);},_setEnabledState:function(_13e1){this.set("canExecute",!!_13e1);var _13e2=this.canExecute&&!this.model.ownerContentLink&&this.model.capabilities.canconfigureapproval;this.set("isAvailable",!!_13e2);},_execute:function(){this.approvalService.navigateToDefinition(this.model.contentLink);}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Stateful"],function(array,_13e3,lang,when,_13e4){return _13e3([_13e4],{upload:function(_13e5){return when(this._filterUploadingFiles(_13e5),function(_13e6){if(!_13e6||!(_13e6.existingContents instanceof Array)||_13e6.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_13e5};}return {showConfirmation:true,uploadingFiles:_13e5,newFiles:_13e6.newFiles,existingContents:_13e6.existingContents};});},_filterUploadingFiles:function(_13e7){var self=this;if(!self.store){return null;}var query=lang.clone(self.get("query"));query.typeIdentifiers=query.typeIdentifiers||[];var _13e8="episerver.core.icontentmedia";if(query.typeIdentifiers.indexOf(_13e8)<0){query.typeIdentifiers.push(_13e8);}return when(self.store.query(query),function(_13e9){var _13ea=array.filter(_13e9,function(_13eb){return _13eb.typeIdentifier!=="episerver.core.icontentfolder"&&array.some(_13e7,function(file){return file.name.toLowerCase()===_13eb.name.toLowerCase();});});var _13ec=array.filter(_13e7,function(file){return array.every(_13e9,function(_13ed){return file.name.toLowerCase()!==_13ed.name.toLowerCase();});});return {existingContents:_13ea,newFiles:_13ec};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/form/Uploader","epi/routes","epi/shell/DialogService","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi/shell/form/uploader/HTML5"],function(array,_13ee,lang,_13ef,_13f0,when,_13f1,_13f2,_13f3,_13f4,_13f5,_13f6,_13f7,_13f8,_13f9,_13fa,_13fb,_13fc){return _13ee([_13f2,_13f3,_13f4,_13f1],{res:_13fc,_isCompleted:true,templateString:_13fb,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _13f8();},upload:function(_13fd){var self=this,_13fe=self.uploaderInput,_13ff=self._getUploadSettings();when(self.model.upload(_13fd),function(_1400){when(self._confirm(_1400),function(_1401){self._resetUploader();if(!(_1401 instanceof Array)||_1401.length===0){self._onUploadComplete();return;}self._fileListModel.set("uploadFiles",_1401);_13fe._files=_1401;_13fe.upload(_13ff);});});},close:function(){var self=this,files=self.uploaderInput._files,_1402=function(_1403){self.emit("close",_1403);self.set("disableToolbar",false);};if(self._isCompleted||!files||files.length<=0){_1402(false);}else{_13f7.alert(_13fc.confirmdialog.description).then(function(){_1402(true);});}},_setBreadcrumbAttr:function(parts){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_13ef.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_1404=parts?parts.length:0;if(_1404>0){for(i;i<_1404-1;i++){this.breadcrumbBar._createItem(parts[i],true);}this.breadcrumbBar._createItem(parts[_1404-1],false);}},_setDisableToolbarAttr:function(_1405){this.uploaderInput.set("disabled",_1405);!_1405&&this.uploaderInput.set("tabindex",0);},_setupUploader:function(){var self=this;this.uploaderInput.uploadUrl=_13f6.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});this.own(_13f0.before(this.uploaderInput,"onChange",function(_1406){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}),this.uploaderInput.on("error",function(){self._fileListModel.error();self._onUploadComplete();}));},_getUploadSettings:function(){return {uploadDirectory:this.get("uploadDirectory"),createAsLocalAsset:this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_1407=this.uploaderInput;self._fileListModel=new _13fa();self.fileList.set("model",self._fileListModel);this.own(_1407.on("begin",function(files){if(files&&files.length>0){self._fileListModel.set("showProgressBar",true);}}),_1407.on("progress",function(_1408){self._fileListModel.set("progress",_1408);}),_1407.on("complete",lang.hitch(self,self._onUploadComplete)),_13f0.after(_1407,"reset",lang.hitch(self,self._fileListModel.clear)),_13f0.around(_1407,"onChange",function(_1409){return function(_140a){var _140b=_1407._files;return when(self.model.upload(_140b),function(_140c){return when(self._confirm(_140c),function(_140d){_140d=_13f9.getFileArray(_140d);if(!(_140d instanceof Array)||_140d.length===0){self._resetUploader();return _1409.apply(_1407,[_140a]);}self._fileListModel.set("uploadFiles",_140d);_1407._files=_140d;_1407.upload(self._getUploadSettings());return _1409.apply(_1407,[_140a]);});});};}));},_confirm:function(_140e){return _140e.showConfirmation===true?this._confirmationDialog.showConfirmation(_140e.existingContents,_140e.uploadingFiles,_140e.newFiles):_140e.uploadingFiles;},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){this._fileListModel.set("showProgressBar",false);this.uploaderInput.reset();this.set("disableToolbar",false);},_onUploadComplete:function(evt){this._isCompleted=true;this._fileListModel.update(_13f9.getFileArray(evt));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",this._fileListModel.uploadFiles);}});});},"epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(array,_140f,lang,_1410,_1411,_1412,when,_1413,_1414,_1415,_1416){return _140f(null,{showConfirmation:function(_1417,_1418,_1419){var _141a=new _1412(),_141b=this._getDialog(_1417.length),_141c=this._getContentList();_141b.set("content",_141c);_141b.set("onAction",function(_141d){_141a.resolve(_141d?_1418:_1419);});when(_141b.show(),function(){_141c.grid.renderArray(_1417);});return _141a;},_getDialog:function(_141e){var self=this,_141f=_1413.toHTML(_141e>1?lang.replace(_1416.multiple.heading,[_141e]):_1416.single.heading),_1420=_1413.toHTML(_141e>1?_1416.multiple.description:_1416.single.description);var _1421=new _1414({closeIconVisible:false,title:_1416.title,heading:_141f,description:_1420,dialogClass:"epi-dialog--auto-height",getActions:function(){return self._getActions(this,_141e===1);}});return _1421;},_getActions:function(_1422,_1423){return [{name:"replaceFiles",label:_1423?_1416.single.buttons.replace:_1416.multiple.buttons.replace,title:null,action:function(){when(_1422.hide(),function(){return _1422.onAction(true);});}},{name:"skipFiles",label:_1423?_1416.single.buttons.skip:_1416.multiple.buttons.skip,title:null,action:function(){when(_1422.hide(),function(){return _1422.onAction(false);});}}];},_getContentList:function(){var _1424=new _1415();_1410.add(_1424.grid.domNode,"epi-thumbnailContentList");return _1424;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase"],function(_1425,_1426,_1427,_1428,_1429,_142a){return _1425([_142a],{_gridClass:_1425([_1426,_1427]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(value){this._set("query",value);this._updateQuery(value);},_getBaseSettings:function(_142b){var _142c=function(item){var _142d=new _1428(item.contentLink);return _1429.title(item.name,_142d.id,item.contentTypeName);};var _142e=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_1429.contentItemFactory("name",_142c,null,_142b,_142e,undefined,undefined,true)],deselectOnRefresh:true,sort:this.queryOptions&&this.queryOptions.sort};},_updateQuery:function(query){if(query){this.grid.set("query",query);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/when","./_GridWidgetBase"],function(_142f,lang,_1430,_1431,when,_1432){return _142f([_1432],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,_defaultGridNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _1433=this.getListSettings();_1433=lang.mixin(_1433,this.defaultGridMixin);if(!this.gridAttachNode){this._defaultGridNode=_1430.create("div",null,this.domNode);}this.grid=new this._gridClass(_1433,this.gridAttachNode||this._defaultGridNode);var _1434=this.model&&this.model.commands&&this.model.commands.length>0;if(_1434){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},layout:function(){this.inherited(arguments);if(this._defaultGridNode){_1431.setMarginBox(this._defaultGridNode,this._contentBox);}},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_1435){var grid=this.grid;var model={contextId:_1435.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);model.data.push(row.data);}}this.model.set("model",model);}}));}});});},"epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(array,lang,_1436){return {StatusScope:{Single:0,All:1},validUploadFiles:function(files){if(!files||!(files instanceof Array)||files.length===0){return false;}return !array.some(files,function(item){return (item.name==null||item.size==null);});},addStatus:function(store,scope,_1437,_1438){var _1439=[];if(store instanceof Array){_1439=lang.clone(store);}var _143a=array.some(_1439,function(item){return (item.scope===scope&&item.itemName===_1437&&item.message===_1438);});if(!_143a){_1439.push({scope:scope,itemName:_1437,message:_1438});}return _1439;},filterFileOnly:function(files){return array.filter(files,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},toggleVisibility:function(_143b,_143c){_1436.set(_143b,"display",(_143c?"block":"none"));},getFileArray:function(_143d){if(!_143d){return null;}if(_143d instanceof Array){return _143d;}if(typeof _143d.item!=="function"){return null;}var i=0,total=_143d.length,_143e=[];for(i;i<total;i++){_143e.push(_143d.item(i));}return _143e;}};});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_143f,array,lang,_1440,_1441,_1442){return _143f([_1440],{progress:null,uploadFiles:null,showProgressBar:false,_progressSetter:function(value){this.progress=value;var files=this.get("uploadFiles");var _1443=0;files.forEach(function(_1444){_1443+=_1444.size;if(_1444.status===_1442.uploadform.uploading&&value.bytesLoaded>=_1443){_1444.status=_1442.uploadform.uploaded;}},this);this.set("uploadFiles",files);},_uploadFilesSetter:function(files){if(!_1441.validUploadFiles(files)){return;}var _1445=[];array.forEach(files,function(file){_1445.push({fileName:file.name,size:file.size,status:_1442.uploadform.uploading});},this);this.uploadFiles=_1445;},update:function(_1446){if(!_1446){return;}var files=this.get("uploadFiles");_1446.forEach(function(_1447){var _1448=array.filter(files,function(file){return _1447.fileName===file.fileName;})[0];_1448.contentLink=_1447.contentLink;if(_1447.errorMessage){_1448.status=_1442.uploadform.failed;_1448.statusMessage=_1447.errorMessage;}else{_1448.status=_1442.uploadform.uploaded;}},this);this.set("uploadFiles",files);},error:function(){var files=this.get("uploadFiles");array.forEach(files,function(_1449){_1449.status=_1442.uploadform.failed;_1449.statusMessage=_1442.uploadform.errormessage;});this.set("uploadFiles",files);},clear:function(){this.set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>","epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_144a,lang,_144b,_144c,_144d,_144e,_144f,_1450,_1451,_1452,_1453,_1454,_1455,_1456,_1457,_1458){return _144a([_144f,_1454],{templateString:_1458,modelBindingMap:{showProgressBar:["showProgressBar"],progress:["progress"],uploadFiles:["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(files){this._bindData(files);},_setShowProgressBarAttr:function(show){_1456.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_1459){if(!_1459){return;}this.progressBar.update({progress:_1459.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _145a=_144a([_1450,_1452,_1455]);this._grid=new _145a({columns:{fileName:{label:_1457.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_1457.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _145b=this.convertBytes(file.size).value;if(isNaN(_145b)){return _145b;}var _145c=_145b===0?_1457.bytetext:_1457.bytestext;return lang.replace("{0} {1}",[_145b,_145c]);})},status:{label:_1457.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,value,node,_145d){_144b.set(node,"title",item.statusMessage?item.statusMessage:"");_144d.toggle(node,"epi-failedStatus",item.status===_1457.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_144c.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_145e,_145f,_1460,lang,_1461,_1462,_1463,_1464){return _145f("dijit.ProgressBar",[_1462,_1463],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_1464,_indeterminateHighContrastImagePath:_145e.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_1465){lang.mixin(this,_1465||{});var tip=this.internalProgress,ap=this.domNode;var _1466=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_1466=Math.min(parseFloat(this.progress)/100,1);this.progress=_1466*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_1466=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-labelledby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_1466);_1460.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_1466*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(label){this._set("label",label);this.update();},_setIndeterminateAttr:function(_1467){this.indeterminate=_1467;this.update();},report:function(_1468){return this.label?this.label:(this.indeterminate?"&#160;":_1461.format(_1468,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\r\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\r\n</div>","epi/shell/form/uploader/HTML5":function(){define("epi/shell/form/uploader/HTML5",["dojo/_base/declare","dojo/_base/lang","dojox/form/uploader/plugins/HTML5","epi/shell/request/mutators"],function(_1469,lang,HTML5,_146a){var _146b=_1469([HTML5],{_headers:null,uploadWithFormData:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},sendAsBinary:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},createXhr:function(){var xhr=this.inherited(arguments),_146c=this._headers;if(_146c){for(var key in _146c){if(_146c.hasOwnProperty(key)){xhr.setRequestHeader(key,_146c[key]);}}}return xhr;},_getHeadersThenExecute:function(_146d,args){var _146e={options:{headers:{}}};return _146a.execute("beforeSend",_146e).then(lang.hitch(this,function(_146f){this._headers=_146f.options.headers;var _1470=_146d.apply(this,args);this._headers=null;return _1470;}));}});dojox.form.addUploaderPlugin(_146b);return _146b;});},"epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi/shell/TypeDescriptorManager"],function(_1471,_1472,_1473,_1474,_1475,_1476){return _1471([_1472,_1473],{fileList:null,typeIdentifier:"episerver.core.contentfolder",createAsLocalAsset:false,_execute:function(){var _1477=_1475.toContentReference(this._getParentLink()).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_1477.toString(),this.createAsLocalAsset);this.fileList=null;},_getParentLink:function(){var model=this._getModel();if(this.createAsLocalAsset){return model.ownerContentLink?model.ownerContentLink:model.contentLink;}return model.contentLink;},_onModelChange:function(){var model=this._getModel(),_1478=!!model&&_1474.hasProviderCapability(model.providerCapabilityMask,_1474.providerCapabilities.Create)&&_1474.hasAccess(model.accessMask,_1474.accessLevel.Create),_1479=_1478&&_1476.isBaseTypeIdentifier(model?model.typeIdentifier:"",this.typeIdentifier);this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.set("isAvailable",_1479);this.set("canExecute",!!(_1478&&this.viewModel&&!this.viewModel.get("isSearching")));},_getModel:function(){return this.model instanceof Array?this.model.length===1?this.model[0]:null:this.model;}});});},"epi-cms/command/EditImage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/routes","epi/Url","epi/UriParser","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/shell/command/_SelectionCommandMixin"],function(_147a,lang,topic,_147b,_147c,Url,_147d,_147e,_147f,_1480,_1481,_1482,_1483){return _147a([_1482,_1483],{canExecute:false,iconClass:"epi-iconNewWindow",_segmentIdSeperator:",,",postscript:function(){this.inherited(arguments);this.contextService=this.contextService||_147b.resolve("epi.shell.ContextService");},getRouteParams:function(){var _1484=this._getSingleSelectionData();return this.contextService.query({uri:"epi.cms.contentdata:///"+_1484.contentLink}).then(function(_1485){var _1486=new _147d(_1485.uri).getId();return {moduleArea:"LegacyCMS",path:"Edit/ImageEditor/ImageEditor.aspx",IsInLegacyWrapper:false,imageId:_1486};});},_createDialog:function(_1487,_1488){var _1489=this._getSingleSelectionData();if(_1489){var _148a=function(_148b){if(_148b){topic.publish("/epi/shell/context/request",{url:_148b.src},{forceReload:true});}};lang.mixin(_1487,{url:_147c.getActionPath(_1488),dialogArguments:{src:_1489.permanentLink,contentLink:_1488.imageId},onCallback:_148a});}return new _1481(_1487);},_onModelChange:function(){if(!_147f.imageEditorEnabled){if(this.get("isAvailable")){this.set("isAvailable",false);}this.set("canExecute",false);return;}var _148c=this._getSingleSelectionData(),_148d=_148c&&_147e.isBaseTypeIdentifier(_148c.typeIdentifier,"episerver.core.icontentimage");this.set("isAvailable",!!_148d);this.set("canExecute",!!_148d);},_getTarget:function(){return this._getSingleSelectionData();}});});},"epi-cms/legacy/LegacyDialogPopup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/DeferredList","epi","epi/shell/widget/dialog/Dialog"],function(_148e,lang,_148f,_1490,_1491,_1492,epi,_1493){return _148e([_1493],{url:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showLoadingOverlay:false,legacyDialogObject:null,defaultActionsVisible:false,legacyButtonQuery:null,contentClass:"epi-dialog-fullWidth",dialogClass:"",dialogTitle:null,_legacyDialogContainer:null,_legacyDialogLoadDeferred:null,wrapper:null,buildRendering:function(){this.inherited(arguments);_148f.add(this.domNode,"epi-legacyDialog");},postCreate:function(){this.inherited(arguments);this._legacyDialogContainer=_1490.create("div");this.set("content",this._legacyDialogContainer);},onCallback:function(_1494,_1495){},onClose:function(){},onLoad:function(_1496){},onMapDialogButton:function(_1497){return true;},onBeforePerformAction:function(_1498){},show:function(){var _1499=new _1492([this._loadLegacyDialog(),this.inherited(arguments)]);return _1499.then(lang.hitch(this,function(_149a){var _149b=_149a[1];if(this.features&&this.features.left&&this.features.top){this.dialog._relativePosition={x:this.features.left,y:this.features.top};}return _149b;}));},_loadLegacyDialog:function(){if(this._legacyDialogLoadDeferred){return this._legacyDialogLoadDeferred;}this._legacyDialogLoadDeferred=new _1491();require(["epi-cms/legacy/LegacyDialogWrapper"],lang.hitch(this,function(_149c){var _149d=new _149c({url:this.url,dialogArguments:this.dialogArguments,callbackArguments:this.callbackArguments,features:this.features,autoFit:this.autoFit,showLoadingOverlay:this.showLoadingOverlay,dialogTitle:this.dialogTitle,legacyButtonQuery:this.legacyButtonQuery,showCloseButton:this.showCloseButton,opener:this.opener},this._legacyDialogContainer);if(this._started&&!_149d._started){_149d.startup();}this.legacyDialogObject=_149d.getLegacyDialog();this.connect(_149d,"onMapDialogButton",this.onMapDialogButton);this.connect(_149d,"onBeforePerformAction",this.onBeforePerformAction);this.connect(_149d,"onCallback",function(_149e,_149f){this.onCallback(_149e,_149f);setTimeout(lang.hitch(this,function(){this.hide();}),1);});this.connect(_149d,"onLoad",function(){this.set("title",_149d.title);this.onLoad(_149d);});this.connect(_149d,"onCancel",function(){this.hide();});this.connect(_149d,"onResize",function(){this.resize();});this.connect(this,"onHide",function(){this.onClose();});this.wrapper=_149d;this._legacyDialogLoadDeferred.resolve();}));return this._legacyDialogLoadDeferred;}});});},"epi-cms/contentediting/command/_LegacyDialogCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","epi/routes","epi/shell/command/_Command","epi/UriParser","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup"],function(_14a0,lang,_14a1,topic,_14a2,_14a3,_14a4,_14a5,_14a6){return _14a0([_14a3],{dialogPath:null,raiseCloseEvent:null,routeParams:null,dialogParams:null,canExecute:true,useVersionSpecificLinkInResult:false,getContentReference:function(_14a7){var _14a8=lang.getObject("model.contentData.contentLink",false,this),_14a9=_14a8?new _14a5(_14a8):null;if(_14a9){_14a9=_14a7?_14a9.toString():_14a9.createVersionUnspecificReference().toString();}return _14a9;},getRouteParams:function(){return {id:this.getContentReference(),path:this.dialogPath,moduleArea:"LegacyCMS",IsInLegacyWrapper:true};},getDialogParams:function(){return {};},_createDialog:function(_14aa,_14ab){var _14ac={url:_14a2.getActionPath(_14ab),dialogArguments:window.document,autoFit:true,onClose:lang.hitch(this,function(){var _14ad=this.getContentReference(this.useVersionSpecificLinkInResult);if(this.raiseCloseEvent&&_14ad){topic.publish("/epi/cms/contentdata/updated",{contentLink:_14ad,recursive:true});}})};return new _14a6(lang.mixin({},_14ac,_14aa));},_execute:function(){_14a1([this.getDialogParams(),this.getRouteParams()]).then(lang.hitch(this,function(_14ae){var _14af=this._createDialog.apply(this,_14ae);_14af.show();}));}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_14b0,_14b1,_14b2,has,sniff,when,_14b3,_14b4,_14b5,_14b6,_14b7){return _14b0([_14b5,_14b6],{label:_14b7.download,tooltip:_14b7.download,iconClass:"epi-iconDownload",_execute:function(){var _14b8=this._getContentData();if(!_14b8){return;}_14b3.download(_14b8.downloadUrl,_14b8.name);},_onModelChange:function(){var _14b9=this._getContentData(),_14ba=_14b9&&_14b9.downloadUrl,_14bb=_14b9&&_14b9.typeIdentifier,_14bc=_14bb&&_14b4.getValue(_14bb,"actAsAnAsset"),_14bd=!!(_14bc&&_14ba);this.set("isAvailable",_14bd);this.set("canExecute",_14bd);},_getContentData:function(){var _14be=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_14be=this.selection.data[0].data;}return _14be;}});});},"epi-cms/asset/command/UploadContentToSelection":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi/shell/TypeDescriptorManager"],function(_14bf,_14c0,_14c1,_14c2,_14c3,_14c4,_14c5){return _14bf([_14c0,_14c2,_14c1],{fileList:null,typeIdentifier:"episerver.core.contentfolder",createAsLocalAsset:false,_execute:function(){var _14c6=_14c4.toContentReference(this._getParentLink()).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_14c6.toString(),this.createAsLocalAsset);this.fileList=null;},_getParentLink:function(){var model=this._getSingleSelectionData();if(this.createAsLocalAsset){return model.ownerContentLink?model.ownerContentLink:model.contentLink;}return model.contentLink;},_onModelChange:function(){var model=this._getSingleSelectionData(),_14c7=!!model&&_14c3.hasProviderCapability(model.providerCapabilityMask,_14c3.providerCapabilities.Create)&&_14c3.hasAccess(model.accessMask,_14c3.accessLevel.Create),_14c8=_14c7&&_14c5.isBaseTypeIdentifier(model?model.typeIdentifier:"",this.typeIdentifier);this.set("isAvailable",_14c8);this.set("canExecute",!!(_14c7&&this.viewModel&&!this.viewModel.get("isSearching")));},_viewModelSetter:function(value){this.viewModel=value;this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));}});});},"epi-cms/asset/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/DestroyableByKey","epi/shell/DialogService","epi/shell/widget/ContextMenu","epi/shell/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","./view-model/HierarchicalListViewModel","epi/shell/dnd/tree/multiDndSource","dojo/text!./templates/HierarchicalList.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(array,_14c9,lang,_14ca,_14cb,_14cc,_14cd,keys,on,when,_14ce,_14cf,_14d0,_14d1,_14d2,_14d3,_14d4,_14d5,_14d6,_14d7,_14d8,_14d9,_14da,_14db,_14dc,_14dd,_14de,res){return _14c9([_14d0,_14ce,_14cf,_14d5,_14d4,_14d6],{contextMenu:null,templateString:_14de,showRoot:false,showThumbnail:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_14dc,hierarchicalListClass:"",noDataMessages:null,noSearchResultMessage:res.nosearchresults,createContentIcon:"",createContentText:"",dndSource:_14dd,additionalTreeClass:"epi-secondaryGadgetContainer",modelBindingMap:{searchRoots:["searchRoots"],searchArea:["searchArea"],listQuery:["listQuery"],treePaths:["treePaths"],selectedListItems:["selectedListItems"],searchListQuery:["searchListQuery"],noDataMessage:["noDataMessage"]},_setSearchAreaAttr:function(value){this.searchBox.set("area",value);},_setSelectedListItemsAttr:function(value){this.list.grid.clearSelection();(value||[]).forEach(function(_14df){this.list.grid.select(_14df.contentLink);},this);this._set("selectedListItems",value);},_setSearchRootsAttr:function(value){this.searchBox.set("searchRoots",value);},_setListQueryAttr:function(value){this.list.set("query",value);},_setNoDataMessageAttr:function(value){this.list.set("noDataMessage",value);},_setSearchListQueryAttr:function(value){this.searchResultList.set("query",value);this._showSearchResults(value);},_setTreePathsAttr:function(value){return this.tree.set("paths",value);},_setShowRootAttr:function(value){this.tree.set("showRoot",value);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _14e0=_14c9(this.modelClassName);this.model=this.commandProvider=new _14e0({componentId:this.componentId,repositoryKey:this.repositoryKey,noDataMessages:this.noDataMessages});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _14d8({category:"context",popupParent:this}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_14cb.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();this._toggleCreateContentArea(this.showCreateContentArea);this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)),this.searchBox.on("searchBoxChange",lang.hitch(this,this._onSearchTextChanged)));},startup:function(){this.inherited(arguments);this.model.startup();if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){var _14e1=_14cc.getMarginBox(this.searchBoxNode),_14e2={h:this._contentBox.h-_14e1.h,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_14e2);},_toggleCreateContentArea:function(_14e3){_14cd.set(this.createContentArea.domNode,"display",_14e3?"":"none");this.listContainer.layout();},_toggleActive:function(_14e4){var _14e5="epi-list--is-active";var _14e6="epi-tree--is-active";if(_14e4===this.tree){_14cb.replace(this.domNode,_14e6,_14e5);}else{_14cb.replace(this.domNode,_14e5,_14e6);}},_showNotification:function(_14e7){_14d7.alert(_14d3.toHTML(_14e7));},_onSearchTextChanged:function(_14e8){this.model.setSearchText(_14e8);},_showSearchResults:function(_14e9){_14cd.set(this.contentNode,"display",_14e9?"none":"");_14cd.set(this.resultNode,"display",!_14e9?"none":"");this.container.layout();},_setupTree:function(){var _14ea=this.model._commandRegistry;function _14eb(copy){copy?_14ea.copy.command.execute():_14ea.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_14eb),on(this.tree,"paste",function(){_14ea.paste.command.execute();}),on(this.tree,"delete",function(){_14ea["delete"].command.execute();}),_14ca.after(this.tree,"onFocus",function(){this.model.updateTreeCommands();this._toggleActive(this.tree);}.bind(this)),_14ca.after(this.tree.rootNode,"setChildItems",function(_14ec){this.model.updateTreePaths(_14ec);}.bind(this),true));if(this.contextMenu){this.own(on(this.tree,"showContextMenu",this.contextMenu.forceOpen.bind(this.contextMenu)));}this.tree.onLoadDeferred.then(function(){this.own(this.tree.watch("paths",function(_14ed,old,_14ee){this.model.setTreePaths(_14ee);}.bind(this)));}.bind(this));_14ea.rename.command.set("renameDelegate",lang.hitch(this,function(model){this.tree.getNodesByItem(model)[0].edit();}));this.tree.supportedDndSources=[this.tree.dndController,this.list.grid.dndSource];},_setupCreateContentArea:function(){this.createContentAreaButton.set("iconClass",this.createContentIcon);this.createContentAreaButton.set("label",this.createContentText);this.own(this.createContentAreaButton.on("click",lang.hitch(this,"_onCreateAreaClick")));},_setupList:function(){var _14ef=this.model._commandRegistry;this.own(on(this.model,"setPathsAndItems",function(_14f0,_14f1){this.model.set("treePaths",_14f0);this.set("treePaths",_14f0).then(function(){this.model.set("selectedListItems",_14f1);}.bind(this));}.bind(this)),_14ca.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_14f2){when(_14f2,lang.hitch(this,this.editContent));})),this.searchResultList.grid.addKeyHandler(keys.ESCAPE,lang.hitch(this.searchBox,this.searchBox.clearValue)),_14ca.after(this.model.treeStoreModel,"onDeleted",lang.hitch(this,function(items){array.forEach(items,function(item){var _14f3=this.searchResultList.grid.row(item.contentLink);if(_14f3&&_14f3.data){this.searchResultList.grid.removeRow(_14f3);}},this);}),true),_14ca.after(this.list,"onFocus",function(){this.model.updateListCommands();this._toggleActive(this.list);}.bind(this)),on(this.searchResultList,"selectionChanged",function(e){this.model.setSelectedSearchResults(e.selection);}.bind(this)),on(this.list,"selectionChanged",function(e){this.model.setSelectedListItems(e.selection);}.bind(this)),on(this.list.grid.domNode,"dgrid-refresh-complete",function(){var _14f4=this.get("selectedListItems");this.list.grid.clearSelection();if(_14f4){_14f4.forEach(function(item){this.list.grid.select(item.contentLink);},this);}}.bind(this)));this.searchBox.on("keyup",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER){e.preventDefault();this.searchResultList.editSelectedContent();}}));this.searchBox.on("keydown",lang.hitch(this,function(e){if(e.keyCode===keys.DOWN_ARROW||e.keyCode===keys.UP_ARROW){e.preventDefault();this.searchResultList.grid.moveSelection(e.keyCode===keys.UP_ARROW);}}));if(this.model.changeContextOnItemSelection){var _14f5=function(){_14ef.edit.command.execute();};this.own(on(this.list,"itemAction",_14f5),on(this.searchResultList,"itemAction",_14f5));}if(this.showThumbnail){_14cb.add(this.list.grid.domNode,"epi-thumbnailContentList");_14cb.add(this.searchResultList.grid.domNode,"epi-thumbnailContentList");}this.list.set("selectionMode","extended");this.searchResultList.set("selectionMode","extended");this.searchResultList.set("noDataMessage",this.noSearchResultMessage);this._handleListKeyEvents();},_handleListKeyEvents:function(){var _14f6=this.model._commandRegistry,_14f7=this.list;this.own(on(_14f7,"copyOrCut",function copyOrCuthandler(copy){copy?_14f6.copy.command.execute():_14f6.cut.command.execute();}),on(_14f7,"paste",function(){this.tree.focus();_14f6.paste.command.execute();}.bind(this)),on(_14f7,"delete",function(){_14f6["delete"].command.execute();}));},_onCreateAreaClick:function(){},_updateClipboardIndicators:function(name,_14f8,_14f9){var _14fa=this.model.clipboardManager.isCopy();if(_14f8 instanceof Array){array.forEach(_14f8,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);this.searchResultList.toggleCut(clip.data,false);},this);}if(!_14fa&&_14f9 instanceof Array){array.forEach(_14f9,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);this.searchResultList.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi/shell/widget/_FocusableMixin","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(array,_14fb,lang,_14fc,_14fd,_14fe,json,when,_14ff,_1500,_1501,_1502,_1503,_1504,_1505,_1506){return _14fb([_1505,_1503],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_14fe.around(self.model,"onRefreshRoots",function(_1507){return function(_1508){if(_1508&&typeof self._onItemDelete==="function"){self._onItemDelete(_1508);}return _1507.apply(self.model,[_1508]);};}));},toggleCut:function(item,isCut){var node=this.tree.getNodesByItem(item)[0];if(node){_14fd.toggle(node.rowNode,"epi-opacity50",isCut);}},_createTreeModel:function(){return new _1506({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}array.forEach(node.getChildren(),function(_1509){_1509.set({item:lang.mixin(_1509.item,{isDeleted:true})});this._updateItemDeletedHierachy(_1509);},this);},_onDeleted:function(item){var nodes=this.getNodesByItem(item);array.forEach(nodes,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _150a=lang.trim(name),_150b=this.getNodesByItem(item)[0];if(_150a){when(this.model.rename(item.contentLink,_150a)).otherwise(function(ex){_150b.rollbackLabel(item.name,ex);_150b.edit();});}else{_150b.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _150c=new _1504(args);_150c.bindContextMenu(this.contextMenu);this.own(_150c.on("rename",lang.hitch(this,function(val){this._renameFolder(_150c.item,val);})));return _150c;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();},checkAcceptance:function(_150d,nodes){if(this.tree.supportedDndSources){return this.tree.supportedDndSources.indexOf(_150d)>=0;}else{return this.inherited(arguments);}}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_150e,lang,_150f,_1510,_1511,_1512,_1513,_1514,keys,on,when,_1515,_1516,_1517,_1518,_1519,epi,_151a){_150e("_TreeInlineEditor",[_1519._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});return _150e([_151a,_1513],{templateString:_1516,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_1512.set(this.iconNodeMenu,"zIndex",_1511.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _1519({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!==keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_1510.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,error){if(!this.labelWidget.value){this._resetValue(val);}if(error&&error.length>0){this._setEditorState(error[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _1514();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _1514();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_151b){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _151c=this._currentRowState;this._currentRowState=_151b?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_151c;this._updateStyle();if(_151b){this.emit("nodeSelected",this);}},setFocusable:function(_151d){this.inherited(arguments);_1510.toggle(this.domNode,"epi-folderTreeNode--focused",_151d);},_updateIndividualLayout:function(){this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_1510.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_1510.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");_1510.add(this.domNode,"epi-folderTreeNode--hovered");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();_1510.remove(this.domNode,"epi-folderTreeNode--hovered");},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_151e){var _151f=this._rowStates;switch(_151e){case _151f.SELECTED:case _151f.ENTERED:if(this.contextMenu){_1510.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_1510.remove(this.iconNodeMenu,this._blockFolderMenu);}_1510.remove(this.iconNode,this._blockFolderExpand);_1510.remove(this.iconNode,this._blockFolderCollapse);var _1520=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_1510.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_1520);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_1510.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){if(this._destroyed){return;}for(var _1521 in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_1521],10)>0){this._updateStyleBySingleState(this._rowStates[_1521]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_150f.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_1522){if(this._editWidget){_1522=_1515.encode(_1522);this._editWidget.invalidMessage=_1522||"";this._editWidget.set("state",_1522?"Error":"");this._editWidget.isValid=function(){return !_1522;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dojo/keys","dojo/on","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi/epi","epi/shell/dgrid/Formatter","epi/shell/dgrid/selection/Extensions","epi/shell/TypeDescriptorManager","epi/shell/widget/_FocusableMixin","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_1523,_1524,lang,_1525,_1526,_1527,_1528,keys,on,_1529,_152a,_152b,_152c,epi,_152d,_152e,_152f,_1530,_1531,_1532,DnD,_1533,_1534){return _1523([_1534,_1530,_1528],{_gridClass:_1523([_152a,_152d,_152b,_152e,DnD,_1529,_1533]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_1525.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(value){if(!this.get("editingItem")){this.set("editingItem",value);}this._set("currentItem",value);this.select(value);},_setNoDataMessageAttr:function(value){this.noDataMessage=value;this.grid.set("noDataMessage",value);},_dndNodeCreator:function(item,hint){var _1535=_152f.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_1535&&this.dndTypes){_1535=this.dndTypes;}return {node:_1526.create("div").appendChild(document.createTextNode(item.name)),type:_1535,data:item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(_1527.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)),this.grid.on("dgrid-contextmenu",lang.hitch(this,"_itemSelected")));this._bindKeys();},_bindKeys:function(){var self=this;function _1536(key,_1537,_1538,_1539){return self.grid.addKeyHandler(key,function(e){if(_1539||_1524.isCopyKey(e)){e.preventDefault();_1538?self.emit(_1537,_1538):self.emit(_1537);}});};this.own(_1536("C".charCodeAt(0),"copyOrCut",true),_1536("X".charCodeAt(0),"copyOrCut",false),_1536("V".charCodeAt(0),"paste"),_1536(keys.DELETE,"delete",undefined,true));},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"&&evt.rows[0].data){this._itemSelected(evt.rows[0].element);}},_itemSelected:function(_153a){var row=this.grid.row(_153a);this.emit("itemSelected",row.data);},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},editSelectedContent:function(){var _153b=this.grid.getFirstSelectedRow();if(!_153b){return;}this.editContent(_153b.data);},_onChangeContext:function(evt){var grid=this.grid;on.once(grid.domNode,"dgrid-refresh-complete",function(evt){grid.focus(grid.getFirstSelectedRow());});this.editContent(grid.row(evt).data);},toggleCut:function(item,isCut){var row;if(item){row=this.grid.row(_1531.toContentReference(item.contentLink).id);if(row&&row.element){_1525.toggle(row.element,"epi-opacity50",isCut);}}}});});},"url:epi-cms/asset/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxNode\">\r\n        <div data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi/shell/widget/SearchBox\"\r\n             data-dojo-props=\"triggerContextChange: this.triggerContextChange, triggerChangeOnEnter: true, encodeSearchText: true\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n\r\n        <div data-dojo-attach-point=\"contentNode\">\r\n            <div class=\"epi-gadgetTopContainer ${additionalTreeClass}\"\r\n                 data-dojo-attach-point=\"tree\"\r\n                 data-dojo-type=\"epi-cms/widget/FolderTree\"\r\n                 data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu, dndSource: this.dndSource\"></div>\r\n            <div class=\"epi-gadgetBottomContainer\"\r\n                 data-dojo-attach-point=\"listContainer\"\r\n                 data-dojo-type=\"dijit/layout/BorderContainer\"\r\n                 data-dojo-props=\"region:'bottom', splitter:true, gutters: false\">\r\n                <div class=\"epi-createContentContainer\"\r\n                     data-dojo-attach-point=\"createContentArea\"\r\n                     data-dojo-type=\"dijit/layout/_LayoutWidget\"\r\n                     data-dojo-props=\"region:'top', splitter:false\">\r\n                    <button type=\"button\" class=\"epi-flat epi-chromeless\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-attach-point=\"createContentAreaButton\"></button>\r\n                </div>\r\n                <div data-dojo-attach-point=\"list\"\r\n                     data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                     data-dojo-props=\"region:'center', splitter:false, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"resultNode\" style=\"display:none\">\r\n            <div data-dojo-attach-point=\"searchResultList\"\r\n                 data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                 data-dojo-props=\"region:'center', splitter:false, store: this.model.searchStore, queryOptions: this.model.searchResultQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/on","dijit/_Widget","dijit/_TemplatedMixin","epi/shell/widget/_ModelBindingMixin","./viewmodel/FilesUploadDropZoneViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_153c,_153d,_153e,on,_153f,_1540,_1541,_1542,_1543,_1544){return _153c([_153f,_1540,_1541],{res:_1543,templateString:_1544,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,validSelection:true,descriptionText:null,settings:null,model:null,modelBindingMap:{descriptionText:["descriptionText"],enabled:["enabled"],validSelection:["validSelection"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1542();},postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.own(on(this.outsideDomNode,"dragenter",this._onDragEnter.bind(this)),on(this.outsideDomNode,"dragend",this._onDragLeave.bind(this)),on(this.outsideDomNode,"drop",this._onDragLeave.bind(this)));}this.own(on(this.dropArea,"dragover",this._onDragOver.bind(this)),on(this.dropArea,"dragleave",this._onDragLeave.bind(this)),on(this.dropArea,"dragend",this._onDragLeave.bind(this)),on(this.dropArea,"drop",this._onDrop.bind(this)));},_onDragEnter:function(evt){if(!this.enabled){return;}evt.preventDefault();_153d.add(this.domNode,this.dragStartCssClass);},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_153d.remove(this.domNode,this.dragStartCssClass);_153d.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();},onDrop:function(evt,files){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_153d.remove(this.domNode,this.dragStartCssClass);_153d.remove(this.domNode,this.dragOverCssClass);},_setSettingsAttr:function(value){this._set("settings",value);this.model.set("settings",value);},_setValidSelectionAttr:function(value){this._set("validSelection",value);_153d.toggle(this.iconNode,"epi-no-drop",!value);},_setDescriptionTextAttr:{node:"descriptionNode",type:"innerText"}});});},"epi-cms/widget/viewmodel/FilesUploadDropZoneViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone"],function(_1545,lang,_1546,_1547){return _1545([_1546],{settings:null,descriptionText:null,dropFolderName:null,validSelection:null,enabled:null,_descriptionTemplate:null,_settingsSetter:function(value){this.settings=value;if(!value){value=this._getDefaultValue();}this.set("enabled",value.enabled);this.set("validSelection",value.validSelection);this.set("dropFolderName",value.dropFolderName);this.set("_descriptionTemplate",value.descriptionTemplate);this.set("descriptionText",this._getDescription(value));},_getDefaultValue:function(){return {enabled:false,validSelection:false,dropFolderName:null};},_getDescription:function(_1548){if(!_1548.validSelection){return _1547.toomanyfolders;}var _1549=this._descriptionTemplate||_1547.description;return lang.replace(_1549,[_1548.dropFolderName||_1547.defaultfoldername]);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <div class=\"dijitReset dijitInline epi-dropZone\">\r\n        <div data-dojo-attach-point=\"iconNode\" class=\"epi-dropZone-icon\"></div>\r\n        <span data-dojo-attach-point=\"descriptionNode\" class=\"epi-dropZone-text\"></span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dropArea\" class=\"epi-dropZone-overlay\"></div>\r\n</div>\r\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi-cms/ApplicationSettings","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(array,_154a,lang,topic,when,_154b,_154c,_154d,_154e,_154f){return _154a([_154e],{betweenThreshold:5,expandExtraNodeItems:_154b.startPage,allowSorting:true,postMixInProperties:function(){this.inherited(arguments);this.checkAcceptance=lang.hitch(this,this.checkAcceptance);this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);},checkAcceptance:function(_1550,nodes){return _1550===this.tree.dndController;},checkItemAcceptance:function(_1551,_1552,_1553){return this.allowSorting||_1553==="over";},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _154c({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_154f.command.label,resources:_154f});this.commands=array.filter(this.commands,lang.hitch(this,function(_1554){return !(_1554 instanceof _154c);}));this._viewTrashCommand=new _154d({typeIdentifiers:this.typeIdentifiers,order:100});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},_setShowAllLanguagesAttr:function(value){this.inherited(arguments);this.allowSorting=!!value;},getIconClass:function(item,_1555){var _1556=array.some(this.model.roots,function(root){return root===this.model.getIdentity(item);},this);if(_1556){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/DialogService","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(array,_1557,_1558,lang,_1559,topic,when,_155a,_155b,_155c,_155d,_155e,_155f,_1560,_1561,_1562,_1563,_1564,_1565,_1566,_1567,_1568,_1569,_156a,_156b,_156c,_156d,_156e,_156f,_1570,_1571,res){return _1558([_156a,_1561,_155d,_1562],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_1567,nodeConstructor:_1566,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _155c();this.selection=new _155e();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("showContextMenu",this._showContextMenuFromKeyboard.bind(this)),this.on("select",lang.hitch(this,this._onTreeNodeClicked)),this.on("paste",function(){if(this._pasteCommand.get("canExecute")){this._pasteCommand.execute();}}.bind(this)));this.connect(this,"onClick","_onTreeNodeClicked");var _1572=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_1572);this.subscribe("/dnd/cancel",_1572);},_showContextMenuFromKeyboard:function(e){this._ensureContextMenu();this._contextMenu.forceOpen(e);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_1573){this.contextChanged(_1573);}));},_preparePathNodes:function(paths){var self=this,_1574;array.some(paths,function(_1575,index){var nodes=self.getNodesByItem(_1575),_1576=nodes.length===1&&!nodes[0];if(index>0&&_1576){array.forEach(_1574,function(_1577){if(_1577.state==="LOADED"){_1577._loadDeferred=null;}});return true;}_1574=nodes;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showAllLanguagesCommand=new _1565({model:this});var _1578=this._contextMenuCommandProvider.get("commands");array.some(_1578,lang.hitch(this,function(_1579){if(_1579 instanceof _156d){this._copyCommand=_1579;}else{if(_1579 instanceof _156e){this._cutCommand=_1579;}else{if(_1579 instanceof _1570){this._pasteCommand=_1579;}else{if(_1579 instanceof _156f){this._deleteCommand=_1579;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showAllLanguagesCommand].concat(_1578);},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this.model.set("showAllLanguages",value);this._showAllLanguagesCommand.set("active",!value);},_onTreeNodeClicked:function(page,node,event){when(this.getCurrentContext(),lang.hitch(this,function(_157a){var _157b=true;if(_157a&&_1569.isContentReference(_157a.id)){_157b=_1569.compareIgnoreVersion(page.contentLink,_157a.id);}var _157c=function(_157d){var _157e={typeName:_155f.getResourceValue(page.typeIdentifier,"name"),name:page.name};topic.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(_157d,{requestedContent:_157e}),forceContextChange:true});};if(!_157b){_157c(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_157c,300);}));},contentContextChanged:function(_157f,_1580){var _1581=new _1569(_157f.id),_1582=_1581.createVersionUnspecificReference().toString(),_1583=_1563.wastebasketPage.toString();this.inherited(arguments);if(_1582===_1583){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_1582;if(_1580&&_1580.sender===this&&this.selectedItem&&_1582===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_157f.dataType)){this.selectContent(_1582,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_1584){return this.tree.model.isSupportedType(_1584);},_getSelectionData:function(_1585){return _1585?[{type:"epi.cms.contentdata",data:_1585}]:[];},_updateGlobalToolbarButtons:function(_1586){var node=_1586||this.get("selectedNode"),_1587=node?this._getSelectionData(node.item):[],_1588=this.getCommandModel(node);if(this._createCommand){this._createCommand.set("model",_1588);}this._contextMenuCommandProvider.updateCommandModel(_1588);this.selection.set("data",_1587);},getCommandModel:function(_1589){return _1589&&_1589.item;},contextChangeFailed:function(_158a,_158b,_158c){this.inherited(arguments);if(_158a){if(_158c&&_158c.sender===this){this.selectContent(_158a.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_1559.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_1559.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(value){this._removeHighlightClass();this._focusNode=value;},_ensureContextMenu:function(){if(!this._contextMenu){this.own(this._contextMenu=new _156b({leftClickToOpen:true,category:"context",popupParent:this}),_1557.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_1557.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}},_showContextMenu:function(evt){this._ensureContextMenu();this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _158d=this.inherited(arguments);_158d.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _158d;},getIconClass:function(item,_158e){var _158f=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _158f;}var _1590="";switch(item.properties.pageShortcutType){case _1564.pageShortcutTypes.Shortcut:_1590="epi-iconObjectInternalLink";break;case _1564.pageShortcutTypes.External:_1590="epi-iconObjectExternalLink";break;case _1564.pageShortcutTypes.Inactive:_1590="epi-iconObjectNoLink";break;case _1564.pageShortcutTypes.FetchData:_1590=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _1590?_158f+" "+_1590:_158f;},enableDrop:function(node,_1591){node._droppable=_1591;},_showNotificationMessage:function(_1592){_1560.alert(_155b.toHTML(_1592));},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_1593,lang,when,_1594,_1595,_1596,_1597,_1598){return _1593([_1597],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_1596.currentContentLanguage;this.store=this.store||_1595.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(){this.set("label",_1598.showonlycontentin);}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(value){this.set("canExecute",value);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/Evented","dojo/mouse","dojo/on","dojo/text!./templates/_ContentNavigationTreeNode.html","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(array,_1599,event,lang,_159a,_159b,_159c,mouse,on,_159d,_159e,_159f,_15a0,_15a1,_15a2,_15a3,_15a4,_15a5,res){return _1599([_15a4,_15a1,_159c],{templateString:_159d,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _15a6=_159f.resolve("epi.storeregistry");this._contentTypeStore=_15a6.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _15a5({contentStatus:this.item.status}));},modelBindingMap:{statusIcon:["statusIcon"],statusMessage:["statusMessage"]},_setStatusMessageAttr:function(_15a7){_159a.set(this.iconNodeStatus,"title",_15a0.toTooltipText(_15a7));},_setStatusIconAttr:function(_15a8){if(!(_15a8 instanceof Array)){return;}_159b.remove(this.iconNodeStatus);_159b.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");array.forEach(_15a8,function(_15a9){_159b.add(this.iconNodeStatus,_15a9);},this);},setSelected:function(_15aa){this.inherited(arguments);if(this.hasContextMenu){_159b.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_15aa);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_159b.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){event.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){event.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask===1){_159b.add(this.iconNodeAccess,this._pageLocked);_159a.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_159b.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_159b.add(this.iconNodeAccess,this._pageBeingEdited);var _15ab=[this.res.tooltip.beingedited];array.forEach(this.item.inUseNotifications,function(_15ac){var date=_159e.toUserFriendlyString(new Date(_15ac.created));_15ab.push(_15ac.userName+", "+date);},this);_159a.set(this.iconNodeAccess,"title",_15ab.join("\n"));}else{_159b.remove(this.iconNodeAccess,this._pageBeingEdited);_159b.remove(this.iconNodeAccess,this._pageLocked);_159a.set(this.iconNodeAccess,"title","");_159b.remove(this.contentNode,"epi-treeReadOnly");}}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_15ad,_15ae,_15af,_15b0,_15b1){return _15ad(_15b1,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _15b2="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_15af.encode(row.label);row.text=_15af.encode(row.text);}if(!row.text){_15b2+="<li class='dojoxEllipsis'>"+_15ae.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_15b2+="<li class='dojoxEllipsis'>"+_15ae.substitute(this.tooltipRowTemplate,row)+"</li>";}}_15b2+="</ul>";return _15b2;}return this.inherited(arguments);}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../plugin-area/navigation-tree","../widget/CreateCommandsMixin","epi/shell/command/_SelectionCommandMixin","epi/shell/selection"],function(_15b3,_15b4,_15b5,_15b6,_15b7,_15b8,_15b9,_15ba,_15bb,_15bc,_15bd,_15be){return _15b3([_15b5,_15bc,_15b4],{treeModel:null,clipboardManager:null,_settings:null,constructor:function(_15bf){_15b3.safeMixin(this,_15bf);this.own(_15bb.on("added, removed",this._updateCommands.bind(this)));},postscript:function(){this.inherited(arguments);this._updateCommands();},updateCommandModel:function(_15c0){this.get("commands").forEach(function(_15c1){if(!_15c1.isInstanceOf(_15bd)){_15c1.set("model",_15c0);}});this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:_15c0}]);},_updateCommands:function(){this.get("commands").forEach(function(_15c2){if(typeof _15c2.destroy==="function"){_15c2.destroy();}});this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _15be()};var _15c3=this.getCreateCommands(),_15c4=[];for(var key in _15c3){_15c4.push(_15c3[key].command);}_15c4.push(new _15b9({category:"context"}),new _15b7(this._settings),new _15b6(this._settings),new _15b8(this._settings),new _15ba(this._settings));_15bb.get().forEach(function(_15c5){_15c5.category="context";_15c4.push(_15c5);});this.set("commands",_15c4);}});});},"epi-cms/plugin-area/navigation-tree":function(){define(["epi/PluginArea","epi-cms/content-approval/command/EditApprovalDefinition"],function(_15c6,_15c7){var _15c8=new _15c6("epi-cms/navigation-tree/commands[]");_15c8.add(_15c7);return _15c8;});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/DialogService","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_15c9,lang,epi,_15ca,_15cb,_15cc,_15cd,_15ce,_15cf,_15d0,_15d1,_15d2,_15d3,_15d4){return _15c9([_15d3,_15cb,_15d0],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_15ca.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _15d5=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_15d5,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _15d6=[new _15cd({label:_15d4.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _15cc({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_15d6);this.fetchData();},_setOnlyShowMyChangesAttr:function(value){this._set("onlyShowMyChanges",value);if(this._started){this._saveSettingComponent("onlyShowMyChanges",value);}},fetchData:function(){var query=this._getQuery();this.grid.set("query",query.query,query.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _15d7={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,value,node,_15d8){node.innerHTML=_15d1.getVersionStatus(value);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_15d7.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _15d7;},_saveSettingComponent:function(type,value){var item=this._componentsController.getComponentDefinition(this.id),query;if(item){item.settings.onlyShowMyChanges=value;var saved=this._componentsController.saveComponents([item]);saved.then(function(done){},function(){_15cf.alert(_15d4.errormessage);});query=this._getQuery();this.grid.query=query.query;this.grid.queryOptions=query.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_15d9){this.grid.clearSelection();var _15da=new _15d2(_15d9.id).createVersionUnspecificReference().toString();var row=this.grid.row(_15da);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-geometry","dojo/dom-class","dojo/on","epi-cms/asset/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(array,_15db,lang,_15dc,_15dd,_15de,_15df,on,_15e0,_15e1,_15e2,res,_15e3){return _15db([_15e0],{showCreateContentArea:false,modelClassName:_15e1,noDataMessages:_15e2.nodatamessages,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,postMixInProperties:function(){this.inherited(arguments);this.modelBindingMap.showAllLanguages=["showAllLanguages"];},buildRendering:function(){this.inherited(arguments);var self=this;this.own(_15dc.after(this.list.grid,"renderQuery",function(_15e4){return _15e4.then(function(_15e5){var _15e6=_15e5.length>0?false:self.model.getCommand("newBlockDefault").get("canExecute");self._toggleCreateContentArea(_15e6);});}));var link=_15dd.create("a",{"class":"epi-visibleLink",innerHTML:_15e3.showalllanguages});this.own(on(link,"click",function(){this.model.set("showAllLanguages",true);}.bind(this)));this.bottomLinkContainer=_15dd.toDom("<div class=\"epi-gadget-bottom-container dijitHidden\"></div>");_15dd.place(link,this.bottomLinkContainer);_15dd.place(this.bottomLinkContainer,this.domNode);},layout:function(){var _15e7=_15df.contains(this.bottomLinkContainer,"dijitHidden")?0:_15de.getMarginBox(this.bottomLinkContainer).h;var _15e8=_15de.getMarginBox(this.searchBoxNode),_15e9={h:this._contentBox.h-_15e8.h-_15e7,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_15e9);},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.newBlockDefault.command.execute();},_setShowAllLanguagesAttr:function(_15ea){this._set("showAllLanguages",_15ea);_15df.toggle(this.bottomLinkContainer,"dijitHidden",_15ea);if(this._contentBox){this.layout();}}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","../asset/view-model/HierarchicalListViewModel","epi-cms/component/_ShowAllLanguagesMixin","./command/NewBlock","epi-cms/command/ShowAllLanguages"],function(_15eb,lang,when,_15ec,_15ed,_15ee,_15ef){return _15eb([_15ec,_15ed],{_selectedTreeItemsSetter:function(_15f0){this._commandRegistry.newBlockDefault.command.set("model",_15f0);this.inherited(arguments);},_setupCommands:function(){this.inherited(arguments);this.showAllLanguagesCommand=new _15ef({model:this});this._setupShowAllLanguages();var _15f1={newBlockDefault:{command:new _15ee({viewModel:this})},allLanguages:{command:this.showAllLanguagesCommand,order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_15f1);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);},_setupShowAllLanguages:function(){when(this._isSiteMultilingual()).then(function(_15f2){if(!_15f2){return;}this.loadShowAllLanguages().then(function(value){this.set("showAllLanguages",value);this.showAllLanguagesCommand.set("active",!value);}.bind(this));}.bind(this));},_showAllLanguagesSetter:function(value){var _15f3=this.showAllLanguages;this.inherited(arguments);if(_15f3!==value){this.saveShowAllLanguages(value);this.showAllLanguagesCommand.set("active",!value);}}});});},"epi-cms/component/command/NewBlock":function(){define(["dojo/_base/declare","epi/shell/DestroyableByKey","epi-cms/command/NewContent","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_15f4,_15f5,_15f6,_15f7){return _15f4([_15f6,_15f5],{contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_15f7.command.label,resources:_15f7,viewModel:null,_onModelChange:function(){this.destroyByKey("isSearchingWatch");this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.inherited(arguments);},_canExecute:function(){var _15f8=this.inherited(arguments);return _15f8&&!this.viewModel.get("isSearching");}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi/Url","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_15f9,_15fa,lang,array,when,_15fb,_15fc,_15fd,Url,_15fe,_15ff,_1600,_1601,_1602,Tree,_1603){return _15f9([_15fc,_1601],{profile:null,buildRendering:function(){this.inherited(arguments);_15fb.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _1604=_1600.resolve("epi.storeregistry");var store=_1604.get("epi.cms.sitestructure");this.profile=this.profile||_1600.resolve("epi.shell.Profile");var model=this._treeModel=new _15fe({store:store});var _1605=new _1602({category:"setting",label:_1603.showalllanguages,model:model,property:"showAllLanguages"});this.commands.push(_1605);this._tree=new Tree({model:model,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _1606=item.editUrl;if(array.some(item.hosts,function(host){return host===window.location.host;})){var _1607=new Url(_1606);_1607.scheme=window.location.protocol.replace(":","");_1607.authority=window.location.host;_1606=_1607.toString();}window.location.replace(_1606);});}}),_createTreeNode:function(args){return new _15ff(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_15fd.show(_1603.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_15fd.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_15fa.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_1608){this._tree.set("path",["root",_1608.currentSite,_1608.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_1609,_160a,_160b){return _1609([_160b],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_160a.add(this.domNode,"epi-st-disabledRow");}else{_160a.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_160a.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","./viewmodels/TasksViewModel","epi-cms/component/ContentQueryGrid","epi/shell/form/CategorizedSelect","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_160c,lang,_160d,_160e,topic,_160f,_1610,_1611,_1612,epi,_1613,_1614,_1615,_1616,_1617){return _160c([_1610,_1611,_160f,_1612],{templateString:_1616,resources:_1617,querySelection:null,model:null,_selectionChangedEventHandler:null,buildRendering:function(){this.inherited(arguments);this.model=new _1613({categories:this.categories});this.querySelection=new _1615({name:"QuerySelection",options:this.model.getOptions()});_160d.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),topic.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},startup:function(){this.inherited(arguments);this._reloadQuery();},resize:function(_1618){this.inherited(arguments);this.contentQuery.resize(this._calculateContentQuerySize(_1618));},_calculateContentQuerySize:function(_1619){var _161a=_160e.getMarginBox(this.toolbar);return {w:_1619.w,h:_1619.h-_161a.h};},_reloadQuery:function(){var _161b=this.querySelection.get("value");var query=this.model.getQuery(_161b);if(query){this.contentQuery.set("ignoreVersionWhenComparingLinks",!query.versionSpecific);}this.contentQuery.set("queryName",_161b);}});});},"epi-cms/component/viewmodels/TasksViewModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_161c,_161d){return _161c([_161d],{categories:null,getOptions:function(){var _161e=this._convert(this.categories);this._selectFirstItem(_161e);return _161e;},getQuery:function(_161f){var _1620=null;this.categories.some(function(_1621){return _1621.queries.some(function(query){if(query.name===_161f){_1620=query;return true;}});});return _1620;},_selectFirstItem:function(_1622){var _1623=_1622.length>0&&_1622[0].category;if(_1623){var item=_1622[1];if(item){item.selected=true;}}},_convert:function(_1624){var _1625=[];_1624.forEach(function(_1626){if(_1626.displayName){_1625.push({category:true,label:_1626.displayName});}_1626.queries.forEach(function(query){_1625.push({label:query.displayName,value:query.name});});});return _1625;}});});},"epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_1627,lang,when,_1628,_1629,_162a){return _1627([_162a],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _162b=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,value,node,_162c){node.innerHTML=_1629.getVersionStatus(value);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_162b,this.domNode);this.grid.set("showHeader",false);this.own(_1628.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_162d){this.set("currentItem",_162d);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:false}]});var _162e=this.queryParameters||{};_162e.query=this.queryName;this.grid.set("query",_162e);},_setQueryNameAttr:function(value){this.queryName=value;this.fetchData();}});});},"epi/shell/form/CategorizedSelect":function(){define("epi/shell/form/CategorizedSelect",["dojo/_base/declare","./CategoryMenuItem","dijit/form/Select"],function(_162f,_1630,_1631){return _162f([_1631],{baseClass:"epi-categorized-select- dijitSelect dijitValidationTextBox",_getMenuItemForOption:function(_1632){if(_1632.category){return new _1630({ownerDocument:this.ownerDocument,label:_1632.label});}return this.inherited(arguments);}});});},"epi/shell/form/CategoryMenuItem":function(){define("epi/shell/form/CategoryMenuItem",["dojo/_base/declare","dojo/dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_Contained"],function(_1633,dom,_1634,_1635,_1636){return _1633([_1634,_1635,_1636],{baseClass:"dijitMenuItemGroup",templateString:"<tr class=\"dijitMenuItemGroup\"><td colspan=\"4\" data-dojo-attach-point=\"containerNode\"></td></tr>",_setLabelAttr:{node:"containerNode",type:"innerHTML"},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.domNode,false);},isFocusable:function(){return false;}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\r\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\r\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\r\n    </div>\r\n</div>\r\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_1637,_1638,_1639,_163a,_163b,_163c,Trash,_163d){return _1637([_1639,_163a,_163b,_163c],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _163d());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dojox/html/entities","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/DialogService","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi-cms/widget/command/DeleteContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(array,_163e,lang,_163f,_1640,_1641,_1642,_1643,_1644,_1645,_1646,_1647,_1648,_1649,_164a,_164b,_164c,_164d,_164e,_164f,_1650,_1651,_1652,_1653,_1654){return _163e([_1644,_1645,_1646,_164a,_1641],{resources:_1653,templateString:_1654,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{contentStore:["store"],queryOptions:["queryOptions"],actionResponse:["actionResponse"],trashes:["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_1655,_1656){this.model.set("currentTrash",_1656.trash);}));this._restoreContentCommand=new _1651({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_164f(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("restoreItem",this._onRestoreItemClick);this.on("deleteItem",this._onDeleteItemClick);},_setTrashesAttr:function(_1657){this.tabContainer.destroyDescendants();var _1658=[];array.forEach(_1657,function(trash){if(trash&&trash.active){this._addTrash(trash);var _1659=new _1650({hasDeleteAccess:trash.hasDeleteAccess,label:trash.name,tooltip:trash.name,trashId:trash.wasteBasketLink,model:this.model});_1658.push(_164c(_1659,null,{title:_1653.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(trash.name),onShow:lang.hitch(this,function(){var _165a=this.tabContainer.selectedChildWidget.getChildren()[0];_165a.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_1658);if(_1657&&_1657.length===1){_163f.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(trash){var _165b=null;if(trash.active){trash.isRequireLoad=true;var item=new _1648({title:trash.name,trash:trash});this.tabContainer.addChild(item);if(this._isSelected(trash)){_165b=item;}}if(_165b){this.tabContainer.selectChild(_165b);}},_isSelected:function(trash){var _165c=false;array.some(trash.typeIdentifiers,lang.hitch(this,function(_165d){return array.some(this.typeIdentifiers,function(type){if(_165d===type){_165c=true;return false;}});}));return _165c;},_setQueryOptionsAttr:function(_165e){if(_165e){var _165f=this.tabContainer.selectedChildWidget;if(_165f){var _1660=this.get("store"),_1661=null;if(_165f.itemListId){_1661=_1649.byId(_165f.itemListId);_1661.set("queryOptions",_165e);}else{_1661=new _164d({queryOptions:_165e,store:_1660,model:this.model});_1661.on("restoreItem",lang.hitch(this,function(row){this.emit("restoreItem",row);}));_1661.on("deleteItem",lang.hitch(this,function(row){this.emit("deleteItem",row);}));_1661.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_165f.set("content",_1661);_165f.itemListId=_1661.id;}}}},_setActionResponseAttr:function(_1662){if(!_1662){return;}this._showNotificationMessage(_1662);},_showNotificationMessage:function(_1663){if(_1663 instanceof Array){_164b.alertWithErrors({},_1663);}else{_164b.alert(_1663?_1663:"");}},_onRestoreItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeleteItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){var _1664=_164c(new _1652({model:this.model,contentId:row.data.contentLink}),null,{title:_1653.singledelete.dialog.title,description:lang.replace(_1653.singledelete.dialog.description,[_1643.encode(row.data.name)])});_1664._execute();}},_onSearchBoxChange:function(_1665){var _1666=this.model.get("currentTrash");_1666.queryText=_1665;_1666.isRequireLoad=true;this.model.set("currentTrash",_1666);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(array,_1667,lang,_1668,_1669,_166a,_166b,_166c,_166d,keys,_166e,query,html,_166f,_1670,when,_1671,_1672,_1673,_1674,_1675,_1676,_1677,_1678,Tree,_1679,_167a,put,epi,_167b,_167c,_167d,_167e,_167f,_1680,_1681,_1682,_1683,_1684,_1685){return _1667([_1671,_1672,_1673,_166e,_166f,_1680],{resources:_1684,epi:epi,templateString:_1685,_grid:null,_observers:{},_setQueryOptionsAttr:function(_1686){this._set("queryOptions",_1686);this._initialize();},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_1687){this.emit("searchBoxChange",_1687);}));},resize:function(){if(this._grid){var top=_166b.position(this._grid.domNode).y;var _1688=_166b.position(_1668.body()).h;_166c.set(this._grid.domNode,"height",(_1688-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_166a.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},_createGrid:function(store,_1689){var _168a=_1667([_1676,_1677,_1678,_167c,_1679]);var grid=new _168a({store:store,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_167d.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_167d.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _1675({target:grid.domNode,color:"#fff",zIndex:500}).placeAt(document.body);this._standby.startup();this.own(_166d.after(grid,"expand",function(_168b){var row=_168b.element?_168b:grid.row(_168b),_168c=query(row.element).parent()[0];if(_168c){_166c.set(_168c,"height","");}},true));_166d.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_166d.before(grid,"adjustRowIndices",function(_168d){if(_168d){array.forEach(query("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_166d.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_166d.before(grid,"renderArray",lang.hitch(this,function(_168e,_168f,_1690){var _1691=this.queryOptions.query;if(_1691&&_1691.query==="searchdeletedcontent"){_168e.map(function(_1692){if(_1692){_1692.hasChildren=false;}});}}));if(_1689){grid.set("queryOptions",_1689.options);grid.set("query",_1689.query);}var _1693="epi-dgrid-mouseover";grid.on(_167a.enterRow,function(evt){_1669.add(this,_1693);});grid.on(_167a.leaveRow,function(evt){_1669.remove(this,_1693);});grid.on(".epi-gridRestoreAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("restoreItem",row);}));grid.on(".epi-gridDeleteAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("deleteItem",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("restoreItem",row);}}));return grid;},_renderTreeNode:function(_1694,data,td,_1695){var title=_167d.htmlEncode(_1683.title(data,_1694.contentLink,_1694.contentTypeName));if(_1694.thumbnailUrl){_166a.create("img",{src:_1694.thumbnailUrl+_1670.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_166a.place(_167d.ellipsis(_167d.htmlEncode(data),title),td);}else{var _1696=_167e.getValue(_1694.typeIdentifier,"iconClass")||"epi-iconObjectPage";_166a.place(_167d.icon(_1696+" epi-objectIcon",_167d.ellipsis(_167d.htmlEncode(data),title)),td);}},_renderActionMenu:function(value){var _1697=lang.replace("<a class=\"epi-gridAction epi-gridRestoreAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_1684.restore.tooltip,label:_1684.restore.label});var _1698=lang.replace("<a class=\"epi-gridAction epi-gridDeleteAction epi-visibleLink\" title=\"{title}\">{label}</a>",{title:_1684.singledelete.tooltip,label:_1684.singledelete.label});return _1697+_1698;},_localizeDate:function(value){return _1681.toUserFriendlyString(value);},_createUserFriendlyUsername:function(name){return _1682.toUserFriendlyString(_167d.htmlEncode(name));},_showStandby:function(_1699){if(!this._standby){return;}if(_1699){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_1684.trashitemempty+"</span></span>";},_aroundInsertRow:function(_169a){return lang.hitch(this,function(_169b,_169c,_169d,i,_169e){var row=_169a.apply(this._grid,arguments);if(_169b&&_169b.thumbnailUrl){_1669.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/extensions/ColumnResizer":function(){define(["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_169f,_16a0,query,lang,dom,geom,has,_16a1,put){function _16a2(table,span,_16a3,_16a4,id){for(var i=1;i<span;i++){table[_16a3+i][_16a4]=id;}};function _16a5(_16a6){var i=_16a6.length,l=i,_16a7=_16a6[0].length,table=new Array(i);while(i--){table[i]=new Array(_16a7);}var _16a8={};for(i=0;i<l;i++){var row=table[i],_16a9=_16a6[i];for(var j=0,js=0;j<_16a7;j++){var cell=_16a9[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_16a2(table,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_16a2(table,cell.rowSpan,i,j,cell.id);}}}_16a8[cell.id]=_16a6[0][j].id;js++;}}return _16a8;};function _16aa(grid,colId,width,_16ab,_16ac){if(width<=0){return;}var _16ad=grid.columns[colId],event,rule;if(!_16ad){return;}event={grid:grid,columnId:colId,width:width,bubbles:true,cancelable:true};if(_16ab){event.parentType=_16ab;}if(!grid._resizedColumns||_16a0.emit(grid.headerNode,"dgrid-columnresize",event)){if(width==="auto"){delete _16ad.width;}else{_16ad.width=width;width+="px";}rule=grid._columnSizes[colId];if(rule){rule.set("width",width);}else{rule=_16a1.addCssRule("#"+_16a1.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_16a1.escapeCssIdentifier(colId,"-"),"width: "+width+";");}grid._columnSizes[colId]=rule;if(_16ac!==false){grid.resize();}return true;}};var _16ae,_16af=0;var _16b0={create:function(){_16ae=put("div.dgrid-column-resizer");},destroy:function(){put(_16ae,"!");_16ae=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_16ae.style.top=pos.y+"px";_16ae.style.height=pos.h+"px";put(document.body,_16ae);},move:function(x){_16ae.style.left=x+"px";},hide:function(){_16ae.parentNode.removeChild(_16ae);}};return _169f(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_16af++){_16b0.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_16af){_16b0.destroy();}},resizeColumnWidth:function(colId,width){return _16aa(this,colId,width);},configStructure:function(){var _16b1=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _16b1){if(!(k in this._columnSizes)){_16b1[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_16b2){this.inherited(arguments);var colId=_16b2.id,rule;if("width" in _16b2){if((rule=this._oldColumnSizes[colId])){rule.set("width",_16b2.width+"px");}else{rule=_16a1.addCssRule("#"+_16a1.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_16a1.escapeCssIdentifier(colId,"-"),"width: "+_16b2.width+"px;");}this._columnSizes[colId]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var assoc;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){assoc=lang.mixin(assoc||{},_16a5(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){assoc=_16a5(this.subRows);}}var _16b3=query(".dgrid-cell",grid.headerNode),i=_16b3.length;while(i--){var _16b4=_16b3[i],id=_16b4.columnId,col=grid.columns[id],_16b5=_16b4.childNodes,_16b6;if(!col||col.resizable===false){continue;}var _16b7=put("div.dgrid-resize-header-container");_16b4.contents=_16b7;while(_16b5.length>0){put(_16b7,_16b5[0]);}_16b6=put(_16b4,_16b7,"div.dgrid-resize-handle.resizeNode-"+_16a1.escapeCssIdentifier(id,"-"));_16b6.columnId=assoc&&assoc[id]||id;}if(!grid.mouseMoveListen){_16a0(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_16a0.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_16a1.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_16a0.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_16b8){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=query(".dgrid-column-"+_16a1.escapeCssIdentifier(_16b8.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(e);_16b0.show(this);},_resizeMouseUp:function(e){var _16b9=this._columnSizes,_16ba,_16bb,_16bc;if(this.adjustLastColumn){_16bc=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_16ba=query(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_16ba=_16ba.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _16b9);});}else{if(this.subRows&&this.subRows.length>1){_16ba=_16ba.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _16b9);});}}_16bb=_16ba.map(function(_16bd){return _16bd.offsetWidth;});_16ba.forEach(function(_16be,i){_16aa(this,_16be.columnId,_16bb[i],null,false);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,delta=this._getResizeMouseLocation(e)-this._startX,_16bf=cell.offsetWidth+delta,obj=this._getResizedColumnWidths(),_16c0=obj.totalWidth,_16c1=obj.lastColId,_16c2=query(".dgrid-column-"+_16a1.escapeCssIdentifier(_16c1,"-"),this.headerNode)[0].offsetWidth;if(_16bf<this.minWidth){_16bf=this.minWidth;}if(_16aa(this,cell.columnId,_16bf,e.type)){if(cell.columnId!=_16c1&&this.adjustLastColumn){if(_16c0+delta<_16bc){_16aa(this,_16c1,"auto",e.type);}else{if(_16c2-delta<=this.minWidth){_16aa(this,_16c1,this.minWidth,e.type);}}}}_16b0.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _16c3=this._getResizeMouseLocation(e),delta=_16c3-this._startX,width=this._targetCell.offsetWidth,left=_16c3;if(width+delta<this.minWidth){left=this._startX-(width-this.minWidth);}_16b0.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _16c4=0,_16c5=query((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode);var i=_16c5.length;if(!i){return {};}var _16c6=_16c5[i-1].columnId;while(i--){_16c4+=_16c5[i].offsetWidth;}return {totalWidth:_16c4,lastColId:_16c6};}});});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>\r\n","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_16c7,_16c8,_16c9,_16ca,_16cb,_16cc){return _16c7([_16c8],{resources:_16cc,_setCommandsAttr:function(_16cd){this._set("commands",_16cd);this._bindEmptyTrashMenu(_16cd);},_bindEmptyTrashMenu:function(_16ce){this.destroyDescendants();if(!_16ce||_16ce.length<1){return;}var _16cf=_16ce.length>1;var _16d0=null;if(_16cf){_16d0=new _16ca({settings:{label:_16cc.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_16d0=new _16c9({settings:{label:_16cc.emptytrash.title}});this.commands[0].label=_16cc.emptytrash.title;}new _16cb({configuration:[{builder:_16d0,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/DialogService","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_16d1,_16d2,lang,_16d3,when,_16d4,_16d5,_16d6,_16d7,_16d8,_16d9,_16da,_16db){return function(model){var _16dc=function(title,_16dd,_16de){return _16d8.confirmation({description:_16d5.toHTML(_16dd),title:_16d5.toHTML(title)}).then(function(){return _16de;});};var _16df=function(_16e0){var _16e1=_16d4.resolve("epi.cms.contentRepositoryDescriptors");var _16e2=[];_16e1.list().forEach(function(key){_16e1.get(key).containedTypes.forEach(function(type){if(_16d6.isBaseTypeIdentifier(_16e0,type)){_16e2=_16e2.concat(_16e1.get(key).containedTypes);}});});return _16e2;};var _16e3=function(_16e4,roots,_16e5){var df=new _16d2(),_16e6=_16db.restore.dialog,_16e7=_16d6.getValue(_16e4.typeIdentifier,"containerTypes"),_16e8={showButtons:false,roots:roots,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_16e7||_16df(_16e4.typeIdentifier),selectedContentType:_16e4.typeIdentifier,showAllLanguages:true};var _16e9=new _16d9(_16e8);var _16ea=new _16d7({title:_16d5.toHTML(_16e6.title),description:_16e5||_16d5.toHTML(_16e6.description),confirmActionText:_16d5.toHTML(_16db.restore.label),content:_16e9});var _16eb=function(value){when(model.contentStore.query({id:value}),function(_16ec){_16ea.onActionPropertyChanged({name:"ok"},"disabled",!_16ec);});};_16e9.on("change",function(value){if(value){_16eb(value);}else{_16ea.onActionPropertyChanged({name:"ok"},"disabled",true);}});_16ea.on("execute",function(){df.resolve(_16e9.get("value"));});_16ea.on("onHide",function(){df.cancel();});_16ea.show();_16e9.onChange(null);return df;};var _16ed=function(_16ee,_16ef){var _16f0=_16da.action.Create,_16f1=_16da.providerCapabilities.Create,_16f2=_16ef&&!(_16ef.isWastebasket||_16ef.isDeleted)&&_16da.isActionAvailable(_16ef,_16f0,_16f1,true,true);if(!_16f2){_16d8.alert(_16d5.toHTML(_16db.restore.userdonothavepermission));return false;}return true;};var _16f3=function(_16f4){var _16f5=_16d4.resolve("epi.cms.contentRepositoryDescriptors");var roots=[];_16f5.list().forEach(function(key){var _16f6=_16f5.get(key);_16f6.containedTypes.forEach(function(type){if(_16d6.isBaseTypeIdentifier(_16f4.typeIdentifier,type)){_16f6.roots.forEach(function(root){if(roots.indexOf(root)===-1){roots.push(root);}});}});});return roots;};var _16f7=function(model,_16f8,_16f9,_16fa,_16fb,_16fc){var _16fd;if(!_16fb||!model||!_16f8){return false;}if(_16fa&&_16f9){_16fd=_16dc(_16db.restore.label,_16db.restore.confirmquestion,_16f9);}else{_16fd=_16e3(_16f8,_16f3(_16f8),_16fc);}when(_16fd,function(_16fe){when(model.contentStore.get(_16fe),function(_16ff){if(!_16ed(_16f8,_16ff)){return false;}return _16fb.apply(model,[_16f8,_16fe]);});},function(){return false;});};_16d3.around(model,"restore",function(_1700){return function(_1701,_1702){return when(model.contentStore.query({id:_1701.contentLink}),lang.hitch(this,function(_1703){var _1704=null;var _1705=null;if(_1703.hasOwnProperty("statusCode")&&(_1703.statusCode===401||_1703.statusCode===403)){_1704=_16d5.toHTML(_16db.restore.userdonothavepermission);}if(_1703.hasOwnProperty("isDeleted")&&!_1703.isDeleted){_1704=_16d5.toHTML(_16db.restore.contentalreadyrestored);_1705=function(){model.updateTrash(model.get("currentTrash"));};}if(_1704){_16d8.alert(_1704).then(_1705);return false;}var _1706=model.get("currentTrash");if(_1703.parentLink!==_1706.wasteBasketLink){return when(_16e3(_1703,_16f3(_1703)),function(_1707){when(model.contentStore.get(_1707),function(_1708){if(!_16ed(_1703,_1708)){return false;}return _1700.apply(model,[_1703,_1707]);});},function(){return false;});}else{return when(model.getOldParent(_1703.contentLink),function(_1709){var _170a=_1709?_1709.contentLink:null;_16f7(model,_1703,_170a,_170a!=null,_1700);});}}),lang.hitch(this,function(error){_16d8.alert(_16d5.toHTML(_16db.restore.contentdeletedpermanently)).then(function(){model.updateTrash(model.get("currentTrash"));});return false;}));};});return model;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_170b,_170c){return _170b([_170c],{label:null,tooltip:null,hasDeleteAccess:false,trashId:null,_execute:function(){this.model.emptyTrash(this.trashId);},_onModelChange:function(){var _170d=this.model&&this.hasDeleteAccess&&!!this.trashId;this.set("canExecute",_170d);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_170e,_170f){return _170e([_170f],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _1710=!!this.model;this.set("canExecute",_1710);}});});},"epi-cms/widget/command/DeleteContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_1711,_1712){return _1711([_1712],{contentId:null,_execute:function(){this.model.deleteContent(this.contentId);},_onModelChange:function(){var _1713=this.model&&!!this.contentId;this.set("canExecute",_1713);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\r\n    <div class=\"epi-listingTopContainer\">\r\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n        <div class=\"epi-mediumButton epi-button--bold epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\r\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"stackContainer\">\r\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_1714,lang,topic,when,_1715,json,epi,_1716,_1717,_1718){return _1714([_1715],{resources:_1718,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,contentService:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_1717.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.contentService=this.contentService||_1717.resolve("epi.cms.ContentHierarchyService");this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=this._contentRepositoryDescriptors||_1717.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var store=this.storeRegistry.get("epi.cms.content.light"),model=this;var _1719=epi.delegate(store,{getChildren:function(_171a,_171b){var _171c=model.get("currentTrash"),_171d=model._createQueryOptions(_171c);lang.mixin(_171d.query,{referenceId:_171a.contentLink});return this.query(_171d.query,_171d.options);},mayHaveChildren:function(_171e){return _171e.hasChildren;}},["notify"]);return _1719;},_createTrashes:function(){when(this.trashStore.query(),function(_171f){this.set("trashes",lang.clone(_171f));}.bind(this));},_currentTrashSetter:function(trash){this.currentTrash=trash;if(trash.isRequireLoad){this.updateTrash(trash);trash.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_1720){var _1721=_1718.emptytrash.singleproviderdescription;if(this.trashes.length>1){_1721=_1718.emptytrash.description.replace("{0}",_1720);}return _1721;},updateTrash:function(trash){if(trash&&trash.active){this.set("queryOptions",this._createQueryOptions(trash));}else{this.set("queryOptions",null);}},_createQueryOptions:function(trash){var query={referenceId:trash.wasteBasketLink,query:"getchildren"};var _1722={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(query,{allLanguages:this.showAllLanguages});_1722.ignore.push("allLanguages");}if(trash.isSearchable){lang.mixin(query,{isSearchable:trash.isSearchable});_1722.ignore.push("isSearchable");}if(trash.queryText){lang.mixin(query,{query:"searchdeletedcontent",matchProvider:true,queryText:trash.queryText});}return {query:query,options:_1722};},_createComparers:function(){return {referenceId:function(_1723,_1724){return _1723===_1724.parentLink;}};},emptyTrash:function(_1725){if(!_1725){return;}when(this.trashStore.executeMethod("Empty",_1725),function(_1726){var _1727=array.filter(this.get("trashes"),function(trash){return trash&&trash.wasteBasketLink===_1725;});array.forEach(_1727,function(trash){trash.isRequireLoad=true;});this.isEmptyTrash=true;topic.publish("/epi/cms/trash/empty",_1726.extraInformation);if(this.currentTrash.wasteBasketLink===_1725){this.set("currentTrash",this.currentTrash);}}.bind(this),function(_1728){if(_1728.status===403){this.set("actionResponse",_1718.emptytrash.accessdenied);}}.bind(this));},deleteContent:function(_1729){if(!_1729){return;}when(this.trashStore.executeMethod("PermanentDelete",_1729).then(function(_172a){var self=this;var _172b=this.get("trashes");var _172c;_172b.some(function(trash,index){if(_172a.extraInformation===trash.wasteBasketLink){_172c=index;trash.isRequireLoad=true;self.set("currentTrash",trash);return true;}return false;});if(_172c){_172b[_172c].isRequireLoad=true;}}.bind(this)).otherwise(function(_172d){if(_172d.status===403){this.set("actionResponse",_1718.singledelete.accessdenied);}else{if(_172d.status===400){this.set("actionResponse",_1718.singledelete.notfromwastebasket);}}}.bind(this)));},restore:function(_172e,_172f){if(!(_172e&&_172e.contentLink&&_172e.isDeleted&&_172f)){return;}return this.contentService.move(_172e.contentLink,_172f);},getOldParent:function(_1730){var query={referenceId:_1730,query:"getrestorepoint",allLanguages:true};return when(this.contentStore.query(query)).then(function(_1731){var _1732=_1731&&lang.isArray(_1731)&&_1731.length>0?_1731[0]:null;return _1732;});}});});},"epi-cms/component/VersionsComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-class","dojo/when","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/component/_ShowAllLanguagesMixin","epi-cms/component/Versions","dojo/text!./templates/Versions.html","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(array,_1733,lang,_1734,_1735,when,_1736,_1737,_1738,_1739,_173a,_173b,_173c,res){return _1733([_1736,_1737,_1738,_173a],{templateString:_173c,res:res,postCreate:function(){this.inherited(arguments);when(this.versions._isSiteMultilingual()).then(function(_173d){if(!_173d){return;}this.loadShowAllLanguages().then(function(_173e){this.versions.set("showAllLanguages",_173e);this._setShowAllLanguagesLinkVisibility(_173e);}.bind(this));}.bind(this));this.own(this.versions.watch("showAllLanguages",function(){var _173f=this.versions.get("showAllLanguages");if(this.showAllLanguages!==_173f){this.saveShowAllLanguages(_173f);}this.set("showAllLanguages",_173f);this._setShowAllLanguagesLinkVisibility(_173f);}.bind(this)));this.own(this.on(".epi-versions-language-link:click",function(){this.versions.set("showAllLanguages",true);}.bind(this)));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;this._relayout();}},_relayout:function(){var _1740=_1735.contains(this.bottomLinkContainer,"dijitHidden")?0:_1734.getMarginBox(this.bottomLinkContainer).h;_1734.setMarginBox(this.versions.domNode,{w:this._contentBox.w,h:this._contentBox.h-_1740});},_setShowAllLanguagesLinkVisibility:function(_1741){_1735.toggle(this.bottomLinkContainer,"dijitHidden",_1741);if(!this._contentBox){return;}this._relayout();}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/string","dojo/topic","dojo/when","dojo/_base/json","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi-cms/dgrid/formatters","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/DialogService","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_1742,lang,_1743,_1744,_1745,topic,when,json,_1746,_1747,_1748,_1749,epi,_174a,_174b,_174c,_174d,_174e,_174f,_1750,_1751,_1752,_1753,_1754,_1755,_1756,_1757,_1758,_1759){return _1742([_1758,_174c,_174e,_1750],{showAllLanguages:true,isMultilingual:false,postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.forceContextReload=true;this.inherited(arguments);this._currentContentLanguage=_1751.currentContentLanguage;this._showAllLanguagesCommand=new _1756({model:this});var _175a=_174a.resolve("epi.storeregistry");this._contentStore=_175a.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _175b=_1742([_1747,_1748]);this.grid=new _175b({columns:{language:{label:epi.resources.header.language},status:{label:epi.resources.header.status,renderCell:_1749.commonDraft},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.inherited(arguments);this.add("commands",this._showAllLanguagesCommand);this._commonDraftCommand=new _1755();this._deleteVersionCommand=new _1753();this._deleteLanguageBranchCommand=new _1754();this.own(_1743.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_175c){_175c.then(lang.hitch(this,this.fetchData),lang.hitch(this,this._onSetCommonDraftFailure));})),_1743.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_175d){_175d.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_1743.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_175e){_175e.then(lang.hitch(this,this._onDeleteLanguageBranchSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_174d(this._deleteVersionCommand,null,{title:_1759.deletemenuitemtitle,heading:_1759.deleteversion.note,description:_1759.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_174d(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_1743.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage();this.fetchData();},_setShowAllLanguagesAttr:function(_175f){this._set("showAllLanguages",_175f);this._showAllLanguagesCommand.set("active",!_175f);this._toggleFilterByLanguage(_175f);},contextChanged:function(_1760,_1761){this.inherited(arguments);!this._isContentContext(_1760)&&this.grid.set("store",null);},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._setQuery(item.contentLink,this.showAllLanguages);this.set("isMultilingual",true);}));},_aroundRenderRow:function(_1762){return lang.hitch(this,function(item){if(item.isCommonDraft){var _1763=this._commonDrafts[item.language];if(_1763&&_1763!==item.contentLink){this._removeCommonDraft(_1763);}this._commonDrafts[item.language]=item.contentLink;}this._versionsByLanguage[item.language]=this._versionsByLanguage[item.language]||[];if(array.every(this._versionsByLanguage[item.language],function(ver){return ver!==item.contentLink;})){this._versionsByLanguage[item.language].push(item.contentLink);}var row=_1762.apply(this.grid,arguments);_1744.toggle(row,"dgrid-row-published",item.status===_1757.versionStatus.Published);return row;});},_onError:function(e){if(e.error&&e.error.status===403){when(this.getCurrentContent(),lang.hitch(this,function(item){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);}));}else{this.inherited(arguments);}},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_1764){if(_1764&&_1764.currentLanguageBranch){var _1765=lang.replace(_1759.deletelanguagebranch.label,[_1764.currentLanguageBranch.name]),_1766=_174b.getResourceValue(_1764.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_1765,description:lang.replace(_1766,[_1746.encode(_1764.name),_1764.currentLanguageBranch.name]),title:_1765});this._deleteLanguageBranchCommand.set("label",_1765);}this._deleteLanguageBranchCommand.set("model",_1764);}));},_showNotificationMessage:function(_1767){_174f.alert({title:_1759.notificationtitle,description:_1767});},_selectCommonDraftVersion:function(uri,_1768){var _1769={sender:this};if(_1768){_1769.forceReload=_1768;}topic.publish("/epi/shell/context/request",{uri:uri},_1769);},_onDeleteLanguageBranchSuccess:function(){return when(this._onDeleteVersionSuccess(arguments),lang.hitch(this,function(){var _176a=this._deleteLanguageBranchCommand.model.currentLanguageBranch.languageId;array.forEach(this._versionsByLanguage[_176a],lang.hitch(this,function(ver){this.store.notify(undefined,new _1752(ver));}));}));},_onDeleteVersionSuccess:function(){var self=this;return when(this.getCurrentContent(),function(_176b){var _176c=new _1752(_176b.contentLink);var _176d=_176c.createVersionUnspecificReference().toString();self._selectCommonDraftVersion("epi.cms.contentdata:///"+_176d,true);});},_onDeleteVersionFailure:function(_176e){if(!_176e||!_176e.status){return;}else{if(_176e.status===403){this._showNotificationMessage(_1759.deleteversion.cannotdeletepublished);}else{if(_176e.status===409){var _176f=_176e.responseText?json.fromJson(_176e.responseText).message:_1759.deleteversion.cannotdelete;this._showNotificationMessage(_176f);}else{this._showNotificationMessage(_1759.deleteversion.cannotdelete);}}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_1759.setcommondraft.failuremessage);},_removeCommonDraft:function(_1770){if(_1770){var item=this.grid.row(_1770).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_1771){return when(this.getCurrentContext()).then(function(_1772){if(!this._isContentContext(_1772)){this.grid.set("store",null);}else{this._setQuery(_1772.id,_1771);this._toggleLanguage();}}.bind(this));},_setQuery:function(_1773,_1774){var query={contentLink:new _1752(_1773).createVersionUnspecificReference().toString()};if(!_1774){query.language=this._currentContentLanguage;}this.grid.set("query",query);if(!this.grid.store){this.grid.set("store",this.store);}this._versionsByLanguage={};},_toggleLanguage:function(){var value=this.showAllLanguages?"table-cell":"none";this.grid.styleColumn("language",_1745.substitute("display:${0};",[value]));}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1775,lang,when,_1776,_1777,_1778,_1779,_177a){return _1775([_177a],{label:_1779.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_1778.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_1776.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_177b){var _177c=_1777.action,_177d=_177b&&_1777.isActionAvailable(_177b,_177c.Delete);this.set("canExecute",_177d);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_177e,lang,when,_177f,_1780,_1781,_1782,_1783,_1784){return _177e([_1780,_1781],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_177f.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _1785=_1783.toContentReference(this.model.contentLink);return when(this._versions.remove(_1785,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_1785.createVersionUnspecificReference().toString());}));},_onModelChange:function(){var model=this.model,_1786=!!(model&&model.currentLanguageBranch&&model.capabilities.deleteLanguageBranch&&!_1782.disableVersionDeletion),_1787=_1786&&!model.currentLanguageBranch.isMasterLanguage&&_1784.isActionAvailable(model,_1784.action.Delete);this.set("canExecute",_1787);this.set("isAvailable",_1786);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1788,topic,_1789,_178a,_178b,_178c){return _1788([_178c],{label:_178b.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _178d=_178a.resolve("epi.storeregistry");this.store=_178d.get("epi.cms.contentversion");},_execute:function(){var store=this.store;return store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){topic.publish("/epi/cms/content/statuschange/","common-draft",{id:item.contentLink});return store.patchCache(item);});},_onModelChange:function(){var model=this.model,_178e=_1789.versionStatus,_178f=model&&!model.isCommonDraft&&(model.status===_178e.CheckedOut||model.status===_178e.Rejected);this.set("canExecute",!!_178f);}});});},"url:epi-cms/component/templates/Versions.html":"<div>\r\n    <div class=\"epi-versions\" data-dojo-type=\"epi-cms/component/Versions\" data-dojo-attach-point=\"versions\"></div>\r\n    <div class=\"epi-gadget-bottom-container dijitHidden\" data-dojo-attach-point=\"bottomLinkContainer\">\r\n        <a class=\"epi-visibleLink epi-versions-language-link\">${res.showalllanguages}</a>\r\n    </div>\r\n</div>\r\n","epi-cms/content-approval/ApprovalComponent":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Deferred","dojo/dom-class","epi/shell/DialogService","epi/shell/command/builder/ButtonBuilder","epi-cms/content-approval/ApprovalEnums","epi-cms/content-approval/viewmodels/ContentApprovalViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ApprovalComponent.html","epi/i18n!epi/nls/episerver.cms.contentapproval.component","epi/i18n!epi/nls/episerver.shared.action","dijit/Toolbar","dijit/form/CheckBox","dijit/form/RadioButton","dijit/form/Select","dijit/form/Form","./Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/NotificationStatusBar","epi-cms/content-approval/ApprovalStepList"],function(lang,_1790,_1791,_1792,_1793,_1794,_1795,_1796,_1797,_1798,_1799,_179a,_179b,_179c,_179d){function _179e(_179f,_17a0){_1792.toggle(_179f,"dijitHidden",!_17a0);};return _1790([_1797,_1798,_1799,_179a],{templateString:_179b,languageWarningTemplate:" <span class='dijitInline dijitReset dijitIcon epi-iconWarning' title='"+_179c.languagefilter.warningmessage+"'></span>",resources:_179c,ApprovalDefinitionStatus:_1795.definitionStatus,_iconThumbnailTemplate:"<img class=\"epi-heading-icon-thumbnail\" src=\"{url}\" />",_iconContentTemplate:"<span class=\"dijitInline dijitReset dijitIcon epi-icon--large {iconClass} \"></span>",modelBindingMap:{approvalLink:["approvalLink"],content:["content"],isOptionsEnabled:["isOptionsEnabled"],isDeclineCommentRequired:["isDeclineCommentRequired"],isApproveCommentRequired:["isApproveCommentRequired"],isStartCommentRequired:["isStartCommentRequired"],selfApprove:["selfApprove"],isReadOnly:["isReadOnly"],filterOptions:["filterOptions"],status:["status"],approvalInheritedFrom:["approvalInheritedFrom"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1796();this.own(this.model);},buildRendering:function(){this.inherited(arguments);var _17a1=new _1794(),_17a2=this.model.get("commands");_17a2.forEach(function(_17a3){_17a1.create(_17a3,this.commandNode);},this);},postCreate:function(){this.inherited(arguments);this.stepList.set("model",this.model);this.own(this.enableButton.on("click",this._updateStatus.bind(this,_1795.definitionStatus.enabled)),this.disableButton.on("click",this._updateStatus.bind(this,_1795.definitionStatus.disabled)),this.inheritButton.on("click",this._updateStatus.bind(this,_1795.definitionStatus.inherited)),this.demandDeclineCommentButton.on("click",this._updateDemandDeclineComment.bind(this)),this.demandApproveCommentButton.on("click",this._updateDemandApproveComment.bind(this)),this.demandStartCommentButton.on("click",this._updateDemandStartComment.bind(this)),this.preventSelfApproveButton.on("click",this._updateSelfApprove.bind(this)),this.languageFilter.on("change",this._updateSelectedLanguage.bind(this)));},updateView:function(){this._focus();},_updateSelectedLanguage:function(_17a4){this.model.set("selectedLanguage",_17a4);},_setNotificationContext:function(_17a5){this.validation.set("notificationContext",{contextTypeName:"epi.cms.approval",contextId:_17a5});},_setBreadcrumb:function(_17a6){this.breadcrumb.set("contentLink",_17a6.contentLink);this.breadcrumbCurrentItem.set("currentItemInfo",{name:_17a6.name,dataType:_17a6.typeIdentifier});},_setContentIcon:function(_17a7){_179e(this.contentIcon,true);if(_17a7){this.contentIcon.innerHTML=lang.replace(this._iconThumbnailTemplate,{url:_17a7});return;}var _17a8=this.model.iconClass();if(_17a8){this.contentIcon.innerHTML=lang.replace(this._iconContentTemplate,{iconClass:_17a8});return;}_179e(this.contentIcon,false);},_setContentName:function(_17a9){this.contentName.textContent=_17a9;},_setApprovalLinkAttr:function(_17aa){this._set("approvalLink",_17aa);this._setNotificationContext(_17aa);},_setContentAttr:function(_17ab){this._set("content",_17ab);if(!_17ab){return;}this._setBreadcrumb(_17ab);this._setContentName(_17ab.name);this._setContentIcon(_17ab.thumbnailUrl);},_setStatusAttr:function(_17ac){this._set("status",_17ac);this.form.set("value",{status:_17ac});this._focus();_179e(this.demandCommentFieldsetNode,(this.model.get("isEnabled")));_179e(this.stepList.domNode,this.model.get("isEnabled"));_179e(this.filterNode,this.model.get("isEnabled")&&!!this.model.get("filterOptions"));this._updateWarningMessage();},_focus:function(){this.enableButton.get("checked")&&this.enableButton.focus();this.disableButton.get("checked")&&this.disableButton.focus();this.inheritButton.get("checked")&&this.inheritButton.focus();},_setApprovalInheritedFromAttr:function(_17ad){this._set("approvalInheritedFrom",_17ad);this._updateWarningMessage();},_updateWarningMessage:function(){_179e(this.warningNode,(!this.model.get("isEnabled")||this.model.get("isInherited")));_179e(this.goToInheritedSequence,this.model.get("isInherited"));this.warningMessage.textContent=this.model.getWarningMessage();},_setIsDeclineCommentRequiredAttr:function(_17ae){this._set("isDeclineCommentRequired",_17ae);this.demandDeclineCommentButton.set("checked",_17ae);},_setIsApproveCommentRequiredAttr:function(_17af){this._set("isApproveCommentRequired",_17af);this.demandApproveCommentButton.set("checked",_17af);},_setIsStartCommentRequiredAttr:function(_17b0){this._set("isStartCommentRequired",_17b0);this.demandStartCommentButton.set("checked",_17b0);},_setSelfApproveAttr:function(_17b1){this._set("selfApprove",_17b1);this.preventSelfApproveButton.set("checked",!_17b1);},_setIsOptionsEnabledAttr:function(_17b2){this._set("isOptionsEnabled",_17b2);this.demandDeclineCommentButton.set("disabled",!_17b2);this.demandApproveCommentButton.set("disabled",!_17b2);this.demandStartCommentButton.set("disabled",!_17b2);this.preventSelfApproveButton.set("disabled",!_17b2);},_setIsReadOnlyAttr:function(_17b3){this._set("isReadOnly",_17b3);this.enableButton.set("disabled",_17b3);this.disableButton.set("disabled",_17b3);this.inheritButton.set("disabled",_17b3);},_setFilterOptionsAttr:function(_17b4){this._set("filterOptions",_17b4);var _17b5=!!_17b4&&this.model.get("isEnabled");_179e(this.filterNode,_17b5);if(!_17b4){return;}_17b4=lang.clone(_17b4);var _17b6=this.model.get("selectedLanguage")||"";_17b4.forEach(function(_17b7){if(!_17b7.isValid&&this.model.get("showValidations")){_17b7.label+=this.languageWarningTemplate;}_17b7.selected=_17b6===_17b7.value;},this);this.languageFilter.set("options",_17b4);this.languageFilter.set("value",_17b6);},_goToInheritedSequence:function(){this.model.goToInheritedSequence();},_updateStatus:function(_17b8){var _17b9;switch(_17b8){case _1795.definitionStatus.inherited:_17b9=this._confirmInherit();break;case _1795.definitionStatus.enabled:this.model.enable();_17b9=new _1791().resolve();break;case _1795.definitionStatus.disabled:_17b9=this._confirmDisable();break;}_17b9.otherwise(this.set.bind(this,"status",this.status));},_updateDemandDeclineComment:function(e){var _17ba=e.target.checked;this.model.set("isDeclineCommentRequired",_17ba);this.demandDeclineCommentButton.set("checked",_17ba);},_updateDemandApproveComment:function(e){var _17bb=e.target.checked;this.model.set("isApproveCommentRequired",_17bb);this.demandApproveCommentButton.set("checked",_17bb);},_updateDemandStartComment:function(e){var _17bc=e.target.checked;this.model.set("isStartCommentRequired",_17bc);this.demandStartCommentButton.set("checked",_17bc);},_updateSelfApprove:function(e){var _17bd=e.target.checked;this.model.set("selfApprove",!_17bd);this.preventSelfApproveButton.set("checked",_17bd);},_confirmDisable:function(){var _17be={title:this.resources.disable.title,description:this.resources.disable.description,confirmActionText:_179d.disable,cancelActionText:_179d.cancel};return _1793.confirmation(_17be).then(this.model.disable.bind(this.model));},_confirmInherit:function(){var _17bf={title:this.resources.inherit.title,description:this.resources.inherit.description,confirmActionText:this.resources.inherit.okbutton,cancelActionText:_179d.cancel,setFocusOnConfirmButton:false};return _1793.confirmation(_17bf).then(this.model.inheritDefinition.bind(this.model));}});});},"epi-cms/content-approval/viewmodels/ContentApprovalViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/DialogService","epi/shell/TypeDescriptorManager","epi-cms/content-approval/ApprovalEnums","epi-cms/content-approval/viewmodels/ApprovalStepViewModel","epi/shell/command/withConditionalConfirmation","dojo/Stateful","epi/shell/DestroyableByKey","epi/shell/_ContextMixin","epi-cms/content-approval/command/SaveApprovalDefinition","epi-cms/content-approval/command/CancelChanges","epi/shell/store/SortableMemory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval","epi/i18n!epi/nls/episerver.cms.languageselector","epi/i18n!epi/nls/episerver.shared.action"],function(_17c0,lang,on,when,epi,_17c1,_17c2,_17c3,_17c4,_17c5,_17c6,_17c7,_17c8,_17c9,_17ca,_17cb,_17cc,_17cd,_17ce,_17cf,_17d0){return _17c0([_17c7,_17c8,_17c9],{approvalSteps:null,approvalService:null,userStore:null,commands:null,isDirty:false,isDeclineCommentRequired:false,isApproveCommentRequired:false,isStartCommentRequired:false,selfApprove:true,isEnabled:false,isInherited:false,selectedLanguage:null,approvalLink:null,content:null,isValid:true,isReadOnly:false,isOptionsEnabled:true,languages:null,filterOptions:null,approvalInheritedFrom:null,languageOptions:null,showValidations:false,status:_17c4.definitionStatus.inherited,_approvalStepsQuery:null,_originalDefinition:null,_validationMessageIds:[],_contextService:null,_messageService:null,constructor:function(_17d1,_17d2,_17d3,_17d4,_17d5,_17d6,_17d7){this.approvalService=_17d2||_17c1.resolve("epi.cms.ApprovalService");this._contextService=_17d3||_17c1.resolve("epi.shell.ContextService");this._messageService=_17d4||_17c1.resolve("epi.shell.MessageService");this.userStore=_17d5||_17c1.resolve("epi.storeregistry").get("epi.cms.notification.users");this._contentStore=_17d6||_17c1.resolve("epi.storeregistry").get("epi.cms.content.light");this._typeDescriptorManager=_17d7||_17c3;},postscript:function(){this.inherited(arguments);when(this.getCurrentContext()).then(this.contextChanged.bind(this));},destroy:function(){this.inherited(arguments);this._removeEventListeners();},contextChanged:function(_17d8){this.set("approvalLink",_17d8.id);this.approvalService.getDefinition(_17d8.id).then(this.loadApprovalDefinition.bind(this)).then(function(){this._contentStore.get(_17d8.id).then(this.set.bind(this,"content"));}.bind(this));},createApprovalStep:function(_17d9){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_17da=steps.getSibling(_17d9),_17db;_17db=new _17c5({languages:this.languages,reviewers:[],userStore:this.userStore,showValidations:this.showValidations});this._addEventListeners(_17db);steps.add(_17db,{before:_17da});},getWarningMessage:function(){if(this.get("isInherited")&&this.approvalInheritedFrom){var text=this.get("isEnabled")?_17ce.component.inheritedenabled:_17ce.component.inheriteddisabled;return lang.replace(text,{name:this.approvalInheritedFrom.name});}else{if(!this.get("isEnabled")){return _17ce.component.disabledwarning;}}},goToInheritedSequence:function(){this.approvalService.navigateToDefinition(this.get("approvalInheritedFrom").contentLink);},inheritDefinition:function(){var _17dc=this.get("approvalLink"),_17dd=this.status;this.set("status",_17c4.definitionStatus.inherited);return this.approvalService.inheritDefinition(_17dc).then(this.loadApprovalDefinition.bind(this)).otherwise(this.set.bind(this,"status",_17dd));},moveApprovalStep:function(_17de,up){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_17df=steps.getSibling(_17de,up);if(!_17df){return;}if(!up){_17df=steps.getSibling(_17df);}steps.put(_17de,{before:_17df});},removeApprovalStep:function(_17e0){if(!this._canEditApprovalSteps()){return;}if(_17e0.canBeDeleted){this.approvalSteps.remove(_17e0.id);}},loadApprovalDefinition:function(_17e1){this._originalDefinition=null;this.set({approvalInheritedFrom:_17e1.approvalInheritedFrom,languages:_17e1.languages,status:_17e1.status,isReadOnly:_17e1.isReadOnly,isDeclineCommentRequired:_17e1.isDeclineCommentRequired,isApproveCommentRequired:_17e1.isApproveCommentRequired,isStartCommentRequired:_17e1.isStartCommentRequired,selfApprove:_17e1.selfApprove,showValidations:false});this._createApprovalSteps(_17e1.approvalSteps);this._originalDefinition=this.serialize();},saveApprovalDefinition:function(){var _17e2=this.serialize();return this.approvalService.saveDefinition(_17e2).then(this.loadApprovalDefinition.bind(this));},serialize:function(){var _17e3=this.approvalSteps.data.map(function(step){return step.serialize();});return {contentLink:this.get("approvalLink"),approvalSteps:_17e3,isDeclineCommentRequired:this.isDeclineCommentRequired,isApproveCommentRequired:this.isApproveCommentRequired,isStartCommentRequired:this.isStartCommentRequired,selfApprove:this.selfApprove,status:this.status};},validate:function(){var _17e4=null;this.approvalSteps.data.forEach(function(step){step.validate();});if(this._hasErrors()){_17e4={level:"error",dialog:{description:_17ce.validationmessage.notenoughreviewersmessage.description}};}else{if(this._hasWarnings()){_17e4={level:"warning",dialog:{title:_17ce.validationmessage.stephaswarnings.title,description:_17ce.validationmessage.stephaswarnings.description,confirmActionText:_17ce.action.saveanyway,cancelActionText:_17d0.cancel}};}}return _17e4;},enable:function(){this.set("status",_17c4.definitionStatus.enabled);this._updateIsSequenceEnabled();},disable:function(){this.set("showValidations",false);this.set("status",_17c4.definitionStatus.disabled);this._updateApprovalSteps();this._updateIsSequenceEnabled();return this.saveApprovalDefinition().otherwise(function(){this.set("showValidations",true);this.enable();}.bind(this));},iconClass:function(){return this.content?this._typeDescriptorManager.getValue(this.content.typeIdentifier,"iconClass"):null;},_createApprovalSteps:function(steps){var _17e5=(steps||[this._createEmptyStep()]).map(this._createStepViewModel.bind(this)),store=_17cd(new _17cc({data:_17e5}));this.set("approvalSteps",store);this.set("isDirty",false);this._approvalStepsQuery=store.query();this._updateApprovalSteps();this.destroyByKey("observeHandle");this.ownByKey("observeHandle",this._approvalStepsQuery.observe(function(){this._updateApprovalSteps();}.bind(this)));},_createEmptyStep:function(){return {reviewers:[]};},_createStepViewModel:function(step,index){step=lang.clone(step);var _17e6=new _17c5({id:index,languages:this.languages,selfApprove:this.selfApprove,reviewers:step.reviewers,name:step.name,userStore:this.userStore});this._addEventListeners(_17e6);return _17e6;},_updateApprovalSteps:function(){var _17e7=this._approvalStepsQuery;if(_17e7){var _17e8=_17e7.length>1,_17e9=!this._canEditApprovalSteps(),_17ea=this.selectedLanguage,_17eb=this.selfApprove;_17e7.forEach(function(step){step.set({canBeDeleted:_17e8,isReadOnly:_17e9,selfApprove:_17eb});step.filterReviewers(_17ea);});this._onApprovalStepsChanged();}},_resetValidationMessageIds:function(){this._validationMessageIds.forEach(function(_17ec){this._messageService.remove({id:_17ec});}.bind(this));this._validationMessageIds=[];if(this.showValidations){this._approvalStepsQuery.forEach(function(step){if(!step.isValid){step.validationMessages.forEach(function(_17ed){var _17ee;if(_17ed.level==="error"){_17ee="error";}else{if(_17ed.level==="warning"){_17ee="warn";}}var _17ef=this._messageService.put(_17ee,_17ed.value,"epi.cms.approval",this.get("approvalLink"));this._validationMessageIds.push(_17ef);},this);}},this);}},_onApprovalStepsChanged:function(){this._resetValidationMessageIds();this._validateFilterOptions();var _17f0=this.serialize();var equal=epi.areEqual(_17f0,this._originalDefinition);this._originalDefinition&&this.set("isDirty",!equal);},_addEventListeners:function(step){this.own(step.on("create-step",this.createApprovalStep.bind(this)),step.on("remove-step",this.removeApprovalStep.bind(this)),step.on("change",this._onApprovalStepsChanged.bind(this)),step.watch("isValid",this._onApprovalStepsChanged.bind(this)));},_canEditApprovalSteps:function(){return !this.isReadOnly&&this.status===_17c4.definitionStatus.enabled;},_commandsGetter:function(){if(this.commands===null){this.commands=[new _17ca({model:this,order:10}),new _17cb({model:this,order:20})];}return this.commands;},_createLanguageOptions:function(_17f1){if(!_17f1){this.set("languageOptions",null);this.set("filterOptions",null);return;}var _17f2=_17f1.map(function(_17f3){return {label:_17f3.text,value:_17f3.value};});this.set("languageOptions",_17f2);var _17f4=lang.clone(_17f2);_17f4.unshift(this._getDefaultLanguageOption());this.set("filterOptions",_17f4);},_getDefaultLanguageOption:function(){return {label:_17cf.alllanguages,value:"",selected:true};},_validateFilterOptions:function(){if(!this.filterOptions){return;}var _17f5=this._stepsMissingLanguageReviewer();this.filterOptions.forEach(function(_17f6){_17f6.isValid=_17f5.every(function(step){return step.get("validationMessages").every(function(_17f7){if(!_17f7.languages){return true;}return _17f7.languages.indexOf(_17f6.value)===-1;});});});this.set("filterOptions",this.filterOptions);},_hasErrors:function(){return this.approvalSteps.data.some(function(step){return !step.isValid&&step.hasErrors();});},_hasWarnings:function(){return this.approvalSteps.data.some(function(step){return !step.isValid&&step.hasWarnings();});},_stepsMissingLanguageReviewer:function(){return this.approvalSteps.data.filter(function(step){return !step.isValid&&step.validationMessages.some(function(_17f8){return _17f8.languages;});});},_isDeclineCommentRequiredSetter:function(_17f9){this.isDeclineCommentRequired=_17f9;this._updateApprovalSteps();},_isApproveCommentRequiredSetter:function(_17fa){this.isApproveCommentRequired=_17fa;this._updateApprovalSteps();},_isStartCommentRequiredSetter:function(_17fb){this.isStartCommentRequired=_17fb;this._updateApprovalSteps();},_selfApproveSetter:function(_17fc){this.selfApprove=_17fc;this._updateApprovalSteps();},_isDirtySetter:function(_17fd){this.isDirty=_17fd;if(!_17fd){this._removeEventListeners();return;}if(this._interceptor){return;}this._beforeUnloadHandler=on(window,"beforeunload",function(e){var _17fe=_17ce.command.cancelchanges.description;e.returnValue=_17fe;return _17fe;});this._interceptor=this._contextService.registerRequestInterceptor(function(){var _17ff={title:_17ce.command.cancelchanges.title,description:_17ce.command.cancelchanges.description};return _17c2.confirmation(_17ff).then(this._removeEventListeners.bind(this));}.bind(this));},_isReadOnlySetter:function(value){this.isReadOnly=value;this._updateApprovalSteps();this._updateIsSequenceEnabled();},_languagesSetter:function(value){this.languages=value;this._createLanguageOptions(this.languages);this._updateApprovalSteps();},_selectedLanguageSetter:function(_1800){this.selectedLanguage=!_1800?null:_1800;this._updateApprovalSteps();},_showValidationsSetter:function(_1801){this.showValidations=_1801;if(this.approvalSteps&&this.approvalSteps.data){this.approvalSteps.data.forEach(function(step){step.set("showValidations",_1801);});}},_updateIsSequenceEnabled:function(){this.set("isOptionsEnabled",this._canEditApprovalSteps());},_statusSetter:function(_1802){this.status=_1802;this._updateApprovalSteps();},_isInheritedGetter:function(){return this.get("status")===_17c4.definitionStatus.inherited;},_isEnabledGetter:function(){if(this.get("status")===_17c4.definitionStatus.inherited){return this.approvalInheritedFrom&&this.approvalInheritedFrom.isEnabled;}return this.get("status")===_17c4.definitionStatus.enabled;},_removeEventListeners:function(){this._interceptor&&this._interceptor.remove();this._interceptor=null;this._beforeUnloadHandler&&this._beforeUnloadHandler.remove();this._beforeUnloadHandler=null;}});});},"epi-cms/content-approval/viewmodels/ApprovalStepViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/content-approval/viewmodels/ReviewerViewModel","dojo/Stateful","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/content-approval/command/AddApprovalStep","epi-cms/content-approval/command/RemoveApprovalStep","epi-cms/content-approval/ApprovalEnums","dojo/store/Memory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval"],function(_1803,lang,_1804,_1805,_1806,_1807,_1808,_1809,_180a,_180b,_180c,_180d){return _1803([_1805,_1807,_1806],{reviewers:null,commands:null,userStore:null,canBeDeleted:true,selfApprove:true,isReadOnly:false,name:"",isValid:true,validationMessages:[],languages:null,showValidations:false,addReviewer:function(_180e){_180e.languages=_180e.languages||[];this.reviewers.add(this._createReviewer(_180e));},filterOutExistingUsers:function(users){var _180f=this.get("reviewers").query();return users=users.filter(function(user){return !_180f.some(function(_1810){return (user.name.toLowerCase()===_1810.name.toLowerCase()&&user.reviewerType===_1810.reviewerType);});},this);},filterReviewers:function(_1811){this.reviewers.query().forEach(function(_1812){if(_1811===null||_1812.languages.length===0){_1812.set("canApprove",true);return;}var _1813=_1812.languages.some(function(_1814){return _1814===_1811;});_1812.set("canApprove",_1813);});},createApprovalStep:function(){this.emit("create-step",this);},removeApprovalStep:function(){this.emit("remove-step",this);},removeReviewer:function(_1815){if(this.isReadOnly){return;}this.reviewers.remove(this._getReviewerId(_1815));},serialize:function(){var _1816=this.reviewers.data.map(function(_1817){return _1817.serialize();});return {name:this.name,reviewers:_1816};},validate:function(){if(!this.reviewers){return;}var _1818=[],_1819=this.reviewers.query(),_181a=this._validateReviewers(_1819);if(_181a){_1818.push(_181a);}_181a=this._validateLanguages(_1819);if(_181a){_1818.push(_181a);}_181a=this._validateSelfApprove(_1819);if(_181a){_1818.push(_181a);}_181a=this._validateRoles(_1819);if(_181a){_1818.push(_181a);}this.set("validationMessages",_1818);this.set("isValid",_1818.length===0);},hasErrors:function(){return this.validationMessages.some(function(_181b){return _181b.level==="error";});},hasWarnings:function(){return this.validationMessages.some(function(_181c){return _181c.level==="warning";});},_createReviewer:function(_181d){var _181e=new _1804(_181d);_181e.id=this._getReviewerId(_181d);this.own(_181e.watch("languages",function(){this.validate();this.emit("change");}.bind(this)));this.validate();return _181e;},_getReviewerId:function(_181f){return _181f.name.toLowerCase()+":"+_181f.reviewerType;},_nameSetter:function(value){value=value||"";if(value===this.name){return;}this.name=value;this.emit("change");},_nameGetter:function(){return this.name||_180d.step.header.placeholder;},_reviewersSetter:function(_1820){var _1821=_1820.map(function(_1822){return this._createReviewer(_1822);},this);this.reviewers=_180c(new _180b({data:_1821}));this.destroyByKey("reviewersObserveHandle");this.ownByKey("reviewersObserveHandle",this.reviewers.query().observe(function(){this.validate();this.emit("change");}.bind(this)));this.validate();},_selfApproveSetter:function(_1823){this.selfApprove=_1823;this.validate();},_commandsGetter:function(){if(this.commands===null){this.commands=[new _1808({model:this}),new _1809({model:this})];}return this.commands;},_validateLanguages:function(_1824){var _1825=null;if(!this.languages||_1824.length===0){return _1825;}var _1826=[];this.languages.forEach(function(_1827){var _1828=_1824.some(function(_1829){if(_1829.languages.length===0){return true;}return _1829.languages.some(function(_182a){return _182a===_1827.value;});});if(!_1828){if(_1825){_1825.languages.push(_1827.value);}else{_1825={languages:[_1827.value],level:"warning"};}_1826.push(_1827.text);}});if(_1825){_1825.value=lang.replace(_180d.validationmessage.notenoughlanguagesmessage.title,{languages:_1826.join(", ")});}return _1825;},_validateSelfApprove:function(_182b){if(this.selfApprove!==false){return null;}if(!this.languages){if(_182b.length===1&&_182b[0].reviewerType===_180a.reviewerType.user){return {value:_180d.validationmessage.onlyonereviewer.title,languages:null,level:"warning"};}return null;}var _182c=this.languages.filter(function(_182d){var _182e=0;_182b.forEach(function(_182f){if(_182f.languages.length===0||_182f.languages.indexOf(_182d.value)!==-1){if(_182f.reviewerType===_180a.reviewerType.user){_182e++;}else{if(_182f.reviewerType===_180a.reviewerType.role){_182e+=2;}}}});return _182e<2;});if(_182c.length>0){return {value:lang.replace(_180d.validationmessage.onlyonelanguagereviewer.title,{languages:_182c.map(function(_1830){return _1830.text;}).join(", ")}),languages:_182c.map(function(_1831){return _1831.value;}),level:"warning"};}return null;},_validateRoles:function(_1832){if(_1832.length===0){return null;}var _1833=[];_1832.forEach(function(_1834){if(_1834.reviewerType===_180a.reviewerType.role&&_1834.numberOfRoleUsersExceededMax){_1833.push(_1834.displayName);}});if(_1833.length===0){return null;}var text=lang.replace(_180d.validationmessage.roleusersexceededmaxmessage.description,{rolenames:_1833.join(", ")});return {value:text,languages:null,level:"warning"};},_validateReviewers:function(_1835){var _1836=null;if(_1835.length===0){_1836={value:_180d.validationmessage.notenoughreviewersmessage.title,languages:null,level:"error"};}return _1836;}});});},"epi-cms/content-approval/viewmodels/ReviewerViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojox/html/entities","epi-cms/content-approval/ApprovalEnums"],function(_1837,_1838,_1839,_183a){return _1837([_1838],{displayName:null,name:null,reviewerType:_183a.reviewerType.user,numberOfUsers:0,numberOfRoleUsersExceededMax:false,roleFirstUsersNames:[],postscript:function(){this.inherited(arguments);if(this.roleInfo!=null){this.set("numberOfUsers",this.roleInfo.totalNumberOfUsers);this.set("roleFirstUsersNames",this.roleInfo.userNames);this.set("numberOfRoleUsersExceededMax",this.roleInfo.numberOfRoleUsersExceededMax);this.set("displayNameUsersLimit",this.roleInfo.displayNameUsersLimit);}},_numberOfOtherUsersGetter:function(){if(!this.roleFirstUsersNames){return this.numberOfUsers;}return this.numberOfUsers-this.roleFirstUsersNames.length;},_displayNameGetter:function(){var _183b=this.displayName;if(this.reviewerType===_183a.reviewerType.role){_183b+=" ("+this.displayNameUsersLimit;if(this.numberOfRoleUsersExceededMax){_183b+="+";}_183b+=")";}return _1839.encode(_183b);},_roleFirstUsersNamesGetter:function(){if(!this.roleFirstUsersNames||this.roleFirstUsersNames.length===0){return [];}return this.roleFirstUsersNames.map(function(_183c){return _1839.encode(_183c);});},languages:null,canApprove:true,serialize:function(){return {name:this.name,displayName:this.displayName,languages:this.languages,reviewerType:this.reviewerType};},_iconGetter:function(){return this.reviewerType===_183a.reviewerType.role?"epi-iconUsers":"epi-iconUser";}});});},"epi-cms/content-approval/command/AddApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_183d,_183e,_183f){return _183d([_183f],{label:_183e.add,iconClass:"epi-icon--inverted epi-iconPlus",category:"add",propertiesToWatch:["isReadOnly"],_execute:function(){this.model.createApprovalStep();},_onPropertyChanged:function(){var _1840=!this.model.isReadOnly;this.set({canExecute:_1840,isAvailable:_1840});}});});},"epi-cms/content-approval/command/RemoveApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.removeapprovalstep","epi/shell/command/_PropertyWatchCommand"],function(_1841,_1842,_1843){return _1841([_1843],{label:_1842.label,iconClass:"epi-iconClose",category:"remove",propertiesToWatch:["canBeDeleted","isReadOnly"],_execute:function(){this.model.removeApprovalStep();},_onPropertyChanged:function(){var model=this.model,_1844=!model.isReadOnly&&model.canBeDeleted;this.set({canExecute:_1844,isAvailable:_1844});}});});},"epi/shell/command/withConditionalConfirmation":function(){define("epi/shell/command/withConditionalConfirmation",["dojo/Deferred","dojo/when","epi/shell/DialogService"],function(_1845,when,_1846){return function(_1847,_1848){var _1849=_1847._execute,_184a=_1848.property||"requiresConfirmation";_1847._execute=function(){var _184b=_1847[_184a]?_1846.confirmation(_1848):new _1845().resolve();return _184b.then(function(){return when(_1849.apply(_1847,arguments));});};return _1847;};});},"epi-cms/content-approval/command/SaveApprovalDefinition":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/DialogService","epi/shell/command/_PropertyWatchCommand"],function(_184c,_184d,_184e,_184f){return _184c([_184f],{label:_184d.save,isAvailable:true,canExecute:false,propertiesToWatch:["isDirty","isValid","isReadOnly"],_execute:function(){this.model.set("showValidations",true);var _1850=this.model.validate();if(!_1850){this.model.saveApprovalDefinition();return;}switch(_1850.level){case "error":_184e.alert(_1850.dialog);break;case "warning":_184e.confirmation(_1850.dialog).then(function(){this.model.saveApprovalDefinition();}.bind(this));break;}},_onPropertyChanged:function(){this.set("isAvailable",!this.model.isReadOnly);this.set("canExecute",this.model.isDirty&&this.model.isValid);this.set("label",this.model.isDirty?_184d.save:_184d.saved);}});});},"epi-cms/content-approval/command/CancelChanges":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_1851,_1852,_1853,_1854){return _1851([_1854],{label:_1853.cancel,canExecute:true,propertiesToWatch:["isDirty"],contextHistory:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_1852.resolve("epi.cms.BackContextHistory");},_execute:function(){this.contextHistory.closeAndNavigateBack(this);},_onPropertyChanged:function(){var _1855=!!this.model.isDirty;this.set("label",_1855?_1853.cancel:_1853.close);}});});},"epi/shell/store/SortableMemory":function(){define("epi/shell/store/SortableMemory",["dojo/_base/declare","epi/shell/store/queryUtils","dojo/store/Memory"],function(_1856,_1857,_1858){return _1856(_1858,{getSibling:function(_1859,_185a){var data=this.data,index=this.index,id=this.getIdentity(_1859);if(!(id in index)){throw new Error("Object specified in options.before does not exist");}var delta=_185a?-1:1,pos=index[id]+delta;if(pos<0||pos>=data.length){return null;}return data[pos];},put:function(_185b,_185c){var data=this.data,_185d=this.idProperty;var id=_185b[_185d]=(_185c&&"id" in _185c)?_185c.id:_185d in _185b?_185b[_185d]:Math.random();var _185e=false;if(id in this.index){_185e=true;}if(_185c){if(_185c.overwrite===false){if(_185e){throw new Error("Object already exists");}}if(_185c.before||(_185c.hasOwnProperty("before")&&_185e)){var _185f=this.index[id],_1860=data.length;if(_185c.before){var _1861=this.getIdentity(_185c.before);_1860=this.index[_1861];}if(_185f<_1860){--_1860;}if(_1860!==undefined){if(_185e){this.remove(id);}data.splice(_1860,0,_185b);this.setData(data);return id;}else{throw new Error("Object specified in options.before does not exist");}}}if(_185e){data[this.index[id]]=_185b;}else{this.index[id]=data.push(_185b)-1;}return id;},queryEngine:function(query,_1862){query=_1857.createFilter(query,_1862);function _1863(){return this.data.filter(query);};_1863.matches=query;return _1863.bind(this);}});});},"url:epi-cms/content-approval/templates/ApprovalComponent.html":"<div class=\"epi-content-approval\">\r\n    <div class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"dijit/Toolbar\">\r\n        <div class=\"epi-toolbarGroupContainer\">\r\n            <div class=\"epi-toolbarGroup epi-toolbarLeading\">\r\n                <div data-dojo-attach-point=\"breadcrumb\" data-dojo-type=\"epi-cms/content-approval/Breadcrumb\" data-dojo-props=\"displayAsText:false, showCurrentNode:false\"></div>\r\n                <div data-dojo-attach-point=\"breadcrumbCurrentItem\" data-dojo-type=\"epi-cms/widget/BreadcrumbCurrentItem\"></div>\r\n            </div>\r\n            <div class=\"epi-toolbarGroup epi-toolbarTrailing\" data-dojo-attach-point=\"commandNode\">\r\n                <div data-dojo-attach-point=\"validation\" data-dojo-type=\"epi-cms/widget/NotificationStatusBar\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"epi-content-approval__container\">\r\n        <div class=\"epi-content-approval__header\">\r\n            <hgroup class=\"epi-heading-group\">\r\n                <h1 class=\"epi-heading\"><span class=\"epi-heading-icon\" data-dojo-attach-point=\"contentIcon\"></span> <span data-dojo-attach-point=\"contentName\"></span></h1>\r\n                <h2 class=\"epi-heading\">${resources.title}</h2>\r\n            </hgroup>\r\n            <p>${resources.instructions.reviewers}</p>\r\n            <p>${resources.instructions.steps}</p>\r\n            <div class=\"epi-content-approval__settings clearfix\" data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\">\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"enable-approval\" data-dojo-attach-point=\"enableButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.enabled}\">\r\n                    <label class=\"dijitInline\" for=\"enable-approval\">${resources.states.enabled}</label>\r\n                </span>\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"inherit-approval\" data-dojo-attach-point=\"inheritButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.inherited}\">\r\n                    <label class=\"dijitInline\" for=\"inherit-approval\">${resources.states.inherited}</label>\r\n                </span>\r\n                <span class=\"dijitInline\">\r\n                    <input id=\"disabled-approval\" data-dojo-attach-point=\"disableButton\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-props=\"name:'status', value:${ApprovalDefinitionStatus.disabled}\">\r\n                    <label class=\"dijitInline\" for=\"disabled-approval\">${resources.states.disabled}</label>\r\n                </span>\r\n                <fieldset class=\"dijitInline\" data-dojo-attach-point=\"demandCommentFieldsetNode\">\r\n                    <div>\r\n                        <input id=\"demandcomment-start\" data-dojo-attach-point=\"demandStartCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-start\">${resources.demandcomment.start}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"demandcomment-approve-approval\" data-dojo-attach-point=\"demandApproveCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-approve-approval\">${resources.demandcomment.label} ${resources.demandcomment.approve}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"demandcomment-approval\" data-dojo-attach-point=\"demandDeclineCommentButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"demandcomment-approval\">${resources.demandcomment.label} ${resources.demandcomment.decline}</label>\r\n                    </div>\r\n                    <div>\r\n                        <input id=\"prevent-self-approve\" data-dojo-attach-point=\"preventSelfApproveButton\" data-dojo-type=\"dijit/form/CheckBox\">\r\n                        <label class=\"dijitInline\" for=\"prevent-self-approve\">${resources.preventselfapprove}</label>\r\n                    </div>\r\n                </fieldset>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-content-approval__disabled-warning\" data-dojo-attach-point=\"warningNode\">\r\n            <span data-dojo-attach-point=\"warningMessage\"></span><a class=\"epi-visibleLink\" data-dojo-attach-point=\"goToInheritedSequence\" data-dojo-attach-event=\"onclick:_goToInheritedSequence\">${resources.gotoinheritedsequence}</a>\r\n        </div>\r\n        <div class=\"epi-content-approval__filter\" data-dojo-attach-point=\"filterNode\">\r\n            <span class=\"dijitInline\">${resources.languagefilter.description}</span>\r\n            <div data-dojo-attach-point=\"languageFilter\" data-dojo-type=\"dijit/form/Select\" class=\"epi-chromeless epi-chromeless--with-arrow epi-visibleLink\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"stepList\" data-dojo-type=\"epi-cms/content-approval/ApprovalStepList\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/content-approval/Breadcrumb":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi-cms/widget/Breadcrumb"],function(_1864,topic,_1865,_1866){return _1864([_1866],{postscript:function(){this.inherited(arguments);this.approvalService=this.approvalService||_1865.resolve("epi.cms.ApprovalService");},onNodeClick:function(e,_1867){e.preventDefault();this.approvalService.navigateToDefinition(_1867.contentLink);}});});},"epi-cms/content-approval/ApprovalStepList":function(){define(["dojo/_base/declare","dojo/keys","epi-cms/content-approval/ApprovalStep","dijit/_WidgetBase","dijit/_TemplatedMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","dgrid/Keyboard","dgrid/extensions/DijitRegistry","dgrid/extensions/DnD","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/WidgetRow","dojo/text!./templates/ApprovalStepList.html","epi/i18n!epi/nls/episerver.cms.contentapproval.steplist"],function(_1868,keys,_1869,_186a,_186b,_186c,List,_186d,_186e,DnD,_186f,_1870,_1871,_1872){var _1873=_1868([List,_186f,DnD,_186d,_186e,_1870]);return _1868([_186a,_186b,_186c],{model:null,modelBindingMap:{approvalSteps:["approvalSteps"]},templateString:_1871,resources:_1872,buildRendering:function(){this.inherited(arguments);this.list=new _1873({className:"epi-chromeless",dndParams:{withHandles:true,creator:this._createAvatar.bind(this),skipForm:true},maintainOddEven:false,renderRow:this._renderRow.bind(this),selectionMode:"single",sort:"default"},this.listNode);this.own(this.list.addKeyHandler(keys.DELETE,this._removeStep.bind(this)),this.list.addKeyHandler(keys.DOWN_ARROW,this._moveStep.bind(this,false)),this.list.addKeyHandler(keys.UP_ARROW,this._moveStep.bind(this,true)),this.list.on(".dgrid-row:keypress",this._createStep.bind(this)));},startup:function(){this.inherited(arguments);this.list.startup();},_createAvatar:function(item){var step=new _1869({model:item});step.startup();var node=step.domNode.cloneNode(true);step.destroyRecursive();return {node:node,type:this.list.dndSourceType,data:item};},_createStep:function(event){if(!event.ctrlKey&&String.fromCharCode(event.which)==="+"){var row=this.list.row(event);this.model.createApprovalStep(row.data);}},_moveStep:function(_1874,event){if(event.ctrlKey){var row=this.list.row(event);this.list.focus(row);this.model.moveApprovalStep(row.data,_1874);}},_removeStep:function(event){var row=this.list.row(event);this.model.removeApprovalStep(row.data);},_renderRow:function(_1875){var _1876=this.model.get("languageOptions");var step=new _1869({model:_1875,languageOptions:_1876});return step.domNode;},_setApprovalStepsAttr:function(_1877){this._set("approvalSteps",_1877);this.list.set("store",_1877);}});});},"epi-cms/content-approval/ApprovalStep":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","epi-cms/content-approval/viewmodels/ReviewerViewModel","./ApprovalEnums","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/Formatter","dgrid/Keyboard","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","dijit/form/ComboBox","./Reviewer","dojo/text!./templates/ApprovalStep.html","epi/i18n!epi/nls/episerver.cms.contentapproval.step","dijit/form/TextBox"],function(_1878,lang,_1879,_187a,keys,_187b,_187c,_187d,_187e,_187f,_1880,_1881,_1882,List,_1883,_1884,_1885,_1886,_1887,_1888,_1889,_188a,_188b,_188c){var _188d=_1878([List,_1885,_1886,_1884,_1883,_1887]);var _188e=_1878([_1888],{labelType:"html",_onKey:function(evt){if(evt.keyCode===keys.UP_ARROW&&!this._opened){this.onMoveUp(evt);return;}if(evt.keyCode===keys.ENTER&&this._hasSuggestions()&&this._hasNoItemSelected()){this.set("item",this.dropDown.items[0]);}this.inherited(arguments);},labelFunc:function(item){var _188f="<span class=\"dijitInline dijitIcon {icon}\"></span>{displayName}";var _1890=new _187d(item);return lang.replace(_188f,{icon:_1890.get("icon"),displayName:_1890.get("displayName")});},onMoveUp:function(){},_hasSuggestions:function(){return this._opened&&!!this.get("value")&&this.dropDown.items.length>0;},_hasNoItemSelected:function(){return !this.item;}});return _1878([_187f,_1880,_1881,_1882],{model:null,modelBindingMap:{isReadOnly:["isReadOnly"],isValid:["isValid"]},templateString:_188a,resources:_188b,buildRendering:function(){this.inherited(arguments);var store=this.model.get("reviewers");this.headerTextbox.set("value",this.model.name);this.list=new _188d({className:"epi-chromeless",maintainOddEven:false,store:store,sort:"default",renderRow:this._renderReviewer.bind(this)},this.listNode);this.own(this.list.addKeyHandler(keys.DOWN_ARROW,function(evt){evt.stopPropagation();if(evt.target===evt.currentTarget.lastElementChild){this.searchBox.focus();}}.bind(this)),this.list.addKeyHandler(keys.UP_ARROW,function(evt){evt.stopPropagation();}),this.headerTextbox.on("change",function(value){this.model.set("name",value);}.bind(this)));var _1891={"class":"epi-approval-step__add-step__button",showLabel:false,tabIndex:-1},_1892=new _187b({settings:_1891}),_1893=[{category:"add",builder:_1892,target:this.arrowNode},{category:"remove",builder:_1892,target:this.removeNode}];new _187c({configuration:_1893,commandSource:this});var _1894=this.model.get("userStore");this.searchBox=new _188e({labelAttr:"displayName",queryExpr:"${0}",query:{includeRoles:true},store:_1894,searchAttr:"name",autoComplete:false,maxHeight:294},this.searchNode);this.own(_1879.before(this.searchBox,"onSearch",this._searchBoxOnSearch.bind(this)),this.searchBox.on("change",this._searchBoxOnChange.bind(this)),this.searchBox.on("moveUp",function(evt){_1885.moveFocusEnd.call(this.list,evt);}.bind(this)),this.searchBox.on("keypress",function(evt){evt.stopPropagation();}));},_renderReviewer:function(model){var _1895=new _1889({model:model,languageOptions:this.languageOptions});this.own(_1895.on("remove-reviewer",function(_1896){this.model.removeReviewer(_1896);}.bind(this)));return _1895.domNode;},_searchBoxOnSearch:function(users,query,_1897){users=this.model.filterOutExistingUsers(users);return [users,query,_1897];},_searchBoxOnChange:function(value){if(!value||!this.searchBox.item){return;}this.model.addReviewer(this.searchBox.item);this.searchBox.set("value","");},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.searchBox.startup();this.list.contentNode.tabIndex=-1;},getCommands:function(){return this.model.get("commands");},_setIsReadOnlyAttr:function(_1898){this._set("isReadOnly",_1898);_187a.toggle(this.domNode,"epi-approval-step--read-only",_1898);this.headerTextbox.set({readOnly:_1898,tabIndex:_1898?-1:0});},_setIsValidAttr:function(_1899){this._set("isValid",_1899);var _189a=!_1899&&this.model.get("showValidations");var _189b=this.model.hasErrors();_187a.toggle(this.domNode,"epi-approval-step--error",_189a&&_189b);_187a.toggle(this.domNode,"epi-approval-step--warning",_189a&&(!_189b&&this.model.hasWarnings()));}});});},"epi/shell/dgrid/SingleQuery":function(){define("epi/shell/dgrid/SingleQuery",["dojo/_base/declare","dgrid/_StoreMixin"],function(_189c,_189d){return _189c(_189d,{refresh:function(){this.inherited(arguments);if(!this._started||!this.store){return;}return this._trackError(function(){var _189e=this.get("queryOptions"),_189f=this.store.query(this.query,_189e);return this.renderArray(_189f,null,_189e);}.bind(this));},renderArray:function(){var rows=this.inherited(arguments);this._lastCollection=null;return rows;}});});},"epi-cms/content-approval/Reviewer":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/store/Memory","dijit/_WidgetBase","dijit/Tooltip","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","./groupMembersListFormatter","./ApprovalEnums","dojo/text!./templates/Reviewer.html","epi/i18n!epi/nls/episerver.cms.contentapproval.reviewer","epi-cms/contentediting/editors/CheckboxListDropDown"],function(_18a0,_18a1,_18a2,_18a3,keys,_18a4,_18a5,_18a6,_18a7,_18a8,_18a9,_18aa,_18ab,_18ac,_18ad){return _18a0([_18a5,_18a7,_18a8,_18a9],{model:null,modelBindingMap:{canApprove:["canApprove"]},templateString:_18ac,resources:_18ad,tooltip:null,postMixInProperties:function(){if(!this.model){throw new Error("An instance of ReviewerViewModel must be provided in order to create an Reviewer component.");}},buildRendering:function(){this.inherited(arguments);if(this.model.reviewerType===_18ab.reviewerType.role){this.own(this.tooltip=new _18a6({connectId:[this.selectedReviewerNode],label:this._formatMembersTooltipLabel(),position:["below-centered","above-centered"]}));}this.set("displayName",this.model.get("displayName"));var store=new _18a4({idProperty:"value",data:this.languageOptions||[]});this.languageSelector.set("store",store);if(this.model.languages){this.languageSelector.set("value",this.model.languages,false);}_18a1.toggle(this.languageSelector.domNode,"dijitHidden",!this.languageOptions);_18a1.add(this.reviewerIcon,this.model.get("icon"));this.own(this.on(".epi-reviewer__remove-button:click",this._removeReviewer.bind(this)),this.on("keydown",this._removeReviewer.bind(this)),this.languageSelector.on("change",function(_18ae){this.model.set("languages",_18ae);this._renderSelectedLanguages();}.bind(this)));this._renderSelectedLanguages();},_formatMembersTooltipLabel:function(){var _18af=this.model.get("roleFirstUsersNames");if(!_18af||_18af.length===0){return _18ad.nogroupmembers;}var _18b0="<div class='epi-approval-group-tooltip'>"+_18aa.renderList(_18af);var _18b1=this.model.get("numberOfOtherUsers");if(_18b1>0){_18b0+="<div>+"+_18b1+"</div>";}_18b0+="</div>";return _18b0;},_removeReviewer:function(evt){if(evt.type==="click"||evt.keyCode===keys.DELETE){evt.stopPropagation();this.emit("remove-reviewer",this.model);}},_renderSelectedLanguages:function(){_18a2.empty(this.languageSettingsNode);if(!this.languageOptions){return;}var self=this;function _18b2(_18b3){var _18b4=self.languageSelector.store.get(_18b3),_18b5="dijitInline epi-lozenge";if(!_18b4&&self.model.languages.length>0){_18b5+=" epi-lozenge--inactive";}var _18b6={innerHTML:_18b3,"class":_18b5,title:_18b4?_18b4.label:_18b3};_18a2.create("span",_18b6,self.languageSettingsNode);};if(this.model.languages){if(this.model.languages.length<1){_18b2(_18ad.alllanguages);return;}this.model.languages.forEach(_18b2);}},_setDisplayNameAttr:{node:"userDisplayNameNode",type:"innerHTML"},_setCanApproveAttr:function(_18b7){this._set("canApprove",_18b7);_18a3.set(this.domNode,"display",_18b7?"":"none");}});});},"epi-cms/content-approval/groupMembersListFormatter":function(){define(["dojo/_base/lang"],function(lang){var _18b8="<span class='epi-reviewer__name'>{name}</span></span>";var _18b9={renderList:function(users){var res=[];users.forEach(function(u){res.push(lang.replace(_18b8,{name:u}));});return res.join(" ");}};return _18b9;});},"url:epi-cms/content-approval/templates/Reviewer.html":"<div class=\"epi-reviewer\">\r\n    <button class=\"epi-button--round epi-reviewer__remove-button\"\r\n            tabindex=\"-1\"\r\n            data-dojo-type=\"dijit/form/Button\"\r\n            type=\"button\">\r\n        <span class=\"dijitInline dijitIcon dijitReset epi-iconMinus epi-icon--inverted\"></span>\r\n    </button>\r\n    <span data-dojo-attach-point=\"selectedReviewerNode\">\r\n        <span data-dojo-attach-point=\"reviewerIcon\" class=\"dijitInline dijitIcon\"></span>\r\n        <span class=\"dijitInline epi-reviewer__name\" data-dojo-attach-point=\"userDisplayNameNode\"></span>\r\n    </span>\r\n    <span class=\"epi-reviewer__language-selector epi-chromeless epi-chromeless--icon-only epi-chromeless--with-arrow\"\r\n          data-dojo-attach-point=\"languageSelector\"\r\n          data-dojo-type=\"epi-cms/contentediting/editors/CheckboxListDropDown\"\r\n          data-dojo-props=\"iconClass: 'epi-iconWebsite', header: '${resources.selectlanguage}', selectAllText: '${resources.anylanguage}'\"></span>\r\n    <span class=\"dijitInline\" data-dojo-attach-point=\"languageSettingsNode\"></span>\r\n</div>\r\n","epi-cms/contentediting/editors/CheckboxListDropDown":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojox/html/entities","epi/epi","epi/i18n!epi/nls/episerver.shared.action","./CheckboxList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_18ba,lang,on,_18bb,epi,_18bc,_18bd,_18be,_18bf){return _18ba([_18bf,_18be],{value:null,store:null,sort:null,query:null,enableSelectAll:true,selectAllText:_18bc.selectall,header:_18bc.select,buildRendering:function(){this.own(this.dropDown=new _18bd({baseClass:"dijitMenu",header:this.header,enableSelectAll:this.enableSelectAll,selectAllText:this.selectAllText,onExecute:function(){}}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);}),true));this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableSelectAll&&!this.value){this.set("value",null);}},compare:function(_18c0,_18c1){return epi.areEqual(_18c0,_18c1)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _18c2=this.dropDown.refresh();return _18c2.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableSelectAll){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_18bb.encode(value||"")]);},_setValueAttr:function(value,_18c3){!_18c3&&this.dropDown&&this.dropDown.set("selectedItems",value);this.inherited(arguments);}});});},"epi-cms/contentediting/editors/CheckboxList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","epi/epi","dojo/text!./templates/CheckboxList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.action","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer"],function(_18c4,lang,keys,when,_18c5,_18c6,epi,_18c7,_18c8,_18c9,_18ca,_18cb,_18cc,mouse,put,_18cd,_18ce,_18cf,_18d0,_18d1){return _18c4([_18ce,_18cf,_18d0,_18d1],{templateString:_18c7,store:null,query:null,enableSelectAll:true,selectAllText:_18c8.selectall,header:_18c8.select,_setHeaderAttr:{node:"headerNode",type:"innerText"},buildRendering:function(){this.inherited(arguments);this.list=new (_18c4([_18c9,_18ca,_18cc,_18cb,_18cd]))({className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionEvents:"click",selectionMode:"toggle",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.list.on("change",function(e){e.stopPropagation();});this.own(this.list,this.list.on("dgrid-select,dgrid-deselect",lang.hitch(this,"_itemsSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(mouse.enterRow,lang.hitch(this,"_listMouseover")),this.selectAll.on("click",lang.hitch(this,"_selectAllSelected")),this.selectAll.on("keypress",lang.hitch(this,"_selectAllKeypress")),this.selectAll.on("mouseover",lang.hitch(this,"_selectAllMouseover")));if(this.enableSelectAll){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_18c5.add(this.selectAll.domNode,"dijitHidden");}this.selectAll.set({iconClass:"dijitCheckBoxIcon",label:_18c6.encode(this.selectAllText),title:this.selectAllText});},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.list.set("store",this.store);},focus:function(){if(this.enableSelectAll){this.selectAll.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_18d2){var _18d3=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitCheckBox"));var label=put("label.epi-selector-list__title.dojoxEllipsis","span",{title:item.label,textContent:item.label});return put("div",[_18d3,label]);},refresh:function(){if(!this._started){return;}return this.list.refresh();},_itemsSelected:function(e){var _18d4=[];Object.keys(e.grid.selection).forEach(function(key){_18d4.push(key);});if(!epi.areEqual(_18d4,this.get("selectedItems"))){this.set("selectedItems",_18d4,true);this.emit("change",{value:_18d4});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(total){this.emit("loaded");_18c5.toggle(this.separatorNode,"dijitHidden",!total||!this.enableSelectAll);}));},_selectAllSelected:function(){this.set("selectedItems",null);},_selectAllKeypress:function(e){var _18d5;switch(e.keyCode){case keys.DOWN_ARROW:_18d5=_18cb.moveFocusHome;break;case keys.PAGE_DOWN:_18d5=_18cb.moveFocusPageDown;break;case keys.END:_18d5=_18cb.moveFocusEnd;break;default:return;}_18d5.apply(this.list,[e]);},_selectAllMouseover:function(){this.selectAll.focus();},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_18d6=list.up(row,1,true);if(row.id===_18d6.id){this.selectAll.focus();}},_listNavigateHome:function(){this.selectAll.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_setSelectedItemsAttr:function(_18d7,_18d8){this._set("selectedItems",_18d7);if(!_18d8){this.list.clearSelection();if(_18d7){_18d7.forEach(function(item){this.list.select(item);}.bind(this));}}this._updateView();},_updateView:function(){this.selectAll.set("checked",!this.selectedItems||this.selectedItems.length===0);}});});},"url:epi-cms/contentediting/editors/templates/CheckboxList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\r\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\r\n        <div class=\"epi-tooltipDialogTop\">\r\n            <span data-dojo-attach-point=\"headerNode\"></span><div class=\"dijitTooltipConnector\"></div>\r\n        </div>\r\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"selectAll\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitcheckboxicon'\"></button>\r\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n    </div>\r\n</div>\r\n","url:epi-cms/content-approval/templates/ApprovalStep.html":"<div class=\"epi-approval-step\">\r\n    <div class=\"epi-approval-step__header\">\r\n        <div class=\"dijitInline dojoDndHandle\">\r\n            <span class=\"dijitInline epi-iconDnD\"></span>\r\n        </div>\r\n        <div placeholder=\"${resources.header.placeholder}\" title=\"${resources.header.tooltip}\" data-dojo-attach-point=\"headerTextbox\" data-dojo-type=\"dijit/form/TextBox\"></div>\r\n        <div class=\"dijitInline\" data-dojo-attach-point=\"removeNode\"></div>\r\n    </div>\r\n    <div class=\"epi-approval-step__container\">\r\n        <div data-dojo-attach-point=\"listNode\"></div>\r\n        <div class=\"epi-reviewer__add\">\r\n            <span class=\"dijitInline dijitIcon epi-iconUser\"></span>\r\n            <div class=\"dijitInline\" data-dojo-attach-point=\"searchNode\"></div>\r\n        </div>\r\n    </div>\r\n    <div class=\"epi-approval-step__add-step\" data-dojo-attach-point=\"arrowNode\"></div>\r\n</div>\r\n","dgrid/extensions/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/on","dojo/topic","dojo/has","dojo/dnd/Source","dojo/dnd/Manager","dojo/_base/NodeList","put-selector/put","../Selection","dojo/has!touch?../util/touch","dojo/has!touch?./_DnD-touch-autoscroll","xstyle/css!dojo/resources/dnd.css"],function(_18d9,lang,_18da,_18db,_18dc,on,topic,has,_18dd,_18de,_18df,put,_18e0,_18e1){var _18e2=_18d9(_18dd,{grid:null,getObject:function(node){var grid=this.grid;return grid.store.get(node.id.slice(grid.id.length+5));},_legalMouseDown:function(evt){var legal=this.inherited(arguments);return legal&&evt.target!=this.grid.bodyNode;},onDrop:function(_18e3,nodes,copy){var _18e4=this,_18e5=this._targetAnchor=this.targetAnchor,grid=this.grid,store=grid.store;if(!this.before&&_18e5){_18e5=_18e5.nextSibling;}_18e5=_18e5&&grid.row(_18e5);_18db.when(_18e5&&store.get(_18e5.id),function(_18e6){if(_18e4!=_18e3){_18e4.onDropExternal(_18e3,nodes,copy,_18e6);}else{_18e4.onDropInternal(nodes,copy,_18e6);}});},onDropInternal:function(nodes,copy,_18e7){var grid=this.grid,store=grid.store,_18e8=this,_18e9=_18e8._targetAnchor,_18ea,_18eb;if(_18e9){_18ea=this.before?_18e9.previousSibling:_18e9.nextSibling;}_18eb=grid.row(nodes[0]);if(!copy&&(_18ea===nodes[0]||(!_18e7&&_18eb&&grid.down(_18eb).element==nodes[0]))){return;}nodes.forEach(function(node){_18db.when(_18e8.getObject(node),function(_18ec){var id=store.getIdentity(_18ec);store[copy&&store.copy?"copy":"put"](_18ec,{before:_18e7});if(_18e8._selectedNodes[id]){_18e8._selectedNodes[id]=grid.row(id).element;}});});},onDropExternal:function(_18ed,nodes,copy,_18ee){var store=this.grid.store,_18ef=_18ed.grid;nodes.forEach(function(node,i){_18db.when(_18ed.getObject(node),function(_18f0){if(!copy){if(_18ef){_18db.when(_18ef.store.getIdentity(_18f0),function(id){!i&&_18ed.selectNone();_18ed.delItem(node.id);_18ef.store.remove(id);});}else{_18ed.deleteSelectedNodes();}}store[store.copy?"copy":"put"](_18f0,{before:_18ee});});});},onDndStart:function(_18f1,nodes,copy){this.inherited(arguments);if(_18f1==this){if(this.grid.cancelTouchScroll){this.grid.cancelTouchScroll();}_18de.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px";}},onMouseDown:function(evt){if(has("touch")&&this.isDragging&&_18e1.countCurrentTouches(evt,this.grid.touchNode)>1){topic.publish("/dnd/cancel");_18de.manager().stopDrag();}else{this.inherited(arguments);}},onMouseMove:function(evt){if(!has("touch")||_18e1.countCurrentTouches(evt,this.grid.touchNode)<=1){this.inherited(arguments);}},checkAcceptance:function(_18f2,nodes){return _18f2.getObject&&_18dd.prototype.checkAcceptance.apply(this,arguments);},getSelectedNodes:function(){if(!this.grid.selection){return this.inherited(arguments);}var t=new _18df(),id;for(id in this.grid.selection){t.push(this._selectedNodes[id]);}return t;}});var DnD=_18d9(_18e0,{dndSourceType:"dgrid-row",dndParams:null,dndConstructor:_18e2,postMixInProperties:function(){this.inherited(arguments);this.dndParams=lang.mixin({accept:[this.dndSourceType]},this.dndParams);},postCreate:function(){this.inherited(arguments);this.dndSource=new (this.dndConstructor||_18e2)(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));var _18f3=this.dndSource._selectedNodes={};function _18f4(row){_18f3[row.id]=row.element;};function _18f5(row){delete _18f3[row.id];put(row.element,"!dojoDndItemSelected!dojoDndItemAnchor");};this.on("dgrid-select",function(event){_18da.forEach(event.rows,_18f4);});this.on("dgrid-deselect",function(event){_18da.forEach(event.rows,_18f5);});_18dc.after(this,"destroy",function(){delete this.dndSource._selectedNodes;_18f3=null;this.dndSource.destroy();},true);},insertRow:function(_18f6){var row=this.inherited(arguments),type=typeof this.getObjectDndType=="function"?this.getObjectDndType(_18f6):[this.dndSourceType];put(row,".dojoDndItem");this.dndSource.setItem(row.id,{data:_18f6,type:type instanceof Array?type:[type]});return row;},removeRow:function(_18f7){this.dndSource.delItem(this.row(_18f7));this.inherited(arguments);}});DnD.GridSource=_18e2;return DnD;});},"url:epi-cms/content-approval/templates/ApprovalStepList.html":"<div class=\"epi-approval-step-list\">\r\n    <div class=\"epi-approval-step-list__status\">\r\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--review\"></span><h2 class=\"dijitInline\">${resources.readytoreview}</h2>\r\n    </div>\r\n    <div data-dojo-attach-point=\"listNode\"></div>\r\n\r\n    <div class=\"epi-approval-step-list__status\">\r\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--publish\"></span><h2 class=\"dijitInline\">${resources.readytopublish}</h2>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,array,_18f8,lang,url,win,_18f9,_18fa,on,topic,_18fb,_18fc,_18fd,epi,_18fe,_18ff,_1900,res,_1901){return _18f8([_18fc,_18fb,_18fd,_18fe],{templateString:_1901,_setContentTypeNameAttr:function(value){this.typeNode.textContent=value;this.typeNode.title=value;},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_1902){this.languagesNode.innerHTML="";array.forEach(_1902,function(item,idx){var elm,_1903=idx===_1902.length-1;if(item.isCurrentLanguage){elm=_18fa.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_18fa.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_18fa.place(elm,this.languagesNode);if(!_1903){_18fa.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_1904){this.visibleToNode.innerHTML=_1904?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(value){_18f9.set(this.manageAccessRightsButton.domNode,"display",value?"":"none");},resources:null,modelBindingMap:{contentTypeName:["contentTypeName"],contentId:["contentId"],existingLanguages:["existingLanguages"],visibleToEveryOne:["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _1905=new _18ff();this._menuAssembler=new _1900({configuration:[{builder:_1905,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(value){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<ul class=\"epi-form-container__section\">\r\n    <ul data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></ul>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.visibleto.title}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span data-dojo-attach-point=\"visibleToNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.existinglanguages}</label>\r\n        <span data-dojo-attach-point=\"languagesNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.idandtypename}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\">\r\n                <span data-dojo-attach-point=\"idNode\"></span>, <span data-dojo-attach-point=\"typeNode\"></span>\r\n            </span>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label></label>\r\n        <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n            <span>${resources.toolsbutton.label}</span>\r\n            <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n        </div>\r\n    </li>\r\n</ul>","epi-cms/contentediting/ContentPreview":function(){define(["dojo/_base/declare","epi-cms/contentediting/_View"],function(_1906,_1907){return _1906([_1907],{noPreview:true,constructor:function(){this.defaultQueryParameters={};},startup:function(){this.inherited(arguments);this.overlay.set("enabled",true);this.iframeWithOverlay.set("previewClass","epi-editorViewport-preview--previewing");},destroy:function(){this.iframeWithOverlay.set("previewClass","");this.inherited(arguments);}});});},"epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/DialogService","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_1908,lang,_1909,_190a,_190b,topic,when,_190c,_190d,_190e,_190f,_1910,_1911,_1912,_1913,_1914,_1915,_1916,_1917,_1918,_1919,_191a,_191b,_191c,_191d){return _1908([_190f,_190c,_190d,_1914],{templateString:_191c,sharedResources:_191d,modelType:_1917,_contextService:null,_beingSuspended:null,modelBindingMap:{parent:["parent"],requestedType:["requestedType"],metadata:["metadata"],isContentTypeSelected:["isContentTypeSelected"],headingText:["headingText"],createAsLocalAssetHelpText:["createAsLocalAssetHelpText"],contentName:["contentName"],contentNameHelpText:["contentNameHelpText"],wizardStep:["wizardStep"],showAllProperties:["showAllProperties"],createAsLocalAsset:["createAsLocalAsset"],seamlessTopPanel:["seamlessTopPanel"],namePanelIsVisible:["namePanelIsVisible"],headingPanelIsVisible:["headingPanelIsVisible"],saveButtonIsVisible:["saveButtonIsVisible"],saveButtonDisabled:["saveButtonDisabled"],showCurrentNodeOnBreadcrumb:["showCurrentNodeOnBreadcrumb"],notificationContext:["notificationContext"],actualParentLink:["actualParentLink"],propertyFilter:["propertyFilter"],allowedTypes:["allowedTypes"],restrictedTypes:["restrictedTypes"]},_setParentAttr:function(_191e){if(_191e){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_191e.name,dataType:_191e.typeIdentifier});}},_setPropertyFilterAttr:function(_191f){this._set("propertyFilter",_191f);this.propertiesForm.propertyFilter=_191f;},_setAllowedTypesAttr:function(value){this.contentTypeList.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this.contentTypeList.set("restrictedTypes",value);},_setRequestedTypeAttr:function(_1920){this.contentTypeList.set("requestedType",_1920);},_setMetadataAttr:function(_1921){if(_1921){this.propertiesForm.set("metadata",_1921);}},_setHeadingTextAttr:function(_1922){this.headingTextNode.textContent=this.subHeadingTextNode.textContent=_1922;},_setContentNameHelpTextAttr:{node:"contentNameHelpTextNode",type:"innerText"},_setCreateAsLocalAssetAttr:function(_1923){this._set("createAsLocalAsset",_1923);var _1924=this.model.get("parent");if(_1924){this.toolbar.setItemProperty("breadcrumbs","contentLink",_1923?_1924.assetsFolderLink:_1924.contentLink);}this.contentTypeList.set("localAsset",_1923);},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_1925){this.nameTextBox.set("value",_1925);},_setWizardStepAttr:function(_1926){var _1927;var child;if(_1926<0||_1926===this.wizardStep){return;}_1927=this.stackContainer.getChildren();if(_1926<_1927.length){child=_1927[_1926];this.stackContainer.selectChild(child);this._set("wizardStep",_1926);}},_setShowAllPropertiesAttr:function(_1928){this._set("showAllProperties",_1928);this.propertiesForm.set("showAllProperties",_1928);},_setSeamlessTopPanelAttr:function(value){_190b.toggle(this.topPanel.domNode,"epi-listingTopContainer",value);},_setNamePanelIsVisibleAttr:function(_1929){_190a.set(this.namePanel,"display",_1929?"":"none");},_setHeadingPanelIsVisibleAttr:function(_192a){_190a.set(this.headingPanel,"display",_192a?"":"none");_190a.set(this.subHeadingPanel,"display",_192a?"none":"");},_setSaveButtonIsVisibleAttr:function(_192b){this.toolbar.setItemVisibility("saveButton",_192b);},_setSaveButtonDisabledAttr:function(_192c){this.toolbar.setItemProperty("saveButton","disabled",_192c);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_192d){this.toolbar.setItemProperty("notificationCenter","notificationContext",_192d);},_setActualParentLinkAttr:function(_192e){this.contentTypeList.set("parentLink",_192e);},_setContentTypeNameAttr:{type:"innerHTML",node:"contentTypeNameNode"},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_1913.resolve("epi.shell.ContextService");this._setupToolbar();},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_190b.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){if(data&&((data.parent&&data.requestedType)||(data.contentData&&data.languageBranch))){this.view=data.view;this._setCreateMode();this._beingSuspended=false;this.set("contentTypeName","");when(this.model.update(data),lang.hitch(this,function(){this.layout();if(this.nameTextBox){this.nameTextBox.focus();this.nameTextBox.textbox.select();}}),function(err){});}},_onSaveSuccess:function(_192f){this._clearCreateMode();this._beingSuspended=true;if(_192f.changeContext){this._changeContext(_192f.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){topic.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();topic.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_1930){var _1931=new _1916({defaultContentName:_1930});_1915.dialog({defaultActionsVisible:false,autofocus:true,content:_1931,title:_1931.title}).then(function(){var name=_1931.get("value");if(name===_1930){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}.bind(this)).otherwise(function(){if(this.contentTypeList.shouldSkipContentTypeSelection){this._cancel();}else{this.model.set("isContentTypeSelected",false);}}.bind(this));},_onContentTypeSelected:function(item){if(!this.isContentTypeSelected){this.model.set("contentTypeId",item.id);this.set("contentTypeName",item.localizedName);}},_onPropertyValidStateChange:function(_1932,error){if(error){this.model.addInvalidProperty(_1932,error);}else{this.model.removeInvalidProperty(_1932);}},_onBlurVerifyContent:function(){if(this.nameTextBox.get("value")===""){this.nameTextBox.set("value",this.model.defaultName);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _1933=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1934=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_191d.action.create,label:_191d.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-button--bold epi-primary"}},{parent:"trailing",name:"cancelButton",title:_191d.action.cancel,label:_191d.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-button--bold"}}];when(this.toolbar.add(_1933),lang.hitch(this,function(){this.toolbar.add(_1934);}));},_changeContext:function(_1935){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1935},{sender:this,viewName:this.view,forceContextChange:true,forceReload:true});},_backToCurrentContext:function(){topic.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"create"});topic.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_190b.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{currentMode:undefined});topic.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/keys","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_1936,lang,_1937,keys,_1938,_1939,_193a,_193b,_193c,epi,_193d,_193e,_193f,_1940,res){return _1936([_1939,_193a,_193b,_193f,_193d,_1938],{templateString:_1940,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _1941=this.contentNameTextbox.isValid();if(evt.keyCode===keys.ENTER&&_1941){this.executeDialog();}}));this.on("focus",lang.hitch(this,function(){this.contentNameTextbox.textbox.select();}));},_getValueAttr:function(){return this.contentNameTextbox.get("value");},_onBlurVerifyContent:function(){if(this.contentNameTextbox.get("value")===""){this.contentNameTextbox.set("value",this.defaultContentName);}},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-attach-point=\"messageNode\"></div>\r\n    <br />\r\n    <div>\r\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\r\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                data-dojo-props=\"required: true, trim:true, selectOnClick: true\"\r\n                data-dojo-attach-event=\"onBlur: _onBlurVerifyContent\"\r\n                missingMessage: \"${res.errormessage.missingmessage}\" />\r\n    </div>\r\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/shell/ui/nls/episerver.shared.messages","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(array,_1942,lang,json,_1943,_1944,when,_1945,_1946,_1947,_1948,_1949,_194a,_194b){return _1942([_1943,_1945],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",contentDataStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,autoPublish:false,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,contentNameHelpText:"",createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,actualParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);if(!this.contentDataStore){var _194c=_1946.resolve("epi.storeregistry");this.contentDataStore=_194c.get("epi.cms.contentdata");}this.metadataManager=this.metadataManager||_1946.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_1946.resolve("epi.cms.ProjectService");this.validator=this.validator||new _1949({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_194d){this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);this.set("isContentTypeSelected",false);this.set("namePanelIsVisible",true);this.set("headingPanelIsVisible",true);this.set("showCurrentNodeOnBreadcrumb",true);this.set("seamlessTopPanel",true);if(_194d){array.forEach(["allowedTypes","restrictedTypes","requestedType","parent","createAsLocalAsset","autoPublish","addToDestination","contentTypeId"],function(_194e){this.set(_194e,_194d[_194e]);},this);}if(this.parent){var _194f=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_194f);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_194f});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){var _1950=this.contentName;if(this.metadata&&this.metadata.additionalValues&&this.metadata.additionalValues.modelTypeIdentifier){_1950=_1947.getResourceValue(this.metadata.additionalValues.modelTypeIdentifier,"newitemdefaultname");}this._emitSaveEvent("invalidContentName",_1950);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_1951){if(_1951){this._emitSaveEvent("validationError");return;}var _1952=this.buildContentObject();this.projectService.getCurrentProjectId().then(function(_1953){_1952.autoPublish=_1952.autoPublish&&!_1953;this.contentDataStore.put(_1952).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}.bind(this));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_1954,_1955){this.set("saveButtonDisabled",false);this.emit(_1954,_1955);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_1956,_1957){var _1958=_1957.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_1957.originalGroupName!=="Advanced";var _1959=this._isRequiredProperty(_1956,_1957);if(this.showAllProperties){return _1958||_1959;}else{return _1959;}},_saveSuccessHandler:function(_195a){var ref=new _1948(_195a),_195b=ref.createVersionUnspecificReference(),_195c=lang.hitch(this,function(_195d){this._emitSaveEvent("saveSuccess",{newContentLink:_195d,changeContext:true});});when(this.contentDataStore.refresh(_195a),lang.hitch(this,function(_195e){if(this.addToDestination){this.addToDestination.save({contentLink:_195b.toString(),name:_195e.name,typeIdentifier:_195e.typeIdentifier});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_195c(_195b.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _195f=json.fromJson(err.responseText);array.forEach(_195f,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:_1944.trim(this.contentName+""),parentLink:this._getParentLink(),contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset,autoPublish:this.autoPublish};},addInvalidProperty:function(_1960,_1961){this.validator.setPropertyErrors(_1960,[{severity:this.validator.severity.error,errorMessage:_1961}],this.validator.validationSource.client);},removeInvalidProperty:function(_1962){this.validator.clearPropertyErrors(_1962);},_contentTypeIdSetter:function(_1963){this.contentTypeId=_1963;if(_1963&&this.parent){this.set("isContentTypeSelected",true);this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this._getMetadata(this.parent.contentLink,_1963),lang.hitch(this,function(_1964){_1964=this._regroupProperties(_1964);this.set("metadata",_1964);if(this.autoPublish||this._hasRequiredProperties(_1964)){this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}),lang.hitch(this,function(){this.set("isContentTypeSelected",false);this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:_194a.unexpectederror}],this.validator.validationSource.server);}));}},_createAsLocalAssetSetter:function(_1965){this.createAsLocalAsset=_1965;if(this.parent){this.set("actualParentLink",this._getParentLink());}},_autoPublishSetter:function(_1966){this.set("showAllProperties",_1966);this.autoPublish=_1966;},_parentSetter:function(_1967){this.parent=_1967;var _1968=this.parent.typeIdentifier,_1969=_1947.getResourceValue(this.requestedType,"name"),_196a=_1947.getResourceValue(_1968,"name"),_196b=_1947.getResourceValue(_1968,"createaslocalassethelptext");if(_1969&&_196a){_196b=lang.replace(_196b,[_1969.toLowerCase(),_196a.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_196b);},_requestedTypeSetter:function(_196c){var _196d=_1947.getResourceValue(_196c,"create"),_196e=_1947.getResourceValue(_196c,"newitemdefaultname");this.defaultName=_196e;this.set("headingText",_196d);this.set("contentName",_196e);this.requestedType=_196c;},_getParentLink:function(){if(!this.parent){return null;}if(this.createAsLocalAsset){return this.parent.ownerContentLink?this.parent.ownerContentLink:this.parent.contentLink;}return this.parent.contentLink;},_hasRequiredProperties:function(_196f){return array.some(_196f.properties,function(_1970){return this._isRequiredProperty(_196f,_1970);},this);},_isRequired:function(_1971){return _1971.settings&&_1971.settings.required;},_isRequiredProperty:function(_1972,_1973){var _1974=!_1973.additionalValues.hasValue;var _1975=_1973.showForEdit&&array.every(_1972.groups,function(group){return (group.name!==_1973.groupName&&group.name!==_1973.originalGroupName)||group.displayUI;});var _1976=array.some(_1973.properties,function(_1977){return this._isRequiredProperty(_1973,_1977);},this);return (this._isRequired(_1973)||_1976)&&_1974&&_1975&&(_1973.name!=="icontent_name");},_regroupProperties:function(_1978){_1978=lang.clone(_1978);_1978.layoutType=this._topLevelContainerType;array.forEach(_1978.properties,function(prop){var _1979=this._isRequiredProperty(_1978,prop);prop.originalGroupName=prop.groupName;prop.groupName=_1979?"required":"additional";},this);_1978.groups=[{name:"required",displayUI:true,title:_194b.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_194b.groups.additional,uiType:this._groupContainerType}];return _1978;},_getMetadata:function(_197a,_197b){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_197a,contentTypeId:_197b});}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi-cms/widget/viewmodel/ContentTypeListViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(_197c,_197d,all,when,_197e,_197f,_1980,_1981,i18n){return _197c([_197e],{parentLink:null,requestedType:null,shouldSkipContentTypeSelection:null,allowedTypes:null,restrictedTypes:null,postMixInProperties:function(){this.inherited(arguments);this.model=new _1981();this.own(this.model);},buildRendering:function(){this.inherited(arguments);var _1982=new _1980();this.connect(_1982,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_1982);this._suggestedContentTypes=_1982;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this.model.getSortedSuggestedContentTypes(),groups:this.model.getSortedGroupContentTypes()})).then(function(_1983){var types=_1983.types,_1984=_1983.groups,_1985=_1984.grouped,_1986=_1984.contentTypes;if(types.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_197d.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",types);this._suggestedContentTypes.setVisibility(true);}var key,group;for(key in _1985){group=this._getOrCreateGroup(key);group.set("contentTypes",_1985[key]);}if(_1986 instanceof Array&&_1986.length===1){this.setVisibility(false);this.set("shouldSkipContentTypeSelection",true);this.onContentTypeSelected(_1986[0]);}else{this.set("shouldSkipContentTypeSelection",false);}}.bind(this));},setVisibility:function(_1987){this.getChildren().forEach(function(group){group.setVisibility(_1987);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_197f.getResourceValue(this.requestedType,"suggestedtypes");this.model.otherTypesTitle=_197f.getResourceValue(this.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();this.model.clear();},_getOrCreateGroup:function(name){var group=this.model.groups[name];if(!group){group=new _1980({title:name});this.connect(group,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(group);this.model.groups[name]=group;}return group;},_setLocalAssetAttr:function(_1988){this._set("localAsset",_1988);this.model.set("localAsset",_1988);if(this.requestedType&&this.parentLink){this.refresh();}},_setParentLinkAttr:function(value){this._set("parentLink",value);this.model.set("parentLink",value);if(this.requestedType){this.refresh();}},_setRequestedTypeAttr:function(value){this._set("requestedType",value);this.model.set("requestedType",value);},_setAllowedTypesAttr:function(value){this._set("allowedTypes",value);this.model.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this._set("restrictedTypes",value);this.model.set("restrictedTypes",value);},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_1989,lang,array,_198a,_198b,_198c,_198d,_198e,keys,_198f){return _1989([_198d,_198c,_198f],{title:"",contentTypes:null,templateString:_198b,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();array.forEach(this.contentTypes,function(type){var child=new _198e({contentType:type});this.connect(child,"onSelect",this.onSelect);this.addChild(child);},this);},clear:function(){array.forEach(this.getChildren(),function(child){this.removeChild(child);child.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(value){this._set("contentTypes",value);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_1990){var value=(_1990?"block":"none");_198a.set(this.domNode,"display",value);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\r\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\r\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\r\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_1991,_1992,focus,_1993,_1994,i18n,_1995){return dojo.declare([_1993,_1994],{templateString:_1995,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_1992.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(value){this._set("contentType",value);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(value){this._set("icon",value);this.iconNode.innerHTML=value?_1992.substitute(this.iconTemplate,[value,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_1991.add(this.focusNode,"epi-advancedListingItemActive");focus.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_1991.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_1991.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_1991.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\r\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\r\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\r\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\r\n</li>","epi-cms/widget/viewmodel/ContentTypeListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/when","dojo/Stateful","epi/dependency"],function(array,_1996,_1997,all,when,_1998,_1999){return _1996([_1998],{store:null,parentLink:null,groups:null,requestedType:null,allowedTypes:null,restrictedTypes:null,contentTypeService:null,localAsset:false,otherTypesTitle:null,postscript:function(){this.inherited(arguments);this.groups={};this.contentTypeService=this.contentTypeService||_1999.resolve("epi.cms.ContentTypeService");if(!this.store){var _199a=_1999.resolve("epi.storeregistry");this.store=_199a.get("epi.cms.contenttype");}},getSortedSuggestedContentTypes:function(){return when(this._getSuggestedContentTypes(this.requestedType)).then(function(types){if(types.length>1){this._sortContentTypes(types);}return types;}.bind(this));},getSortedGroupContentTypes:function(){return when(this._groupContentTypes()).then(function(_199b){var _199c=_199b.grouped;for(var key in _199c){this._sortContentTypes(_199c[key]);}return _199b;}.bind(this));},clear:function(){for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getAvailableContentTypes:function(type){return this.contentTypeService.getAcceptedChildTypes(this.parentLink,this.localAsset,[type],this.allowedTypes,this.restrictedTypes);},_getSuggestedContentTypes:function(type){var _199d=this.store.query({query:"getsuggestedcontenttypes",localAsset:this.localAsset,parentReference:this.parentLink,requestedTypes:[type]});return this.contentTypeService.filterQueryResult(_199d,this.allowedTypes,this.restrictedTypes);},_groupContentTypes:function(){var _199e={},_199f=new _1997(),_19a0=this.otherTypesTitle;when(this._getAvailableContentTypes(this.requestedType)).then(function(_19a1){var count=_19a1.length;array.forEach(_19a1,function(item){when(item,function(type){var _19a2=type.groupName||_19a0,group=_199e[_19a2]||[];group.push(type);_199e[_19a2]=group;count--;if(count===0){_199f.resolve({grouped:_199e,contentTypes:_19a1});}});});}.bind(this));return _199f;},_sortContentTypes:function(types){if(types&&types.length>1){types.sort(function(a,b){return a.localizedName<=b.localizedName?-1:1;});}}});});},"epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(array,_19a3,lang,when,_19a4,_19a5){return _19a3([_19a4],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(value){this._set("metadata",value);setTimeout(lang.hitch(this,function(){this._setupForm();}),0);},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _19a5({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_19a6,_19a7){this.own(_19a7.watch("state",lang.hitch(this,function(name,_19a8,value){if(_19a8==="Error"&&value!=="Error"){this.onPropertyValidStateChange(_19a6);}else{if(_19a8!=="Error"&&value==="Error"){this.onPropertyValidStateChange(_19a6,_19a7.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.domNode.scrollTop=0;this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_19a9,_19aa){},_getValueAttr:function(){return this._form.get("value");}});});},"url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\r\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\r\n            <div data-dojo-attach-point=\"headingPanel\">\r\n                <h1><span data-dojo-attach-point=\"headingTextNode\"></span>:&nbsp;<span data-dojo-attach-point=\"contentTypeNameNode\"></span></h1>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\r\n            <div data-dojo-attach-point=\"namePanel\">\r\n                <label>${sharedResources.header.name}</label>\r\n                <input data-dojo-attach-point=\"nameTextBox\"\r\n                       data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                       data-dojo-props=\"selectOnClick: true, required: true, trim:true\"\r\n                       data-dojo-attach-event=\"onChange: _onContentNameChange, onBlur: _onBlurVerifyContent\"\r\n                       maxlength=\"255\" />\r\n                <span data-dojo-attach-point=\"contentNameHelpTextNode\" class=\"dijitInline dgrid-no-data\"></span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\" data-dojo-attach-event=\"onContentTypeSelected: _onContentTypeSelected\">\r\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\r\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\r\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_19ab,lang,_19ac,_19ad){return _19ab([_19ac],{modelType:_19ad,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createpage.translate"],function(_19ae,lang,when,_19af,_19b0,res){return _19ae([_19b0],{languageBranch:null,masterLanguageVersionId:null,contentNameHelpText:res.namehelptext,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);this._languageStore=this._languageStore||_19af.resolve("epi.storeregistry").get("epi.cms.language");},update:function(_19b1){var _19b2=_19b1.contentData;var _19b3=_19b1.languageBranch;this.set("contentNameHelpText",_19b2.publicUrl?res.namehelptext:"");var self=this;return when(this.contentDataStore.get(_19b2.parentLink)).then(function(_19b4){var _19b5=_19b0.prototype.update.apply(self,[{requestedType:_19b2.typeIdentifier,parent:_19b4,contentTypeId:_19b2.contentTypeID}]);self.set("languageBranch",_19b3);self.set("masterLanguageVersionId",_19b2.contentLink);self.set("contentName",_19b2.name);return _19b5;}).then(function(_19b6){return when(self._languageStore.get(self.languageBranch)).then(function(_19b7){self.set("headingText",lang.replace(res.namelabel,[_19b7.name]));return _19b6;});});},_hasRequiredProperties:function(){return true;},_isRequired:function(_19b8){return this.inherited(arguments)&&(!this.languageBranch||_19b8.settings.isLanguageSpecific===true);},buildContentObject:function(){var _19b9=this.inherited(arguments);lang.mixin(_19b9,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _19b9;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_19ba,_19bb,lang,_19bc,_19bd,_19be,_19bf,_19c0,_19c1,_19c2,_19c3){return _19bb([_19bf,_19c0,_19c1,_19c2],{templateString:_19be,value:null,resources:_19c3,postCreate:function(){this.inherited(arguments);this.own(this.dateTimeSelector.watch("value",lang.hitch(this,function(value,_19c4,_19c5){this._set("value",_19c5);this.onChange(_19c5);})));},onChange:function(_19c6){this.validate();},validate:function(){var _19c7=this.inherited(arguments);if(_19c7){var value=this.get("value");_19c7=this.disabled||!value||!this.minimumValue||value>this.minimumValue;this._set("state",_19c7?"":"Error");if(_19c7){this.hideMessage();}else{this.displayMessage(this.minimumValueMessage);}}return _19c7;},_setValueAttr:function(value){this.dateTimeSelector.set("value",value);this._set("value",value);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.dateTimeSelector.set("readOnly",value);_19bc.set(this.expireNowNode,"display",value?"none":"");}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div>\r\n    <a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-point=\"expireNowNode\"\r\n       data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\r\n</div>\r\n","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_19c8,_19c9){return dojo.declare([_19c8],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _19ca=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_19ca["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_19ca);}var ew=this.editorWidget;var _19cb=new _19c9({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth",destroyOnHide:false});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_19cb,"onHide",this._onHide);this.connect(_19cb,"onCancel",this._onCancel);this._dialog=_19cb;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode===dojo.keys.ENTER&&e.target.tagName==="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(title){if(this._dialog){this._dialog.set("title",title);}this._set("title",title);}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojox/html/entities","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_19cc,lang,_19cd,on,_19ce,_19cf,_19d0,_19d1,_19d2,_19d3){return _19cc([_19d1,_19d0,_19d3],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _19d4;while((_19d4=this._checkboxes.pop())){_19d4.destroyRecursive();}var _19d5;while((_19d5=this._labelClickHandles.pop())){_19d5.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_19cf.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _19d6=[];var _19d7=this.valueIsInclusive;array.forEach(this._checkboxes,function(_19d8){if(_19d7===_19d8.checked){_19d6.push(_19d8.value);}});this._set("value",this.valueIsCsv?_19d6.join(","):_19d6);},_setValueAttr:function(value){this._set("value",value);var _19d9=[];if(value){_19d9=this.valueIsCsv?value.split(","):value;}var _19da=this.valueIsInclusive;var _19db=this._compareCheckboxValue;array.forEach(this._checkboxes,function(_19dc){_19dc.set("checked",_19da===array.some(_19d9,function(v){return _19db(_19dc,v);}));});},_compareCheckboxValue:function(_19dd,value){var _19de=_19dd.value;if(_19de===undefined||_19de===null){return false;}return _19de.toString()===value.toString();},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _19df=_19cd.create("div",{"class":"epi-checkboxContainer"},this.domNode);var _19e0=new _19d2({value:item.value});_19e0.placeAt(_19df);this.own(on(_19e0,"change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);})));_19e0.set("readOnly",!!this.readOnly);this._checkboxes.push(_19e0);var label=_19cd.create("label",{"for":_19e0.id},_19df);label.textContent=item.text;this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_19cf.focus(_19e0.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_19e1,lang,_19e2,_19e3,_19e4,json,on,_19e5,when,_19e6,_19e7,_19e8,_19e9,_19ea,_19eb,_19ec,put,_19ed,_19ee,_19ef,_19f0,_19f1,_19f2,_19f3,_19f4,DnD,_19f5,_19f6,_19f7,_19f8,_19f9,_19fa){return _19e1([_19e7,_19e6,_19ee,_19f8],{templateString:_19f9,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_19f2,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_19e1([_19e9,_19ed,_19ea,_19e8,DnD,_19eb,_19ec,_19f6]),gridAssemblerType:_19f7,gridSettings:null,itemModelType:null,itemEditorType:_19ef,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_19fa.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.dialogParams=lang.mixin(this.dialogParams,{"class":this.baseClass+"--dialog"});this.itemModelType=this.itemModelType||_19f3;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(this.model);this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var node=_19e3.create("div");return {node:node,type:this.allowedDndTypes,data:item};},_setupGrid:function(){var _19fb=this._getGridDefinition();var _19fc=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_19fb,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_19fd){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_19fd);})});this.own(this.grid=_19fc.build(this.gridNode,this.commandTargetNode));_19e4.add(this.gridNode,"epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_19e2.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_19fe,_19ff,nodes,copy){var i;if(this.grid.dndSource===_19ff){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_19fe.length;i++){this._addItem(_19fe[i]);if(_19ff&&_19ff.grid&&_19ff.grid.consumer&&_19ff.grid.consumer!==this){_19ff.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_1a00){this.model.addItem(_1a00,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _1a01=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_1a01);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){if(this.readOnly){return;}var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onCancelDialog:function(){this.inherited(arguments);this._onBlur();},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);}},_renderNoDataMessage:function(){if(this.grid.noDataNode){return;}this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;}});});},"dgrid/extensions/ColumnReorder":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_1a02,_1a03,on,query,_1a04,put){var _1a05=/(\d+)(?:-(\d+))?$/;function _1a06(grid,match){var _1a07=match[2],_1a08=grid[_1a07?"columnSets":"subRows"][match[1]];return _1a07?_1a08[match[2]]:_1a08;};function _1a09(grid,match,_1a0a){if(match[2]){grid.columnSets[match[1]][match[2]]=_1a0a;}else{grid.subRows[match[1]]=_1a0a;}};function _1a0b(_1a0c){return "dgrid-"+_1a0c+"-";};function _1a0d(_1a0e,_1a0f){return _1a0f.slice(_1a0b(_1a0e).length);};var _1a10=_1a02(_1a04,{copyState:function(){return false;},checkAcceptance:function(_1a11,nodes){return _1a11==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_1a05.exec(_1a0d(grid.id,nodes[0].getAttribute("dndType"))),_1a12=match[2]?"columnSets":"subRows",_1a13=_1a06(grid,match),_1a14=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _1a15=_1a03.map(nodes[0].parentNode.childNodes,function(col){return _1a14[col.columnId];}),_1a16;_1a09(grid,match,_1a15);_1a16={grid:grid,subRow:_1a15,column:_1a14[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_1a16[_1a12]=grid[_1a12];if(on.emit(grid.domNode,"dgrid-columnreorder",_1a16)){grid.set(_1a12,grid[_1a12]);}else{_1a09(grid,match,_1a13);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _1a17=_1a02(null,{columnDndConstructor:_1a10,_initSubRowDnd:function(_1a18,_1a19){var _1a1a,c,len,col,th;for(c=0,len=_1a18.length;c<len;c++){col=_1a18[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_1a19+"]");if(!_1a1a){_1a1a=th.parentNode;}}if(_1a1a){this._columnDndSources.push(new this.columnDndConstructor(_1a1a,{horizontal:true,grid:this}));}},renderHeader:function(){var _1a1b=_1a0b(this.id),_1a1c,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_1a1c=this.columnSets.length;cs<_1a1c;cs++){_1a03.forEach(this.columnSets[cs],function(_1a1d,sr){this._initSubRowDnd(_1a1d,_1a1b+cs+"-"+sr);},this);}}else{_1a03.forEach(this.subRows,function(_1a1e,sr){this._initSubRowDnd(_1a1e,_1a1b+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_1a03.forEach(this._columnDndSources,function(_1a1f){_1a1f.destroy();});}this.inherited(arguments);}});_1a17.ColumnDndSource=_1a10;return _1a17;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_1a20,lang,_1a21,_1a22,_1a23,_1a24,when,all,_1a25,_1a26,_1a27,_1a28,_1a29,_1a2a,_1a2b,_1a2c){var _1a2d={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _1a2e=_1a20([_1a24,_1a23,_1a25],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_1a27.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_1a2a;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_1a2f){this.set("itemMetadata",_1a2f);return this._initData();}));},_initData:function(){this._itemModels=new _1a26([]);this.own(_1a21.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true)));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _1a30=array.map(this.data,function(item){var _1a31=new this.itemModelType();return when(_1a31.fromItemData(item,this.itemType),function(){return _1a31;});},this);return when(all(_1a30),lang.hitch(this,function(_1a32){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_1a32));}));},getListCommands:function(_1a33){return [new _1a29({name:"add",tooltip:_1a2c.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_1a2d.add,_1a33),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_1a34,_1a35){return [new _1a29({name:"edit",category:_1a35,label:_1a2c.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_1a2d.edit,_1a34),delegate:lang.hitch(this,this.editItemDelegate)}),new _1a29({name:"moveUp",category:_1a35,label:_1a2c.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_1a2d.moveUp,_1a34),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _1a29({name:"moveDown",category:_1a35,label:_1a2c.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_1a2d.moveDown,_1a34),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _1a29({name:"remove",category:_1a35,label:_1a2c.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_1a2d.remove,_1a34),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_1a36,_1a37){_1a37=_1a37||this.availableCommands;return !!(_1a36&_1a37);},generateColumnsDefinition:function(_1a38){var _1a39={};array.forEach(array.filter(this.itemMetadata.properties,function(_1a3a){return array.every(_1a38,function(col){return col!==_1a3a.name;});}),function(_1a3b){var _1a3c=_1a28.pascalToCamel(_1a3b.name);_1a39[_1a3c]={label:_1a3b.displayName||_1a3b.name};});return _1a39;},generateFormatters:function(_1a3d){for(var _1a3e in _1a3d){array.some(this.itemMetadata.properties,function(_1a3f){if(_1a3e===_1a28.pascalToCamel(_1a3f.name)){this._setTypeFormatter(_1a3f,_1a3d[_1a3e]);this._setSelectionFactoryFormatter(_1a3f,_1a3d[_1a3e]);this._setWrappingFormatter(_1a3d[_1a3e]);return true;}},this);}return _1a3d;},_typeFormatterMap:{"System.DateTime":_1a2b.localizedDate,"System.Boolean":_1a2b.friendlyBoolean},_wrappingFormatterMap:{SecondaryText:function(_1a40){if(_1a40){return function(value){return _1a2b.secondaryText(_1a40(value),true);};}return function(value){return _1a2b.secondaryText(value);};},VisibleLink:function(_1a41){if(_1a41){return function(value){return _1a2b.visibleLink(_1a41(value),true);};}return function(value){return _1a2b.visibleLink(value);};}},_setTypeFormatter:function(_1a42,_1a43){for(var _1a44 in this._typeFormatterMap){if(_1a42.modelType.indexOf(_1a44)>-1){_1a43.formatter=this._typeFormatterMap[_1a44];break;}}},_setSelectionFactoryFormatter:function(_1a45,_1a46){if(_1a45.selections&&_1a45.selections.length>0){var _1a47=_1a45.selections;if(_1a46){_1a46.formatter=function(value){var _1a48=value;_1a47.forEach(function(_1a49){if(_1a49.value===value){_1a48=_1a49.text;}});return _1a48;};}}},_setWrappingFormatter:function(_1a4a){if(_1a4a.wrappingFormatter&&this._wrappingFormatterMap[_1a4a.wrappingFormatter]){_1a4a.formatter=this._wrappingFormatterMap[_1a4a.wrappingFormatter](_1a4a.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_1a2d.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1a4b=index-1;if(_1a4b>=0){this.moveItem(item,this._itemModels[_1a4b],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1a4c=index+1;if(_1a4c<this._itemModels.length){this.moveItem(item,this._itemModels[_1a4c],false);}},saveItem:function(item,index){var _1a4d=new this.itemModelType();return when(_1a4d.fromItemData(item,this.itemType),lang.hitch(this,function(){this._itemModels.splice(index,1,_1a4d);}));},addItem:function(item,_1a4e,_1a4f){var _1a50=new this.itemModelType();return when(_1a50.fromItemData(item,this.itemType),lang.hitch(this,function(){var _1a51;if(!_1a4e){_1a51=this._itemModels.length;}else{_1a51=this._itemModels.indexOf(_1a4e);if(!_1a4f){_1a51++;}}this._itemModels.splice(_1a51,0,_1a50);}));},moveItem:function(item,_1a52,_1a53){this._itemsUnchanged=true;var _1a54=this._itemModels.indexOf(item);this._itemModels.splice(_1a54,1);var _1a55=this._itemModels.indexOf(_1a52);var _1a56=_1a53?_1a55:_1a55+1;_1a56=_1a55===-1?_1a54:_1a56;this._itemModels.splice(_1a56,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_1a57){return _1a57.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_1a2e.commandMask=_1a2d;return _1a2e;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_1a58){function _1a59(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _1a5a=function(a){var array=lang._toArray(a||[]);var ctor=_1a5a;ctor._meta={bases:[_1a58]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _1a59([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _1a59([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_1a5b=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_1a5b,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_1a5b.length+adds.length);}return _1a5b;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _1a5a([].concat.apply(this,arguments));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _1a5a(slice);},watchElements:function(_1a5c){var _1a5d=this._watchElementCallbacks,_1a5e=this;if(!_1a5d){_1a5d=this._watchElementCallbacks=function(idx,_1a5f,adds){for(var list=[].concat(_1a5d.list),i=0;i<list.length;i++){list[i].call(_1a5e,idx,_1a5f,adds);}};_1a5d.list=[];}_1a5d.list.push(_1a5c);var h={};h.unwatch=h.remove=function(){for(var list=_1a5d.list,i=0;i<list.length;i++){if(list[i]==_1a5c){list.splice(i,1);break;}}};return h;}},_1a58.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _1a60=this.length;_1a58.prototype.set.call(this,name,value);if(_1a60!=this.length){_1a58.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_1a5a);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_1a61,_1a62){return _1a61([_1a62],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(array,_1a63,lang,_1a64){return _1a63([_1a64],{_itemDataPropertyNames:null,_nameGetter:function(){return this.name||this.text||"*";},fromItemData:function(_1a65,_1a66){lang.mixin(this,_1a65);this._itemDataPropertyNames=[];for(var _1a67 in _1a65){if(_1a65.hasOwnProperty(_1a67)){this._itemDataPropertyNames.push(_1a67);}}this.typeIdentifier=_1a66&&_1a66.toLowerCase();},toItemData:function(){var _1a68={};array.forEach(this._itemDataPropertyNames,function(_1a69){_1a68[_1a69]=this.get(_1a69);},this);return _1a68;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_1a6a,lang,json,_1a6b,epi,_1a6c,_1a6d,_1a6e){var _1a6f=_1a6a([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_1a70){lang.mixin(this,_1a70);},build:function(_1a71,_1a72){},instantiateGrid:function(_1a73,_1a74,_1a75,node){return new _1a73(lang.mixin(_1a74,{columns:_1a75,className:"epi-plain-grid epi-grid-height--auto"}),node);}});return _1a6a([_1a6f],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_1a76,_1a77){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_1a78){var _1a79=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _1a6b({commands:_1a79});this.renderActionMenu(item,node,_1a79);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_1a76);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_1a77);return grid;},renderActionMenu:function(item,node,_1a7a){node.innerHTML=_1a7a&&_1a7a.length>0?_1a6e.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _1a7b=this.itemCommandsFactory(item,"context");array.some(_1a7b,function(_1a7c){if(_1a7c.name==="remove"&&this.gridSettings.useDeleteWithConfirmation){_1a7c=_1a6d(_1a7c,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _1a7b;},_setupCommands:function(_1a7d,_1a7e){var _1a7f=this.getListCommandBuilder();array.forEach(_1a7d,function(_1a80){_1a7f.create(_1a80,_1a7e);},this);},getListCommandBuilder:function(){return new _1a6c({settings:{showLabel:true},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_1a81,lang,on,_1a82,_1a83,_1a84,_1a85,_1a86){return _1a81([_1a82,_1a84],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){this.onFocus();this._setupItemEditor();this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this._itemEditor=this._createItemEditor();this.own(this._dialog=new _1a83(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor},this.dialogParams)));this._dialog.own(this._itemEditor,this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),on(this._dialog,"execute",lang.hitch(this,this._onDialogExecute)),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_1a87){this._dialog.set("title",this._getDialogTitleText(_1a87));},_getDialogTitleText:function(_1a88){return _1a85.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},_onDialogExecute:function(){if(this.validate()){this.onExecuteDialog();}},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_1a89){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_1a89));},_getDialogConfirmActionText:function(_1a8a){return _1a8a?_1a86.action.ok:_1a86.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_1a8b,lang,_1a8c,dom,_1a8d,popup){return _1a8b([_1a8d],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){if(!this._started){this.own(_1a8c.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true),_1a8c.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true));}this.inherited(arguments);},_onPopupOpen:function(_1a8e){var popup=_1a8e.popup;if(popup&&popup.popupParent){return;}var _1a8f=popup&&popup.currentTarget;if(_1a8f&&dom.isDescendant(_1a8f,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._destroyed){return;}if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\">\r\n    <div class=\"command-area\"><div data-dojo-attach-point=\"commandTargetNode\"></div></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1a90,lang,_1a91,_1a92,_1a93,on,topic,when,_1a94,_1a95,_1a96,_1a97,_1a98,_1a99,_1a9a,_1a9b,_1a9c,_1a9d,_1a9e,_1a9f,_1aa0,_1aa1,_1aa2,_1aa3,_1aa4,_1aa5,_1aa6,_1aa7,_1aa8,_1aa9,_1aaa,_1aab,_1aac,_1aad){return _1a90([_1a95,_1a96,_1a98,_1a97,_1aa1,_1a9e,_1a9a,_1aa4,_1a9d],{baseClass:"epi-content-area-editor",res:_1aad,templateString:_1aac,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_preventOnBlur:false,_dndTarget:null,allowedTypes:null,restrictedTypes:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.tree&&this.model.get("value").length>0){this._focusManager.focus(this.tree.domNode);}else{if(this.textWithLinks){this.textWithLinks.focus();}}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _1aa6(),new _1aab(),new _1aaa({category:null}),new _1aa9(),new _1aa7(),new _1aa8(),new _1aa5()];this.commands.forEach(function(_1aae){this.own(_1aae);},this);this.own(this.model=this.model||new _1a9f(),this.treeModel=this.treeModel||new _1a9c({model:this.model}),this.model.watch("selectedItem",lang.hitch(this,function(name,_1aaf,_1ab0){this.updateCommandModel(_1ab0);})),on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));this.allowedDndTypes.push("personalizationarea");},buildRendering:function(){this.inherited(arguments);this.contextMenu=new _1aa0();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.own(this._dndTarget=new _1a99(this.actionsContainer,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,isSource:false,alwaysCopy:false,allowMultipleItems:true,insertNodes:function(){}}));this.own(_1a91.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1ab1,_1ab2,nodes,copy){_1ab1.forEach(function(_1ab3){this.model.modify(lang.hitch(this,function(){this.model.addChild(_1ab3.data);}));},this);if(!this.tree){this._createTree();}}),true));this.own(_1a91.after(this._dndTarget,"onDrop",lang.hitch(this,"focus")));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_1aad.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.tree&&this.tree.startup();this.contextMenu.startup();},destroy:function(){this.tree&&this.tree.destroyRecursive();this.inherited(arguments);},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},executeAction:function(_1ab4){if(_1ab4==="createnewblock"){this._preventOnBlur=true;this.validate(false);var _1ab5=new _1aa3({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_1ab5.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.parent.set("editing",true);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;this.onBlur();})});_1ab5.execute();}},isValid:function(_1ab6){return (this._preventOnBlur||!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_1ab7){this._set("readOnly",_1ab7);_1a93.set(this.actionsContainer,"display",_1ab7?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_1ab7);}this.tree&&this.tree.set("readOnly",_1ab7);},_checkAcceptance:function(_1ab8,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_1ab8,nodes);},_createTree:function(){this.tree=new _1a9b({accept:this.allowedDndTypes,reject:this.restrictedDndTypes,contextMenu:this.contextMenu,model:this.treeModel,readOnly:this.readOnly}).placeAt(this.domNode,"first");this.tree.own(_1a91.after(this.tree.dndController,"onDndEnd",lang.hitch(this,"focus")));},_selectFromOverlay:function(_1ab9){var child=_1ab9&&_1ab9.selectedItem&&_1ab9.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_1ab9.selectedItem.ensurePersonalization);this.tree&&this.tree.set("path",path);},_startDrag:function(_1aba,nodes,copy){var _1abb=this._dndTarget.accept&&this._dndTarget.checkAcceptance(_1aba,nodes);_1a92.toggle(this.domNode,"dojoDndTargetDisabled",!_1abb);var _1abc=_1a94.getEnclosingWidget(nodes[0]);if(_1abc&&_1abc.isInstanceOf(_1aa2)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}},_setValueAttr:function(value){this.tree&&this.tree.destroyRecursive();this._set("value",value||[]);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;this._createTree();}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_1abd,_1abe,event,array,lang,_1abf,_1ac0,_1ac1,_1ac2,_1ac3,_1ac4,Tree,_1ac5,_1ac6,_1ac7,_1ac8){return _1abd([Tree],{persist:false,showRoot:false,dndController:_1ac3,betweenThreshold:8,_typeDescriptorManager:null,postMixInProperties:function(){this.inherited(arguments);this._typeDescriptorManager=this._typeDescriptorManager||_1ac4;this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_1abf.add(this.domNode,"epi-tree-mngr");this.own(_1abe.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_1ac9){if(_1ac9[0]&&_1ac9[0].data){this.model.deleteItem(_1ac9[0].data);}}),true));this.own(_1abe.after(this,"_onItemChildrenChange",lang.hitch(this,function(_1aca,_1acb){array.forEach(_1acb,function(child){var _1acc=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_1acc[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_1acc[0].showPersonalizationSelector();}},this);}),true));},getTooltip:function(item){return item.tooltip||item.label||"";},_setReadOnlyAttr:function(_1acd){this._set("readOnly",_1acd);if(this.dndController){this.dndController.isSource=!_1acd;}},getItemType:function(item){if(item.typeIdentifier){var _1ace=this._typeDescriptorManager.getAndConcatenateValues(item.typeIdentifier,"dndTypes");return _1ace;}else{if(item.contentGroup!==undefined){return ["personalizationarea"];}}return this.accept;},checkItemAcceptance:function(_1acf,_1ad0,_1ad1,copy){if(this.tree.readOnly){return false;}var _1ad2=_1ac0.getEnclosingWidget(_1acf);var _1ad3=_1ad2.item;var _1ad4=true;_1ad0.forInSelectedItems(function(item){_1ad4=this.tree.model.checkItemAcceptance(_1ad3,item.data.item,_1ad1);},this);return _1ad4;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _1ac6){node=new _1ac8(model);}else{if(model.item instanceof _1ac5){node=new _1ac7(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _1ac8){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1ad5,lang,when,all,_1ad6,epi,_1ad7,_1ad8,_1ad9,_1ada,_1adb,_1adc){return _1ad5([_1ad9,_1ad8],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},roles:null,contentGroup:null,name:null,contentTypeName:null,roleIdentities:null,typeIdentifier:null,attributes:null,constructor:function(){this.roleIdentities=this.roleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _1add=_1ad7.resolve("epi.storeregistry");this.store=_1add.get("epi.cms.visitorgroup");}this.contentTypeName=this.contentTypeName||(this.typeIdentifier&&_1adb.getResourceValue(this.typeIdentifier,"name"));this.set("label",this.name);this.set("tooltip",_1ada.title(this.name,this.contentLink,this.contentTypeName));this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_1ade){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_1ade)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_1adf,_1ae0){var _1ae1=(this.roles||[]).map(function(role){return role.id;});var index=_1ae1.indexOf(_1adf);if(index>=0){if(!_1ae0){_1ae1.splice(index,1);}}else{if(_1ae0){_1ae1.push(_1adf);}}this.set("roleIdentities",_1ae1);},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1ae2){this.attributes[this.settings.displayOptionsAttributeName]=_1ae2;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1ae3){this.roleIdentities=_1ae3||[];this._reloadRoles();},_parentSetter:function(_1ae4){this.parent=_1ae4;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_1ae5){this.contentGroup=_1ae5||"";this.attributes[this.settings.contentGroupAttributeName]=this.contentGroup;this._reloadRoles();},_reloadRoles:function(){var store=this.store;if(!store){return;}var _1ae6=all(this.roleIdentities.map(function(id){return when(store.get(id)).otherwise(function(){console.warn("Could not load visitor group with id: "+id);});}));_1ae6.then(lang.hitch(this,"set","roles"));return _1ae6;},_hasSiblingsSetter:function(_1ae7){this.hasSiblings=_1ae7;this._updateRolesString();},_selectedSetter:function(_1ae8){this.selected=_1ae8;if(_1ae8){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===null){this.set("rolesString","");return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_1adc.everyoneelsesee);}else{this.set("rolesString",_1adc.everyonesees);}return;}if(!this.roles.length){this.set("rolesString",_1adc.groupcannotsees);return;}var _1ae9=this.roles.map(function(r){return "<em>"+_1ad6.encode(r.name)+"</em>";}).sort().join(", ");var names=_1ae9.replace(/, (?=[^,]+$)/," "+_1adc.groupsand);var _1aea="";if(this.roles.length>1){_1aea=lang.replace(_1adc.groupssee,{groupNames:names});}else{_1aea=lang.replace(_1adc.groupsees,{groupName:names});}this.set("rolesString",_1aea);},_rolesSetter:function(roles){this.roles=roles.filter(function(role){return !!role;});this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_1aeb,_1aec,_1aed,_1aee){return _1aeb([_1aec,_1aed,_1aee],{modify:function(_1aef,scope,_1af0){this._isBeingModified=true;if(scope){_1aef.apply(scope);}else{_1aef();}this._isBeingModified=false;if(_1af0||_1af0===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_1af1,lang,_1af2,_1af3){return _1af1([_1af2],{name:null,label:_1af3.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this.ownByKey(child.id,child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed")));},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_1af4){this.selected=_1af4;if(_1af4){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","epi/shell/DestroyableByKey","./_ViewModelMixin"],function(array,_1af5,_1af6,_1af7){return _1af5([_1af7,_1af6],{constructor:function(){this._data=[];},destroy:function(){this.inherited(arguments);this._data.forEach(function(item){if(item.destroy){item.destroy();}});},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);child.id=this._hash(child);if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _1af8=this._data;for(var i=_1af8.length-1;i>=0;i--){if(_1af8[i].equals(item)){return _1af8[i];}}return null;},getChildById:function(id){var _1af9=this._data;for(var i=_1af9.length-1;i>=0;i--){if(_1af9[i].id===id){return _1af9[i];}}return null;},getChildByIndex:function(index){return this._data[index];},getChildren:function(){return this._data;},removeChild:function(child,_1afa){var index=this.indexOf(child);if(index<0){if(_1afa){this.getChildren().slice().forEach(function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_1afa);}});}return;}child=this.getChildByIndex(index);this.destroyByKey(child.id);child.destroy();this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _1afb=this.indexOf(child);this._data.splice(_1afb,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){var _1afc=this._data.indexOf(child);if(_1afc>=0||!child||typeof child.id==="undefined"){return _1afc;}for(var i=0;i<this._data.length;i++){if(this._data[i].id===child.id){return i;}}return -1;},_hash:function(child){},_readOnlySetter:function(_1afd){this.readOnly=_1afd;array.forEach(this.getChildren(),function(child){child.set("readOnly",_1afd);},this);},_emitChildrenChanged:function(_1afe){var _1aff=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_1aff-1));child.set("canMovePrevious",index>0&&index<=(_1aff-1));child.set("hasSiblings",_1aff>1);});this.set("count",_1aff||0);this.emit("childrenChanged",_1afe?_1afe:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_1b00,lang,keys,_1b01,Tree,_1b02,_1b03,_1b04,_1b05,_1b06,_1b07,_1b08,_1b09){return _1b00([Tree._TreeNode,_1b06,_1b03],{templateString:_1b09,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_1b07,_1b08),buildRendering:function(){this.inherited(arguments);this.dropDown=new _1b04({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_1b01.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var _1b0a=_1b05.contentIconClass(this.item.typeIdentifier);_1b01.add(this.iconNode,_1b0a);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_1b0b,_1b0c,_1b0d){node.innerHTML=_1b0d;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_1b0e,_1b0f){this.inherited(arguments);this.item.set("selected",_1b0e);_1b01.toggle(this.iconNodeMenu,this._contextMenuClass,_1b0e);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1b02.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode===keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_1b10,lang,_1b11,when,_1b12,_1b13,_1b14,_1b15,_1b16,_1b17,_1b18,_1b19){return _1b10([_1b13,_1b14,_1b15],{templateString:_1b18,model:null,resources:_1b19,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1b1a=_1b17.resolve("epi.storeregistry");this.store=_1b1a.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(!this.rdEveryone.checked&&this.model.roleIdentities&&this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_1b1b){if(!this._destroyed){this.set("visitorGroups",_1b1b);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);this.model.modify(function(){this.model.resetRoleIdentities();},this);},_setVisitorGroupsAttr:function(_1b1c){this._set("visitorGroups",_1b1c);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_1b1c,function(group){var item=new _1b16({label:_1b12.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_1b1d,_1b1e,_1b1f){this.model.modify(function(){this.model.selectRole(group.id,_1b1f);},this);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div class=\"epi-menu--inverted\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\r\n            <div class=\"epi-menuSeparator\" tabindex=\"-1\"></div>\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\r\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_1b20,array,_1b21,_1b22,_1b23){return _1b20([_1b22],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_1b23,_onClick:function(e){if(!this.checked){this._resetState();this.inherited(arguments);}},_resetState:function(){array.forEach(this._getChildren(),function(child,index){child.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_1b24){this._set("iconClass",_1b24);_1b21.add(this.labelIconNode,_1b24);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_1b25,lang,on,_1b26,event,_1b27){return _1b25([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_1b28){this._unBindContextMenu();this._set("contextMenu",_1b28);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_1b27.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\r\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\r\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\r\n                </span>\r\n                <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1b29,array,_1b2a,lang,_1b2b,_1b2c,Tree,_1b2d,_1b2e,_1b2f){return _1b2a([Tree._TreeNode,_1b2d],{templateString:_1b2e,_contextMenuClass:"epi-iconContextMenu",resources:_1b2f,buildRendering:function(){this.inherited(arguments);_1b2b.remove(this.iconNode,"dijitFolderClosed");this.own(_1b29.after(this,"expand",lang.hitch(this,function(_1b30){_1b30.then(lang.hitch(this,function(){if(this._destroyed){return;}_1b2b.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_1b31){var child=_1b31.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_1b31.showPersonalizationSelector();}},this);}));return _1b30;})));this.own(_1b29.after(this,"collapse",lang.hitch(this,function(_1b32){_1b32.then(lang.hitch(this,function(){_1b2b.remove(this.domNode,"epi-treeNodeOpen");}));return _1b32;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_1b33,_1b34,_1b35){this.set("count",_1b35);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_1b36){this.inherited(arguments);this.item.set("selected",_1b36);_1b2b.remove(this.rowNode,"dijitTreeRowSelected");_1b2b.toggle(this.domNode,"dijitTreeRowSelected",_1b36);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_1b2c.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\r\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\r\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <hr />\r\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_1b37,lang,_1b38,_1b39,_1b3a){return _1b37([_1b38],{model:null,root:{id:"root",name:"root"},constructor:function(_1b3b){_1b37.safeMixin(this,_1b3b);},pasteItem:function(_1b3c,_1b3d,_1b3e,bCopy,_1b3f,_1b40){var _1b41=_1b3d.id==="root"?this.model:this.model.getChildById(_1b3d.id);var child=_1b41.getChildById(_1b3c.id);var _1b42=_1b3e.id==="root"?this.model:this.model.getChildById(_1b3e.id);if(child instanceof _1b39&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_1b41===_1b42){this.model.modify(function(){_1b42.move(child,_1b3f);});return;}this.model.modify(function(){_1b41.removeChild(child);_1b42.addChild(child,_1b3f);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_1b43,_1b44,_1b45){if(args.dndData&&args.dndData.data){var _1b46=_1b43.id==="root"?this.model:this.model.getChildById(_1b43.id);var item=args.dndData.data;if(!(item instanceof _1b39)&&!(item instanceof _1b3a)){item=new _1b39(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_1b46.addChild(item,_1b44);});}},checkItemAcceptance:function(_1b47,item,_1b48){if(_1b48==="over"){if(!(_1b47 instanceof _1b3a)){return false;}if(!(item instanceof _1b39)){return false;}}if(_1b47 instanceof _1b39&&item instanceof _1b3a&&_1b47.contentGroup){return false;}return true;},getRoot:function(_1b49){_1b49(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_1b4a,_1b4b){var _1b4c;if(_1b4a.id==="root"){_1b4c=this.model.getChildren();_1b4b(_1b4c);this.model.on("childrenChanged",lang.hitch(this,function(index,_1b4d,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_1b4a.id);if(model&&typeof model.getChildren=="function"){_1b4c=model.getChildren();_1b4b(_1b4c);model.on("childrenChanged",lang.hitch(this,function(index,_1b4e,adds){this.onChildrenChange(_1b4a,model.getChildren());}));}else{_1b4b([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_1b4f){return _1b4f("dijit.tree.model",null,{destroy:function(){},getRoot:function(_1b50){},mayHaveChildren:function(item){},getChildren:function(_1b51,_1b52){},isItem:function(_1b53){},fetchItemByIdentity:function(_1b54){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_1b55,_1b56,_1b57){},pasteItem:function(_1b58,_1b59,_1b5a,bCopy,_1b5b,_1b5c){},onChange:function(item){},onChildrenChange:function(_1b5d,_1b5e){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_1b5f,lang,_1b60,on,when,_1b61,_1b62){return _1b5f(null,{textWithLinks:null,actionsResource:_1b62,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _1b63=new _1b60();var _1b64=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_1b65){var _1b66=_1b65?_1b64.template:_1b64.templatewithoutcreate;_1b63.resolve({templateString:_1b66,actions:_1b64.actions});});return _1b63.promise;},setupActionLinks:function(_1b67){when(this.getTemplateString(),lang.hitch(this,function(_1b68){if(!_1b68){return;}this.textWithLinks=new _1b61({contentString:_1b68.templateString,namedActions:_1b68.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_1b67){this.textWithLinks.placeAt(_1b67);}}));},executeAction:function(_1b69){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_1b6a,event,lang,_1b6b,on,query,_1b6c,_1b6d,_1b6e,_1b6f){return _1b6a([_1b6c,_1b6d,_1b6b],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _1b70={};var _1b71=this.contentString;var _1b72;var id=0;if(this.namedActions){for(var _1b73 in this.namedActions){_1b72=_1b6f.encode(this.namedActions[_1b73]);_1b70[_1b73]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_1b72+"</a>";this._actionMap.push(_1b73);}_1b71=lang.replace(_1b71,_1b70);}this.templateString=lang.replace(this.templateString,[this.tagName,_1b71]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_1b74,id){var link=this["action"+id];if(link){var _1b75=on(link,"click",(function(_1b76,_1b77){return function(evt){event.stop(evt);_1b76.emit("onActionClick",_1b77);};})(this,_1b74));this._eventHandlers.push(_1b75);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_1b78){_1b78.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_1b6e.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojox/uuid/generateRandomUuid","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi-cms/_ContentContextMixin"],function(array,_1b79,lang,all,when,_1b7a,_1b7b,_1b7c,_1b7d,_1b7e,_1b7f,_1b80){return _1b79([_1b7f,_1b80],{selectedItem:null,postscript:function(){this.inherited(arguments);this.contentTypeService=this.contentTypeService||_1b7b.resolve("epi.cms.ContentTypeService");if(!this._contentTypeStore){var _1b81=_1b7b.resolve("epi.storeregistry");this._contentTypeStore=_1b81.get("epi.cms.contenttype");}},addChild:function(child){var _1b82=[];if(!(child instanceof _1b7c)&&!(child instanceof _1b7d)){var model=new _1b7c(child);if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _1b7d){_1b82.push(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);this._emitChanged();}})));}else{if(child instanceof _1b7c){child.resetRoleIdentities();}}}_1b82.push(child.on("changed",this._emitChanged.bind(this)));this.inherited(arguments);_1b82.push(child.on("selected",lang.hitch(this,"set","selectedItem")));_1b82.forEach(function(_1b83){this.ownByKey(child.id,_1b83);},this);},canCreateBlock:function(_1b84,_1b85){var _1b86=this.contentTypeService;return all([this.getCurrentContext(),this.getCurrentContent()]).then(function(_1b87){var _1b88=_1b87[0],_1b89=_1b87[1];if(!_1b88||!_1b89){return false;}var _1b8a=_1b7e.isActionAvailable(_1b89,_1b7e.action.Create,_1b7e.providerCapabilities.Create,true);if(!_1b8a||!_1b88.capabilities.resourceable||_1b88.currentMode==="create"||_1b88.currentMode==="translate"){return false;}return when(_1b86.getAcceptedChildTypes(_1b89.contentLink,true,["episerver.core.blockdata"],_1b84,_1b85)).then(function(_1b8b){return !!_1b8b.length;});});},moveVisible:function(child,_1b8c){var _1b8d=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_1b8c?1:-1,_1b8e=array.indexOf(_1b8d,child)+delta,index=this.indexOf(_1b8d[_1b8e]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _1b7d({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _1b8f=this.getChildren();for(var i=_1b8f.length-1;i>=0;i--){this.removeChild(_1b8f[i]);}this._groups={};array.forEach(value,function(child){var model=new _1b7c(child);if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_emitChanged:function(){this.emit("changed");},_createGroup:function(name){var group=new _1b7d({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+_1b7a();}});});},"dojox/uuid/generateRandomUuid":function(){define("dojox/uuid/generateRandomUuid",["./_base"],function(){dojox.uuid.generateRandomUuid=function(){var _1b90=16;function _1b91(){var _1b92=Math.floor((Math.random()%1)*Math.pow(2,32));var _1b93=_1b92.toString(_1b90);while(_1b93.length<8){_1b93="0"+_1b93;}return _1b93;};var _1b94="-";var _1b95="4";var _1b96="8";var a=_1b91();var b=_1b91();b=b.substring(0,4)+_1b94+_1b95+b.substring(5,8);var c=_1b91();c=_1b96+c.substring(1,4)+_1b94+c.substring(4,8);var d=_1b91();var _1b97=a+_1b94+b+_1b94+c+d;_1b97=_1b97.toLowerCase();return _1b97;};return dojox.uuid.generateRandomUuid;});},"dojox/uuid/_base":function(){define("dojox/uuid/_base",["dojo/_base/kernel","dojo/_base/lang"],function(dojo){dojo.getObject("uuid",true,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(_1b98,_1b99){if(!_1b98){if(!_1b99){_1b99="An assert statement failed.\n"+"The method dojox.uuid.assert() was called with a 'false' value.\n";}throw new Error(_1b99);}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID;};dojox.uuid.isValid=function(_1b9a){_1b9a=_1b9a.toString();var valid=(dojo.isString(_1b9a)&&(_1b9a.length==36)&&(_1b9a==_1b9a.toLowerCase()));if(valid){var _1b9b=_1b9a.split("-");valid=((_1b9b.length==5)&&(_1b9b[0].length==8)&&(_1b9b[1].length==4)&&(_1b9b[2].length==4)&&(_1b9b[3].length==4)&&(_1b9b[4].length==12));var _1b9c=16;for(var i in _1b9b){var part=_1b9b[i];var _1b9d=parseInt(part,_1b9c);valid=valid&&isFinite(_1b9d);}}return valid;};dojox.uuid.getVariant=function(_1b9e){if(!dojox.uuid._ourVariantLookupTable){var _1b9f=dojox.uuid.variant;var _1ba0=[];_1ba0[0]=_1b9f.NCS;_1ba0[1]=_1b9f.NCS;_1ba0[2]=_1b9f.NCS;_1ba0[3]=_1b9f.NCS;_1ba0[4]=_1b9f.NCS;_1ba0[5]=_1b9f.NCS;_1ba0[6]=_1b9f.NCS;_1ba0[7]=_1b9f.NCS;_1ba0[8]=_1b9f.DCE;_1ba0[9]=_1b9f.DCE;_1ba0[10]=_1b9f.DCE;_1ba0[11]=_1b9f.DCE;_1ba0[12]=_1b9f.MICROSOFT;_1ba0[13]=_1b9f.MICROSOFT;_1ba0[14]=_1b9f.UNKNOWN;_1ba0[15]=_1b9f.UNKNOWN;dojox.uuid._ourVariantLookupTable=_1ba0;}_1b9e=_1b9e.toString();var _1ba1=_1b9e.charAt(19);var _1ba2=16;var _1ba3=parseInt(_1ba1,_1ba2);dojox.uuid.assert((_1ba3>=0)&&(_1ba3<=16));return dojox.uuid._ourVariantLookupTable[_1ba3];};dojox.uuid.getVersion=function(_1ba4){var _1ba5="dojox.uuid.getVersion() was not passed a DCE Variant UUID.";dojox.uuid.assert(dojox.uuid.getVariant(_1ba4)==dojox.uuid.variant.DCE,_1ba5);_1ba4=_1ba4.toString();var _1ba6=_1ba4.charAt(14);var _1ba7=16;var _1ba8=parseInt(_1ba6,_1ba7);return _1ba8;};dojox.uuid.getNode=function(_1ba9){var _1baa="dojox.uuid.getNode() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1ba9)==dojox.uuid.version.TIME_BASED,_1baa);_1ba9=_1ba9.toString();var _1bab=_1ba9.split("-");var _1bac=_1bab[4];return _1bac;};dojox.uuid.getTimestamp=function(_1bad,_1bae){var _1baf="dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1bad)==dojox.uuid.version.TIME_BASED,_1baf);_1bad=_1bad.toString();if(!_1bae){_1bae=null;}switch(_1bae){case "string":case String:return dojox.uuid.getTimestamp(_1bad,Date).toUTCString();break;case "hex":var _1bb0=_1bad.split("-");var _1bb1=_1bb0[0];var _1bb2=_1bb0[1];var _1bb3=_1bb0[2];_1bb3=_1bb3.slice(1);var _1bb4=_1bb3+_1bb2+_1bb1;dojox.uuid.assert(_1bb4.length==15);return _1bb4;break;case null:case "date":case Date:var _1bb5=3394248;var _1bb6=16;var _1bb7=_1bad.split("-");var _1bb8=parseInt(_1bb7[0],_1bb6);var _1bb9=parseInt(_1bb7[1],_1bb6);var _1bba=parseInt(_1bb7[2],_1bb6);var _1bbb=_1bba&4095;_1bbb<<=16;_1bbb+=_1bb9;_1bbb*=4294967296;_1bbb+=_1bb8;var _1bbc=_1bbb/10000;var _1bbd=60*60;var _1bbe=_1bb5;var _1bbf=_1bbe*_1bbd;var _1bc0=_1bbf*1000;var _1bc1=_1bbc-_1bc0;var _1bc2=new Date(_1bc1);return _1bc2;break;default:dojox.uuid.assert(false,"dojox.uuid.getTimestamp was not passed a valid returnType: "+_1bae);break;}};return dojox.uuid;});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_1bc3,event,lang,_1bc4,_1bc5,on,when,_1bc6,_1bc7,_1bc8,_1bc9,_1bca,_1bcb,_1bcc,_1bcd){return _1bc3([_1bc6,_1bc7,_1bc8,_1bc9],{templateString:_1bcd,res:_1bcc,_setMissingRendererAttr:function(value){_1bc4.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_1bc5.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.own(this.commandProvider=this.commandProvider||new _1bca({model:this.viewModel}),this.viewModel.watch("statusMessage",lang.hitch(this,function(_1bce,_1bcf,_1bd0){when(_1bcb.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_1bd1){_1bc5.set(this.warningIcon,"display",_1bd1?"":"none");}));_1bc5.set(this.iconsContainer,"display",this.viewModel.contentGroup||_1bd0?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")),on(this.domNode,"mouseout",lang.hitch(this,function(e){if(this.contextMenu&&this.contextMenu.isShowingNow){event.stop(e);}})));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_1bd2=_1bc5.get(node,"display"),_1bd3=/inline|inline-block/.test(_1bd2)?"-inline":"";_1bc4.add(node,"epi-injected-minSize"+_1bd3);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1bd4,lang,_1bd5,on,when,mouse,_1bd6,_1bd7,_1bd8){return _1bd4(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1bd9,_1bda,_1bdb){this.set("statusMessage",_1bdb);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1bdc){var _1bdd=this.get("overlayItemInfo");if(!_1bdd){return;}_1bdd.set("statusIcon",_1bdc);},_setStatusMessageAttr:function(_1bde){var _1bdf=this.get("overlayItemInfo");if(!_1bdf){return;}_1bdf.set("statusMessage",_1bde);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _1bd7();_1bd5.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _1be0,_1be1,_1be2,_1be3;_1be0=this.get("overlayItemInfo");_1be0.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _1be4=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_1be4){_1be1=_1bd6.getValue(_1be4,"useIconOnBlock");_1be2=_1bd6.getValue(_1be4,"iconClass");_1be3=_1bd6.getValue(_1be4,"description");if(_1be1){_1be0.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_1be2);this.set("statusMessage",_1be3);}}},_showStatusMessage:function(_1be5){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_1be5);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_1be6,lang,_1be7,_1be8,_1be9,_1bea,_1beb,_1bec,_1bed,_1bee,_1bef){return _1be6([_1bea,_1beb],{templateString:_1bef,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_1bf0){if(this._tooltip){_1bf0?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_1bf1){var _1bf2=lang.isArray(_1bf1);if(_1bf2){array.forEach(_1bf1,function(_1bf3){_1be7.add(this.highlightArea,_1bf3);},this);}else{_1be7.add(this.highlightArea,_1bf1);}},_setStatusMessageAttr:function(_1bf4){if(!_1bf4){return;}var _1bf5=lang.isArray(_1bf4);if(this._tooltip){if(_1bf5){this._tooltip.tooltipRows=_1bf4;}else{this._tooltip.label=_1bec.encode(_1bf4);}}else{var _1bf6=_1be8.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1bed.toHTML(_1bec.encode(_1bf4))}),_1bf7=_1bf5?{tooltipRows:_1bf4}:{label:_1bf6.outerHTML};this._tooltip=new _1bee(_1bf7);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dijit/Destroyable","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_1bf8,_1bf9,_1bfa,_1bfb,Edit,_1bfc,_1bfd,_1bfe,_1bff){return _1bf8([_1bf9,_1bfa],{commands:null,constructor:function(){this.commands=[new Edit(),new _1bff(),new _1bfe(),new _1bfc(),new _1bfd(),new _1bfb()];this.commands.forEach(function(_1c00){this.own(_1c00);},this);},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_1c01){_1c01.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1c02,epi,_1c03){return _1c02([_1c03],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_1c04,lang,_1c05){return _1c04([_1c05],{_onModelChange:function(){var model=this.model;this._destroyModelHandles();if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},destroy:function(){this._destroyModelHandles();this.inherited(arguments);},_destroyModelHandles:function(){if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];},_watch:function(_1c06,_1c07,scope){if(scope){this._handles.push(this.model.watch(_1c06,lang.hitch(scope,_1c07)));}else{this._handles.push(this.model.watch(_1c06,_1c07));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _1c08=function(item){if(item.parent){return _1c08(item.parent);}return item;};return _1c08(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1c09,lang,topic,when,epi,_1c0a,_1c0b,_1c0c,_1c0d){return _1c09([_1c0b],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_1c0c;var _1c0e=_1c0a.resolve("epi.storeregistry");this._store=_1c0e.get("epi.cms.content.light");},_execute:function(){var _1c0f=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1c0f},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _1c10=item&&this._store.get(item.contentLink);when(_1c10,lang.hitch(this,function(_1c11){this.set("canExecute",_1c11&&!_1c11.isDeleted);if(_1c11&&_1c11.accessMask){if(this.contentActionSupport.hasAccess(_1c11.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_1c0d.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1c0d.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_1c12,_1c13){return _1c12([_1c13],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1c14=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1c14,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1c15,epi,_1c16){return _1c15([_1c16],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_1c17,_1c18){return _1c17([_1c18],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1c19=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1c19,this._getItem());this.set("canExecute",index!==-1&&index<_1c19.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1c1a,epi,_1c1b){return _1c1a([_1c1b],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1c1c,_1c1d,_1c1e,_1c1f){return _1c1c([_1c1e],{label:_1c1f.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_1c20,lang,when,_1c21,_1c22,_1c23,_1c24,_1c25){return _1c20([_1c22],{label:_1c25.label,category:"popup",_labelAutomatic:lang.replace(_1c25.label,[_1c25.automatic]),constructor:function(){this.popup=new _1c24();},postscript:function(){this.inherited(arguments);if(!this.store){var _1c26=_1c21.resolve("epi.storeregistry");this.store=_1c26.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_1c27){this._setCommandAvailable(_1c27);this.popup.set("displayOptions",_1c27);}));},destroy:function(){this.inherited(arguments);this.popup&&this.popup.destroyRecursive();},_onModelChange:function(){this.inherited(arguments);var _1c28=this.popup.displayOptions,_1c29=this.model.get("displayOption"),_1c2a=_1c28&&_1c28.length>0;_1c2a=_1c2a&&(this.model instanceof _1c23);this._setCommandAvailable(_1c28);if(!_1c2a){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_1c29){this.set("label",this._labelAutomatic);}else{this._setLabel(_1c29);}this._watch("displayOption",function(_1c2b,_1c2c,_1c2d){if(!_1c2d){this.set("label",this._labelAutomatic);}else{this._setLabel(_1c2d);}},this);},_setCommandAvailable:function(_1c2e){this.set("isAvailable",_1c2e&&_1c2e.length>0&&this.model instanceof _1c23);},_setLabel:function(_1c2f){when(this.store.get(_1c2f),lang.hitch(this,function(_1c30){this.set("label",lang.replace(_1c25.label,[_1c30.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi/shell/DestroyableByKey","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_1c31,lang,when,_1c32,_1c33,_1c34,_1c35,_1c36){return _1c31([_1c34,_1c33],{model:null,headingText:_1c35.title,_rdAutomatic:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _1c36({label:_1c35.automatic,value:""}));this.addChild(this._rdAutomatic);this.own(this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault)));},destroy:function(){this._removeMenuItems();this.inherited(arguments);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_1c37){this._set("displayOptions",_1c37);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _1c38=this.model.get("displayOption");array.forEach(this.displayOptions,function(_1c39){var item=new _1c36({label:_1c39.name,iconClass:_1c39.iconClass,displayOptionId:_1c39.id,checked:_1c38===_1c39.id,title:_1c39.description});this.ownByKey("items",item.watch("checked",lang.hitch(this,function(_1c3a,_1c3b,_1c3c){if(!_1c3c){return;}this.model.modify(function(){this.model.set("displayOption",_1c39.id);},this);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_1c38);},_removeMenuItems:function(){var items=this.getChildren();this.destroyByKey("items");items.forEach(function(item){if(item===this._rdAutomatic){return;}this.removeChild(item);item.destroy();},this);}});});},"url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\r\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\r\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\r\n        <span class=\"epi-overlayControls epi-mediumButton \">\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\r\n        </span>\r\n    </span>\r\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\r\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\r\n    </button>\r\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1c3d,_1c3e,_1c3f){return _1c3d([_1c3e],{label:_1c3f.moveoutsidegroup,tooltip:_1c3f.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"treeNode\"></div>\r\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/mouse","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_1c40,lang,event,_1c41,_1c42,_1c43,_1c44,_1c45,keys,mouse,on,query,topic,when,_1c46,_1c47,_1c48,_1c49,_1c4a,_1c4b,_1c4c,_1c4d,_1c4e,_1c4f,_1c50,_1c51,DnD,_1c52,_1c53,_1c54,_1c55,_1c56,_1c57,_1c58,_1c59){return _1c40([_1c48,_1c46,_1c47,_1c4b,_1c56,_1c57],{baseClass:"epi-item-collection-editor",multiple:true,res:_1c59,actionsResource:_1c59,templateString:_1c58,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_1c55,_newItemCommand:null,_gridClass:_1c40([_1c4f,_1c49,_1c50,DnD,_1c4e]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _1c54(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _1c4a(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _1c4c();this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions});this.contextMenu.addProvider(this.commandProvider);this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _1c53({model:this.model,dialogContentParams:this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_1c5a=function(data,_1c5b,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_1c5c={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_1c51.contentItemFactory("text","title","typeIdentifier",menu),_1c5a],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator),isSource:!this.readOnly},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_1c5d=function(_1c5e){var types=_1c4d.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_1c5c._getDndType=_1c5d;}this.own(this.grid=new this._gridClass(_1c5c,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_1c5f=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_1c5f(".dgrid-row",mouse.enter),function(e){_1c42.add(self,self._mouseOverClass);}),self.grid.on(_1c5f(".dgrid-row",mouse.leave),function(e){_1c42.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_1c5f(".dgrid-row",_1c52.keys.del),function(e){self.model.remove();}),self.grid.on(_1c5f(".dgrid-row",_1c52.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_1c5f(".dgrid-row",_1c52.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_1c41.around(self.grid.dndSource,"checkAcceptance",function(_1c60){return function(_1c61,nodes){return !self.readOnly&&_1c60.apply(self.grid.dndSource,arguments);};}),_1c41.after(self.grid.dndSource,"onDropData",function(_1c62,_1c63,nodes,copy){var i;if(self.grid.dndSource===_1c63){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{for(i=0;i<_1c62.length;i++){when(_1c62[i].data,lang.hitch(this,function(_1c64){self.model.addTo(_1c64,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_1c63&&_1c63.grid&&_1c63.grid.consumer&&_1c63.grid.consumer!==self){_1c63.grid.consumer.model.set("selectedItem",_1c64);_1c63.grid.consumer.model.remove();}}));}}},true),_1c41.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_1c41.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_1c65,nodes,copy){var _1c66=this.grid.dndSource,_1c67=_1c66.accept&&_1c66.checkAcceptance(_1c65,nodes);_1c42[_1c67?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_1c41.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1c68,_1c69,nodes,copy){for(var i=0;i<_1c68.length;i++){when(_1c68[i].data,lang.hitch(this,function(_1c6a){this.model.addTo(_1c6a,null,false);if(_1c69&&_1c69.grid&&_1c69.grid.consumer&&_1c69.grid.consumer!==this){_1c69.grid.consumer.model.set("selectedItem",_1c6a);_1c69.grid.consumer.model.remove();}}));}this.focus();}),true));var _1c6b=this.commandProvider.commands.concat(this._newItemCommand);_1c6b.forEach(function(_1c6c){this.own(_1c41.after(_1c6c,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_1c41.after(_1c6c,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_1c6d){if(_1c6d==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _1c6e=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_1c6e){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1c6e;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.grid&&this.value&&this.value.length>0){this.grid.focus();if(this.model){var _1c6f=this.model.get("selectedItem"),_1c70=this.model.getItemIndex(_1c6f);if(_1c6f){this.grid.focus(this.grid.row(_1c70).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _1c54(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_1c71){this._set("readOnly",_1c71);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_1c71);}},_dndNodeCreator:function(item,hint){var _1c72=this.allowedDndTypes,node=_1c43.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_1c72=_1c4d.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {node:node,type:_1c72,data:item};},_aroundInsertRow:function(_1c73){return lang.hitch(this,function(_1c74,_1c75,_1c76,i,_1c77){var row=_1c73.apply(this.grid,arguments);var _1c78=this.model.get("selectedItem");if(_1c78&&_1c78.id===_1c74.id){this.select(_1c78);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){if(this.readOnly){return;}var _1c79=this.model.get("selectedItem"),_1c7a=this.model.getItemIndex(_1c79);if(_1c79){event.stop(e);this.contextMenu.scheduleOpen(this,null,_1c45.position(query(".epi-iconContextMenu",this.grid.row(_1c7a).element)[0],true));}},_displayActionsContainer:function(){_1c44.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1c7b,_1c7c,_1c7d,_1c7e){return _1c7b([_1c7c,_1c7d],{dialogContentClass:_1c7e,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel","epi-cms/widget/HyperLinkSelector"],function(array,_1c7f,lang,_1c80,_1c81,_1c82,epi,_1c83,_1c84,_1c85,_1c86,_1c87,_1c88,_1c89){return _1c7f([_1c85,_1c86,_1c84,_1c82,_1c87],{_metadataManager:null,modelClassName:_1c88,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_1c83.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _1c8a=_1c7f(this.modelClassName);this.model=new _1c8a();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_1c8b){_1c8b.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_1c8c){array.forEach(this.form._getDescendantFormWidgets(),function(_1c8d){if(this.hiddenFields&&this.hiddenFields.indexOf(_1c8d.name)>-1){var _1c8e=this._getAncestorNode(_1c8d.domNode,"epi-form-container__section__row");_1c80.set(_1c8e,{display:"none"});_1c8d.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_1c8f){var _1c90=array.filter(this.form._getDescendantFormWidgets(),function(_1c91){return _1c91&&_1c91.name===_1c8f;},this);return _1c90?_1c90[0]:null;},_getAncestorNode:function(node,_1c92){var _1c93=node?node.parentNode:null;if(!_1c93){return null;}if(!_1c81.contains(_1c93,_1c92)){return this._getAncestorNode(_1c93,_1c92);}return _1c93;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_1c94){return _1c94.get("required")?!!_1c94.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/dependency"],function(array,_1c95,_1c96,lang,_1c97,topic,_1c98,when,_1c99){return _1c95([_1c98],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","dijit/form/ValidationTextBox","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(array,_1c9a,lang,_1c9b,_1c9c,_1c9d,_1c9e,when,all,_1c9f,_1ca0,_1ca1,_1ca2,_1ca3,Url,_1ca4,_1ca5,_1ca6,_1ca7,_1ca8,_1ca9,_1caa){return _1c9a([_1ca0,_1ca1,_1ca4],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_1ca7,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _1cab=_1c9a(this.modelClassName);this.model=new _1cab({providers:this.providers});}this._languageStore=this._languageStore||_1ca3.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();this._createRemainingUrlInput();},startup:function(){this.inherited(arguments);this._languageSelector.startup();this._remainingUrl.startup();var self=this,_1cac=this._languageSelector;when(this._languageStore.get(),function(_1cad){if(self.get("showLanguageSelector")){if(_1cad.length<=1){self._toggleLanguageSelector(false);}else{self._toggleLanguageSelector(true);}}var _1cae=_1cad.map(function(_1caf){return {text:_1caf.name,value:_1caf.languageId};});_1cae.splice(0,0,{text:_1ca9.automaticlanguage,value:""});_1cac.set("selections",_1cae);_1cac.set("value","");return self._createInputWrappers();}).then(function(){_1c9e.place(this._remainingUrlWrapperNode,this.domNode,"last");}.bind(this));},onSelectorsCreated:function(_1cb0){},_setShowLanguageSelectorAttr:function(value){this._set("showLanguageSelector",value);this._toggleLanguageSelector(value);},_setSelectedWrapperAttr:function(_1cb1){if(!_1cb1){return;}array.forEach(this.wrappers,function(_1cb2){_1cb2.set("selected",false);});_1cb1.set("selected",true);this._languageSelector.set("disabled",!_1cb1.settings.isContentLink);_1c9d.toggle(this._remainingUrlWrapperNode,"dijitHidden",!_1cb1.settings.isContentLink);},_createLanguageSelector:function(){this.own(this._languageSelector=new _1ca6());this._languageSelectorWrapperNode=_1c9e.toDom(_1c9f.substitute(_1caa,{id:this._languageSelector.id,label:_1ca9.language,title:""}));_1c9e.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_createRemainingUrlInput:function(){this.own(this._remainingUrl=new _1ca2({}));this._remainingUrlWrapperNode=_1c9e.toDom(_1c9f.substitute(_1caa,{id:this._remainingUrl.id,label:_1ca9.remainingurl,title:_1ca9.remainingurltitle}));this._remainingUrl.placeAt(this._remainingUrlWrapperNode,"last");},_toggleLanguageSelector:function(_1cb3){_1c9d.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_1cb3);},_createInputWrappers:function(){var _1cb4=this.model.wrapperSettings,_1cb5=[],self=this;_1cb4.forEach(function(_1cb6){var def=new _1c9b();_1cb5.push(def.promise);require([_1cb6.widgetType],function(ctor){var _1cb7=new _1ca5(lang.mixin(_1cb6,{groupName:_1cb6.groupName+this.id,inputWidgetCtor:ctor,required:self.required}));self.own(_1cb7.on("radioButtonChange",lang.hitch(this,function(){self.set("selectedWrapper",_1cb7);_1cb7.focus();})));if(_1cb6.invisible){_1c9c.set(_1cb7.domNode,{display:"none"});}def.resolve(_1cb7);});},this);return when(all(_1cb5),function(_1cb8){if(_1cb8.length===0){return;}_1cb8.forEach(function(_1cb9){self.addChild(_1cb9);});self.set("wrappers",_1cb8);var value=self.get("value");if(value){self._setValueForWidgets(value);}else{self.set("selectedWrapper",_1cb8[0]);}self.onSelectorsCreated(self);});},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_1cba){return _1cba.get("selected");})[0];},_getValueAttr:function(){var _1cbb=this._getSelectedWrapper();if(_1cbb){if(_1cbb.inputWidget&&_1cbb.settings.isContentLink){return this.model.getUrlValue(_1cbb.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this._remainingUrl.get("value"),this.value);}else{return _1cbb.get("value");}}return this.value;},_setValueAttr:function(value){var _1cbc=function(value){this._set("value",value);this._remainingUrl.set("value",this.model.getRemainingUrl(value));this._setValueForWidgets(value);};if(value){this.model.getPermanentLink(value).then(_1cbc.bind(this));}else{_1cbc.call(this,value);}},_setValueForWidgets:function(value){var _1cbd=this.get("wrappers");if(!_1cbd){return;}array.forEach(_1cbd,function(_1cbe){_1cbe.set("value",null);});if(!value){return;}var url=new Url(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));when(this.model.getContentData(value),lang.hitch(this,function(_1cbf){if(_1cbf){array.every(_1cbd,function(_1cc0){if(_1cc0&&_1cc0.settings.isContentLink){if(array.some(_1cc0.settings.allowedTypes,lang.hitch(this,function(_1cc1){return this.model.isBaseTypeIdentifier(_1cbf.typeIdentifier,_1cc1);}))){_1cc0.set("value",_1cbf.contentLink);this.set("selectedWrapper",_1cc0);return false;}}return true;},this);}else{array.every(_1cbd,function(_1cc2){if(_1cc2&&!_1cc2.settings.isContentLink){var _1cc3=_1cc2.inputWidget;if(_1cc3&&this._isValidEditorWidget(value,_1cc3)&&_1cc3.validator(value,_1cc3.constraints)){_1cc2.set("value",value);this.set("selectedWrapper",_1cc2);return false;}}return true;},this);}}));},_isValidEditorWidget:function(value,_1cc4){if(_1cc4 instanceof _1ca8){return Url(value).scheme==="mailto";}return true;},validate:function(){var _1cc5=this._getSelectedWrapper();if(_1cc5){_1cc5._hasBeenBlurred=this._hasBeenBlurred;return _1cc5.validate();}return false;},focus:function(){var _1cc6=this._getSelectedWrapper();if(_1cc6){_1cc6.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Contained","epi/string","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_1cc7,lang,_1cc8,_1cc9,_1cca,_1ccb,_1ccc){return _1cc7([_1cc8,_1cca,_1cc9],{templateString:_1ccc,inputWidget:null,inputWidgetCtor:null,settings:null,_hasBeenBlurred:false,buildRendering:function(){this.inherited(arguments);var _1ccd=lang.mixin({value:this.get("value")||null},this.settings);this.own(this.inputWidget=new this.inputWidgetCtor(_1ccd).placeAt(this.domNode));},_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_1cce,evt){},validate:function(){if(this.inputWidget){this.inputWidget._hasBeenBlurred=this._hasBeenBlurred;return this.inputWidget.validate();}return true;},_setValueAttr:function(value){this._set("value",value);if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){if(this._started&&this.inputWidget){return this.inputWidget.get("value");}return this.value;},_setRequiredAttr:function(val){this._set("required",val);if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){this._set("selected",value);if(this.inputWidget){this.inputWidget.set("disabled",!value);if(!value){this.inputWidget.set("state","");}}this.radioNode.checked=value;},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){this._set("showAllLanguages",val);if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}_${name}\">\r\n        <input type=\"radio\" name=\"${groupname}\" id=\"${id}_${name}\" value=\"${name}\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-attach-event=\"onchange:_onRadioButtonChange\" data-dojo-attach-point=\"radioNode\" />\r\n        ${displayName}\r\n    </label>\r\n</div>","epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dojox/html/entities","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_1ccf,lang,_1cd0,on,_1cd1,_1cd2,_1cd3,_1cd4,_1cd5,_1cd6){return _1ccf([_1cd5,_1cd2,_1cd6],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1cd7){this.set("options",array.map(_1cd7,function(item){return {label:_1cd1.encode(item.text),value:item.value,selected:(item.value===this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);this.own(on(this,"change",lang.hitch(this,function(){if(!this.disabled){this.validate();}this.onLayoutChanged();})));},_getMenuItemForOption:function(_1cd8){var item=null;if(_1cd8.type==="separator"){item=new _1cd4();}else{var click=lang.hitch(this,"_setValueAttr",_1cd8);item=new _1cd3({option:_1cd8,label:_1cd8.label||this.emptyLabel,onClick:click,disabled:_1cd8.disabled||false});item.focusNode.setAttribute("role","listitem");}this.own(item);return item;},_getValueFromOpts:function(){var _1cd9=this.getOptions()||[];if(!this.multiple&&_1cd9.length){var _1cda=array.filter(_1cd9,function(i){return i.selected;})[0];if(_1cda&&_1cda.value!==undefined){return _1cda.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1cd9,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_1cdb){var _1cdc=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_1cdc,function(i){return (i.value===value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _1cdd=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_1cdd;this.actualValue=_1cdd;}array.forEach(_1cdc,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_1cdb);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _1cde=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_1cde);},this);}},validator:function(value,flags){}});});},"epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/Url","epi/shell/TypeDescriptorManager","epi-cms/core/PermanentLinkHelper"],function(array,_1cdf,lang,_1ce0,_1ce1,_1ce2,_1ce3,when,_1ce4,Url,_1ce5,_1ce6){return _1cdf([_1ce0],{_providersSetter:function(_1ce7){var _1ce8=[];array.forEach(_1ce7,lang.hitch(this,function(_1ce9){_1ce8.push({name:_1ce9.name,displayName:_1ce9.displayName?_1ce9.displayName:_1ce9.name,title:_1ce9.title?_1ce9.title:"",groupname:"hyperLink_",widgetType:_1ce9.widgetType,invisible:_1ce9.invisible,settings:lang.mixin({roots:_1ce9.roots,allowedTypes:_1ce9.linkableTypes,isContentLink:(_1ce9.linkableTypes&&_1ce9.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null,searchArea:_1ce9.searchArea},_1ce9.widgetSettings)});}));this.set("wrapperSettings",_1ce8);},getContentData:function(value){if(value){return _1ce6.getContent(value,{allLanguages:true});}return null;},isBaseTypeIdentifier:function(type,base){return _1ce5.isBaseTypeIdentifier(type,base);},getPermanentLink:function(href){return _1ce6.getPermanentLink(href);},getUrlValue:function(_1cea,_1ceb,_1cec,_1ced){if(!_1cea){return "";}var url=new Url(_1cea);if(_1ced){var _1cee=new Url(_1ced);if(this._areEqual(_1cee,url)){url.query=lang.mixin(_1cee.query,url.query);}}if(_1ceb===""){delete url.query.epslanguage;}else{url.query.epslanguage=_1ceb;}if(_1cec){var rUrl=new Url(_1cec);if(rUrl.path){url.query["epsremainingpath"]=rUrl.path;}if(rUrl.fragment){url.fragment=rUrl.fragment;}Object.keys(rUrl.query).forEach(function(key){url.query[key]=rUrl.query[key];});}return url.toString();},getRemainingUrl:function(value){if(!value){return "";}var url=new Url(value);url.authority="";url.scheme="";delete url.query["epslanguage"];delete url.query["epieditmode"];if(url.query.epsremainingpath){url.path=url.query.epsremainingpath;}else{url.path="";}delete url.query["epsremainingpath"];return url.toString();},_areEqual:function(url1,url2){return url1.scheme===url2.scheme&&url1.authority===url2.authority&&url1.path===url2.path&&url1.fragment===url2.fragment;}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/lang","dojo/when","epi/dependency","epi/shell/XhrWrapper","epi/routes"],function(lang,when,_1cef,_1cf0,_1cf1){var xhr=new _1cf0();return {getContent:function(link,_1cf2){if(!link){return null;}var _1cf3=_1cef.resolve("epi.storeregistry"),store=_1cf3.get("epi.cms.content.light"),query=lang.mixin({query:"getcontentbypermanentlink",permanentLink:link},_1cf2||{});return when(store.query(query)).then(function(_1cf4){return _1cf4&&_1cf4 instanceof Array?_1cf4[0]:_1cf4;});},getPermanentLink:function(href){var route=_1cf1.getActionPath({moduleArea:"CMS",controller:"Links",action:"GetPermanentLink"});return xhr.xhrGet({url:route,content:{href:href}});}};});},"epi-cms/form/EmailValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/ValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.form.emailvalidation"],function(_1cf5,lang,_1cf6,res){var _1cf7=_1cf5([_1cf6],{invalidMessage:res.invalidmessage,addMailTo:false,validator:function(value,_1cf8){value=value||"";if(!this.required&&this._isEmpty(value)){return true;}value=value.replace(/\\.{1}/g,"replaced").replace(/".*?"/g,"replaced");return _1cf7.validationRegex.test(value);},_getValueAttr:function(){var value=this.inherited(arguments);if(this.addMailTo){value=value?lang.trim(value):"";if(value&&value.indexOf("mailto:")!==0){value="mailto:"+value;}}return value;},_setValueAttr:function(value){value=value?value.replace("mailto:",""):"";this.inherited(arguments,[value]);}});_1cf7.validationRegex=/.+@.+\..+/i;return _1cf7;});},"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}\" title=\"${title}\">${label}</label>\r\n</div>","epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin","epi-cms/contentediting/viewmodel/LinkItemModel"],function(_1cf9,lang,_1cfa,all,when,_1cfb,_1cfc){return _1cf9([_1cfb],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_1cfd){_1cf9.safeMixin(this,_1cfd);},postscript:function(data){require([this.itemModelType],lang.hitch(this,function(_1cfe){this.itemModelClass=_1cfe;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1cff,item,_1d00){if(!_1cff){return false;}if(this.getItemIndex(_1cff)>=0){this.moveTo(_1cff,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1cff),function(model){if(!item){self._data.push(model);}else{var _1d01=self.getItemIndex(item)+(_1d00?0:1);self._data.splice(_1d01,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_1d02,item,_1d03){if(!_1d02&&!this._selectedItem){return false;}this.set("selectedItem",_1d02||this._selectedItem);var _1d04=this.getItemIndex(this._selectedItem);this._data.splice(_1d04,1);var _1d05=(item?this.getItemIndex(item):(this._data.length-1))+(_1d03?0:1);this._data.splice(_1d05,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_1d06,_1d07){if(!this._data[_1d06]||!this._data[_1d07]){return false;}var temp=this._data[_1d06];this._data[_1d06]=this._data[_1d07];this._data[_1d07]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_1d08;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_1d08=data.map(function(item){return this._createItemModel(item);},this);all(_1d08).then(function(_1d09){self._data=_1d09;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _1d0a=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _1cfa();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _1d0a){model=lang.mixin(lang.clone(item),id);}else{model=new _1d0a(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_1d0b){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_1d0b);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_1d0c,lang,_1d0d,when,Url,_1d0e,_1d0f){return _1d0c([_1d0e],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1d10=new Url(url);if(!_1d10.scheme){_1d10=new Url("",{scheme:window.location.protocol,authority:window.location.hostname,path:url});}return _1d10.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1d0f.getContent(this.href),lang.hitch(this,function(_1d11){if(_1d11){this._parseFromContent(_1d11);}}));}},_parseFromContent:function(_1d12){if(_1d12){this.typeIdentifier=_1d12.typeIdentifier;this.publicUrl=this._buildPublicUrl(_1d12.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1d13,_1d14){return _1d13([_1d14],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_1d15){if(_1d15){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_1d16,_1d17){if(_1d16===_1d17){return this[_1d16];}return this.get(_1d16);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_1d18,_1d19,Edit,_1d1a,_1d1b,_1d1c){return _1d18([_1d1c],{constructor:function(_1d1d){var _1d1e=_1d1d?_1d1d.commandOptions:{};this.commands=[new Edit(_1d1e),new _1d1a(_1d1e),new _1d1b(_1d1e),new _1d19(_1d1e)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1d1f,_1d20,_1d21,_1d22){return _1d1f([_1d20,_1d21],{dialogContentClass:_1d22,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_1d23){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_1d23&&_1d23.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\r\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\r\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\r\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_1d24,_1d25,_1d26,_1d27){return _1d24([_1d27],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _1d26({datePackage:null});this.inherited(arguments);},_setLabelValueAttr:function(value){this.inherited(arguments,[_1d25.toUserFriendlyHtml(value)]);}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_1d28,lang,_1d29,_1d2a,dijit,_1d2b,_1d2c,_1d2d,_1d2e,_1d2f,epi,_1d30,_1d31){return _1d28([_1d2c,_1d2b,_1d2d,_1d2e],{value:null,changeLabel:epi.resources.action.change,templateString:_1d30,control:null,controlParams:[],state:"",_setLabelValueAttr:function(value){this._set("labelValue",value);if(this._isHtml(value)){this.labelNode.innerHTML=value;}else{this.labelNode.title=value;this.labelNode.textContent=value;}},_setIsEmptyAttr:function(_1d32){this._set("isEmpty",_1d32);if(_1d32){_1d29.add(this.domNode,"epi-state-empty");}else{_1d29.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_1d31.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1d2f();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_1d33){this.control.set(_1d33,this.get(_1d33));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_1d34){if(!_1d34&&!this.validate()){return;}this.showControl=_1d34;_1d2a.set(this.labelNode,"display",_1d34?"none":"");_1d2a.set(this.control.domNode,"display",_1d34?"":"none");if(!this.readOnly){_1d2a.set(this.changeNode,"display",_1d34?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_1d31.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_1d35){this._set("readOnly",_1d35);_1d2a.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();},_isHtml:function(text){return text!==_1d31.encode(text);}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-previewableTextBox-link epi-functionLink\">${changeLabel}</a>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_1d36,_1d37,_1d38,_1d39){return _1d36([_1d39],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/DialogService","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_1d3a,lang,_1d3b,_1d3c,_1d3d,_1d3e,_1d3f,_1d40,epi,_1d41,_1d42,_1d43,_1d44,_1d45,_1d46){return _1d3a([_1d3d,_1d3e,_1d3f,_1d44],{templateString:"<div class=\"dijitInline\">                            <span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink\" data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div>                          </div>",resources:epi.resources,value:null,contentLink:null,metadata:null,destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _1d47=new _1d42({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _1d43({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});_1d41.dialog({defaultActionsVisible:false,confirmActionText:_1d46.action.save,content:_1d47,title:_1d45.dialogtitle}).then(function(){var value=_1d47.get("value");this.set("value",value);this.onChange(value);}.bind(this)).always(function(){this.isShowingChildDialog=false;}.bind(this));this.isShowingChildDialog=true;},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1d3c.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","dojox/validate/regexp","epi-cms/widget/Breadcrumb","epi-cms/contentediting/PageShortcutTypeSupport","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/nls/episerver.shared"],function(_1d48,lang,_1d49,_1d4a,html,_1d4b,_1d4c,_1d4d,_1d4e,_1d4f,_1d50,_1d51,_1d52,_1d53,_1d54){return _1d48([_1d50,_1d52,_1d4f,_1d4b,_1d51],{templateString:_1d53,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],enableSaveButton:["enableSaveButton"],enableShortcutLink:["enableShortcutLink"],enableExternalLink:["enableExternalLink"],clearExternalLink:["clearExternalLink"],enableOpenIn:["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _1d55=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-form-container__section__row");if(_1d55){_1d49.set(_1d55,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _1d56=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-form-container__section__row");if(_1d56){_1d49.set(_1d56,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _1d57=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-form-container__section__row");if(_1d57){_1d49.set(_1d57,"display",value?"":"none");}}},_getAncestorNode:function(node,_1d58){var _1d59=node?node.parentNode:null;if(!_1d59){return null;}if(!_1d4a.contains(_1d59,_1d58)){return this._getAncestorNode(_1d59,_1d58);}return _1d59;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_1d5a,_1d5b){switch(_1d5a){case "pageLinkURL":this._externalLinkWidget=_1d5b;this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "contentShortcutLink":this._shortcutLinkWidget=_1d5b;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_1d5b;break;case "pageTargetFrame":this._targetFrameWidget=_1d5b;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{pageShortcutTypeName:this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));var _1d5c=this._shortcutTypeWidget&&this._shortcutTypeWidget.get("value");if(_1d5c===_1d4e.pageShortcutTypes.Shortcut){this._shortcutLinkWidget&&this._shortcutLinkWidget.set("canSelectOwnerContent",false);}},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_1d54.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_1d54.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_1d5d,dojox){var _1d5e=lang.getObject("validate.regexp",true,dojox);_1d5e=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _1d5f="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _1d60="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _1d61="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _1d62="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _1d63="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _1d64="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_1d5f);}if(flags.allowDottedHex){a.push(_1d60);}if(flags.allowDottedOctal){a.push(_1d61);}if(flags.allowDecimal){a.push(_1d62);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_1d63);}if(flags.allowHybrid){a.push(_1d64);}var _1d65="";if(a.length>0){_1d65="("+a.join("|")+")";}return _1d65;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _1d66="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _1d67="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _1d68=flags.allowPort?"(\\:\\d+)?":"";var _1d69="((?:"+_1d66+"\\.)+"+_1d67+"\\.?)";if(flags.allowIP){_1d69+="|"+_1d5e.ipAddress(flags);}if(flags.allowLocal){_1d69+="|localhost";}if(flags.allowNamed){_1d69+="|^[^-][a-zA-Z0-9_-]*";}return "("+_1d69+")"+_1d68;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _1d6a=_1d5d.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _1d6b="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _1d6a+_1d5e.host(flags)+_1d6b;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _1d6c="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _1d6d=_1d6c+"@"+_1d5e.host(flags);if(flags.allowCruft){_1d6d="<?(mailto\\:)?"+_1d6d+">?";}return _1d6d;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _1d6e=_1d5e.emailAddress(flags);var _1d6f="("+_1d6e+"\\s*["+flags.listSeparator+"]\\s*)*"+_1d6e+"\\s*["+flags.listSeparator+"]?\\s*";return _1d6f;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _1d70=function(_1d71){return _1d5d.escapeString(_1d71,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _1d5d.buildGroupRE(flags.format,_1d70);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _1d72="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _1d73="AS|FM|GU|MH|MP|PW|PR|VI";var _1d74="AA|AE|AP";if(flags.allowTerritories){_1d72+="|"+_1d73;}if(flags.allowMilitary){_1d72+="|"+_1d74;}return "("+_1d72+")";}}};return _1d5e;});},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(dojo){return dojo.dojox;});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-form-container\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi"],function(_1d75,_1d76,_1d77,_1d78,epi){return _1d75([_1d76],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_intermediateValueSetter:function(value){this.intermediateValue=value;this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType===_1d78.pageShortcutTypes.Shortcut||value.pageShortcutType===_1d78.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType===_1d78.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType===_1d78.pageShortcutTypes.External&&this.savedValue.pageShortcutType!==_1d78.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&!(value.pageShortcutType===_1d78.pageShortcutTypes.FetchData||value.pageShortcutType===_1d78.pageShortcutTypes.Inactive||value.pageShortcutType===_1d78.pageShortcutTypes.Normal));},_savedValueSetter:function(value){this.savedValue=value;this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1d79,_1d7a,_1d7b,topic,_1d7c,_1d7d,_1d7e,_1d7f){return _1d79([_1d7f],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var self=this;this.own(topic.subscribe("/epi/shell/context/request",function(_1d80,_1d81){if(!_1d81.contextIdSyncChange){self.tryToStopEditing(false);self.set("editing",false);self._destroyDialog();}}),topic.subscribe("/epi/shell/action/changeview",function(){self.set("editing",false);self._removeEditingFeatures();}));},destroy:function(){this.tryToStopEditing(false);this._destroyDialog();this.inherited(arguments);},startEdit:function(_1d82){this.editorParams=Object.assign(this.editorParams||{},_1d82);var self=this;self._destroyDialog();return self._setupDialog().then(function(){self.own(_1d7a.after(self._dialog,"onAfterShow",function(){self._startEdit(_1d82);self._onTryToStopWithInvalidValue();}));return self._dialog.show();});},_createDialog:function(_1d83){return new _1d7e({title:this.propertyDisplayName,content:_1d83,duration:350,snapToNode:this.blockDisplayNode,positioner:_1d7d.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(node){this.inherited(arguments);var _1d84=this._dialog;if(_1d84){_1d84.set("snapToNode",node);}},_setupDialog:function(){var _1d85={};var _1d86=function(_1d87,_1d88){_1d85[_1d87]=_1d88;};var _1d89=function(_1d8a){for(var _1d8b in _1d85){var _1d8c=_1d85[_1d8b];_1d8c.set("parent",this);}_1d85=null;}.bind(this);var _1d8d=Object.assign({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){_1d8d=Object.assign(_1d8d,{onFieldCreated:_1d86,onFormCreated:_1d89,doLayout:false});}var _1d8e=new _1d7b();require([this.editorWidgetType],function(_1d8f){var _1d90=new _1d8f(_1d8d);this.editorWidget=_1d90;var _1d91=this._createDialog(_1d90);this._handlers=[this.connect(_1d91,"onButtonClose",this._onButtonClose),this.connect(_1d91,"onCancel",this._onDialogCancel),this.connect(_1d91.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1d90,"onChange",this._onChange),this.connect(_1d90,"onKeyPress","_onEditorKeyPress")];this._dialog=_1d91;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1d8e.resolve();}.bind(this));return _1d8e.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_1d92){_1d92.remove();});this._handlers=null;if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}if(this._dialog){this._dialog.destroy();this._dialog=null;}},_removeEditingFeatures:function(){var _1d93=this._dialog;if(_1d93&&_1d93.open){_1d93.hide();}},_onTryToStopWithInvalidValue:function(){_1d7c.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/has","dijit/focus","dijit/DialogUnderlay","dijit/Dialog","epi/shell/widget/dialog/_DialogMixin","dijit/_WidgetsInTemplateMixin","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/LightWeight.html"],function(_1d94,lang,_1d95,_1d96,_1d97,has,focus,_1d98,_1d99,_1d9a,_1d9b,_1d9c,_1d9d){return _1d94([_1d99,_1d9a,_1d9b],{templateString:_1d9d,buttonCloseText:_1d9c.action.close,buttonDoneText:_1d9c.action.done,buttonLearnMoreText:_1d9c.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,showButtonContainer:true,destroy:function(){this._interval&&clearInterval(this._interval);this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){var _1d9e=this._relativePosition&&this._relativePosition.id;_1d97.set(this.containerNode,"overflow","visible");this.inherited(arguments);_1d97.set(this.containerNode,"overflow","auto");if(this.positioner){var obj={snapTo:this.snapToNode,transformIndex:_1d9e};this._relativePosition=this.positioner.findPosition(this.domNode,obj);}},resize:function(){this._size();this._position();},_onAfterShow:function(){function _1d9f(){var _1da0=_1d96.position(this.domNode),_1da1=this._relativePosition;if(_1da1&&(Math.abs(_1da1.w-_1da0.w)>8||Math.abs(_1da1.h-_1da0.h)>8)){this.resize();}};if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.own(_1d95.after(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay)),_1d95.after(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay)));this._attachedContentResizeEvents=true;}}this._interval=setInterval(lang.hitch(this,_1d9f),250);this.onAfterShow();},_createUnderlay:function(){var _1da2=this.containerNode,_1da3=_1d97.get(_1da2,"width");if(has("trident")){var _1da4=_1da2.offsetWidth-_1da2.clientWidth;_1da3+=_1d96.getPadBorderExtents(_1da2).w+_1da4;}_1d97.set(_1da2,{width:_1da3+"px"});if(this._glassUnderlay){this._glassUnderlay.show();}else{this.own(this._glassUnderlay=new _1d98());this._glassUnderlay.show();var _1da5=_1d97.get(this.domNode,"zIndex");_1d97.set(this._glassUnderlay.domNode,"zIndex",_1da5-1);_1d97.set(this._glassUnderlay.domNode,"opacity","0");}},_endDrag:function(){this.inherited(arguments);this._relativePosition.id=this.positioner.userSetTransformId;},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},_setSnapToNodeAttr:function(node){this.snapToNode=null;this._set("snapToNode",node);},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){this._interval&&clearInterval(this._interval);this._interval=null;return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1d97.get(this._glassUnderlay.domNode,"display")!=="none"){this._glassUnderlay.layout();}var _1da6=_1d98._singleton;var _1da7=_1da6?_1d97.get(_1da6.domNode,"display"):null;this.inherited(arguments);if(_1da6){_1d97.set(_1da6.domNode,"display",_1da7);}},_setShowButtonContainerAttr:function(_1da8){this._set("showButtonContainer",_1da8);_1d97.set(this.buttonContainerNode,"display",_1da8?"":"none");},_checkIfSingleChild:function(){this._singleChild=null;}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_1da9,lang,on,_1daa,_1dab){return _1da9([_1dab],{destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onEditorResize:function(_1dac){},_onEditorResizeFinished:function(_1dad){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _1dae=null,_1daf=this.overlayItem;while(_1daf){if(_1daf instanceof _1daa){_1dae=_1daf;break;}_1daf=_1daf.getParent();}return this._iframeWithOverlay=_1dae;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1db0,_1db1,lang,_1db2,_1db3,_1db4,_1db5,_1db6,_1db7,_1db8){return _1db1([_1db8],{_eventHandlers:null,constructor:function(){this._eventHandlers=[];},_createDialog:function(_1db9){var _1dba=function(_1dbb){if(!this.open||!_1dbb){return;}this._containerNodeCS=this._containerNodeCS||_1db4.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1db3.getMarginBox(this.domNode).h-_1db3.getMarginBox(this.containerNode).h;}_1db3.setMarginBox(this.containerNode,{h:_1dbb.h-this._chromeHeight},this._containerNodeCS);_1db4.set(this.domNode,{top:_1dbb.t+"px",left:_1dbb.l+"px"});};var _1dbc=new _1db7({title:this.propertyDisplayName,content:_1db9,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_1dba,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1db2.add(_1dbc.domNode,"epi-floatingEditorWrapperDialog");_1db2.remove(_1dbc.domNode,"epi-lfw-dialog--dark");_1dbc.placeAt(this.get("iframeWithOverlay"));_1db4.set(_1dbc.domNode,{top:"-10000px"});return _1dbc;},_disconnectLocal:function(_1dbd){if(lang.isArray(_1dbd)){var _1dbe;while((_1dbe=_1dbd.pop())){_1db0.disconnect(_1dbe);}}},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1dbf,event,lang,_1dc0,_1dc1,on,when,_1dc2){return _1dbf([_1dc2],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},tryToStopEditing:function(){var _1dc3=this.getEditorWidget();if(_1dc3&&_1dc3.isEditing()){_1dc3.onEditorBlur();}this.inherited(arguments,[true]);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _1dc4=new _1dc1();var _1dc5=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_1dc5.style=this._computeStyling();}require([this.editorWidgetType],lang.hitch(this,function(_1dc6){var _1dc7=this.editorWidget=new _1dc6(_1dc5);_1dc7.placeAt(this.get("overlayItem").domNode);this.own(on(_1dc7.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_1dc7,"onClick",event.stop),this.connect(_1dc7,"onEditorResizing",this._onEditorResizing),this.connect(_1dc7,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_1dc7,"onChange","_onEditorChange"));this._handlers.push(this.connect(_1dc7,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_1dc4.resolve(_1dc7);}));return _1dc4;},_computeStyling:function(){var _1dc8=_1dc0.getComputedStyle(this.blockDisplayNode),_1dc9="line-height:"+_1dc8.lineHeight+";",_1dca=_1dc0.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _1dcb=_1dc8["font"+prop],_1dcc=_1dca["font"+prop];if(_1dcc!==_1dcb){_1dc9+="font-"+prop+":"+_1dc8["font"+prop]+";";}},this);var width=this.width;if(width==="100%"){_1dc9+="width:100%;";}else{_1dc9+="width:"+(width+(Number(width)===width?"px":""))+";";}_1dc9+="position: absolute; left: 0px; top: 0px;";return _1dc9;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_1dcd){},_onEditorResized:function(_1dce){},_onEditorStateChanged:function(_1dcf){var _1dd0=this.get("overlayItem");_1dd0&&_1dd0.set("error",_1dcf==="Error");},startEdit:function(){var _1dd1=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_1dd2){this._blockDisplayNodeOpacity=_1dc0.get(this.blockDisplayNode,"opacity");_1dc0.set(_1dd2.domNode,{display:""});_1dc0.set(this.blockDisplayNode,{opacity:0.5});_1dd1.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_1dd3){_1dd3.remove();});},_onTryToStopWithInvalidValue:function(){},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_1dc0.set(this.blockDisplayNode,{opacity:this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_1dc0.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_1dd4){var _1dd5=this.get("overlayItem");if(!_1dd5){return;}var _1dd6=this.getEditorWidget();if(!_1dd6||!_1dd6.supportCustomDnd){return;}if(_1dd4===true){_1dd5.transferDndControlTo(_1dd6);}else{_1dd5.transferDndControlTo(_1dd5);}},_toggleOverlayItemZIndex:function(_1dd7){var _1dd8=this.get("overlayItem");if(!_1dd8||!_1dd8.item){return;}var _1dd9=parseInt(_1dc0.get(_1dd8.item,"zIndex"),10);_1dc0.set(_1dd8.item,{zIndex:_1dd7===true?++_1dd9:--_1dd9});}});});},"epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1dda,lang,array,_1ddb,when,_1ddc,_1ddd,_1dde,_1ddf,_1de0,_1de1,_1de2,_1de3){return _1dda([_1de0,_1ddd,_1dde,_1ddf],{templateString:_1de3,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _1de4=this.detailsWidgetIdentifier;var _1de5=this.detailsModelIdentifier;var _1de6=new _1ddb();var _1de7=new _1ddb();require([_1de4,_1de5],lang.hitch(this,function(_1de8,_1de9){var _1dea=new _1de8({},this.contentDetails);this.own(_1dea);var model=new _1de9();this.own(model);_1dea.set("model",model);_1dea.startup();this.contentDetails=_1dea;_1de6.resolve(_1dea);_1de7.resolve(model);}));this._contentDetailsDef=_1de6;this._contentDetailsModelDef=_1de7;},_setContentViewModelAttr:function(_1deb){this._set("contentViewModel",_1deb);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1deb);});},addChild:function(w){if(this.detailsWidgetProperties){var _1dec=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName===w.name;});if(_1dec.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1ded){_1ded.addChild(w,_1dec[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <div data-dojo-attach-point=\"contentDetails\"></div>\r\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_1dee,_1def,_1df0){return _1dee([_1df0],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_1def.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_1def.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _1df1="";var _1df2=this.disabled||this.isValid(true);if(_1df2){this._maskValidSubsetError=true;}var _1df3=this._isEmpty(this.textbox.value);var _1df4=!_1df2&&this._isValidSubset();this._set("state",_1df2?(this._isValidWhenTyping()?"":"Incomplete"):(((_1df3||_1df4)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_1df2?"false":"true");if(this.state==="Error"){this._maskValidSubsetError=_1df4;_1df1=this.getErrorMessage(true);}else{if(this.state==="Incomplete"){_1df1=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_1df3){_1df1=this.getPromptMessage(true);}}}this.set("message",_1df1);return _1df2;}});});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi-cms/contentediting/command/DynamicProperties","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_1df5,lang,when,epi,_1df6,_1df7,_1df8,_1df9,_1dfa,_1dfb,_1dfc,_1dfd,_1dfe,_1dff,_1e00){return _1df5([_1e00,_1dfc,_1dfd],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,dynamicPropertiesCommand:null,expirationCommand:null,constructor:function(_1e01){_1df5.safeMixin(this,_1e01);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=new _1df9();this.languageSettingsCommand=new _1dfa();this.dynamicPropertiesCommand=new _1dfb();if(!this.expirationCommand){var _1e02=_1df7.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_1e02.manageExpiration;}if(!this.store){var _1e03=_1df7.resolve("epi.storeregistry");this.store=_1e03.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.dynamicPropertiesCommand.destroy();this.inherited(arguments);},_dataModelSetter:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.dynamicPropertiesCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_1e04,value){var _1e05=this.dataModel.contentData,_1e06=new _1dff(_1e05.contentLink);this.set("contentId",_1e06.id);this.set("existingLanguages",array.map(_1e05.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_1e05.currentLanguageBranch&&item.languageId===_1e05.currentLanguageBranch.languageId,contentLink:new _1dff(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_1e05.visibleToEveryOne);when(this.store.get(_1e05.contentTypeID),lang.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _1e07=this.inherited(arguments);return [this.dynamicPropertiesCommand,this.languageSettingsCommand,this.expirationCommand].concat(_1e07);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights"],function(_1e08,_1e09,_1e0a,_1e0b){return _1e08([_1e0a],{name:"AccessRights",label:_1e0b.label,tooltip:_1e0b.tooltip,dialogPath:"Edit/EditSecurity.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1e0c=this.model.contentData,_1e0d=_1e09.hasAccess(_1e0c.accessMask,_1e09.accessLevel.Administer);this.set("canExecute",_1e0c.capabilities.securable&&_1e0d);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings"],function(_1e0e,_1e0f,_1e10,_1e11){return _1e0e([_1e10],{name:"LanguageSettings",label:_1e11.label,tooltip:_1e11.tooltip,useVersionSpecificLinkInResult:true,dialogPath:"Edit/LanguageSettings.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1e12=this.model.contentData,_1e13=_1e0f.hasAccess(_1e12.accessMask,_1e0f.accessLevel.Administer);this.set("canExecute",_1e12.capabilities.languageSettings&&_1e13);}});});},"epi-cms/contentediting/command/DynamicProperties":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.dynamicproperties"],function(_1e14,_1e15,_1e16,_1e17,_1e18){return _1e14([_1e16],{label:_1e18.label,tooltip:_1e18.tooltip,dialogPath:"Edit/EditDynProp.aspx",raiseCloseEvent:true,postscript:function(){this.inherited(arguments);this.set("isAvailable",_1e17.isDynamicPropertiesEnabled);},_onModelChange:function(){var _1e19=this.model.contentData,_1e1a=_1e15.hasAccess(_1e19.accessMask,_1e15.accessLevel.Administer),_1e1b=this.model.canChangeContent();this.set("canExecute",_1e19.capabilities.dynamicProperties&&_1e1a&&_1e1b);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_1e1c){return _1e1c(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_1e1d){_1e1d.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_1e1e,_1e1f,data){if(_1e1e===this.sourceDataType&&_1e1f===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_1e20,_1e21,_1e22){return _1e20([_1e22],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/when","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_1e23,_1e24,when,_1e25,_1e26,_1e27){return _1e23([_1e25],{templateString:_1e27,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_1e28,index){if(_1e28.region==="top"){this.own(_1e28.placeAt(this.topPaneContainerNode));}else{this.inherited(arguments);}},removeChild:function(_1e29){if(_1e29.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _1e2a=_1e26.findWidgets(this.topPaneContainerNode);array.forEach(_1e2a,function(_1e2b){_1e2b.resize();});return this.inherited(arguments);},selectChild:function(_1e2c){if(_1e2c.region==="top"){return;}else{return when(this.inherited(arguments)).then(function(_1e2d){this.layout();return _1e2d;}.bind(this));}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\r\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\r\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\r\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\r\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>\r\n","epi-cms/legacy/LegacyFormEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/widget/_HasChildDialogMixin","epi/shell/widget/_ValueRequiredMixin","epi-cms/legacy/EditPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor"],function(_1e2e,lang,_1e2f,_1e30,_1e31,_1e32,_1e33,epi,_1e34,_1e35,_1e36,_1e37,_1e38,res){return _1e2e([_1e30,_1e31,_1e32,_1e36,_1e37],{localization:res,destroyOnHide:false,editorWidgetClass:_1e38,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-legacyFormEditor\">                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.helptext}'\"></div>            </div>",editorWidget:null,value:null,multiple:false,contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,_dialog:null,onChange:function(){},postCreate:function(){this.inherited(arguments);lang.mixin(this.params,{contentLink:this.contentLink});},buildRendering:function(){this.inherited(arguments);if(this.output){this.output.set("disabled",true);}},destroy:function(){if(this._dialog){this._dialog.destroyRecursive();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.openButton.set("disabled",value);},_setValueAttr:function(value){this._set("value",value);if(this.editorWidget&&!epi.areEqual(value,this.editorWidget.get("value"))){this.editorWidget.set("value",value);}this.setDisplayValue(value);},_onChange:function(){var value=this.editorWidget.get("value");this.set("value",value);this.onChange(value);if(this._dialog&&this._dialog.open){this._dialog.hide();}},_onCancel:function(){this._dialog.hide();},_onDialogHide:function(){this.isShowingChildDialog=false;if(this.destroyOnHide){this.editorWidget=this._dialog=null;}},openEditor:function(){this.isShowingChildDialog=true;if(!this._dialog){this._createDialog();}this.editorWidget.set("value",this.value);this._dialog.show();},_createDialog:function(){var _1e39=this.editorWidgetClass;this.editorWidget=new _1e39(this.params);this._dialog=new _1e35({destroyOnHide:this.destroyOnHide,content:this.editorWidget,title:this.editorWidget.title||this.label,defaultActionsVisible:false,dialogClass:"",contentClass:"epi-dialog-fullWidth"});this.connect(this.editorWidget,"onResize",lang.hitch(this,function(){this._dialog.resize();}));this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onCancel","_onCancel");this.connect(this._dialog,"onHide","_onDialogHide");},setDisplayValue:function(value){if(this.output){this.output.set("value",this.localization.helptext);}},focus:function(){this.openButton.focus();}});});},"epi-cms/legacy/EditPropertyWidget":function(){define(["epi","dojo","dijit","dojo/i18n","dojo/string","dojox/html/entities","epi-cms/contentediting/RenderManager","epi-cms/legacy/LegacyDialogWrapper","epi/routes"],function(epi,dojo,dijit,i18n,_1e3a,_1e3b,_1e3c,_1e3d,_1e3e){return dojo.declare([_1e3d],{editorFeatures:null,value:"",contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,fullName:null,_reloadOnNextEdit:false,onChange:function(_1e3f){},postMixInProperties:function(){this.features=dojo.mixin({width:400,height:30},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);var _1e40={moduleArea:"LegacyCMS",path:"edit/EditProperty.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};dojo.mixin(_1e40,this.contentLink?{id:this.contentLink}:{contentTypeId:this.contentTypeId,parentLink:this.parentLink});this.set("url",_1e3e.getActionPath(_1e40));},_setUrlAttr:function(url){this._currentUrl=url;var value=_1e3b.encode(dojo.toJson(this.value));var _1e41=_1e3a.substitute("<html><body><form method=\"post\" action=\"${0}\" ><input type=\"hidden\" name=\"value\" value=\"${1}\" /></form></body></html>",[url,value]);this.containerIframe.contentDocument.write(_1e41);this.containerIframe.contentDocument.forms[0].submit();},_onCallback:function(_1e42){var _1e43=_1e42.value;var _1e44=dojo.fromJson(_1e43);if(this._oldStringValue===undefined){this._oldStringValue=dojo.toJson(this.value);}if(_1e43!==this._oldStringValue){this._oldStringValue=dojo.toJson(_1e44);this.value=_1e44;this.onChange(_1e44);}else{this.onCancel();}},resize:function(){this.inherited(arguments);if(this._reloadOnNextEdit){this._reloadOnNextEdit=false;this._reloadUrl(true);}},_setValueAttr:function(value){this._set("value",value);if(this._started){this._reloadOnNextEdit=true;}}});});},"epi-cms/legacy/LegacyDialogWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/query","dojo/string","dojo/when","dijit/_Contained","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/a11y","dijit/focus","dijit/layout/_LayoutWidget","epi/Url","epi/shell/widget/_ActionProviderWidget","epi-cms/legacy/_LegacyDialogObject","epi-cms/legacy/LegacyDialogPopup","epi/i18n!epi/cms/nls/episerver.shared.action"],function(array,_1e45,lang,_1e46,on,topic,_1e47,_1e48,_1e49,_1e4a,_1e4b,has,query,_1e4c,when,_1e4d,_1e4e,_1e4f,a11y,_1e50,_1e51,Url,_1e52,_1e53,_1e54,_1e55){return _1e45([_1e51,_1e4e,_1e4f,_1e52,_1e4d],{_currentUrl:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showCloseButton:false,_isIframeInitialLoad:true,_iframeFocusRegistration:null,_scrollbarWidth:null,_iframeHandles:null,templateString:"        <div style=\"position: relative;\" tabindex=\"0\">            <iframe data-dojo-attach-point=\"containerIframe\" tabindex=\"-1\" frameborder=\"0\" style=\"border: none; position: absolute, top:0, left: 0;\" src=\"about:blank\" ></iframe>        </div>",_mappedButtons:null,postMixInProperties:function(){this.inherited(arguments);this._isIframeInitialLoad=true;this._iframeHandles=[];this.features=lang.mixin({width:320,height:240},this.features);},postCreate:function(){this.inherited(arguments);this._legacyDialog=this._createLegacyDialogObject(lang.hitch(this,function(){this.onCallback.apply(this,arguments);}),this.callbackArguments,this.dialogArguments,this.opener||window);this._resetIframeContainerSize();this.own(topic.subscribe("/IsInLegacyWrapper/NeedToBeCloseOnLoad",lang.hitch(this,function(_1e56){this.onCancel();})));},startup:function(){this.inherited(arguments);if(this.containerIframe.attachEvent){this.containerIframe.attachEvent("onload",lang.hitch(this,this._onIframeLoad));}else{this.connect(this.containerIframe,"onload",lang.hitch(this,this._onIframeLoad));}},resize:function(){this.inherited(arguments);if(this._started){this._setIframeSizeFromDomNode();}},_setUrlAttr:function(value){var url=value||"about:blank";this._currentUrl=url;_1e47.set(this.containerIframe,"src",url);},onCallback:function(_1e57){},onLoad:function(){},onCancel:function(){},onMapDialogButton:function(_1e58){return true;},onBeforePerformAction:function(_1e59){},getLegacyDialog:function(){return this._legacyDialog;},_focusIframeContent:function(){var _1e5a=this.containerIframe.contentWindow,doc=_1e5a&&_1e5a.document,_1e5b=(doc&&a11y.getFirstInTabbingOrder(doc))||this.containerIframe;_1e50.focus(_1e5b);},_onIframeLoad:function(){this._iframeFocusRegistration=_1e50.registerIframe(this.containerIframe);this._focusIframeContent();this._overrideLegacyDialogUtilities();var _1e5c=this.containerIframe.contentWindow;this._iframeHandles.push(on(_1e5c,"unload",lang.hitch(this,this._removeIframeHandles)));if(_1e5c.EPi&&_1e5c.EPi.ToolButton){this._iframeHandles.push(_1e46.after(_1e5c.EPi.ToolButton,"SetEnabled",lang.hitch(this,this._toolButtonChanged),true));}this._iframeHandles.push(_1e46.after(this._legacyDialog,"ButtonChanged",lang.hitch(this,this._toolButtonChanged),true));this._mapDialogButtons();this._setTitle();var _1e5d=query(".epi-contentContainer",this.containerIframe.contentWindow.document)[0];if(_1e5d){_1e48.add(_1e5d,"epi-legacyDialog");}if(this.autoFit){this._calculateAndSetContentSize();}this.onResize();this.onResize();if(this.onLoad){this.onLoad.apply(this,arguments);}this._isIframeInitialLoad=false;},_removeIframeHandles:function(){array.forEach(this._iframeHandles,function(_1e5e){_1e5e.remove();});this._iframeHandles=[];this._mappedButtons=null;},_setTitle:function(){if(this.dialogTitle){this.title=this.dialogTitle;return;}var title=query("title",this.containerIframe.contentWindow.document)[0];if(title){this.title=_1e4c.trim(title.innerHTML);}},_getScrollbarWidth:function(){if(this._scrollbarWidth===null){var d=_1e49.create("div",{style:"position:absolute; top:-2000; left:-2000; width:100px; height:100px; overflow:scroll"},document.body);this._scrollbarWidth=d.offsetWidth-d.clientWidth;_1e49.destroy(d);}return this._scrollbarWidth;},_boxToStyle:function(size){return {width:size.w+"px",height:size.h+"px"};},_setIframeSizeFromDomNode:function(){_1e4b.set(this.containerIframe,this._boxToStyle(_1e4a.getContentBox(this.domNode)));},_setContentSize:function(size){_1e4b.set(this.domNode,this._boxToStyle(size));this._setIframeSizeFromDomNode();},_calculateAndSetContentSize:function(_1e5f){function _1e60(doc,dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};var _1e61=null;try{_1e61=this.containerIframe.contentWindow.document;}catch(e){return;}var _1e62=(_1e61.documentElement.scrollHeight-_1e61.documentElement.clientHeight)>0,_1e63=_1e62&&this.autoFit?this._getScrollbarWidth():0,_1e64={w:_1e60(_1e61,"Width")+_1e63,h:_1e60(_1e61,"Height")};this._setContentSize(_1e64);},_resetIframeContainerSize:function(){this._setContentSize({w:this.features.width,h:this.features.height});},_showNode:function(_1e65,show){if(!_1e65){return;}_1e4b.set(_1e65,"display",show?"":"none");},_toolButtonChanged:function(_1e66,_1e67){if(typeof _1e66==="string"){var _1e68=lang.getObject("containerIframe.contentWindow.EPi",false,this);_1e66=_1e68&&_1e68._GetDomObject&&_1e68._GetDomObject(_1e66);}if(_1e66){if(this.hasAction(_1e66.id)){this.setActionProperty(_1e66.id,"disabled",_1e66.disabled);this.setActionProperty(_1e66.id,"visible",_1e66.style.display!=="none");this.setActionProperty(_1e66.id,"label",_1e66.value||_1e66.innerHTML);}var _1e69=this._mappedButtons[_1e66.id];if(_1e69){this._showNode(_1e69.containerNode,false);}}},_mapDialogButtons:function(){var _1e6a=query(this.legacyButtonQuery||"[data-epi-dialog-button]",this.containerIframe.contentWindow.document);this.removeActions(this.getActions());this._mappedButtons={};array.forEach(_1e6a,function(_1e6b){var _1e6c=_1e47.get(_1e6b,"data-epi-dialog-button"),_1e6d=null;switch(_1e6c){case "functioner":return;case "container":_1e6d=query("[data-epi-dialog-button=\"functioner\"]",_1e6b)[0];break;default:if(_1e6b.tagName==="INPUT"){_1e6d=_1e6b;if(_1e48.contains(_1e6d.parentNode,"epi-cmsButton")){_1e6b=_1e6d.parentNode;}}else{_1e6d=query("INPUT",_1e6b)[0];}break;}this._mappedButtons[_1e6d.id]={containerNode:_1e6b,functionNode:_1e6d};this._showNode(_1e6b,false);when(this.onMapDialogButton(_1e6d),lang.hitch(this,function(_1e6e){if(_1e6e){var label=_1e6d.tagName==="INPUT"?_1e6d.value:_1e6d.innerHTML,title=_1e6d.tagName==="INPUT"?_1e47.get(_1e6d,"title"):_1e6d.innerHTML,_1e6f={name:_1e6d.id,label:label,disabled:_1e6d.disabled,title:title,action:lang.hitch(this,function(){this.onBeforePerformAction(_1e6f,_1e6d);_1e6d.click();})};this.addActions(_1e6f);}}));},this);if(this.showCloseButton){this.addActions({name:"close",label:_1e55.close,action:lang.hitch(this,this.onCancel)});}},_overrideLegacyDialogUtilities:function(){var _1e70=this.containerIframe.contentWindow;if(!_1e70.EPi){_1e70.EPi={};}_1e70.EPi.CreateDialog=lang.hitch(this,this._createLegacyDialogFnc);_1e70.EPi.GetDialog=lang.hitch(this,this._getLegacyDialogFnc);},_getLegacyDialogFnc:function(win){if(win){return win.EPi.GetDialog();}return this._legacyDialog;},_createLegacyDialogFnc:function(url,_1e71,_1e72,_1e73,_1e74,_1e75){var _1e76=new _1e54({url:url,dialogArguments:_1e73,callbackArguments:_1e72,features:_1e74,opener:_1e75});_1e76.on("Callback",lang.hitch(this,function(){if(_1e71){_1e71.apply(this,arguments);}}));_1e76.show();return _1e76.legacyDialogObject;},_createLegacyDialogObject:function(_1e77,_1e78,_1e79,_1e7a){var obj=new _1e53({callbackMethod:_1e77,callbackArguments:_1e78,dialogArguments:_1e79,_opener:_1e7a?_1e7a:window.top});try{this.containerIframe.contentWindow.opener=_1e7a;obj._dialog=this.containerIframe.contentWindow;}catch(e){obj._dialog=null;}return obj;},_reloadUrl:function(_1e7b){this._isIframeInitialLoad=_1e7b;if(this._isIframeInitialLoad){this._resetIframeContainerSize();}var url=new Url(this._currentUrl);lang.mixin(url.query,{"epi.preventCache":new Date().valueOf()});this.set("url",url.toString());},cleanup:function(){var _1e7c=this.containerIframe.contentWindow;_1e7c.EPi.CreateDialog=null;_1e7c.EPi.GetDialog=null;if(this._legacyDialog&&!this._legacyDialog.IsCleaned()){this._legacyDialog.Cleanup();}},destroy:function(){this.cleanup();if(this._iframeFocusRegistration){this._iframeFocusRegistration.remove();this._iframeFocusRegistration=null;}this.inherited(arguments);}});});},"epi-cms/legacy/_LegacyDialogObject":function(){define(["dojo/_base/declare"],function(_1e7d){return _1e7d(null,{_dialog:null,constructor:function(_1e7e){this.callbackMethod=_1e7e.callbackMethod||null;this.callbackArguments=_1e7e.callbackArguments||null;this.dialogArguments=_1e7e.dialogArguments||null;this._opener=(_1e7e.opener?_1e7e.opener.top:window.top);while(this._opener.EPiOpenedDialog&&this._opener.EPiOpenedDialog._dialog){this._opener=this._opener.EPiOpenedDialog._dialog;}this._opener.EPiOpenedDialog=this;},Close:function(_1e7f){if(typeof (this.callbackMethod)=="function"){(this.callbackMethod).call(this,_1e7f,this.callbackArguments);}},ButtonChanged:function(_1e80){},Cleanup:function(){this._CleanDialog();if(this._opener){this._opener.EPiOpenedDialog=null;}delete this._opener;this.callbackMethod=null;this.callbackArguments=null;delete this.callbackMethod;delete this.callbackArguments;this._cleaned=true;},IsCleaned:function(){return this._cleaned;},_CleanDialog:function(){for(var prop in this){if(prop!=="callbackMethod"&&prop!=="callbackArguments"&&prop!=="_opener"){this[prop]=null;delete this[prop];}}}});});},"epi-cms/project/Overview":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/_ContextMixin","./_ProjectView","./viewmodels/OverviewViewModel","dojo/text!./templates/Overview.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/Toolbar","dijit/form/Button","dijit/form/DropDownButton","dijit/layout/TabContainer","epi-cms/activity/ActivityFeed","epi-cms/project/ProjectItemList","epi-cms/project/PublishMenu"],function(_1e81,lang,_1e82,on,when,_1e83,_1e84,_1e85,_1e86,res){return _1e81([_1e84],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],dndEnabled:["dndEnabled"],isActivitiesVisible:["isActivitiesVisible"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"],projectItemCountMessage:["projectItemCountMessage"],projectName:["projectName"]},res:res,templateString:_1e86,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"refresh-activities",this.activityFeed.refresh.bind(this.activityFeed)));},_createViewModel:function(){return new _1e85();},layout:function(){if(!this._started){return;}var _1e87=_1e82.getMarginBox(this.toolbar),size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1e87.h});this.tabs.resize(size);},_onShow:function(){this.model.set("isProjectOverviewActive",true);},onHide:function(){this.model.set("isProjectOverviewActive",false);},_close:function(){this.model.requestPreviousContext();},_setIsActivitiesVisibleAttr:function(_1e88){this.itemList.toggleActivities(_1e88);},_setProjectNameAttr:{node:"projectNameNode",type:"innerText"},_setProjectItemCountMessageAttr:{node:"toolbarTextNode",type:"innerText"}});});},"epi-cms/project/_ProjectView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/_ModelBindingMixin","./CreateNewDraftConfirmationDialog","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_1e89,lang,_1e8a,_1e8b,_1e8c,on,when,_1e8d,_1e8e,_1e8f,_1e90,_1e91,_1e92,_1e93,res){return _1e89([_1e8f,_1e8d,_1e8e,_1e92],{model:null,commandProvider:null,res:res,_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=this.commandProvider=this._createViewModel());}},_createViewModel:function(){},buildRendering:function(){this.inherited(arguments);this._setupList();this._setupProjectMenu();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();},_setupList:function(){var model=this.model,_1e94=this.itemList;function _1e95(_1e96){if(_1e96.existingProjectItems.length!==0){new _1e93({projectItems:_1e96.existingProjectItems,contentReferences:_1e96.contentReferences,onAction:function(_1e97){if(_1e97){model.addProjectItems(_1e96.contentReferencesToAdd).then(_1e94.setSelection.bind(_1e94));}}}).show();}else{if(_1e96.contentReferencesToAdd.length>0){model.addProjectItems(_1e96.contentReferencesToAdd);}}};this.own(on(this.model,"refresh",_1e94.refresh.bind(_1e94)),on(this.model,"selected-project-items-updated",function(_1e98){_1e94.selectItems(_1e98);}),on(this.domNode,"selection-changed",function(e){model.updateActivityFeed(e.items);}),on(this.domNode,"active-items-changed",function(e){model.set("selectedProjectItems",e.items);}),on(this.domNode,"itemaction",function(e){model.namedCommands.editProjectItem.execute();}),on(this.domNode,"itemremove",function(){model.namedCommands.removeProjectItem.execute();}),on(this.domNode,"itemsdropped",function(e){model.canAddContent(e.items).then(_1e95);}),on(this.model,"clear-selection",function(){_1e94.clearSelection();}),on(this.model,"item-removed",function(){_1e94.clearSelection();_1e94.focus();}));},_setupProjectMenu:function(){this.own(this._menuAssembler=new _1e90({configuration:[{builder:new _1e91({settings:{"class":"epi-disabledDropdownArrow",showLabel:false}}),category:"projectButton",target:this.toolbarGroupNode},{builder:new _1e91({settings:{"class":"epi-floatRight",showLabel:false}}),category:"project-comments",target:this.projectCommentsToolbar},{builder:new _1e91(),category:"project-activities",target:this.toolbarGroupNode}],commandSource:this.model}));},_publishMenuClickHandler:function(){this.model.refreshProject(false);},_setCreatedAttr:{node:"createdNode",type:"innerText"},_setCreatedByAttr:{node:"createdByNode",type:"innerText"},_setDndEnabledAttr:function(value){this.itemList.set("dndEnabled",value);},_setProjectItemQueryAttr:function(value){var store=value?this.model.projectItemStore:null;this.itemList.updateQuery(store,value);},_setProjectItemSortOrderAttr:function(value){this.itemList.set("sortOrder",value);},_setNotificationMessageAttr:function(value){this.itemList.set("notificationMessage",value);},_setProjectStatusAttr:function(value){this.projectStatusMessageNode.textContent=value;_1e8b.toggle(this.projectStatusMessageNode,"dijitHidden",!value);},_setContentLanguageAttr:function(value){this.itemList.set("contentLanguage",value);}});});},"epi-cms/project/CreateNewDraftConfirmationDialog":function(){define(["dojo/_base/declare","dojo/string","dgrid/Grid","epi/shell/widget/dialog/Confirmation","epi/string","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/episerver.cms.components.project.newdraftconfirmation"],function(_1e99,_1e9a,Grid,_1e9b,_1e9c,_1e9d,_1e9e,_1e9f,_1ea0){return _1e99([_1e9b],{projectItems:null,contentReferences:null,title:_1ea0.allreadypartofproject,cancelActionText:_1e9f.action.cancel,dialogClass:"epi-dialog-contentReferences epi-contentReferences",setFocusOnConfirmButton:false,buildRendering:function(){this.inherited(arguments);var _1ea1={showHeader:true,"class":"epi-plain-grid epi-plain-grid--no-border",columns:{name:{sortable:false,label:_1e9f.header.name,className:"epi-grid--30 epi-cursor--default",renderCell:function(_1ea2,value,node,_1ea3){var title=_1ea2.name+", ID: "+_1ea2.contentLink;node.innerHTML=_1e9d.statusFormatter(_1e9e.contentItem(_1ea2.typeIdentifier,"",value,title),_1ea2,node,_1ea3);}},path:{sortable:false,label:_1ea0.path,className:"epi-grid--40 epi-cursor--default",formatter:_1e9e.path},projectName:{sortable:false,className:"epi-grid--30 epi-cursor--default",label:_1ea0.project,renderCell:function(_1ea4,value,node,_1ea5){node.textContent=_1ea4.projectName;}}}};this.own(this.content=new _1e99([Grid])(_1ea1));this.content.renderArray(this.projectItems);this.set("description",_1e9a.substitute(_1ea0.confirmationtext,[this.projectItems.length,this.contentReferences.length]));this.set("confirmActionText",this.projectItems.length===1?_1ea0.addnewdraft:_1ea0.addnewdrafts);},_size:function(){this.inherited(arguments);this.content.resize();}});});},"epi-cms/dgrid/listItemFormatters":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.project","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/ListItem.html"],function(_1ea6,_1ea7,_1ea8,_1ea9,_1eaa,res,_1eab,_1eac,_1ead){var _1eae;function _1eaf(item){return item.path?item.path.join(" > "):item.name;};function _1eb0(item){if(!item.contentLanguage){return null;}return item.contentLanguage!==_1eae.contentLanguage?{language:item.contentLanguage}:null;};function _1eb1(value,_1eb2,node){var _1eb3=_1ea9.accessLevel,_1eb4="epi-statusIndicatorIcon epi-statusIndicator"+_1eb2.status,title=_1ea9.versionLocalizations[_1eb2.status]||"";if(_1eb2.isDeleted){_1eb4="epi-iconWarning epi-icon--warning";title=_1eab.versionnotfound;_1ea6.add(node,"epi-content--deleted");}else{if(!_1ea9.hasAccess(_1eb2.accessMask,_1eb3.Read)){_1eb4="epi-iconLock";title=res.status.message.noreadaccess;_1ea6.add(node,"epi-content--no-access");}else{if(!_1ea9.hasAccess(_1eb2.accessMask,_1eb3.Publish)){_1eb4="epi-iconWarning epi-icon--warning";title=res.status.message.nopublishaccess;}}}return "<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon "+_1eb4+"\" title=\""+title+"\"></span>"+value;};function _1eb5(_1eb6){return function formatter(value,_1eb7,node,_1eb8){var _1eb9=_1eb0(_1eb7),name=value.name||"",_1eba=_1ea7.substitute(res.list.card.modifiedbyuser,{modified:_1eaa.localizedDate(_1eb7.modified),userName:_1eaa.userName(_1eb7.userName)}),_1ebb=(_1ea9.versionLocalizations[_1eb7.status]||"")+(_1eb7.delayPublishUntil?" "+_1eaa.localizedDate(_1eb7.delayPublishUntil):""),map,_1ebc=_1eb7.typeIdentifier;if(!_1ea9.hasAccess(_1eb7.accessMask,_1ea9.accessLevel.Read)){name=res.status.message.notavailable;_1ebb=res.status.message.insufficient;_1eba="";_1ebc="";}if(_1eb7.isDeleted){_1ebb=_1eab.versionnotfound;}map={iconResizer:_1eb7.thumbnailUrl?"epi-card__icon epi-card__icon--thumbnailresizer":"epi-card__icon",icon:_1eb7.thumbnailUrl?_1eaa.thumbnail(_1eb7.thumbnailUrl):_1ebc&&_1eaa.contentIcon(_1ebc," epi-icon--large")||"",name:_1ea8.encode(name,_1ea8.html),nameTooltip:_1ea8.encode(_1eaf(_1eb7)||"",_1ea8.html),statusIcon:_1eb1("",_1eb7,node,_1eb8),status:_1ebb,menu:_1eaa.menu({title:_1eac.action.options}),cardTitle:_1eba,cardTitleTooltip:res.list.card.lastmodified,contentTypeDescription:_1eaa.contentTypeDescription(_1ebc)||"",languageBranch:_1eb9&&_1eb9.language||"",languageBranchClass:_1eb9&&_1eb9.language?"epi-card__language-branch":"epi-card__language-branch--hidden",commentsClass:_1eb7.hasComments?"":"dijitHidden",commentsTooltip:res.list.card.hascomments};_1ea6.add(node,_1eb6);return _1ea7.substitute(_1ead,map);};};_1eae={contentLanguage:null,languageSelector:_1eb0,titleSelector:_1eaf,statusFormatter:_1eb1,card:[_1eb5("epi-card")],"card-compact":[_1eb5("epi-card epi-card--compact")]};return _1eae;});},"url:epi-cms/dgrid/templates/ListItem.html":"<div class=\"epi-mo\">\r\n    <div class=\"epi-mo--img\">\r\n        <div class=\"dijitIcon ${iconResizer}\">${icon}</div>\r\n    </div>\r\n    <div class=\"epi-mo--body\">\r\n        <div class=\"epi-card__menu\">\r\n            ${menu}\r\n        </div>\r\n        <span class=\"epi-secondaryText dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\r\n        <div class=\"epi-card__info\">\r\n            <div class=\"dijitInline\">\r\n                <span class=\"epi-card__title\" title=\"${cardTitleTooltip}\">${cardTitle}</span>\r\n                <span class=\"epi-secondaryText\">\r\n                    ${contentTypeDescription}\r\n                    <span class=\"dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <div class=\"dijitInline epi-card__title--ellipsis-wrapper\">\r\n            <div>\r\n                <span class=\"dijitInline epi-card__title dojoxEllipsis\" title=\"${nameTooltip}\">${name}</span>\r\n            </div>\r\n            ${statusIcon}<span class=\"epi-secondaryText\">${status}</span>\r\n            <span class=\"dijitInline dijitIcon epi-iconBubble epi-icon--warning ${commentsClass}\" title=\"${commentsTooltip}\"></span>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/project/viewmodels/OverviewViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/project/command/RefreshProjectItems","epi-cms/project/command/ToggleProjectActivities","./_ProjectViewModel","./ActivityFeedViewModel","./ProjectCommentViewModel","epi/i18n!epi/nls/episerver.cms.components.project.overview.eventfeed"],function(_1ebd,lang,topic,when,_1ebe,_1ebf,_1ec0,_1ec1,_1ec2,_1ec3,_1ec4){return _1ebd([_1ec1],{contextHistory:null,isProjectOverviewActive:false,_sortOrderProfileKey:"epi.project-overview-sort-order",_isActivitiesVisibleProfileKey:"epi.project-overview-is-activities-visible",postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_1ebe.resolve("epi.cms.BackContextHistory");this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this.projectOverviewChanged)));this.activityFeedModel=new _1ec2({noQueryMessage:_1ec4.noquerymessage,noAccessMessage:_1ec4.noaccessmessage,activitiesStore:this.activitiesStore});this.projectCommentFeedModel=new _1ec3({noQueryMessage:_1ec4.noquerymessage,activitiesStore:this.activitiesStore});},contextChanged:function(_1ec5,_1ec6){this.inherited(arguments);if(_1ec5&&_1ec5.type==="epi.cms.project"){var _1ec7=parseInt(_1ec5.id,10);when(this.projectStore.refresh(_1ec7)).then(this.set.bind(this,"selectedProject"));}else{this.set("selectedProject",null);}},projectOverviewChanged:function(_1ec8){var _1ec9=this.get("isProjectOverviewActive"),_1eca;if(_1ec9){if(_1ec8&&_1ec8.id){_1eca="epi.cms.project:///"+_1ec8.id;topic.publish("/epi/shell/context/request",{uri:_1eca},{sender:this});}else{this.requestPreviousContext();}}},requestPreviousContext:function(){this.contextHistory.closeAndNavigateBack(this);},_createProjectCommands:function(){var _1ecb=this.inherited(arguments);_1ecb.refreshProject=new _1ebf({model:this,category:"project-comments",order:120});return _1ecb;},_createProjectItemCommands:function(){var _1ecc=this.inherited(arguments);_1ecc.toggleProjectActivities=new _1ec0({model:this,order:100});return _1ecc;},updateActivityFeed:function(_1ecd){this.activityFeedModel.set({selectedProjectId:this.selectedProject&&this.selectedProject.id,selectedProjectItems:_1ecd});},_selectedProjectSetter:function(_1ece){this.inherited(arguments);this._updateProjectFeedViewModel(_1ece);},_updateSelectedProjectDependencies:function(_1ecf){this.inherited(arguments);this._updateProjectFeedViewModel(_1ecf);},_updateProjectFeedViewModel:function(_1ed0){this.projectCommentFeedModel.set({placeholderName:_1ed0&&_1ed0.name,selectedProjectId:_1ed0&&_1ed0.id});}});});},"epi-cms/project/command/RefreshProjectItems":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1ed1,_1ed2,res){return _1ed1([_1ed2],{label:res.refresh,iconClass:"epi-iconReload",category:"projectButton",canExecute:true,_execute:function(){this.model.refreshProject();this.model.refreshActivities();}});});},"epi-cms/project/command/_ProjectCommand":function(){define(["dojo/_base/declare","epi/shell/command/_PropertyWatchCommand"],function(_1ed3,_1ed4){return _1ed3([_1ed4],{propertiesToWatch:["selectedProject"],_onPropertyChanged:function(){}});});},"epi-cms/project/viewmodels/_ProjectViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/dom-class","dojo/promise/all","dojo/when","dojo/string","dijit/Destroyable","epi/epi","epi/datetime","epi/dependency","epi/username","epi/shell/_ContextMixin","epi/shell/xhr/errorHandler","epi-cms/plugin-area/project-overview","../../contentediting/ContentActionSupport","epi/shell/command/withConfirmation","../command/AddProject","../command/PublishProject","../command/EditProjectItem","../command/ReadyForReviewProjectItem","../command/ReadyToPublishProjectItem","../command/RefreshProjectItems","../command/RemoveProject","../command/RemoveProjectItem","../command/RemoveProjectScheduling","../command/RenameProject","../command/SortProjectItems","../command/ScheduleProject","epi/i18n!epi/nls/episerver.cms.components.project","epi/i18n!epi/nls/episerver.shared.action"],function(_1ed5,lang,_1ed6,_1ed7,_1ed8,_1ed9,topic,_1eda,all,when,_1edb,_1edc,epi,_1edd,_1ede,_1edf,_1ee0,_1ee1,_1ee2,_1ee3,_1ee4,_1ee5,_1ee6,_1ee7,_1ee8,_1ee9,_1eea,_1eeb,_1eec,_1eed,_1eee,_1eef,_1ef0,res,_1ef1){return _1ed5([_1ed9,_1edc,_1ed8,_1ee0],{commands:null,namedCommands:null,created:"",createdBy:"",profile:null,contentLanguage:"",dndEnabled:false,isActivitiesVisible:false,projectStore:null,projectSortOrder:null,projectItemStore:null,projectItemQuery:null,activitiesStore:null,projectItemSortOrder:null,projectStatus:"",projectName:"",notificationMessage:"",selectedProject:null,selectedProjectItems:null,projectItemCountMessage:"",placeholderState:"noProjects",_sortOrderProfileKey:"epi.project-sort-order",_isActivitiesVisibleProfileKey:"epi.project-is-activities-visible",_messages:null,constructor:function(){this.projectItemSortOrder=[];this.projectSortOrder=[{attribute:"created",descending:true}];this.selectedProjectItems=[];this.own(_1ee2.on("added, removed",this._updateCommands.bind(this)));},postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1ede.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1ede.resolve("epi.storeregistry").get("epi.cms.project");this.projectItemStore=this.projectItemStore||_1ede.resolve("epi.storeregistry").get("epi.cms.project.item");this.activitiesStore=this.activitiesStore||_1ede.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_1ede.resolve("epi.shell.Profile");this._messages=this.isProjectModeEnabled()?res.status.message:lang.mixin({},res.status.message,res.status["messagelegacy"]);this._createCommands();this.own(this.projectService.on("project-item-updated",lang.hitch(this,this._updateSelectedItems)),this.projectService.on("project-updated",lang.hitch(this,this._projectUpdated)));},initialize:function(){return all(when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _1ef2=this._findSortOption("key",sort)||this.namedCommands.sortProjectItems.options[0];this._changeAttrValue("projectItemSortOrder",_1ef2.value);})),when(this._loadSelectedProject(),lang.hitch(this,function(_1ef3){this._updateSelectedProjectDependencies(_1ef3);this._changeAttrValue("selectedProject",_1ef3);})),when(this.profile.getContentLanguage(),lang.hitch(this,function(_1ef4){this.set("contentLanguage",_1ef4);})),when(this.profile.get(this._isActivitiesVisibleProfileKey),lang.hitch(this,function(_1ef5){if(typeof _1ef5==="boolean"){this.set("isActivitiesVisible",_1ef5);}})));},isProjectModeEnabled:function(){return this.projectService.isProjectModeEnabled;},getCommands:function(){return this.commands;},addProject:function(_1ef6){this.projectStore.add(_1ef6).then(lang.hitch(this,function(value){this.set("selectedProject",value);})).otherwise(_1ee1.forXhr);},getProject:function(){return this.get("selectedProject");},updateProject:function(_1ef7){this.projectStore.put(_1ef7).then(lang.hitch(this,"set","selectedProject")).otherwise(_1ee1.forXhr);},publishProject:function(_1ef8,_1ef9){var self=this;return this.projectService.publishProject(_1ef8,_1ef9).then(function(_1efa){return self._updateSelectedProjectAndRefreshContextRequest(_1efa).then(function(){return _1efa;});});},reactivateProject:function(_1efb){var self=this;if(isNaN(_1efb)){throw new Error("The given project ID is not a number.");}return this.projectService.reactivateProject(_1efb).then(function(_1efc){return self._updateSelectedProjectAndRefreshContextRequest(_1efc).then(function(){return _1efc;});});},refreshActivities:function(){this.emit("refresh-activities");},refreshProject:function(_1efd){var self=this;if(_1efd===undefined){_1efd=true;}if(this.selectedProject){return this.projectStore.refresh(this.selectedProject.id).then(function(value){self.set("selectedProject",value);if(_1efd){self.emit("refresh");}return value;},function(ex){self.set("selectedProject",null);});}if(_1efd){this.emit("refresh");}},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1ed7().resolve();}return store.remove(this.selectedProject.id).then(function(){self.set("selectedProject",null);});},canAddContent:function(_1efe){var _1eff=this.get("selectedProject").id;return this.projectService.canAddContent(_1eff,_1efe);},canPublishProject:function(_1f00){var _1f01;function _1f02(){return Object.keys(_1f01).some(function(key){if(key.indexOf("nopublishaccess")>-1){if(_1f01[key]>0){return true;}}});};function _1f03(state){return _1f01[state]>0;};_1f00=_1f00||this.selectedProject;_1f01=_1f00&&_1f00.itemStatusCount;if(this.isProjectModeEnabled()){return !!_1f00&&_1f00.itemStatusCount.checkedin>0;}else{return !!_1f00&&(_1f00.status==="active"||_1f00.status==="publishfailed")&&!_1f02()&&!_1f03("notcreated")&&!_1f03("rejected")&&!_1f03("checkedout")&&(_1f03("checkedin")||_1f03("published")||_1f03("previouslypublished")||_1f03("delayedpublish"));}},addProjectItems:function(_1f04,_1f05){var _1f06=this.get("selectedProject");_1f05=_1f05||(_1f06&&_1f06.id);if(!_1f05){throw new Error("If no projectId is provided a selectedProject must be set in the context");}return this.projectService.addProjectItems(_1f05,_1f04);},removeSelectedProjectItems:function(){var _1f07=this.projectService.removeProjectItems(this.selectedProjectItems);_1f07.then(function(){this.emit("item-removed");}.bind(this));return _1f07;},markProjectItemsAsReadyForReview:function(_1f08){return this._setStatusOnProjectItems("markAsReadyForReview",{comment:_1f08});},markProjectItemsAsReadyToPublish:function(){this._setStatusOnProjectItems("markAsReadyToPublish");},_setStatusOnProjectItems:function(_1f09,_1f0a){if(!this.selectedProjectItems.length){return new _1ed7().resolve();}var self=this;var _1f0b=this.selectedProjectItems.map(function(item){return item.id;});return this.projectService[_1f09](_1f0b,_1f0a).then(function(){return when(self.getCurrentContext());}).then(function(ctx){var _1f0c;self.selectedProjectItems.some(function(item){if(item.contentLink===ctx.id){_1f0c=item;return true;}});if(_1f0c){self.requestContextChange(_1f0c.contentLink);}});},requestContextChange:function(_1f0d){var _1f0e=_1f0d.uri?_1f0d:{uri:"epi.cms.contentdata:///"+_1f0d};topic.publish("/epi/shell/context/request",_1f0e,{sender:this});},updateActivityFeed:function(_1f0f){},_projectUpdated:function(_1f10){if(this.selectedProject&&this.selectedProject.id===_1f10.id){this.set("selectedProject",_1f10);}},_updateSelectedItems:function(item){var _1f11=this.selectedProjectItems.length;for(var i=0;i<_1f11;i++){if(this.selectedProjectItems[i].id===item.id){this.selectedProjectItems[i]=item;this.set("selectedProjectItems",this.selectedProjectItems);this.emit("selected-project-items-updated",this.selectedProjectItems);break;}}},onCommandsChanged:function(name,_1f12,added){},_updateCommands:function(){var _1f13=this.commands;this._createCommands();this.onCommandsChanged("commands",_1f13,this.commands);},_createCommands:function(){var _1f14=this._getOrCreateNamedCommands();var _1f15=Object.keys(_1f14).map(function(key){return _1f14[key];});_1ee2.get().forEach(function(_1f16){this.own(_1f16);_1f15.push(_1f16);}.bind(this));_1f15=_1f15.sort(function(a,b){return a.order-b.order;});this.set("commands",_1f15);},_getOrCreateNamedCommands:function(){if(this.namedCommands){return this.namedCommands;}var _1f17=Object.assign(this._createProjectCommands(),this._createProjectItemCommands());this.own.apply(this,_1f17);this.set("namedCommands",_1f17);return _1f17;},_createProjectCommands:function(){return {addProject:new _1ee5({model:this,order:10}),renameProject:new _1eee({model:this,order:20}),removeProject:new _1eeb({model:this,order:30,store:this.projectStore}),publishProject:new _1ee6({model:this,order:40}),scheduleProject:new _1ef0({model:this,order:50}),removeProjectScheduling:_1ee4(new _1eed({model:this,order:60}),null,{title:res.command.removeschedulingprojectitem.title,description:res.command.removeschedulingprojectitem.confirmation,confirmActionText:_1ef1.remove,cancelActionText:_1ef1.cancel})};},_createProjectItemCommands:function(){return {readyForReviewProjectItem:new _1ee8({model:this,order:90}),readyToPublishProjectItem:new _1ee9({model:this,order:100}),editProjectItem:new _1ee7({model:this,order:110}),removeProjectItem:_1ee4(new _1eec({model:this,order:120}),null,{title:res.command.removeprojectitem.label,description:res.command.removeprojectitem.confirmation,confirmActionText:_1ef1.remove,cancelActionText:_1ef1.cancel}),sortProjectItems:new _1eef({model:this,order:130}),refreshProjectItems:new _1eea({model:this,order:140})};},_loadSelectedProject:function(){return this.projectService.getCurrentProject();},_persistSelectedProject:function(_1f18){this.profile.set(this._selectedProjectProfileKey,_1f18&&_1f18.id,{location:"server"});},_persistSortOrder:function(_1f19){var _1f1a=this._findSortOption("value",_1f19),key=_1f1a&&_1f1a.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_persistIsActivitiesPanelVisible:function(_1f1b){this.profile.set(this._isActivitiesVisibleProfileKey,_1f1b,{location:"server"});},_findSortOption:function(key,term){var _1f1c=this.namedCommands.sortProjectItems.options,_1f1d=null;term&&_1f1c.some(function(item){if(term===item[key]){_1f1d=item;return true;}});return _1f1d;},_updateSelectedProjectDependencies:function(_1f1e){var _1f1f="",_1f20="",_1f21="",_1f22=false,_1f23="",_1f24=null,_1f25="",_1f26="",_1f27=this.isProjectModeEnabled();if(_1f1e){_1f1f=_1edd.toUserFriendlyString(new Date(_1f1e.created));_1f20=_1edf.toUserFriendlyString(_1f1e.createdBy,null,true);_1f22=(_1f27&&_1f1e.status!=="publishing")||_1f1e.status==="active"||_1f1e.status==="publishfailed";_1f24={projectId:_1f1e.id};_1f26=_1f1e.name;if(!this.canPublishProject(_1f1e)||_1f27){_1f25=this._messages[_1f1e.status]||"";if(_1f1e.status==="delayedpublished"&&!_1f27){_1f21=_1edd.toUserFriendlyString(_1f1e.delayPublishUntil);_1f25=lang.replace(_1f25,{date:_1f21});_1f23=lang.replace(res.status.state.delayedpublished,{delayPublishUntil:_1f21});}}if(_1f1e.status==="publishfailed"){_1f23=this._getProjectFailedMessage(_1f1e);}}this.set({created:_1f1f,createdBy:_1f20,dndEnabled:_1f22,notificationMessage:_1f23,projectItemQuery:_1f24,projectStatus:_1f25,projectName:_1f26});},_getProjectFailedMessage:function(_1f28){var _1f29=0,_1f2a="",_1f2b=res.notifications.publishfailed;_1f29=this._getUnpublishedItems(_1f28.itemStatusCount);if(_1f29>0){_1f2a=lang.replace(_1f29>1?_1f2b.notificationtextmultipleitems:_1f2b.notificationtextsingleitem,{failedItemsCount:_1f29});}return _1f2a;},_getUnpublishedItems:function(_1f2c){var count=0;Object.keys(_1f2c).forEach(function(key){if(key.indexOf("checkedin")===0){count+=_1f2c[key];}});return count;},_isActivitiesVisibleSetter:function(_1f2d){if(_1f2d===this.isActivitiesVisible){return;}this.isActivitiesVisible=_1f2d;this._persistIsActivitiesPanelVisible(_1f2d);},_selectedProjectSetter:function(_1f2e){_1f2e=lang.clone(_1f2e);if(epi.areEqual(this.selectedProject,_1f2e)){return;}if(this.selectedProject&&(!_1f2e||this.selectedProject.id!==_1f2e.id)){this.emit("clear-selection");}this.selectedProject=_1f2e;this._updateSelectedProjectDependencies(_1f2e);},_projectItemSortOrderSetter:function(_1f2f){if(_1f2f&&_1f2f===this.projectItemSortOrder){return;}this.projectItemSortOrder=_1f2f;this._persistSortOrder(_1f2f);},_updateSelectedProjectAndRefreshContextRequest:function(_1f30){var self=this;self.set("selectedProject",_1f30);return when(this.getCurrentContext()).then(function(_1f31){self.requestContextChange(_1f31);return _1f31;});},_selectedProjectItemsSetter:function(_1f32){this.selectedProjectItems=_1f32;this._updateProjectCountMessage(_1f32);},_updateProjectCountMessage:function(_1f33){var items=_1f33&&_1f33.length>0?_1f33.length:null,_1f34="";function _1f35(count,_1f36){_1f34=_1edb.substitute(res.notifications.selecteditems[_1f36],{count:count});};if(items){if(items===1){_1f35(items,"singular");}else{if(items>1){_1f35(items,"plural");}}}this.set("projectItemCountMessage",_1f34);}});});},"epi-cms/plugin-area/project-overview":function(){define(["epi/PluginArea"],function(_1f37){var _1f38=new _1f37("epi-cms/project-overview/commands[]");return _1f38;});},"epi-cms/project/command/AddProject":function(){define(["dojo/_base/declare","./_ProjectCommand","epi-cms/project/ProjectDialogContent","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.newproject"],function(_1f39,_1f3a,_1f3b,_1f3c,res){return _1f39([_1f3a,_1f3c],{label:res.label,title:res.label,canExecute:true,iconClass:"epi-iconPlus",defaultActionsVisible:true,dialogClass:"epi-dialog-landscape",dialogContentClass:_1f3b,onDialogExecute:function(){this.model.addProject(this.dialogContent.get("value"));},_execute:function(){this.showDialog();}});});},"epi-cms/project/ProjectDialogContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","epi/dependency","epi/shell/widget/FormContainer","epi/shell/widget/dialog/_DialogContentMixin"],function(_1f3d,lang,keys,_1f3e,_1f3f,_1f40){return _1f3d([_1f3f,_1f40],{_metadataManager:null,postMixInProperties:function(){this.inherited(arguments);if(!this.metadata){var _1f41=this._metadataManager||_1f3e.resolve("epi.shell.MetadataManager");this.metadata=_1f41.getMetadataForType("EPiServer.Cms.Shell.UI.Rest.Projects.Internal.Models.ProjectViewModel");}},postCreate:function(){this.inherited(arguments);this.on("keypress",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&this.isValid()){this.executeDialog();}}));}});});},"epi-cms/project/command/PublishProject":function(){define(["dojo/_base/declare","dojo/string","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.publishproject"],function(_1f42,_1f43,_1f44,res){return _1f42([_1f44],{category:"publishmenu-primary",label:res.label,isExecuting:false,_execute:function(){var model=this.model,self=this;self.set("isExecuting",true);model.publishProject(this.model.selectedProject.id).then(function(){self.set("isExecuting",false);},function(){self.set("isExecuting",false);});},_onPropertyChanged:function(){var _1f45=this.model.selectedProject,_1f46=_1f45&&_1f45.status,_1f47=this.model.canPublishProject(_1f45),_1f48=this.model.isProjectModeEnabled();this.set({canExecute:_1f47,isAvailable:_1f48||(_1f46!=="published"&&_1f46!=="delayedpublished"),isExecuting:_1f46==="publishing"});},_updateLabel:function(){var _1f49=this.model&&this.model.selectedProject,_1f4a=(_1f49&&_1f49.itemStatusCount.checkedin)||0,data={count:_1f4a>0?_1f4a+" ":""},label;if(this.isExecuting){label=_1f4a===1?res.labelexecuting.singular:res.labelexecuting.plural;}else{if(!this.isAvailable){label=res.labelexecuted;}else{label=_1f4a===1?res.label.singular:res.label.plural;}}this.set("label",_1f43.substitute(label,data));},_isExecutingSetter:function(value){this.isExecuting=value;this._updateLabel();}});});},"epi-cms/project/command/EditProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1f4b,_1f4c,_1f4d,_1f4e){return _1f4b([_1f4d],{category:"menuWithSeparator",iconClass:"epi-iconPen",label:_1f4e.edit,propertiesToWatch:["selectedProjectItems"],_execute:function(){var _1f4f=this.model.selectedProjectItems[0];this.model.requestContextChange(_1f4f.contentLink);},_onPropertyChanged:function(){var _1f50=false,_1f51;var items=this.model&&this.model.selectedProjectItems;this.set("label",_1f4e.edit);this.set("iconClass","epi-iconPen");if(items&&items.length===1){_1f51=_1f4c.getPermissionMap(items[0].accessMask);if(_1f51.Read&&!_1f51.Edit){_1f50=_1f51.Read;this.set("label",_1f4e.view);this.set("iconClass","epi-iconSearch");}else{_1f50=_1f51.Edit;}}this.set("canExecute",!!_1f50);}});});},"epi-cms/project/command/ReadyForReviewProjectItem":function(){define(["dojo/_base/declare","dojo/Deferred","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readyforreviewprojectitem","epi-cms/content-approval/command/ReadyForReview"],function(_1f52,_1f53,_1f54,_1f55,_1f56){return _1f52([_1f56],{category:"itemContext",label:_1f55.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){var _1f57=this.model.selectedProjectItems.some(function(item){return item.isStartCommentRequired;});if(_1f57){this._executeDeferred=new _1f53();this.showDialog();return this._executeDeferred.promise;}else{return this._executeServiceMethod();}},_executeServiceMethod:function(_1f58){return this.model.markProjectItemsAsReadyForReview(_1f58);},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1f59=_1f54.versionStatus,_1f5a=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&item.hasApprovalDefinition&&(item.status===_1f59.CheckedOut||item.status===_1f59.Rejected)&&_1f54.hasAccess(item.accessMask,_1f54.accessLevel.Edit);});this.set("canExecute",!!_1f5a);}});});},"epi-cms/project/command/ReadyToPublishProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readytopublishprojectitem","epi-cms/project/command/_ProjectCommand"],function(_1f5b,_1f5c,_1f5d,_1f5e){return _1f5b([_1f5e],{category:"menuWithSeparator",label:_1f5d.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.markProjectItemsAsReadyToPublish();},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1f5f=_1f5c.versionStatus,_1f60=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&!item.hasApprovalDefinition&&(item.status===_1f5f.CheckedOut||item.status===_1f5f.Rejected)&&_1f5c.hasAccess(item.accessMask,_1f5c.accessLevel.Edit);});this.set("canExecute",!!_1f60);}});});},"epi-cms/project/command/RemoveProject":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","./RemoveProjectConfirmation","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","./_ProjectCommand"],function(_1f61,lang,on,when,_1f62,res,_1f63){return _1f61([_1f63],{category:"context",label:res.label,iconClass:"epi-iconTrash",_execute:function(){var _1f64=this.model.getProject();this.model.projectService.hasScheduledProjectItems(_1f64.id).then(this._createRemoveProjectConfirmationDialog.bind(this));},_createRemoveProjectConfirmationDialog:function(_1f65){var _1f66=this.model.getProject().status==="delayedpublished",_1f67=new _1f62({isScheduledProject:_1f65&&_1f66});on.once(_1f67,"execute",lang.hitch(this,"_removeProject"));_1f67.show();},_removeProject:function(_1f68){var model=this.model,_1f69=model.getProject(),_1f6a=!_1f68&&model.reactivateProject(_1f69.id);when(_1f6a).then(function(){return model.removeProject();}).otherwise(function(error){console.error("An error occured while removing the project.",error);});},_onPropertyChanged:function(){var _1f6b=this.model.getProject();this.set("canExecute",!!_1f6b&&!_1f6b.isDeleted);}});});},"epi-cms/project/command/RemoveProjectConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","epi/i18n!epi/nls/episerver.shared.action","epi/shell/widget/dialog/Confirmation"],function(_1f6c,lang,_1f6d,_1f6e,_1f6f){return _1f6c([_1f6f],{isScheduledProject:false,dialogClass:"epi-dialog-confirm epi-dialog--wide",postMixInProperties:function(){this.inherited(arguments);this.title=this.isScheduledProject?_1f6d.scheduledlabel:_1f6d.label;this.description=this.isScheduledProject?_1f6d.scheduledconfirmation:_1f6d.confirmation;},getActions:function(){var _1f70={name:"keepScheduling",label:this.isScheduledProject?_1f6d.deleteandkeepscheduling:_1f6e.deletelabel,action:lang.hitch(this,"onExecute",true)},_1f71={name:"removeScheduling",label:_1f6d.deleteandremovescheduling,action:lang.hitch(this,"onExecute",false)},_1f72={name:"cancel",label:_1f6e.cancel,action:lang.hitch(this,this.onCancel),settings:{"class":"Salt",firstFocusable:true}};return this.isScheduledProject?[_1f70,_1f71,_1f72]:[_1f70,_1f72];}});});},"epi-cms/project/command/RemoveProjectItem":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.removeprojectitem"],function(_1f73,_1f74,res){return _1f73([_1f74],{category:"itemContext",label:res.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.removeSelectedProjectItems();},_onPropertyChanged:function(){var self=this,model=this.model,_1f75=model&&model.selectedProjectItems&&model.selectedProjectItems.length,_1f76=model.selectedProject;this.set("canExecute",false);this.model.projectService.getCurrentProject().then(function(_1f77){var _1f78=_1f76&&(_1f76.status==="active"||_1f76.status==="publishfailed"||_1f77);self.set("canExecute",!!(_1f75&&_1f78));});}});});},"epi-cms/project/command/RemoveProjectScheduling":function(){define(["dojo/_base/declare","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1f79,_1f7a,res){return _1f79([_1f7a],{category:"publishmenu",iconClass:"epi-iconClose",label:res.removeschedulingprojectitem.label,postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.removeschedulingproject.label);}},_execute:function(){var model=this.model;return model.reactivateProject(model.selectedProject.id);},_onPropertyChanged:function(){var _1f7b=this.model.selectedProject,_1f7c;_1f7c=!!_1f7b&&(this.model.isProjectModeEnabled()?_1f7b.itemStatusCount.delayedpublish>0:_1f7b.status==="delayedpublished");this.set("canExecute",_1f7c);this.set("isAvailable",_1f7c);}});});},"epi-cms/project/command/RenameProject":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/project/ProjectDialogContent","epi-cms/project/command/_ProjectCommand","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.renameproject"],function(_1f7d,lang,_1f7e,_1f7f,_1f80,_1f81){return _1f7d([_1f7f,_1f80],{category:"context",dialogClass:"epi-dialog-landscape",dialogContentClass:_1f7e,label:_1f81.label,title:_1f81.label,iconClass:"epi-iconRename",onDialogExecute:function(){var value=lang.mixin(this.value,this.dialogContent.get("value"));this.model.updateProject(value);},_execute:function(){this.showDialog();},_onPropertyChanged:function(){var _1f82=this.model.getProject();this.set("canExecute",!!_1f82&&!_1f82.isDeleted);this.set("value",lang.clone(_1f82));}});});},"epi-cms/project/command/SortProjectItems":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort","epi/shell/command/OptionCommand"],function(_1f83,_1f84,_1f85){return _1f83([_1f85],{category:"projectButton",iconClass:"epi-iconSort",label:_1f84.label,options:null,property:"projectItemSortOrder",constructor:function(){this.options=[{label:_1f84.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_1f84.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_1f84.status,key:"+Status",value:[{attribute:"status",descending:false},{attribute:"name",descending:false}]},{label:_1f84.type,key:"+PrimaryTypeIdentifier",value:[{attribute:"primaryTypeIdentifier",descending:false},{attribute:"name",descending:false}]},{label:_1f84.modifieddescending,key:"-Modified",value:[{attribute:"modified",descending:true},{attribute:"name",descending:false}]},{label:_1f84.modifiedascending,key:"+Modified",value:[{attribute:"modified",descending:false},{attribute:"name",descending:false}]}];}});});},"epi-cms/project/command/ScheduleProject":function(){define(["dojo/_base/declare","./_ProjectCommand","../ProjectSchedulingDialog","../ProjectSchedulingDialogViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1f86,_1f87,_1f88,_1f89,res){return _1f86([_1f87],{category:"publishmenu",label:res.scheduleprojectitem.label,iconClass:"epi-iconClock",postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.scheduleproject.label);}},_execute:function(){var model=this.model,_1f8a=model.selectedProject,_1f8b=new _1f89({title:_1f8a.name,query:{projectId:_1f8a.id,scheduled:true}}),_1f8c=new _1f88({model:_1f8b});_1f8c.on("execute",function(){model.publishProject(_1f8a.id,_1f8b.dateValue);});_1f8c.show();},_onPropertyChanged:function(){this.set("canExecute",this.model.canPublishProject());this._updateIsAvailable();},_updateIsAvailable:function(){var _1f8d,_1f8e=this.model.selectedProject,_1f8f=_1f8e&&_1f8e.status;if(this.model.isProjectModeEnabled()){_1f8d=true;}else{_1f8d=_1f8f!=="published"&&_1f8f!=="delayedpublished";}this.set("isAvailable",_1f8d);}});});},"epi-cms/project/ProjectSchedulingDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","epi-cms/contentediting/ScheduledPublishSelector","epi/shell/widget/DelayableStandby","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject"],function(_1f90,lang,_1f91,on,_1f92,_1f93,_1f94,res){return _1f90([_1f94],{dialogClass:"epi-dialog-contentReferences",title:res.label,defaultActionsVisible:false,_contentLoaded:null,constructor:function(){this._contentLoaded=new _1f91();},buildRendering:function(){this.inherited(arguments);this.own(this.content=new _1f92({model:this.model}),this._standby=new _1f93({target:document.body,zIndex:999}).placeAt(document.body),on.once(this.content,"contentreferencegrid-loading-complete",this._contentLoaded.resolve));},show:function(){var _1f95=arguments;if(!this._started){this.startup();}this._standby.show();return this._contentLoaded.then(lang.hitch(this,function(){this._standby.hide();return this.inherited(_1f95);}));}});});},"epi-cms/project/ProjectSchedulingDialogViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/dependency","dojo/topic","epi-cms/dgrid/formatters","./ContentReferenceGridModel","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject","epi/i18n!epi/cms/nls/episerver.cms.components.project.contentreferencelist","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_1f96,lang,_1f97,topic,_1f98,_1f99,_1f9a,_1f9b,_1f9c,_1f9d,res){return _1f96([_1f99,_1f9a],{dateLabel:res.publishchangeson,notificationText:res.alreadyscheduleditems,_totalItemsSetter:function(value){this.totalItems=value;if(value){var _1f9e=(value===1?_1f9c.itemintotal:_1f9c.itemsintotal);this.set("resultSummary",lang.replace(_1f9e,[value]));}},onItemClicked:function(item){topic.publish("/epi/shell/context/request",{uri:item.contentUri});},postscript:function(){this.inherited(arguments);this.store=this.store||_1f97.resolve("epi.storeregistry").get("epi.cms.project.item");this.columns={primaryTypeIdentifier:{label:"",className:"epi-grid-column--snug epi-cursor--default",formatter:_1f98.contentIcon},name:{label:"",className:"epi-grid--30 epi-cursor--default"},path:{label:"",formatter:_1f98.path,className:"epi-grid--35 epi-cursor--default"},delayPublishUntil:{label:"",formatter:_1f98.localizedDate,className:"epi-grid--25 epi-grid-column--centered epi-cursor--default dgrid-column-treePath"},contentUri:{formatter:function(){return "<a class=\"epi-visibleLink\">"+_1f9d.view+"</a>";},className:"dgrid-column-view"}};}});});},"epi-cms/project/ContentReferenceGridModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_1f9f,_1fa0){return _1f9f([_1fa0],{onItemClicked:function(item){},resultSummary:"",notificationText:"",store:null,query:null,columns:null,totalItems:null});});},"epi-cms/project/viewmodels/ActivityFeedViewModel":function(){define(["dojo/_base/declare","./_ProjectFeedViewModel"],function(_1fa1,_1fa2){return _1fa1([_1fa2],{_contentLink:null,postscript:function(){this.inherited(arguments);this.set("noDataMessage",this.noQueryMessage);},_selectedProjectItemsSetter:function(_1fa3){_1fa3=_1fa3||[];var _1fa4=_1fa3.filter(function(item){return !!item.contentLink;});var _1fa5=_1fa3.length===1&&_1fa4.length===1;this.set("isSingleItemSelected",_1fa5);var _1fa6=_1fa5?_1fa4[0].name:"";this.set("placeholderName",_1fa6);this._contentLink=_1fa5?_1fa4[0].contentLink:null;this.set("noDataMessage",_1fa3.length?this.noAccessMessage:this.noQueryMessage);this.set("store",_1fa4.length?this.activitiesStore:null);var query={contentReferences:_1fa4.map(function(item){return item.contentLink;}),projectId:this.selectedProjectId};this.set("query",_1fa4.length?query:null);}});});},"epi-cms/project/viewmodels/ProjectCommentViewModel":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.activities.commentfeed","./_ProjectFeedViewModel"],function(_1fa7,_1fa8,_1fa9){return _1fa7([_1fa9],{isSingleItemSelected:true,noDataMessage:_1fa8.nodatamessage,_selectedProjectIdSetter:function(_1faa){this.selectedProjectId=_1faa;this.set("store",_1faa?this.activitiesStore:null);this.set("query",{projectId:_1faa,activityType:"ProjectMessageActivity"});}});});},"url:epi-cms/project/templates/Overview.html":"<div class=\"epi-project-overview\">\r\n    <div data-dojo-attach-point=\"toolbar\" class=\"epi-project-overview__toolbar epi-viewHeaderContainer epi-editToolbarMedium\">\r\n        <h2 class=\"dijitInline\">\r\n            <div class=\"dijitInline epi-iconObjectProject epi-icon--large\"></div>\r\n            <span data-dojo-attach-point=\"projectNameNode\"></span>\r\n        </h2>\r\n        <div class=\"epi-project-overview__toolbar__trailing\">\r\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\r\n                 data-dojo-attach-point=\"publishContainer\"\r\n                 data-dojo-props=\"showLabel: true, label: this.res.overview.publishdropdown.label\"\r\n                 data-dojo-attach-event=\"onClick:_publishMenuClickHandler\"\r\n                 class=\"epi-mediumButton epi-button--bold\">\r\n                <span></span>\r\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\r\n                     data-dojo-attach-point=\"publishMenu\"\r\n                     data-dojo-props=\"commandSource: this.model\">\r\n                    <section data-epi-section=\"primarySection\">\r\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\r\n                    </section>\r\n                    <section data-epi-section=\"statusSection\">\r\n                        <ul>\r\n                            <li>\r\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\r\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\r\n                            </li>\r\n                        </ul>\r\n                    </section>\r\n                </div>\r\n            </div>\r\n            <button data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-point=\"closeButton\"\r\n                    data-dojo-attach-event=\"onClick:_close\"\r\n                    data-dojo-props=\"showLabel: true, label: this.res.overview.closebutton.label\"\r\n                    class=\"epi-mediumButton epi-button--bold\"></button>\r\n        </div>\r\n    </div>\r\n\r\n    <div data-dojo-attach-point=\"tabs\" data-dojo-type=\"dijit/layout/TabContainer\">\r\n        <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n             data-dojo-attach-point=\"itemList\"\r\n             data-dojo-props=\"title: this.res.overview.title, commandSource: this.model, res: this.res.overview\">\r\n\r\n                <section data-epi-section=\"toolbarSection\">\r\n                    <div data-dojo-attach-point=\"toolbarTextNode\" class=\"epi-project-item-list__item-count-message-node\"></div>\r\n                    <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n                </section>\r\n                <section data-epi-section=\"activitySection\">\r\n                    <div data-dojo-type=\"epi-cms/activity/ActivityFeed\"\r\n                         data-dojo-attach-point=\"activityFeed\"\r\n                         data-dojo-props=\"model: this.model.activityFeedModel\"></div>\r\n                </section>\r\n        </div>\r\n\r\n        <div data-dojo-type=\"epi-cms/activity/ActivityFeed\"\r\n             data-dojo-attach-point=\"projectComments\"\r\n             data-dojo-props=\"title: this.res.comments.title, model: this.model.projectCommentFeedModel\"\r\n             class=\"epi-project-comment-feed\">\r\n            <div data-dojo-type=\"dijit/Toolbar\"\r\n                 data-dojo-attach-point=\"projectCommentsToolbar\"\r\n                 class=\"epi-project-item-list__toolbar epi-flatToolbar\">\r\n            </div>\r\n         </div>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectItemList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-class","dojo/keys","dojo/on","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/_CssStateMixin","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dgrid/extensions/DijitRegistry","epi","epi/shell/dnd/Target","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi/shell/dgrid/Responsive","epi/shell/widget/_FocusableMixin","epi/shell/widget/_SectionedTemplatedMixin","epi-cms/extension/events","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/WithContextMenu","epi/i18n!epi/cms/nls/episerver.cms.components.project","dojo/text!./templates/ProjectItemList.html"],function(_1fab,lang,_1fac,_1fad,_1fae,keys,on,_1faf,_1fb0,_1fb1,_1fb2,_1fb3,_1fb4,_1fb5,epi,_1fb6,_1fb7,_1fb8,_1fb9,_1fba,_1fbb,_1fbc,_1fbd,_1fbe,res,_1fbf){return _1fab([_1fb0,_1fbb,_1faf,_1fb1,_1fba],{contentLanguage:null,commandProvider:null,dndEnabled:false,sections:["toolbarSection","listContainer","activitySection"],templateString:_1fbf,listItemType:"card",res:res,_listClass:_1fab([_1fb3,_1fb8,_1fb4,_1fb2,_1fbe,_1fb5,_1fb7,_1fb9]),_list:null,_noDataMessageWrapper:"<span class=\"dgrid-no-data__content\">{0}</span>",buildRendering:function(){this.inherited(arguments);this._setupList();},focus:function(){if(this._list){this._list.focus();}},layout:function(){var _1fc0,size;if(!this._contentBox){return;}_1fc0=_1fad.getMarginBox(this.toolbar.domNode).h+_1fad.getMarginBox(this.notificationBarNode).h;size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1fc0});_1fad.setMarginBox(this.listContainer,size);this._list.resize();},clearSelection:function(){this._list.clearSelection();this.emit("selection-changed",{items:[]});},refresh:function(){this._list.refresh({keepScrollPosition:true});},setSelection:function(_1fc1){this.selectItems(_1fc1);this.emit("selection-changed",{items:_1fc1});},selectItems:function(_1fc2){this._list.clearSelection();_1fc2.forEach(function(item){this._list.select(item);},this);},toggleActivities:function(_1fc3){_1fae.toggle(this.domNode,"epi-project-item-list--activities-visible",_1fc3);},updateQuery:function(store,query){var _1fc4=!query&&this.res.noquery?this.res.noquery:this.res.nodata,_1fc5=lang.replace(this._noDataMessageWrapper,[_1fc4]);this._list.set("noDataMessage",_1fc5);if(this._list.store!==store||!epi.areEqual(this._list.query,query)){this._list.set("store",store,query);}},_setupList:function(){var list,_1fc6;_1fbd.contentLanguage=this.contentLanguage;list=new this._listClass({formatters:_1fbd[this.listItemType],cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,refocusOnRefresh:true,responsiveMap:{"epi-card-list--narrow":570}},this.itemListNode);list.contextMenu.addProvider(this.commandSource);this.own(this._list=list,list.on("dgrid-cellfocusin, .dgrid-content:click",lang.hitch(this,function(evt){if(evt.target===list.contentNode){this.clearSelection();}var items=this._getSelectedItems(list);this.emit("selection-changed",{items:items});})),list.on("dgrid-select, dgrid-deselect",lang.hitch(this,function(evt){var items=this._getSelectedItems(list);this.emit("active-items-changed",{items:items});})),list.on(".dgrid-row:dblclick",lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.addKeyHandler(keys.ENTER,lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.on(on.selector(".dgrid-row",_1fbc.keys.del),lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemremove",{item:item});})),_1fc6=new _1fb6(this.overlayNode,{createItemOnDrop:false,allowMultipleItems:true,accept:["episerver.core.icontentdata.reference"]}),_1fac.after(_1fc6,"onDropData",lang.hitch(this,this._onDropData),true));},_getSelectedItems:function(list){var items=[];Object.keys(list.selection).forEach(function(key){if(list.selection[key]){var item=list.row(key).data;items.push(item);}});return items;},_onDropData:function(_1fc7){var items=_1fc7.map(function(item){return item.data;});this.emit("itemsdropped",{items:items});},_setDndEnabledAttr:function(value){this._set("dndEnabled",value);_1fae.toggle(this.overlayNode,"dijitHidden",!value);},_setNotificationMessageAttr:function(value){this.notificationTextNode.textContent=value;_1fae.toggle(this.notificationBarNode,"dijitHidden",!value);this.layout();},_setSortOrderAttr:function(value){if(this._list.get("sort")!==value){this._list.set("sort",value);}},_setContentLanguageAttr:function(value){this._set("contentLanguage",value);_1fbd.contentLanguage=value;}});});},"epi/shell/dgrid/Responsive":function(){define("epi/shell/dgrid/Responsive",["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry"],function(_1fc8,_1fc9,_1fca){return _1fc8([],{currentResponsiveClass:"",responsiveMap:null,resize:function(){this.inherited(arguments);var _1fcb=Infinity,_1fcc=_1fca.getContentBox(this.domNode).w,_1fcd="",_1fce=this.responsiveMap;if(_1fce){Object.keys(_1fce).forEach(function(key){var _1fcf=_1fce[key];if(_1fcc<=_1fcf&&_1fcf<_1fcb){_1fcb=_1fcf;_1fcd=key;}});_1fc9.replace(this.domNode,_1fcd,this.currentResponsiveClass);this.currentResponsiveClass=_1fcd;}}});});},"epi/shell/widget/_SectionedTemplatedMixin":function(){define("epi/shell/widget/_SectionedTemplatedMixin",["dojo/_base/declare","dojo/query","dojo/string","dijit/_TemplatedMixin"],function(_1fd0,query,_1fd1,_1fd2){return _1fd0([_1fd2],{sections:[],_fillContent:function(_1fd3){this.sections.forEach(function(_1fd4){var _1fd5=this[_1fd4],_1fd6=query(_1fd1.substitute("[data-epi-section=${0}]",[_1fd4]),_1fd3);_1fd6.forEach(function(_1fd7){while(_1fd7.childNodes.length>0){_1fd5.appendChild(_1fd7.childNodes[0]);}});},this);}});});},"url:epi-cms/project/templates/ProjectItemList.html":"<div class=\"epi-project-item-list\">\r\n    <div data-dojo-type=\"dijit/Toolbar\"\r\n         data-dojo-attach-point=\"toolbar\"\r\n         class=\"epi-project-item-list__toolbar epi-flatToolbar\">\r\n        <span data-dojo-attach-point=\"toolbarSection\"></span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"listContainer\" class=\"epi-project-item-list__container\">\r\n        <div data-dojo-attach-point=\"notificationBarNode\" class=\"epi-notificationBar dijitHidden\">\r\n            <div class=\"epi-notificationBarItem\">\r\n                <div class=\"epi-notificationBarText\">\r\n                    <p data-dojo-attach-point=\"notificationTextNode\"></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"overlayNode\"\r\n             class=\"epi-project-item-list__dnd-area epi-visible-dnd-area epi-project-list-area__dnd-area--empty-list dijitHidden\">\r\n            <span class=\"epi-project-item-list__dnd-area-content\">${res.droptoadditems}</span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"itemListNode\"\r\n             class=\"epi-card-list dgrid--centered-no-data-message\"></div\r\n        ><div data-dojo-attach-point=\"activitySection\"\r\n              class=\"epi-activity-section\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/project/PublishMenu":function(){define(["dojo/_base/declare","dojo/on","dijit/DropDownMenu","dijit/registry","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/widget/_SectionedTemplatedMixin","./command/PublishMenuButtonBuilder","dojo/text!./templates/PublishMenu.html"],function(_1fd8,on,_1fd9,_1fda,_1fdb,_1fdc,_1fdd,_1fde,_1fdf){return _1fd8([_1fd9,_1fdd],{sections:["primarySection","statusSection"],templateString:_1fdf,buildRendering:function(){this.inherited(arguments);var _1fe0=[{builder:new _1fde({settings:{"class":"epi-button--bold epi-button--full-width epi-success",isExecutingClass:"epi-loading"},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),category:"publishmenu-primary",target:this.publishMenuNode},{builder:new _1fdc(),category:"publishmenu",target:this.projectActionMenu}];this.own(this._menuAssembler=new _1fdb({configuration:_1fe0}));this.own(on(this.domNode,"beforeFocusedButtonRemoved",this.domNode.focus));},childSelector:function(node){var _1fe1=_1fda.byNode(node);return _1fe1&&_1fe1.focus&&(node.parentNode===this.projectActionMenu);},getChildren:function(){return [].concat(_1fda.findWidgets(this.publishMenuNode),_1fda.findWidgets(this.projectActionMenu));},_setCommandSourceAttr:function(_1fe2){this._menuAssembler.set("commandSource",_1fe2);},_getCommandSourceAttr:function(){return this._menuAssembler.get("commandSource");}});});},"epi-cms/project/command/PublishMenuButtonBuilder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/form/Button","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/ButtonBuilder"],function(_1fe3,lang,on,_1fe4,_1fe5,_1fe6){return _1fe3([_1fe6],{_buttonClass:_1fe3([_1fe4,_1fe5],{_setSelected:function(){},_setIsAvailableAttr:function(_1fe7){if(!_1fe7&&this.get("focused")){on.emit(this.domNode,"beforeFocusedButtonRemoved",{bubbles:true});}this.inherited(arguments);}})});});},"url:epi-cms/project/templates/PublishMenu.html":"<div tabIndex=\"${tabIndex}\" role=\"menu\" class=\"epi-invertedTooltip epi-publishActionMenu\" data-dojo-attach-point=\"containerNode\" data-dojo-attach-event=\"onkeypress:_onKeyPress\">\r\n    <div class=\"epi-tooltipDialogTop\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"primarySection\" class=\"epi-projectStatusMessage\"></li>\r\n            <li data-dojo-attach-point=\"publishMenuNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <div data-dojo-attach-point=\"statusSection\" class=\"epi-tooltipDialogInfo\"></div>\r\n    <table class=\"epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n        <tbody data-dojo-attach-point=\"projectActionMenu\"></tbody>\r\n    </table>\r\n</div>\r\n","epi-cms/project/ProjectChangesComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectChangesComponentViewModel","dojo/text!./templates/ProjectChangesComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.changes","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList"],function(_1fe8,lang,_1fe9,_1fea,_1feb,on,when,_1fec,_1fed,_1fee,_1fef,res){return _1fe8([_1fed,_1fec],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],dndEnabled:["dndEnabled"],contentLanguage:["contentLanguage"]},res:res,templateString:_1fef,"class":"epi-project-changes-component",layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1fee();}});});},"epi-cms/project/viewmodels/ProjectChangesComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./_ProjectViewModel"],function(_1ff0,lang,_1ff1){return _1ff0([_1ff1],{_sortOrderProfileKey:"epi.project-changes-sort-order",postscript:function(){this.inherited(arguments);this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this._projectChanged)));},refreshProject:function(){if(!this.selectedProject){this._updateHasProject();}this.inherited(arguments);},_createProjectCommands:function(){return {};},_createProjectItemCommands:function(){var _1ff2=this.inherited(arguments),_1ff3={};Object.keys(_1ff2).forEach(function(key){var _1ff4=_1ff2[key];switch(key){case "refreshProjectItems":break;case "sortProjectItems":_1ff4.set({category:"projectButton",iconClass:"epi-iconSort"});break;case "readyToPublishProjectItem":_1ff3.primaryReadyToPublishProjectItem=lang.delegate(_1ff4,{iconClass:"epi-iconCheckmark",category:null});break;default:_1ff3[key+"_context"]=lang.delegate(_1ff4,{category:"context"});}});return lang.mixin(_1ff2,_1ff3);},_projectChanged:function(_1ff5){this.set("selectedProject",_1ff5);},_updateSelectedProjectDependencies:function(_1ff6){var _1ff7=false,_1ff8=null,_1ff9=this.isProjectModeEnabled();if(_1ff6){_1ff7=(_1ff9&&_1ff6.status!=="publishing")||_1ff6.status==="active"||_1ff6.status==="publishfailed";_1ff8={projectId:_1ff6.id};}this.set({dndEnabled:_1ff7,projectItemQuery:_1ff8});}});});},"url:epi-cms/project/templates/ProjectChangesComponent.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n         data-dojo-attach-point=\"itemList\"\r\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact', res: this.res\">\r\n        <section data-epi-section=\"toolbarSection\">\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </section>\r\n        <section data-epi-section=\"listContainer\">\r\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\"></div>\r\n        </section>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectComponentViewModel","dojo/text!./templates/ProjectComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList","./ProjectSelector","./PublishMenu"],function(_1ffa,lang,_1ffb,_1ffc,_1ffd,on,when,_1ffe,_1fff,_2000,_2001,res){function show(list){list.forEach(function(node){_1ffc.remove(node,"dijitHidden");});};function hide(list){list.forEach(function(node){_1ffc.add(node,"dijitHidden");});};lang.delegate(_1fff.prototype.modelBindingMap,{placeHolder:["placeHolder"]});return _1ffa([_1fff,_1ffe],{"class":"epi-project-component",modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],createProjectInfo:["createProjectInfo"],dndEnabled:["dndEnabled"],placeholderState:["placeholderState"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"]},res:res,templateString:_2001,layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _2000();},_projectSelectorSortChanged:function(_2002){this.model.set("projectSortOrder",_2002);},_projectSelectorChange:function(_2003){this.model.set("selectedProject",_2003);},_newProjectButtonClickHandler:function(){this.model.namedCommands.addProject.execute();},_setCreateProjectInfoAttr:{node:"createProjectInfoNode",type:"innerText"},_setSelectedProjectAttr:function(value){this.projectSelector.set("value",value);},_setPlaceholderStateAttr:function(value){if(this.get("_placeholderState")===value){return;}this._set("_placeholderState",value);switch(value){case "noProjects":show([this.placeholderNode]);hide([this.projectSelector.domNode,this.publishContainer.domNode]);break;case "noSelectedProject":show([this.projectSelector.domNode,this.placeholderNode]);hide([this.publishContainer.domNode]);break;default:show([this.projectSelector.domNode,this.publishContainer.domNode]);hide([this.placeholderNode]);}}});});},"epi-cms/project/viewmodels/ProjectComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","./_ProjectViewModel","epi/i18n!epi/nls/episerver.cms.components.project"],function(_2004,lang,_2005,when,_2006,res){return _2004([_2006],{createProjectInfo:"",hasProject:false,_selectedProjectProfileKey:"epi.selected-project-id",initialize:function(){this._updateHasProject();return this.inherited(arguments);},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _2005().resolve();}return store.remove(this.selectedProject.id).then(function(){self._selectNextProject();});},_loadSelectedProject:function(){var _2007=this.projectStore;return when(this.profile.get(this._selectedProjectProfileKey),function(_2008){if(!_2008){return null;}return when(_2007.get(_2008)).then(function(_2009){var _200a=!!_2009||undefined;return this._updateHasProject(_200a).then(function(){return _2009;});}.bind(this)).otherwise(function(ex){return null;});}.bind(this));},_updatePlaceholderState:function(){var _200b=this.get("hasProject"),_200c=!!this.get("selectedProject"),state="";if(!_200b){state="noProjects";this.set("createProjectInfo",res.placeholder.noprojectscreated);}else{if(_200b&&!_200c){state="noSelectedProject";this.set("createProjectInfo",res.placeholder.noprojectselected);}}this.set("placeholderState",state);},_getProjects:function(start,count,sort){return this.projectStore.query(null,{start:start,count:count,sort:sort});},_updateHasProject:function(_200d){return when(_200d===true?[_200d]:this._getProjects(0,1)).then(function(_200e){var _200f=_200e.length>0;this.set("hasProject",_200f);return _200f;}.bind(this));},_selectNextProject:function(){when(this._getProjects(0,1,this.get("projectSortOrder")),lang.hitch(this,function(_2010){var value=_2010.length>0?_2010[0]:null;this.set("selectedProject",value);this.set("hasProject",_2010.length>0);}));},_hasProjectSetter:function(value){this.hasProject=value;this._updatePlaceholderState();},_selectedProjectSetter:function(_2011){this.inherited(arguments);if(!this.hasProject&&_2011){this.set("hasProject",true);}else{this._updatePlaceholderState();}this.profile.set(this._selectedProjectProfileKey,_2011&&_2011.id,{location:"server"});}});});},"url:epi-cms/project/templates/ProjectComponent.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\r\n         data-dojo-attach-point=\"itemList\"\r\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact'\">\r\n        <section data-epi-section=\"toolbarSection\">\r\n            <span data-dojo-type=\"epi-cms/project/ProjectSelector\"\r\n                  data-dojo-attach-point=\"projectSelector\"\r\n                  data-dojo-props=\"store:this.model.projectStore\"\r\n                  data-dojo-attach-event=\"onSortChanged:_projectSelectorSortChanged, onChange:_projectSelectorChange\"></span>\r\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\r\n                 data-dojo-attach-point=\"publishContainer\"\r\n                 data-dojo-props=\"iconClass: 'epi-iconPublishProject', showLabel: false, label: this.res.publishdropdown.label\"\r\n                 data-dojo-attach-event=\"openDropDown:_publishMenuClickHandler\"\r\n                 class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\">\r\n                <span></span>\r\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\r\n                     data-dojo-attach-point=\"publishMenu\"\r\n                     data-dojo-props=\"commandSource: this.model\">\r\n                    <section data-epi-section=\"primarySection\">\r\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\r\n                    </section>\r\n                    <section data-epi-section=\"statusSection\">\r\n                        <ul>\r\n                            <li>\r\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\r\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\r\n                            </li>\r\n                        </ul>\r\n                    </section>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\r\n        </section>\r\n\r\n        <section data-epi-section=\"listContainer\">\r\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\">\r\n                <div class=\"epi-project-gadget__placeholder-content\">\r\n                    <button data-dojo-type=\"dijit/form/Button\" type=\"button\"\r\n                            data-dojo-props=\"iconClass: 'epi-iconPlus'\"\r\n                            data-dojo-attach-event=\"onClick:_newProjectButtonClickHandler\"\r\n                            class=\"epi-flat epi-chromeless\">${res.command.newproject.label}</button>\r\n                    <div data-dojo-attach-point=\"createProjectInfoNode\" class=\"epi-project-gadget__placeholder-info\"></div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    </div>\r\n</div>\r\n","epi-cms/project/ProjectSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/on","dojo/Deferred","dojox/html/entities","epi","dojo/text!dijit/form/templates/Select.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","./ProjectSelectorList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_2012,lang,_2013,_2014,on,_2015,_2016,epi,_2017,_2018,_2019,_201a,_201b,_201c){return _2012([_201c,_201b],{"class":"epi-project-selector epi-chromeless epi-chromeless--with-arrow epi-flat",iconClass:"epi-iconProject",value:null,store:null,sort:null,query:null,enableDefaultValue:false,defaultValueText:_2019.preview.defaultoption,header:_2019.selector.title,buildRendering:function(){this.inherited(arguments);this.own(this.dropDown=new _201a({baseClass:"dijitMenu",header:this.header,enableDefaultValue:this.enableDefaultValue,defaultValueText:this.defaultValueText}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);this.closeDropDown(true);}),true));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableDefaultValue&&!this.value){this.set("value",null);}},compare:function(_201d,_201e){return epi.areEqual(_201d,_201e)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _201f=this.dropDown.refresh();return _201f.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableDefaultValue){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_2016.encode(value||"")]);},_setValueAttr:function(value,_2020){this.set("label",value&&value.name);if(this.enableDefaultValue&&!value){this.set("label",this.defaultValueText);}!_2020&&this.dropDown&&this.dropDown.set("selectedProject",value);this.inherited(arguments);}});});},"epi-cms/project/ProjectModeToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/on","dojo/dom-style","dojo/dom-class","dojo/string","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/form/Button","epi/shell/DialogService","epi/shell/widget/_ModelBindingMixin","./ProjectSelector","./viewmodels/ProjectModeToolbarViewModel","epi/dependency","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","dojo/text!./templates/ProjectModeToolbar.html","dojo/text!./templates/CurrentProjectDoesNotExistsWarning.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.toolbar"],function(_2021,lang,has,on,_2022,_2023,_2024,_2025,_2026,_2027,_2028,_2029,_202a,_202b,_202c,_202d,_202e,_202f,_2030,_2031,_2032){return _2021([_2027,_2025,_2026,_202a],{templateString:_2030,localizations:_2032,_projectDoesNotExistWarning:"",postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_202d.resolve("epi.cms.ProjectService");},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _202c());}this._projectDoesNotExistWarning=_2024.substitute(_2031,{warning:_2032.projectdoesnotexists.alert.warning,description:_2032.projectdoesnotexists.alert.description});},buildRendering:function(){this.inherited(arguments);this._setupContextMenu();var _2033=this._projectDoesNotExistWarning;this.own(this.projectOverviewButton=new _2028({showLabel:true,"class":"dijitHidden epi-chromeless",label:_2032.overview.label},this.projectOverviewButtonNode),this.projectOverviewButton.on("click",lang.hitch(this,"_openProjectOverview")),this.projectSelector=new _202b({iconClass:"dijitNoIcon","class":"epi-chromeless epi-chromeless--inverted epi-chromeless--with-arrow epi-project-mode-toolbar__selector",enableDefaultValue:true,defaultValueText:_2032.defaultoption,store:this.model.projectStore},this.projectSelectorNode),this.model.on("currentProjectDoesNotExists",function(){_2029.alert(_2033);}));},_toggleOverviewButton:function(_2034){var _2035=this.projectOverviewButton.domNode;_2023.toggle(_2035,"dijitHidden",!_2034);},startup:function(){this.inherited(arguments);this.own(this.model.watch("overviewButtonVisible",lang.hitch(this,function(_2036,_2037,_2038){this._toggleOverviewButton(_2038);})));var model=this.model;this.model.initialize().then(lang.hitch(this,function(){var _2039=this.domNode;this.own(this.projectSelector.watch("value",lang.hitch(this,function(_203a,_203b,_203c){_2023.toggle(_2039,"epi-project-mode-toolbar--project-selected",!!_203c);_2023.remove(_2039,"epi-project-mode-toolbar--project-deleted");model.set("currentProject",_203c);})));this.projectSelector.set("value",model.get("currentProject"));}));this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,function(_203d){this.projectSelector.set("value",_203d);})));this.own(this.model.on("animateToolbar",lang.hitch(this,function(){_2023.add(this.domNode,"epi-project-mode-toolbar--flash");var _203e=on(this.domNode,"animationend",lang.hitch(this,function(){_2023.remove(this.domNode,"epi-project-mode-toolbar--flash");_203e.remove();}));})));this.own(this.model.watch("currentProject",lang.hitch(this,function(_203f,_2040,_2041){if(_2041&&_2041.isDeleted){_2023.add(this.domNode,"epi-project-mode-toolbar--project-deleted");}})));},_openProjectOverview:function(){var _2042=this.projectSelector.get("value");if(_2042){this.model.showProjectOverview(_2042.id);}},_setupContextMenu:function(){this.own(new _202f({configuration:[{builder:new _202e({settings:{"class":"epi-chromeless",iconClass:"epi-iconContextMenu",showLabel:false,label:_2032.contextmenu.label},optionClass:""}),category:"context",target:this.contextMenu}],commandSource:this.model}));}});});},"epi-cms/project/viewmodels/ProjectModeToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","epi/epi","epi/dependency","epi-cms/_ContentContextMixin","../command/AddProject","../command/RenameProject","../command/RemoveProject","epi/shell/xhr/errorHandler"],function(_2043,lang,_2044,_2045,_2046,_2047,topic,when,_2048,_2049,epi,_204a,_204b,_204c,_204d,_204e,_204f){return _2043([_2047,_2048,_2046,_204b,_2049],{projectStore:null,currentProject:null,overviewButtonVisible:false,postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_204a.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_204a.resolve("epi.storeregistry").get("epi.cms.project");this._createCommands();var _2050=function(id){if(this.currentProject&&this.currentProject.id===id){this._markCurentProjectAsDeleted();}}.bind(this);var _2051=function(_2052){if(this.currentProject&&this.currentProject.id===_2052.id){this.set("currentProject",_2052);}}.bind(this);this.own(this.projectService.on("project-removed",_2050),this.projectService.on("project-updated",_2051));when(this.getCurrentContext()).then(this.contextChanged.bind(this));},initialize:function(){return when(this.projectService.getCurrentProject()).then(lang.hitch(this,function(_2053){this._changeAttrValue("currentProject",_2053,false);this.set("overviewButtonVisible",!!_2053);}));},contentContextChanged:function(_2054,_2055){this.inherited(arguments);if(this.get("currentProject")){var self=this;this.projectService.exists(this.currentProject.id).then(function(_2056){if(!_2056){self.emit("currentProjectDoesNotExists");}});}},_markCurentProjectAsDeleted:function(){var _2057=lang.clone(this.currentProject);_2057.isDeleted=true;this.set("currentProject",_2057,false);this.set("overviewButtonVisible",false);},contextChanged:function(_2058,_2059){this.inherited(arguments);if(_2058&&_2058.type==="epi.cms.project"){var _205a=parseInt(_2058.id,10);when(this.projectStore.get(_205a)).then(lang.hitch(this,function(_205b){if(_2059&&_2059.sender&&_2059.sender._requestContext){this.emit("animateToolbar");}this.set("currentProject",_205b);}));}},_currentProjectSetter:function(_205c,_205d){if(epi.areEqual(this._clearProjectStats(this.currentProject),this._clearProjectStats(_205c))){return;}this.set("overviewButtonVisible",!!_205c);this.currentProject=_205c;var _205e=new _2045().resolve();if(_205d||_205d===undefined){_205e=this.projectService.setCurrentProject(_205c);}_205e.then(lang.hitch(this,"getCurrentContext")).then(function(_205f){if(_205f.type!=="epi.cms.project"&&_205f.currentMode===undefined){topic.publish("/epi/shell/context/request",{uri:_205f.versionAgnosticUri},{sender:this});}});},_clearProjectStats:function(_2060){if(!_2060){return _2060;}return Object.assign({},_2060,{itemStatusCount:{}});},showProjectOverview:function(_2061){var _2062="epi.cms.project:///"+_2061;topic.publish("/epi/shell/context/request",{uri:_2062},{sender:this});},getCommands:function(){return this.commands;},addProject:function(_2063){this.projectStore.add(_2063).then(lang.hitch(this,function(value){this.set("currentProject",value);})).otherwise(_204f.forXhr);},getProject:function(){return this.get("currentProject");},updateProject:function(_2064){this.projectStore.put(_2064).then(lang.hitch(this,"set","currentProject")).otherwise(_204f.forXhr);},reactivateProject:function(){if(!this.currentProject){return new _2045().resolve();}return this.projectService.reactivateProject(this.currentProject.id);},removeProject:function(){if(!this.currentProject){return new _2045().resolve();}return this.projectStore.remove(this.currentProject.id).then(lang.hitch(this,function(){this.set("currentProject",null);}));},_createCommands:function(){var _2065={model:this,category:"context",propertiesToWatch:["currentProject"]},_2066=this.own(new _204c(_2065),new _204d(_2065),new _204e(_2065));this.set("commands",_2066);}});});},"url:epi-cms/project/templates/ProjectModeToolbar.html":"<div class=\"epi-project-mode-toolbar\">\r\n\t<span data-dojo-attach-point=\"projectIconNode\" class=\"dijitReset dijitInline epi-project-mode-toolbar__icon-node\">\r\n\t\t<span class=\"dijitReset dijitInline dijitIcon epi-iconProject\"></span>\r\n    </span>\r\n    <span data-dojo-attach-point=\"projectLabelNode\" class=\"dijitInline\">${localizations.label}</span>\r\n    <span data-dojo-attach-point=\"projectSelectorNode\"></span>\r\n    <span class=\"dijitInline epi-project-mode-toolbar__warning-label\">${localizations.projectdoesnotexists.currentprojectdoesnotexists}</span>\r\n    <span data-dojo-attach-point=\"contextMenu\" class=\"epi-project-mode-toolbar__contextmenu\"></span>\r\n    <span data-dojo-attach-point=\"projectOverviewButtonNode\"></span>\r\n</div>\r\n","url:epi-cms/project/templates/CurrentProjectDoesNotExistsWarning.html":"<div class=\"epi-project-mode-project-deleted-warning\">${warning}</div>\r\n<p>${description}</p>","epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/epi","epi/shell/widget/dialog/Dialog","./viewmodel/CategorySelectorViewModel","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_2067,lang,_2068,_2069,_206a,_206b,query,_206c,_206d,_206e,_206f,_2070,_2071,_2072,_2073,epi,_2074,_2075,_2076,res){return _2067([_206d,_206c,_206e,_2071,_2073],{templateString:_2076,localization:res,multiple:true,value:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.model=new _2075();this.own(this.model);},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _2077=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_2077);if(_2077.length>0){this._set("value",_2077);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this.model.get("categories"),value)){return;}this.model.set("categories",value);this.onChange(this.model.get("categories"));this._updateDisplayNode();},_getValueAttr:function(){return this.model.get("categories");},_setReadOnlyAttr:function(value){this._set("readOnly",value);_206b.set(this.button.domNode,"display",value?"none":"");_2069.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},isValid:function(){if(!this.required){return true;}var value=this.get("value");return value&&value.length>0;},_createCategoryButton:function(_2078){if(query("div[data-epi-category-id='"+_2078.id+"']",this.categoriesGroupContainer).length!==0){return;}var _2079=_206a.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _207a=_206a.create("div",{"class":"dijitInline epi-resourceName"});var _207b=_206a.create("div",{"class":"dojoxEllipsis",innerHTML:_2078.description});_206a.place(_207b,_207a);_206a.place(_207a,_2079);this._tooltip=new _2070({connectId:_207b,label:this._getCategoryPath(_2078)});var _207c=_206a.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_2068.set(_207c,"data-epi-category-id",_2078.id);var _207d=_207c.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_207c,_207d,lang.hitch(this,this._onRemoveClick));_206a.place(_207c,_207a);}else{_206a.place(_206a.create("span",{innerHTML:"&nbsp;"}),_207a);}_206a.place(_2079,this.categoriesGroupContainer);},_getCategoryPath:function(_207e){if(!_207e.parentsNameCollection||_207e.parentsNameCollection.length===1){return "";}var path=_207e.parentsNameCollection[1];for(var i=2;i<_207e.parentsNameCollection.length;i++){path=path+"/"+_207e.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){_206a.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";this.model.refreshCategories().then(function(_207f){if(!this.model.hasCategories()){this._createNoCategoriesChosenSpan();return;}_207f.forEach(function(_2080){this._createCategoryButton(_2080);},this);}.bind(this));},_onRemoveClick:function(arg){if(!this.model.get("categories")){return;}var _2081=parseInt(_2068.get(arg.target,"data-epi-category-id"),10);var _2082=this.model.get("categories").indexOf(_2081);if(_2082===-1){return;}var _2083=lang.clone(this.model.get("categories"));_2083.splice(_2082,1);this.set("value",_2083);},_getCategoriesParentsNameClone:function(){var _2084={};array.forEach(this.model.get("categories"),lang.hitch(this,function(_2085){_2084[_2085]=this.model.get("categoriesParentsName")[_2085];}));return _2084;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this.model.get("categories")));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _2086=this.categorySelectorDialog.get("value");this.set("value",_2086);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _2072({rootCategory:this.root});this.dialog=new _2074({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_2087,lang,_2088,_2089,_208a,_208b,epi,_208c,_208d){return _2087([_2089,_2088,_208a],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_208e,lang,Tree,epi,_208f,_2090){return _208e([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _2090({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _208f(args);},getTooltip:function(item){var _2091=this.model.getTooltip||this.model.getLabel;return _2091?_2091(item):this.inherited(arguments);},getNodeById:function(_2092){var nodes=this.getNodesByItem(_2092.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_2093,_2094,_2095){if(!_2093||!_2093.item||!_2093.item.hasChildren||!lang.isArray(_2094)||_2094.length===0||!_2095){return 0;}var _2096=0,_2097=[],_2098=[],_2099=lang.clone(_2093.item.parentsNameCollection);var _209a=function(_209b){if(lang.isArray(_209b)&&_209b.length>0){_209b.pop();}};_2099[_2099.length-1]=_2093.item.description;array.forEach(_2094,function(_209c){_2097=lang.clone(_2095[_209c]);_209a(_2097);_2098=lang.clone(_2097);lang.mixin(_2098,_2099);if(lang.isArray(_2097)&&epi.areEqual(_2097,_2098)){_2096++;}},this);return _2096;},_setTotalSelectedNodes:function(_209d){if(_209d){_209d.set("totalSelectedNodes",this._getTotalSelectedNodes(_209d,this.selectedNodeIds,this.selectedNodeData));array.forEach(_209d.getChildren(),function(_209e){if(_209e&&_209e.item&&_209e.item.hasChildren){if(_209e.isExpanded){this._setTotalSelectedNodes(_209e);}else{_209e.set("totalSelectedNodes",this._getTotalSelectedNodes(_209e,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_209f,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!==-1;if(_209f&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_209f&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_20a0,_20a1){if(!_20a0||!lang.isArray(_20a1)){return;}var _20a2=false;array.forEach(_20a0.getChildren(),function(_20a3){if(_20a3){_20a2=_20a1.indexOf(_20a3.item.id)!==-1;_20a3.set("checked",_20a2);if(_20a3.hasChildren()){this.set("toggleSelectNodes",_20a3,_20a1);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_20a4,item){this._onNodeSelectChanged(_20a4,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_20a5,lang,_20a6,_20a7,keys,_20a8,_20a9,_20aa,epi,_20ab){return _20a5([_20ab,_20a9],{templateString:_20a8,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_20a6.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _20ac=_20a7.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _20ad=new _20aa({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_20ae){this.onNodeSelectChanged(_20ae,this.item);})});_20ad.placeAt(_20ac);_20a7.place(_20ac,this.expandoNode,"after");return _20ad;},onNodeSelectChanged:function(_20af,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode===keys.SPACE||evt.keyCode===keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_20b0){if(!this._checkbox){return;}this._set("checked",_20b0);this._checkbox.set("checked",_20b0);},_setTotalSelectedNodesAttr:function(_20b1){var _20b2=this.tree.model.getLabel(this.item),_20b3=!this.isExpanded&&_20b1>0;this.labelNode.innerHTML=_20b3?_20b2+" ("+_20b1+")":_20b2;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\r\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\r\n            </span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi/routes"],function(_20b4,lang,when,_20b5,_20b6,_20b7){return _20b4(null,{store:null,rootCategory:undefined,constructor:function(args){lang.mixin(this,args);if(!this.store){var _20b8=_20b6.resolve("epi.storeregistry");this.store=_20b8.get("epi.cms.category");}},getRoot:function(_20b9){when(this.store.get(this.rootCategory),_20b9);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_20ba,_20bb){var id=this.getIdentity(_20ba),_20bc=this.store.query({id:id,query:"getchildren"});_20bc.then(function(_20bd){_20ba.children=_20bd;_20bb(_20bd);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return _20b5.encode(item.description);}});});},"epi-cms/widget/viewmodel/CategorySelectorViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dijit/Destroyable","dojo/Stateful","dojo/when","dojo/promise/all","epi/dependency"],function(_20be,_20bf,_20c0,_20c1,when,all,_20c2){return _20be([_20c1,_20c0],{_categories:null,_categoriesParentsName:null,_updateDisplayPromise:null,store:null,constructor:function(_20c3){if(_20c3&&_20c3.store){this.store=_20c3.store;}else{var _20c4=_20c2.resolve("epi.storeregistry");this.store=_20c4.get("epi.cms.category");}this._categoriesParentsName={};},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},refreshCategories:function(){var _20c5=new _20bf();this._categoriesParentsName={};if(!this.hasCategories()){_20c5.resolve([]);return _20c5.promise;}var _20c6=[];var _20c7=[];this._categories.forEach(function(_20c8){var def=when(this.store.refresh(_20c8)).then(function(_20c9){if(!_20c9||!_20c9.visible){_20c7.push(_20c8);return null;}this._categoriesParentsName[_20c9.id]=_20c9.parentsNameCollection;return _20c9;}.bind(this),function(){_20c7.push(_20c8);return null;}.bind(this));_20c6.push(def);},this);this._updateDisplayPromise=all(_20c6).then(function(_20ca){this._updateDisplayPromise=null;_20c7.forEach(function(c){var _20cb=this._categories.indexOf(c);if(_20cb!==-1){this._categories.splice(_20cb,1);}}.bind(this),this);_20c5.resolve(_20ca.filter(function(c){return c!==null;}));}.bind(this));return _20c5.promise;},hasCategories:function(){var _20cc=this.get("categories");return !!_20cc&&_20cc.length>0;},hasCategory:function(_20cd){return this.get("categories")&&this.get("categories").indexOf(_20cd)!==-1;},_categoriesParentsNameGetter:function(){return this._categoriesParentsName;},_categoriesGetter:function(){return this._categories;},_categoriesSetter:function(value){this._categories=value;}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/string","dojo/when","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/_SelectorBase","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_20ce,lang,_20cf,_20d0,_20d1,_20d2,when,_20d3,_20d4,_20d5,_20d6,_20d7,_20d8,_20d9,_20da,_20db,_20dc){return _20ce([_20db],{roots:null,value:null,required:false,missingMessage:_20dc.requiredmessage,tooltipPosition:[],contentLink:null,previewUrl:null,canSelectOwnerContent:false,accessLevel:_20d9.accessLevel.Read,showAllLanguages:true,showSearchBox:true,searchArea:null,contentClass:null,dialogClass:"epi-dialog-portrait",_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},buildRendering:function(){var _20dd=this.name?(this.name.replace(/"/g,"&quot;")):"";this.input=_20d1.create("input",{type:"hidden",name:_20dd});this.inherited(arguments);this.domNode.appendChild(this.input);},postMixInProperties:function(){this.inherited(arguments);var _20de=_20d5.resolve("epi.storeregistry");this._store=_20de.get("epi.cms.content.light");var _20df=this.contentRepositoryDescriptors||_20d5.resolve("epi.cms.contentRepositoryDescriptors");var _20e0=_20df.get(this.repositoryKey);if(_20e0&&!this.roots){this.roots=_20e0.roots;}if(_20e0&&!this.searchArea){this.searchArea=_20e0.searchArea;}},postCreate:function(){this.inherited(arguments);if(!this.value){this._updateDisplayNode(null);}},destroy:function(){if(this.dialog){this.dialog.destroy();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);_20d0.set(this.button.domNode,"display",value?"none":"");_20d0.set(this.clearButton,"display",value?"none":"");_20cf.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._setValueAndFireOnChange(value);},createDialogContent:function(){return new _20da({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes,showAllLanguages:this.showAllLanguages,showSearchBox:this.showSearchBox,searchArea:this.searchArea});},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_20dc.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_20d6.getResourceValue(this.allowedTypes[0],"name");if(name){title=_20d2.substitute(_20dc.format,[name]);}}this.contentSelectorDialog=this.createDialogContent();this.dialog=new _20d7({title:title,dialogClass:this.dialogClass,contentClass:this.contentClass,content:this.contentSelectorDialog,destroyOnHide:false});this.dialog.own(this.contentSelectorDialog);this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");this.connect(this.dialog,"onShow","_onDialogShow");return this.dialog;},_onDialogShow:function(){this.inherited(arguments);this._setDialogButtonState(this._convertValueToContentReference(this.value));},_isContentAllowed:function(_20e1){var _20e2=_20d6.getValidAcceptedTypes([_20e1],this.allowedTypes,this.restrictedTypes);return !!_20e2.length;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_20e3){this.canSelectOwnerContent=this.canSelectOwnerContent&&_20e3&&this._isContentAllowed(_20e3.typeIdentifier);var _20e4=this._getDialog();this.isShowingChildDialog=true;var _20e5;if(this.value){_20e5=this._convertValueToContentReference(this.value);}if(_20e5){_20e5=_20e5.createVersionUnspecificReference().toString();this.contentSelectorDialog.set("value",_20e5);}else{this.setInitialValue();}_20e4.show();}));},setInitialValue:function(){this.contentSelectorDialog.set("value",undefined);},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return value?new _20d8(value):null;},_setValueAndFireOnChange:function(value){var _20e6=value==="-"?this.contentLink:value;this.set("permanentLink",null);this.set("previewUrl",null);this._valueChangedPromise=when(this._getContentData(_20e6),lang.hitch(this,function(_20e7){this._valueChangedPromise=null;var _20e8=this.value!==_20e6;this.value=_20e6;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_20e7);if(_20e8){this.onChange(_20e6);}if(_20e7){this.set("permanentLink",_20e7.permanentLink);this.set("previewUrl",_20e7.previewUrl);}}));},_getContentData:function(_20e9){if(!_20e9){return null;}return this._store.get(_20e9);},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_20d3.focus(this.button.focusNode);}catch(e){}}},_updateDisplayNode:function(_20ea){this.inherited(arguments);if(_20ea){this.set("selectedContentLink",new _20d8(_20ea.contentLink).id);}else{this.set("selectedContentName",_20dc.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_20eb){var self=this;if(!_20eb){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",true);return;}when(self._store.get(_20eb),function(_20ec){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_20d9.hasAccess(_20ec.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/dom-prop","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_20ed,lang,_20ee,_20ef,_20f0,_20f1,_20f2,query,when,_20f3,_20f4,_20f5,_20f6,_20f7,i18n,_20f8,_20f9,_20fa,_20fb,_20fc){return _20ed([_20f5,_20f4,_20f6,_20f3,_20fa,_20fb,_20f9,_20f8],{templateString:_20fc,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_valueChangedPromise:null,_setSelectedContentNameAttr:function(value){_20f2.set(this.selectedContentNameNode,"textContent",value);this._updateDisplayNodeTitle();},_setSelectedContentLinkAttr:function(value){_20f2.set(this.selectedContentLinkNode,"innerHtml",value);this._updateDisplayNodeTitle();},_updateDisplayNodeTitle:function(){this.resourceName.title=this.resourceName.textContent.trim();},postCreate:function(){this.inherited(arguments);this.own(_20ee.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_20f7.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _20fd=this.contentRepositoryDescriptors.get(this.repositoryKey);this.roots=_20fd.roots;}},destroy:function(_20fe){this.inherited(arguments);if(this._valueChangedPromise){this._valueChangedPromise.cancel();this._valueChangedPromise=null;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_20f1.set(this.button.domNode,"display",value?"none":"");_20f1.set(this.clearButton,"display",value?"none":"");_20f0.toggle(this.domNode,"dijitReadOnly",value);},_getDialog:function(){},_onButtonClick:function(){if(!this.dialog){this.dialog=this._getDialog();this.dialog.startup();this.own(_20ee.after(this.dialog,"onExecute",lang.hitch(this,this._onDialogExecute)));this.own(_20ee.after(this.dialog,"onShow",lang.hitch(this,this._onDialogShow)));this.own(_20ee.after(this.dialog,"onHide",lang.hitch(this,this._onDialogHide)));this.own(this.dialog);}this.dialog.show();},_onDialogShow:function(){this.isShowingChildDialog=true;},_onDialogExecute:function(){},_onDialogHide:function(){this.isShowingChildDialog=false;this.focus();},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_20ff){if(_20ff){_20f0.remove(this.domNode,"epi-noValue");_20f0.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_20ff.name);}else{_20f0.add(this.domNode,"epi-noValue");_20f0.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_setDialogButtonState:function(_2100){}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_2101,lang,when,_2102){return _2101(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _2103=this.own(new _2102(this.dropAreaNode,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_2103,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_2104,_2105,nodes,copy){var _2106=_2104?(_2104.length?_2104[0]:_2104):null;if(_2106){this.onDropping();when(_2106.data,lang.hitch(this,function(_2107){var value;if(this.dndSourcePropertyName){value=_2107[this.dndSourcePropertyName];}else{value=_2107;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _2108=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_2108,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}this.focus();var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\" >\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dijit/_Container","dijit/registry","epi","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/core/ContentReference","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_2109,lang,_210a,_210b,_210c,_210d,_210e,_210f,json,on,query,_2110,_2111,epi,Item,_2112,_2113,_2114,Block,_2115,_2116,_2117,_2118,_2119,_211a){return _2109([Item,_2110,_2119],{templateString:_211a,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_2117,dndSourceClass:_2109([_2112,_2113]),dndSourceSettings:null,allowedTypes:null,restrictedTypes:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.own(this.model);this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_211b,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();})));this._pendingPersonalizations=[];this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _210f.get(this.sourceItemNode,"minHeight");},onValueChange:function(_211c){},updatePosition:function(_211d){if(!this.canUpdatePosition()){return false;}var _211e=this.inherited(arguments),_211f,_2120,_2121,_2122;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_2121=this.get("minHeight");_210f.set(this.sourceItemNode,"minHeight","");_211f=Math.floor(_210e.position(this.actionsNodeControls,false).h);_2120=_211f>0?_211f:this.get("actionNodeHeight")||0;_2122=Math.floor(_210e.position(this.sourceItemNode,false).h);if(_2120===0){if(_2122!==0){this._clearPosition();return _211e;}}_2120&&(this.set("actionNodeHeight",_2120));_210f.set(this.sourceItemNode,"minHeight",(_2122+_2120)+"px");_210f.set(this.actionsNodeControls,"marginTop",(_2122)+"px");if(_2121===_2122+_2120){return _211e;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_210d.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setDisabledAttr:function(){this.inherited(arguments);if(this.position){this.updatePosition(this.position);}},_setupDnd:function(){var _2123=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,reject:this.restrictedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_2123);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance);this.own(_210a.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_210a.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_210d.create("div"),_2124;if(typeof item.getNormalizedData=="function"){_2124=item.getNormalizedData();}_2124=_2124?_2124.data:item;return {node:node,type:this.allowedDndTypes,data:_2124};},_setupBlocks:function(){var _2125=this._getBlockNodes();array.forEach(_2125,this._createBlock,this);this.set("hasChildren",_2125.length>0);},_createBlock:function(node){var id=_210c.get(node,"data-epi-block-id"),info=json.parse(_210c.get(node,"data-epi-block-personalization")),_2126=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_2126){model=model.getChild({name:_2126});}var _2127=model&&model.getChild(lang.mixin({contentLink:new _2114(id).createVersionUnspecificReference().toString()},info));if(!_2127){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:_2127,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=_2127.watch("ensurePersonalization",lang.hitch(this,function(_2128,_2129,_212a){var index=array.indexOf(this._pendingPersonalizations,_2127);if(_212a){if(index<0){this._pendingPersonalizations.push(_2127);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));_2127.set("visible",true);this._source.setItem(block.domNode.id,{name:_2127.name,data:_2127,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _212b=this.getChildren(),_212c=[],_212d=this.get("position");array.forEach(_212b,function(_212e,i){var _212f;if(!_212c[i]){_212c[i]=_210e.position(_212e.sourceItemNode,false);}_212f=_212c[i];_212f.x-=_212d.x;_212f.y-=_212d.y;_212e.resize(_212f);},this);},_checkAcceptance:function(_2130,nodes){if(this.readOnly||nodes===undefined){return false;}var _2131=_2111.getEnclosingWidget(nodes[0]);if(_2131.isInstanceOf(_2115)){return false;}return this._source.defaultCheckAcceptance(_2130,nodes);},_getBlockNodes:function(){var _2132=query("[data-epi-block-id]",this.sourceItemNode);var _2133=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_2132,function(node){return _2133.indexOf(node)===-1;});},_setupDirectionality:function(){var _2134;if(/vertical|horizontal/.test(this.layout)){_2134=this.layout==="horizontal";}else{_2134=array.some(this._getBlockNodes(),function(node){var style=_210f.getComputedStyle(node),_2135=/left|right/.test(style.cssFloat),_2136=/inline|inline-block/.test(style.display);return _2135||_2136;});}this._source.setHorizontal(_2134);},executeAction:function(_2137){if(_2137==="createnewblock"){var _2138=new _2116({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,treatAsSecondaryView:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_2138.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_2138.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_2139,nodes,_213a){var model=this.model,_213b=this._source;if(_213b.anchor===_213b.targetAnchor){return;}var index=array.indexOf(_213b.getAllNodes(),_213b.targetAnchor)+(_213b.before?-1:1),_213c=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_213c[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_213b===_2139&&!_213a){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _2118(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/has","dojo/dnd/Manager","dojo/dnd/Source","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_213d,has,_213e,_213f,_2140,_2141,_2142,_2143){return _213d(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_2141.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_2144){_2140.toggle(this.node,"dojoDndHorizontal",_2144);this.horizontal=_2144;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState==="Disabled"){return;}_213f.superclass.onMouseMove.call(this,e);var m=_213e.manager();var _2145=has("mac")?"metaKey":"ctrlKey";if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(e[_2145],true));}}}if(this.isDragging){var _2146=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!==this.current){this.targetBox=_2142.position(this.current,true);}if(this.horizontal){_2146=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_2146=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_2146=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!==this.targetAnchor||_2146!==this.before){this._markTargetAnchor(_2146);m.canDrop(!this.current||m.source!==this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _2147=[],_2148,_2149;function _214a(_214b,_214c){function _214d(value){return value*value;};return Math.sqrt(_214d(_214b.x-_214c.x)+_214d(_214b.y-_214c.y));};this.getAllNodes().forEach(function(node){var pos=_2142.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_2147.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_2147.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_2147,function(value){value.distance=_214a(point,value);if(!_2148||value.distance<_2149){_2148=value;_2149=value.distance;}},this);if(_2148){this.current=_2148.node;this._calculatedCurrent=true;return _2148.before;}return false;},_markTargetAnchor:function(_214e){var _214f=true,_2150=true;if(this.current===this.targetAnchor&&this.before===_214e){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_214e;if(this.targetAnchor){this.targetAnchorSibling=_214e?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_2140.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_214f=!(this.targetAnchor.id in this.selection);_2150=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_214f&&_2150){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_214f&&_2150){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_214f&&_2150);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_2151){var _2152=this._markerNode,_2153,_2154,_2155,style,top,left,_2156,width,gap=-1;if(_2151){_2153=_2142.position(this.targetAnchor,false);_2154=this.targetAnchorSibling?_2142.position(this.targetAnchorSibling,false):{h:0,w:0};_2155=_2142.position(this.node,false);if(this.horizontal){if(this.before){left=_2153.x-_2155.x;if(this.targetAnchorSibling){gap=(_2153.x-_2154.x-_2154.w)/2;}if(gap>=0){left-=gap;}}else{left=_2153.x+_2153.w-_2155.x;if(this.targetAnchorSibling){gap=(_2154.x-_2153.x-_2153.w)/2;}if(gap>=0){left+=gap;}}_2156=gap>=0?Math.max(_2153.h,_2154.h):_2153.h;style={display:"block",top:_2153.y-_2155.y+"px",left:left+"px",height:_2156+"px"};}else{if(this.before){top=_2153.y-_2155.y;if(this.targetAnchorSibling){gap=(_2153.y-_2154.y-_2154.h)/2;}if(gap>=0){top-=gap;}}else{top=_2153.y+_2153.h-_2155.y;if(this.targetAnchorSibling){gap=(_2154.x-_2153.x-_2153.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_2153.w,_2154.w):_2153.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_2152){_2152=this._markerNode=_2141.place(this.markerTemplateString,this.node);_2143.set(_2152,style);}else{setTimeout(function(){_2143.set(_2152,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_2157,_2158,event,_2159,_215a,_215b,html,_215c,query,_215d,_215e,pm,_215f,_2160,_2161,res,_2162){return _2157([_215d,_215e,_2160],{templateString:_2162,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{contentLink:["contentLink"],name:["name"],contentGroup:["contentGroup"],roleIdentities:["roleIdentities"],selected:["selected"]},_setSelectedAttr:function(_2163){this.inherited(arguments);_215a.toggle(this.itemNode,"epi-content-block-editor-node-selected",_2163);_215b.set(this.iconNodeMenu,"visibility",_2163?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_2159.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _2161(this.modelData);},_setIsDraggableAttr:function(_2164){this._set("isDraggable",_2164);if(this.isDraggable){_215a.add(this.domNode,"dojoDndItem");}else{_215a.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_2165,lang,_2166,_2167){return _2165([_2166,_2167],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\r\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\r\n            </span>\r\n        </span>\r\n    </a>\r\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\r\n\t<div class=\"epi-overlay-item-container\">\r\n        <span data-dojo-attach-point=\"informationNode\" class=\"epi-overlay-item-info\"></span>\r\n        <div class=\"epi-overlay-bracket\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\r\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\r\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\r\n\t</div>\r\n</div>\r\n","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property"],function(_2168,lang,_2169,_216a){return _2168([_216a],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_216b,_216c){this.model.set("data",_216c);})));},onDrop:function(_216d,value){this.model.addTo(value,null,false);},_setupModel:function(data){require([this.modelType],lang.hitch(this,function(_216e){this.model=new _216e(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_216f){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _2170=this.modelParams.itemConverterKey,_2171=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_2170){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_2170;});}if(_2171){this.allowedDndTypes.unshift(_2171);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_2172,_2173,_2174,_2175,_2176){return _2172([_2173,_2174],{templateString:_2176,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_2175.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"valueNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\r\n</div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","epi-cms/widget/ContentSelector","epi-cms/widget/_UrlSelectorMixin"],function(_2177,_2178,_2179){return _2177([_2178,_2179],{});});},"epi-cms/widget/_UrlSelectorMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper"],function(_217a,_217b,lang,when,epi,Url,_217c,_217d){return _217a(null,{_contentData:null,_setValueAndFireOnChange:function(value){var _217e;if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}this.set("permanentLink",null);this.set("previewUrl",null);if(!value){this._updateDisplayNode(null);_217e=this.value!==value;this.value=value;this._contentData=null;if(_217e){this.onChange(value);}this._started&&this.validate();return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_217f){this._updateDisplayNode(_217f);var _2180=_217f.permanentLink;this._started&&this.validate();_217e=!epi.areEqual(this.value,_2180);this.value=_2180;if(_217e){this.onChange(_2180);}if(_217f){this.set("permanentLink",_217f.permanentLink);this.set("previewUrl",_217f.previewUrl);}}));},_convertValueToContentReference:function(value){if(this._contentData){return new _217c(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}this._valueChangedPromise=new _217b();when(_217d.getContent(value,{allLanguages:true}),lang.hitch(this,function(_2181){this._contentData=_2181;if(this._valueChangedPromise){this._valueChangedPromise.resolve(_2181);}}));return this._valueChangedPromise.promise;}});});},"epi-cms/widget/UrlMediaSelector":function(){define(["dojo/_base/declare","epi-cms/widget/MediaSelector","epi-cms/widget/_UrlSelectorMixin"],function(_2182,_2183,_2184){return _2182([_2183,_2184],{});});},"epi-cms/widget/MediaSelector":function(){define(["dojo/_base/declare","dojo/dom-style","dojo/topic","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/widget/ContentSelector","epi-cms/ApplicationSettings","epi-cms/component/Media"],function(_2185,_2186,topic,when,_2187,_2188,_2189,_218a,_218b,Media){var _218c=_2185([Media,_2187],{componentId:"SelectableMediaComponent",root:_218b.rootPage,additionalTreeClass:"",postMixInProperties:function(){this.inherited(arguments);this.model.containedTypes=this.allowedTypes;this.model.changeContextOnItemSelection=false;this.model.treeStoreModel.forThisFolderEnabled=this._currentContext.currentMode!=="create";this.own(topic.subscribe("/epi/cms/upload",this._focusGrid.bind(this)));},_getValueAttr:function(){return this.model.selection.data[0].data.contentLink;},_setValueAttr:function(value){this._set("value",value);if(value){this.model.selectItemsByContentReference(value,true);this._focusGrid();}else{this.model.set("treePaths",null);}},_focusGrid:function(){this._focusManager.focus(this.list.grid.domNode);}});return _2185([_218a,_2187],{contentClass:"epi-wrapped epi-mediaSelector",dialogClass:null,createDialogContent:function(){var _218d=new _218c({repositoryKey:this.repositoryKey,allowedTypes:this.allowedTypes});_218d.list.set("selectionMode","single");_218d.searchResultList.set("selectionMode","single");_218d.resize({h:370,w:680,l:0,t:0});_218d.tree.set({region:"left",splitter:true});_2186.set(_218d.tree.domNode,"width","250px");_218d.listContainer.set({region:"center",splitter:false});this.own(_218d.model.selection.watch("data",this._dataChanged.bind(this)));return _218d;},contextChanged:function(){if(this.dialog){this.dialog.hide();}},setInitialValue:function(){when(this.getCurrentContent()).then(function(_218e){var _218f;if(this._currentContext.currentMode==="create"){_218f=_218b.globalAssetsFolder;}else{_218f=new _2189(_218e.assetsFolderLink).createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_218f);}.bind(this));},_dataChanged:function(name,_2190,_2191){if(!_2191||_2191.length!==1||!_2191[0].data||!this.allowedTypes.some(function(_2192){return _2188.isBaseTypeIdentifier(_2191[0].data.typeIdentifier,_2192);})){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}this._setDialogButtonState(_2191[0].data.contentLink);}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","dojo/aspect","dojo/Deferred","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi/Url","epi-cms/widget/LinkEditor","epi-cms/widget/_SelectorBase","epi-cms/core/PermanentLinkHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink"],function(_2193,lang,_2194,_2195,when,_2196,_2197,_2198,_2199,Url,_219a,_219b,_219c,res){return _2193([_219b,_2198],{resource:res,linkHelper:_219c,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _219d=_2193(this.modelClassName);this.model=new _219d();}},startup:function(){if(this._started){return;}this.inherited(arguments);!this.value&&this.set("value",null);},isValid:function(){return (!this.required||(!this.get("isEmpty")));},_onDialogShow:function(){this.inherited(arguments);var link=this.get("value");this.dialogContent.set("value",{href:link});},_onDialogExecute:function(){var _219e=this.dialogContent.get("value");this.set("value",_219e.href);},_getDialog:function(){this.dialogContent=new _219a({modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target","language"]});this.own(this.dialogContent);return new _2199({title:this._getTitle(),dialogClass:"epi-dialog-portrait",content:this.dialogContent,destroyOnHide:false,defaultActionsVisible:false});},_setValueAttr:function(value){if(!value){this.set("isEmpty",true);this._setValueAndFireOnChange(null);return;}this.set("isEmpty",false);this._setValueAndFireOnChange(value);},_setValueAndFireOnChange:function(value){var _219f=this.get("value");this._set("value",value);var _21a0=true;if(!_219f&&!value){_21a0=false;}else{if(value&&value===_219f){_21a0=false;}}if(_21a0){this.onChange(value);}if(this._valueChangedPromise){this._valueChangedPromise.cancel("");}if(value){this._valueChangedPromise=this._getLinkName(value);this._valueChangedPromise.then(lang.hitch(this,this._updateDisplayNode));}else{this._updateDisplayNode(null);}},_getLinkName:function(value){var def=new _2197();when(this.linkHelper.getContent(value,{allLanguages:true}),lang.hitch(this,function(_21a1){var _21a2={name:_21a1?_21a1.name:value};if(!def.isCanceled()){def.resolve(_21a2);}}));return def.promise;},_getTitle:function(){return lang.replace(this.value?this.resource.title.template.edit:this.resource.title.template.create,this.resource.title.action);}});});}}});