//>>built
require({cache:{"url:epi-cms/asset/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxNode\">\r\n        <div data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi/shell/widget/SearchBox\"\r\n             data-dojo-props=\"triggerContextChange: this.triggerContextChange, triggerChangeOnEnter: true, encodeSearchText: true\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n\r\n        <div data-dojo-attach-point=\"contentNode\">\r\n            <div class=\"epi-gadgetTopContainer ${additionalTreeClass}\"\r\n                 data-dojo-attach-point=\"tree\"\r\n                 data-dojo-type=\"epi-cms/widget/FolderTree\"\r\n                 data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu, dndSource: this.dndSource\"></div>\r\n            <div class=\"epi-gadgetBottomContainer\"\r\n                 data-dojo-attach-point=\"listContainer\"\r\n                 data-dojo-type=\"dijit/layout/BorderContainer\"\r\n                 data-dojo-props=\"region:'bottom', splitter:true, gutters: false\">\r\n                <div class=\"epi-createContentContainer\"\r\n                     data-dojo-attach-point=\"createContentArea\"\r\n                     data-dojo-type=\"dijit/layout/_LayoutWidget\"\r\n                     data-dojo-props=\"region:'top', splitter:false\">\r\n                    <button type=\"button\" class=\"epi-flat epi-chromeless\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-attach-point=\"createContentAreaButton\"></button>\r\n                </div>\r\n                <div data-dojo-attach-point=\"list\"\r\n                     data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                     data-dojo-props=\"region:'center', splitter:false, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"resultNode\" style=\"display:none\">\r\n            <div data-dojo-attach-point=\"searchResultList\"\r\n                 data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                 data-dojo-props=\"region:'center', splitter:false, store: this.model.searchStore, queryOptions: this.model.searchResultQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi-cms/asset/HierarchicalList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/DestroyableByKey","epi/shell/DialogService","epi/shell/widget/ContextMenu","epi/shell/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","./view-model/HierarchicalListViewModel","epi/shell/dnd/tree/multiDndSource","dojo/text!./templates/HierarchicalList.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(_1,_2,_3,_4,_5,_6,_7,_8,on,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,res){return _2([_c,_a,_b,_11,_10,_12],{contextMenu:null,templateString:_1a,showRoot:false,showThumbnail:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_18,hierarchicalListClass:"",noDataMessages:null,noSearchResultMessage:res.nosearchresults,createContentIcon:"",createContentText:"",dndSource:_19,additionalTreeClass:"epi-secondaryGadgetContainer",modelBindingMap:{searchRoots:["searchRoots"],searchArea:["searchArea"],listQuery:["listQuery"],treePaths:["treePaths"],selectedListItems:["selectedListItems"],searchListQuery:["searchListQuery"],noDataMessage:["noDataMessage"]},_setSearchAreaAttr:function(_1b){this.searchBox.set("area",_1b);},_setSelectedListItemsAttr:function(_1c){this.list.grid.clearSelection();(_1c||[]).forEach(function(_1d){this.list.grid.select(_1d.contentLink);},this);this._set("selectedListItems",_1c);},_setSearchRootsAttr:function(_1e){this.searchBox.set("searchRoots",_1e);},_setListQueryAttr:function(_1f){this.list.set("query",_1f);},_setNoDataMessageAttr:function(_20){this.list.set("noDataMessage",_20);},_setSearchListQueryAttr:function(_21){this.searchResultList.set("query",_21);this._showSearchResults(_21);},_setTreePathsAttr:function(_22){return this.tree.set("paths",_22);},_setShowRootAttr:function(_23){this.tree.set("showRoot",_23);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _24=_2(this.modelClassName);this.model=this.commandProvider=new _24({componentId:this.componentId,repositoryKey:this.repositoryKey,noDataMessages:this.noDataMessages});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _14({category:"context",popupParent:this}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_5.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();this._toggleCreateContentArea(this.showCreateContentArea);this.own(this.model.clipboardManager.watch("data",_3.hitch(this,this._updateClipboardIndicators)),this.searchBox.on("searchBoxChange",_3.hitch(this,this._onSearchTextChanged)));},startup:function(){this.inherited(arguments);this.model.startup();if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){var _25=_6.getMarginBox(this.searchBoxNode),_26={h:this._contentBox.h-_25.h,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_26);},_toggleCreateContentArea:function(_27){_7.set(this.createContentArea.domNode,"display",_27?"":"none");this.listContainer.layout();},_toggleActive:function(_28){var _29="epi-list--is-active";var _2a="epi-tree--is-active";if(_28===this.tree){_5.replace(this.domNode,_2a,_29);}else{_5.replace(this.domNode,_29,_2a);}},_showNotification:function(_2b){_13.alert(_f.toHTML(_2b));},_onSearchTextChanged:function(_2c){this.model.setSearchText(_2c);},_showSearchResults:function(_2d){_7.set(this.contentNode,"display",_2d?"none":"");_7.set(this.resultNode,"display",!_2d?"none":"");this.container.layout();},_setupTree:function(){var _2e=this.model._commandRegistry;function _2f(_30){_30?_2e.copy.command.execute():_2e.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_2f),on(this.tree,"paste",function(){_2e.paste.command.execute();}),on(this.tree,"delete",function(){_2e["delete"].command.execute();}),_4.after(this.tree,"onFocus",function(){this.model.updateTreeCommands();this._toggleActive(this.tree);}.bind(this)),_4.after(this.tree.rootNode,"setChildItems",function(_31){this.model.updateTreePaths(_31);}.bind(this),true));if(this.contextMenu){this.own(on(this.tree,"showContextMenu",this.contextMenu.forceOpen.bind(this.contextMenu)));}this.tree.onLoadDeferred.then(function(){this.own(this.tree.watch("paths",function(_32,old,_33){this.model.setTreePaths(_33);}.bind(this)));}.bind(this));_2e.rename.command.set("renameDelegate",_3.hitch(this,function(_34){this.tree.getNodesByItem(_34)[0].edit();}));this.tree.supportedDndSources=[this.tree.dndController,this.list.grid.dndSource];},_setupCreateContentArea:function(){this.createContentAreaButton.set("iconClass",this.createContentIcon);this.createContentAreaButton.set("label",this.createContentText);this.own(this.createContentAreaButton.on("click",_3.hitch(this,"_onCreateAreaClick")));},_setupList:function(){var _35=this.model._commandRegistry;this.own(on(this.model,"setPathsAndItems",function(_36,_37){this.model.set("treePaths",_36);this.set("treePaths",_36).then(function(){this.model.set("selectedListItems",_37);}.bind(this));}.bind(this)),_4.after(this.model,"onListItemUpdated",_3.hitch(this.list,function(_38){_9(_38,_3.hitch(this,this.editContent));})),this.searchResultList.grid.addKeyHandler(_8.ESCAPE,_3.hitch(this.searchBox,this.searchBox.clearValue)),_4.after(this.model.treeStoreModel,"onDeleted",_3.hitch(this,function(_39){_1.forEach(_39,function(_3a){var _3b=this.searchResultList.grid.row(_3a.contentLink);if(_3b&&_3b.data){this.searchResultList.grid.removeRow(_3b);}},this);}),true),_4.after(this.list,"onFocus",function(){this.model.updateListCommands();this._toggleActive(this.list);}.bind(this)),on(this.searchResultList,"selectionChanged",function(e){this.model.setSelectedSearchResults(e.selection);}.bind(this)),on(this.list,"selectionChanged",function(e){this.model.setSelectedListItems(e.selection);}.bind(this)),on(this.list.grid.domNode,"dgrid-refresh-complete",function(){var _3c=this.get("selectedListItems");this.list.grid.clearSelection();if(_3c){_3c.forEach(function(_3d){this.list.grid.select(_3d.contentLink);},this);}}.bind(this)));this.searchBox.on("keyup",_3.hitch(this,function(e){if(e.keyCode===_8.ENTER){e.preventDefault();this.searchResultList.editSelectedContent();}}));this.searchBox.on("keydown",_3.hitch(this,function(e){if(e.keyCode===_8.DOWN_ARROW||e.keyCode===_8.UP_ARROW){e.preventDefault();this.searchResultList.grid.moveSelection(e.keyCode===_8.UP_ARROW);}}));if(this.model.changeContextOnItemSelection){var _3e=function(){_35.edit.command.execute();};this.own(on(this.list,"itemAction",_3e),on(this.searchResultList,"itemAction",_3e));}if(this.showThumbnail){_5.add(this.list.grid.domNode,"epi-thumbnailContentList");_5.add(this.searchResultList.grid.domNode,"epi-thumbnailContentList");}this.list.set("selectionMode","extended");this.searchResultList.set("selectionMode","extended");this.searchResultList.set("noDataMessage",this.noSearchResultMessage);this._handleListKeyEvents();},_handleListKeyEvents:function(){var _3f=this.model._commandRegistry,_40=this.list;this.own(on(_40,"copyOrCut",function copyOrCuthandler(_41){_41?_3f.copy.command.execute():_3f.cut.command.execute();}),on(_40,"paste",function(){this.tree.focus();_3f.paste.command.execute();}.bind(this)),on(_40,"delete",function(){_3f["delete"].command.execute();}));},_onCreateAreaClick:function(){},_updateClipboardIndicators:function(_42,_43,_44){var _45=this.model.clipboardManager.isCopy();if(_43 instanceof Array){_1.forEach(_43,function(_46){this.tree.toggleCut(_46.data,false);this.list.toggleCut(_46.data,false);this.searchResultList.toggleCut(_46.data,false);},this);}if(!_45&&_44 instanceof Array){_1.forEach(_44,function(_47){this.tree.toggleCut(_47.data,true);this.list.toggleCut(_47.data,true);this.searchResultList.toggleCut(_47.data,true);},this);}}});});